/*
 * Copyright (2000) Sandia Corporation. Under the terms of Contract
 * DE-AC04-94AL85000 with Sandia Corporation, the U.S. Government retains
 * certain rights in this software.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *   * Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *
 *   * Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the
 *     distribution.
 *
 *   * Neither the name of Sandia nor the names of any contributors may
 *     be used to endorse or promote products derived from this software
 *     without specific prior written permission.
 *
 *   * Modified source versions must be plainly marked as such, and must
 *     not be misrepresented as being the original software.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
 * DAMAGE.
 */

/**
 * \file checkfile2io.c
 * \brief Unit tests for \ref FileIO Module using external data.
 * 
 * $Source: /usr/local/Repositories/fcdmf/fclib/unittest/checkfileio2.c,v $
 * $Revision: 1.23 $
 * $Date: 2006/11/24 22:27:26 $
 *
 * \todo FIX? it seems possible to write a generic "check the dataset" function
 *    to which you just pass a pointer to some structure stuffed full of the
 *    data. Probably too much work to make completely general.
 *    But right now have 2 copies of the same code in the two lsdyna reader
 *    check--only the data varies. If end up copying that code again, should
 *    think about a generic function. WSD - 11/17/2005.
 *
 * \modifications
 *    - 11/15/2005 WSD. Created.
 */

#include <stdlib.h>
#include <string.h>
#include <check.h>
#include "fc.h"
#include "fcP.h"
#include "checkall.h"

// ***** Fixtures for the rest of the file io tests

static void fileio_setup(void) 
{
  FC_ReturnCode rc;
  
  if (isForking) {
    fc_setLibraryVerbosity(fc_messages);
    rc = fc_initLibrary();
    fail_unless(rc == FC_SUCCESS, "test aborted: failed to init library");
  }
}

static void fileio_teardown(void) 
{
  FC_ReturnCode rc;
  
  if (isForking) {
    rc = fc_finalLibrary();
    fail_unless(rc == FC_SUCCESS, "failed to final library at end of test");
  }
}

// **** exodus read

// FCLIB_DATA_DIR is sent in at compile time with a -D
static char oldexofile[100] = "../" FCLIB_DATA_DIR "/exodusData/cancrush/can.ex2";

// Read a really old Exodus file generated by something other than FCLib
// to make sure we are backwards compatible.
// NOTE: float numbers were generated with %.17g so that there were
// extra digits past the significant digits so that FC_FLT_EQUIV worked.
START_TEST(oldoldexo)
{
  int i, j, k, m, n;
  int midID = 2;
  int numSeq = 1, numGlbVar = 0, numGlbSeqVar = 6, numMesh = 2;
  int numVar = 1, numSeqVar = 10;
  int numWholeVar = 0, numVertVar = 9; //numElemVar = 1;
  int temp_num, *temp_numStepPerSeqVar;
  FC_ReturnCode rc;
  FC_Dataset dataset;
  FC_Sequence* sequences;
  FC_Mesh* meshes;
  FC_Subset* subsets;
  FC_Variable *glbVars, **glbSeqVars, *vars, **seqVars;
  char* dataset_file_name = oldexofile; 
  char dataset_name[1024] = " self contact test problem";
  char* temp_name;
  char sequence_name[1024] = "time";
  int numStep = 44;
  FC_DataType dataType = FC_DT_DOUBLE;
  double seqCoords[3] = { 0, 0.00019990510190837085, 0.004299988504499197 };
  FC_DataType temp_dataType;
  double* temp_seqCoords;
  char meshNames[2][1024] = { "block_1",
                              "block_2" };  
  int topodim = 3, numDim = 3, numVertPerElem;
  int numVertPerMesh[2] = { 6724, 3364 };
  int numElemPerMesh[2] = { 4800, 2352 };
  FC_ElementType elemType = FC_ET_HEX;
  // index by mesh case, vertex case, then dim
  double coords[3][3][3] = {
    //mesh0 - verts 0, 2, & 6723
    { { 5.1999998092651367, 0, 0 },
      { 5.1999998092651367, 0, -0.74999994039535522 },
      { -5, 0, -14.999999046325684 } },
    //mesh1 - verts 0, 2, & 3363
    { { -7.8784618377685547, 0, 2.3160855770111084 },
      { -7.5890483856201172, 0, 3.9574317932128906 },
      { 8.3125820159912109, 8, 1.9997341632843018 } } };
  //index by mesh case, then elem case, then numVertPerElem
  int conns[3][3][8] = {
    //mesh0 - elems 0, 2, 4799
    { { 1, 42, 1723, 1682, 0, 41, 1722, 1681 },
      { 3, 44, 1725, 1684, 2, 43, 1724, 1683 },
      { 5001, 5042, 6723, 6682, 5000, 5041, 6722, 6681 } },
    //mesh1 - elems 0, 2, 2351
    { { 1, 5, 121, 117, 0, 4, 120, 116 },
      { 3, 7, 123, 119, 2, 6, 122, 118 },
      { 3243, 3247, 3363, 3359, 3242, 3246, 3362, 3358 } } };
  int temp_topodim, temp_numDim, temp_numVert, temp_numElem;
  FC_ElementType temp_elemType;
  int *temp_conns;
  double* temp_coords;
  char glbSeqVarNames[6][1024] = { "KE",
                                   "XMOM",
                                   "YMOM",
                                   "ZMOM",
                                   "NSTEPS",
                                   "TMSTEP" };
  int numCompPerGlbSeqVar[6] = { 1, 1, 1, 1, 1, 1 };
  // index by numvar, then by time case, then by dim
  double global_data[6][3][1] = {
    { { 2959999.75 }, { 2911410.25 }, { 1467643.625 } },
    { { 0 }, { -0.0081744026392698288 }, { -0.048639591783285141 } },
    { { 0 }, { -0.001355688669718802 }, { -5.8409209251403809 } },
    { { -1183.9998779296875 }, { -1178.4620361328125 }, { -765.4190673828125 } },
    { { 0 }, { 809 }, { 28318 } },
    { { 2.4712693402761943e-07 }, { 2.4709487433938193e-07 }, { 5.5783235808348763e-08 } } };
  int numSubsetPerMesh[2] = { 3, 1 };
  // index by mesh, then subset
  char subsetNames[2][3][1024] = {
    { "nodeset_1", "nodeset_100", "sideset_4" },
    { "nodeset_1" } };
  // index by mesh, then subset
  int numMemberPerSubset[2][3] = { { 328, 164, 120 },
                                   { 116 } };
  // index by mesh, then subset
  int maxNumMemberPerSubset[2][3] = { { 6724, 6724, 16240 },
                                      { 3364 } };
  // index by mesh, then subset
  FC_AssociationType assocPerSubset[2][3] = { 
    { FC_AT_VERTEX, FC_AT_VERTEX, FC_AT_FACE },
    { FC_AT_VERTEX } };
  // index by mesh, then subset, then member case
  int memberIDs[2][3][3] = {
    //mesh0
    { { 0, 2, 6723 }, { 40, 122, 6723 }, { 5, 366, 16122 } },
    //mesh1
    { { 0, 2, 3251 } } };
  int temp_numMember, temp_maxNumMember, *temp_memberIDs;
  char varNames[1][1024] = { "ID" };
  // index by mesh, then var, then vert/elem case
  int whole_data_non_seq[2] = { 1, 2 };
  // (global IDs var data)
  /*int globalIDs[12][2][3] = {
    { { 1, 6, 156080 }, { 1, 6, 113876 } },
    { { 215415, 215420, 282668 }, { 218627, 218632, 218734 } },
    { { 209890, 210027, 282588 }, { 190239, 190244, 218626 } },
    { { 209889, 209900, 253556 }, { 164199, 164204, 190238 } },
    { { 209889, 209894, 215414 }, { 161743, 161748, 164198 } },
    { { 205417, 205422, 208586 }, { 159210, 159215, 161142 } },
    { { 156081, 156086, 205416 }, { 113877, 113882, 159209 } },
    { { 208587, 208592, 209888 }, { 161143, 161148, 161742 } },
    { { 288195, 288200, 355448 }, { 275619, 275624, 275726 } },
    { { 282670, 282807, 355368 }, { 247231, 247236, 275618 } },
    { { 282669, 282680, 326336 }, { 221191, 221196, 247230 } },
    { { 282669, 282674, 288194 }, { 218735, 218740, 221190 } } };
  */
  char seqVarNames[10][1024] = { "DISPLX",
                                 "DISPLY",
                                 "DISPLZ",
                                 "VELX",
                                 "VELY",
                                 "VELZ",
                                 "ACCLX",
                                 "ACCLY",
                                 "ACCLZ",
                                 "EQPS" };
  int numCompPerSeqVar[10] = { 1, 1, 1, 1, 1, 1 ,1, 1, 1, 1 };
  // index by mesh case, then numWholeVar, then by time case, then dim
  double whole_data[3][6][4][3] = {  };
  // index by mesh case, then numVertVar, then time case, then entity case
  // and finally by dim
  double vert_data[3][9][3][3][3] = {
    { //mesh0
      //seqVar0
      { { { 0 },
          { 0 },
          { 0 } },
        { { -0.25766152143478394 },
          { -0.072616413235664368 },
          { -0.00017220656445715576 } },
        { { -6.7651410102844238 },
          { -6.4051728248596191 },
          { -2.0501153469085693 } } },
      //seqVar1
      { { { 0 },
          { 0 },
          { 0 } },
        { { -0.33865350484848022 },
          { -0.27198565006256104 },
          { -0.0048898546956479549 } },
        { { -3.5821719169616699 },
          { -3.5079376697540283 },
          { -3.3039648532867432 } } },
      //seqVar2
      { { { 0 },
          { 0 },
          { 0 } },
        { { -0.8949320912361145 },
          { -0.47312483191490173 },
          { 0 } },
        { { -13.843609809875488 },
          { -12.983407020568848 },
          { 0 } } },
      //seqVar3
      { { { 0 },
          { 0 },
          { 0 } },
        { { -3865.595703125 },
          { -1738.8505859375 },
          { -2.7970654964447021 } },
        { { -2937.789794921875 },
          { -2956.769775390625 },
          { -3060.3603515625 } } },
      //seqVar4
      { { { 0 },
          { 0 },
          { 0 } },
        { { -1373.2373046875 },
          { -1427.1458740234375 },
          { -21.133554458618164 } },
        { { -1896.3304443359375 },
          { -1871.5765380859375 },
          { -1715.9552001953125 } } },
      //seqVar5
      { { { 0 },
          { 0 },
          { 0 } },
        { { -3882.672607421875 },
          { -3009.54736328125 },
          { 0 } },
        { { 2575.714599609375 },
          { 2623.302734375 },
          { 0 } } },
      //seqVar6
      { { { 0 },
          { 0 },
          { 0 } },
        { { -12617310 },
          { -12543222 },
          { -22665.548828125 } },
        { { 2018813.75 },
          { 2612584.75 },
          { -1578497 } } },
      //seqVar7
      { { { 0 },
          { 0 },
          { 0 } },
        { { -5923986 },
          { 3330627.75 },
          { -798482.1875 } },
        { { 7276788.5 },
          { 7281741.5 },
          { -1595007.125 } } },
      //seqVar8
      { { { 0 },
          { 0 },
          { 0 } },
        { { -45693244 },
          { -840747.25 },
          { 0 } },
        { { 8702140 },
          { 6048872.5 },
          { 0 } } } },
    { //mesh1
      //seqVar0
      { { { 0 },
          { 0 },
          { 0 } },
        { { 0.00068953703157603741 },
          { -0.00081049569416791201 },
          { -0.00019026297377422452 } },
        { { 0.80871790647506714 },
          { 0.6971595287322998 },
          { 0.37523630261421204 } } },
      //seqVar1
      { { { 0 },
          { 0 },
          { 0 } },
        { { 2.851736826414708e-05 },
          { 4.8221983888652176e-05 },
          { 0.0030200823675841093 } },
        { { 0.15274769067764282 },
          { 0.88734418153762817 },
          { 0.39466142654418945 } } },
      //seqVar2
      { { { 0 },
          { 0 },
          { 0 } },
        { { -1.0017846822738647 },
          { -1.0015072822570801 },
          { -0.99949616193771362 } },
        { { -16.230049133300781 },
          { -16.391754150390625 },
          { -19.093179702758789 } } },
      //seqVar3
      { { { 0 },
          { 0 },
          { 0 } },
        { { 14.823398590087891 },
          { 3.8141951560974121 },
          { 6.2554311752319336 } },
        { { 443.28363037109375 },
          { 399.88925170898438 },
          { 102.68535614013672 } } },
      //seqVar4
      { { { 0 },
          { 0 },
          { 0 } },
        { { -17.570152282714844 },
          { 1.8811159133911133 },
          { 8.1974382400512695 } },
        { { 565.59954833984375 },
          { 1112.8055419921875 },
          { -12.666584968566895 } } },
      //seqVar5
      { { { -5000 },
          { -5000 },
          { -5000 } },
        { { -4998.923828125 },
          { -4997.64306640625 },
          { -4933.17138671875 } },
        { { -1566.1199951171875 },
          { -1840.981201171875 },
          { -4747.08984375 } } },
      //seqVar6
      { { { 9.3358138997245987e-08 },
          { 8.3287844176993531e-08 },
          { 0 } },
        { { 653893 },
          { -429953.96875 },
          { 330598.9375 } },
        { { -975510.6875 },
          { -58754.7890625 },
          { 620185.625 } } },
      //seqVar7
      { { { 1.6914539457957289e-07 },
          { 1.6914543721213704e-07 },
          { 0 } },
        { { -274085.15625 },
          { 659531.6875 },
          { -42205.9453125 } },
        { { 728266.9375 },
          { -599290.1875 },
          { -2247693.5 } } },
      //seqVar8
      { { { 4.2425785551358786e-08 },
          { -1.4685898719335455e-08 },
          { -1.3286064131534658e-05 } },
        { { 1020800.1875 },
          { 1177436.125 },
          { -1091528.375 } },
        { { -1683550 },
          { -1916286.625 },
          { 9805.5205078125 } } } } };
  // index by mesh case, then numElemVar, then time case
  // then entity case
  double elem_data[3][1][3][3] = {
    { //mesh0
      //seqVar9
      { { 0, 0, 0 },
        { 0.9243086576461792, 0.42012575268745422, 0 },
        { 0.92615300416946411, 0.45941245555877686, 0.066919349133968353 } } },
    { //mesh1
      //seqVar9
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0.0050492295995354652, 0, 0 } } } };
  int temp_numComp;
  FC_AssociationType temp_assoc;
  FC_MathType temp_mathType;
  double* temp_data;
  int* temp_int_data;

  // *** Test load dataset

  rc = fc_loadDataset(dataset_file_name, &dataset);
  fail_unless(rc == FC_SUCCESS, "failed to load dataset");

  // *** Test dataset

  rc = fc_getDatasetName(dataset, &temp_name);
  fail_unless(rc == FC_SUCCESS, "failed to get dataset name");
  fail_unless(!strcmp(temp_name, dataset_name), 
	      "mismatch of dataset name");
  free(temp_name);
 
  // *** Test sequences

  rc = fc_getSequences(dataset, &temp_num, &sequences);
  fail_unless(rc == FC_SUCCESS, "failed to get sequences");
  fail_unless(temp_num == numSeq, "mismatch of numSequence");
  for (i = 0; i < numSeq; i++) {

    // test sequence meta data
    rc = fc_getSequenceName(sequences[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence name");
    fail_unless(!strcmp(temp_name, sequence_name), 
		"mismatch of sequence name");
    free(temp_name);
    rc = fc_getSequenceInfo(sequences[i], &temp_num, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence info");
    fail_unless(temp_num == numStep, "mismatch of numStep");
    fail_unless(temp_dataType == dataType, 
		"mismatch of sequence dataType");

    // test sequence big data
    rc = fc_getSequenceCoordsPtr(sequences[i], (void**)&temp_seqCoords);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence coords");
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
	timeID = midID;
      else if (j == 2)
	timeID = numStep-1;
      fail_unless(FC_FLT_EQUIV(seqCoords[j], temp_seqCoords[timeID]),
		  "mismatch of seq coords");
    }
  }
  free(sequences);
 
  // *** Test global vars

  rc = fc_getGlobalVariables(dataset, &temp_num, &glbVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global vars");
  fail_unless(temp_num == numGlbVar, "mismatch of numGlbVar");

  // *** Test global seq vars
  
  rc = fc_getGlobalSeqVariables(dataset, &temp_num, 
                                &temp_numStepPerSeqVar, &glbSeqVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global seq vars");
  fail_unless(temp_num == numGlbSeqVar, "mismatch of numGlbSeqVar");
  for (i = 0; i < numGlbSeqVar; i++) {

    // test glb seq variable meta data
    rc = fc_getVariableName(glbSeqVars[i][0], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable name");
    fail_unless(!strcmp(temp_name, glbSeqVarNames[i]), 
                "mismatch of glb seq variable name");
    free(temp_name);
    fail_unless(temp_numStepPerSeqVar[i] == numStep, 
                "mismatch of numStepPerSeqVar");
    rc = fc_getVariableInfo(glbSeqVars[i][0], &temp_num, &temp_numComp,
                            &temp_assoc, &temp_mathType, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable info");
    fail_unless(temp_numComp == numCompPerGlbSeqVar[i], "mismatch of numComp");
    fail_unless(temp_num == 1, "mismatch of numDataPoint");
    fail_unless(temp_assoc == FC_AT_WHOLE_DATASET, "mismatch of assoc");
    if (temp_numComp == 3)
      fail_unless(temp_mathType == FC_MT_VECTOR, 
                  "mismatch of glb seq var mathType");
    else
      fail_unless(temp_mathType == FC_MT_SCALAR, 
                  "mismatch of glb seq var mathType");
    fail_unless(temp_dataType == dataType, "mismatch of glb seq var dataType");
    
    // test glb seq variable big data
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
        timeID = midID;
      else if (j == 2)
        timeID = numStep-1;
      rc = fc_getVariableDataPtr(glbSeqVars[i][timeID], (void**)&temp_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < temp_numComp; k++)        
        fail_unless(FC_FLT_EQUIV(temp_data[k], global_data[i][j][k]),
                    "mismatch of global data");
    }
    
    // done with this glb seq variable
    fc_deleteSeqVariable(temp_numStepPerSeqVar[i], glbSeqVars[i]);
    free(glbSeqVars[i]);
  }
  free(temp_numStepPerSeqVar);
  free(glbSeqVars);

  // *** Test meshes

  rc = fc_getMeshes(dataset, &temp_num, &meshes);
  fail_unless(rc == FC_SUCCESS, "failed to get meshes");
  fail_unless(temp_num == numMesh, "mismatch of numMesh");
  for (i = 0; i < numMesh; i++) {
    int meshLU = -1;
    if (i == 0)
      meshLU = 0;
    else if (i == midID)
      meshLU = 1;
    else if (i == numMesh-1)
      meshLU = 1;

    // test mesh meta data
    rc = fc_getMeshName(meshes[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh name");
    fail_unless(!strcmp(temp_name, meshNames[i]), "mismatch of mesh name");
    free(temp_name);
    rc = fc_getMeshInfo(meshes[i], &temp_topodim, &temp_numDim,
			&temp_numVert, &temp_numElem, &temp_elemType);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh info");
    fail_unless(temp_topodim == topodim, "mismatch of topodim");
    fail_unless(temp_numDim == numDim, "mismatch of numDim");
    fail_unless(temp_numVert == numVertPerMesh[i], "mismatch of numVert");
    fail_unless(temp_numElem == numElemPerMesh[i], "mismatch of numElem");
    fail_unless(temp_elemType == elemType, "mismatch of elemType");

    // test mesh big data
    if (meshLU > -1) {
      rc = fc_getMeshCoordsPtr(meshes[i], &temp_coords);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh coords");
      rc = fc_getMeshElementConnsPtr(meshes[i], &temp_conns);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh elem conns");
      numVertPerElem = fc_getElementTypeNumVertex(temp_elemType);
      for (j = 0; j < 3; j++) { // do 1st entity, middle entity & last entity
	int vertID = 0;
	int elemID = 0;
	if (j == 1) {
	  vertID = midID;
	  elemID = midID;
	}
	else if (j == 2) {
	  vertID = numVertPerMesh[i]-1;
	  elemID = numElemPerMesh[i]-1;
	}
	for (k = 0; k < numDim; k++) 
          fail_unless(FC_FLT_EQUIV(temp_coords[vertID*numDim+k], 
                                   coords[meshLU][j][k]),
                      "mismatch of coords");
	fail_unless(!memcmp(&temp_conns[elemID*numVertPerElem], 
                            conns[meshLU][j], numVertPerElem*sizeof(int)),
                    "mismatch of conns");
      }
    }
    
    // *** Test subsets

    rc = fc_getSubsets(meshes[i], &temp_num, &subsets);
    fail_unless(rc == FC_SUCCESS, "failed to get subsets");
    fail_unless(temp_num == numSubsetPerMesh[i], "mismatch of numSubset");
    for (j = 0; j < numSubsetPerMesh[i]; j++) {
      
      // test subset meta data
      rc = fc_getSubsetName(subsets[j], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get subset name");
      fail_unless(!strcmp(temp_name, subsetNames[i][j]),
                  "mismatch of subset name");
      free(temp_name);
      rc = fc_getSubsetInfo(subsets[j], &temp_numMember, &temp_maxNumMember,
                            &temp_assoc);
      fail_unless(rc == FC_SUCCESS, "failed to get subset info");
      fail_unless(temp_numMember == numMemberPerSubset[i][j], 
                  "mismatch of numMember");
      fail_unless(temp_maxNumMember == maxNumMemberPerSubset[i][j],
                  "mismatch of maxNumMember");
      fail_unless(temp_assoc == assocPerSubset[i][j], "mismatch of assoc");
    
      // test subset big data
      rc = fc_getSubsetMembersAsArray(subsets[j], &temp_numMember,
                                      &temp_memberIDs);
      fail_unless(rc == FC_SUCCESS, "failed to get subset member IDs");
      for (k = 0; k < 3; k++) {
        int entityID = 0;
        if (k == 1)
          entityID = midID;
        else if (k == 2)
          entityID = temp_numMember - 1;
        fail_unless(memberIDs[i][j][k] == temp_memberIDs[entityID],
                    "member id mismatch");
      }
      free(temp_memberIDs);
    }
    free(subsets);

    // *** Test variables

    rc = fc_getVariables(meshes[i], &temp_num, &vars);
    fail_unless(rc == FC_SUCCESS, "failed to get variables");
    fail_unless(temp_num == numVar, "mismatch of numVar");
    for (j = 0; j < numVar; j++) {
      
      // test var meta data
      rc = fc_getVariableName(vars[j], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get variable name");
      fail_unless(!strcmp(temp_name, varNames[j]),
		  "mismatch of variable name");
      free(temp_name);
      rc = fc_getVariableInfo(vars[j], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");
      fail_unless(temp_numComp == 1, "mismatch of numComp");
      fail_unless(temp_num == 1, "mismatch of numDataPoint");
      fail_unless(temp_assoc == FC_AT_WHOLE_MESH, "mismatch of assoc");
      fail_unless(temp_dataType == FC_DT_INT, "mismatch of var dataType");

      // test variable big data
      rc = fc_getVariableDataPtr(vars[j], (void**)&temp_int_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      fail_unless(whole_data_non_seq[i] == temp_int_data[0],
                  "data mismatch");
    }
    free(vars);
  
    // *** Test seq variables

    rc = fc_getSeqVariables(meshes[i], &temp_num, &temp_numStepPerSeqVar, 
			    &seqVars);
    fail_unless(rc == FC_SUCCESS, "failed to get seq variables");
    fail_unless(temp_num == numSeqVar, "mismatch of numSeqVar");
    for (j = 0; j < numSeqVar; j++) {

      // test seq variable meta data
      rc = fc_getVariableName(seqVars[j][0], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable name");
      fail_unless(!strcmp(temp_name, seqVarNames[j]), 
		  "mismatch of seq variable name");
      free(temp_name);
      fail_unless(temp_numStepPerSeqVar[j] == numStep, 
		  "mismatch of numStepPerSeqVar");
      rc = fc_getVariableInfo(seqVars[j][0], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");
      fail_unless(temp_numComp == numCompPerSeqVar[j], "mismatch of numComp");
      if (j < numWholeVar) {
	fail_unless(temp_num == 1, "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_WHOLE_MESH, "mismatch of assoc");
      }
      else if (j < numWholeVar + numVertVar) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      if (temp_numComp == 3)
	fail_unless(temp_mathType == FC_MT_VECTOR, 
		    "mismatch of seq var mathType");
      else
	fail_unless(temp_mathType == FC_MT_SCALAR, 
		    "mismatch of seq var mathType");
      fail_unless(temp_dataType == dataType, "mismatch of seq var dataType");

      // test seq variable big data
      if (meshLU > -1) {
	for (k = 0; k < 3; k++) {
	  int varLU;
	  int timeID = 0;
	  if (k == 1)
	    timeID = midID;
	  else if (k == 2)
	    timeID = numStep-1;
	  rc = fc_getVariableDataPtr(seqVars[j][timeID], (void**)&temp_data);
	  fail_unless(rc == FC_SUCCESS, "failed to get variable data");
	  //printf("%d %d %d: temp = %g, known = %g\n", i, j, k,
	  //     temp_data[0], whole_data[meshLU][j][k]);
	  if (j < numWholeVar) {
            for (n = 0; n < temp_numComp; n++)
              fail_unless(FC_FLT_EQUIV(temp_data[n], whole_data[meshLU][j][k][n]),
			"mismatch of whole data");
          }
	  else {
	    for (m = 0; m < 3; m++) {
	      int entityID = 0;
	      if (m == 1)
		entityID = midID;
	      else if (m == 2)
		entityID = temp_num-1;
	      if (j < numWholeVar + numVertVar) {
		varLU = j - numWholeVar;
		for (n = 0; n < temp_numComp; n++)
		  fail_unless(FC_FLT_EQUIV(temp_data[entityID*temp_numComp+n],
					   vert_data[meshLU][varLU][k][m][n]),
			      "mismatch of vert data");
	      }
	      else {
		// FIX? if we ever have a non scalar elem data, this'll change
		varLU = j - numWholeVar - numVertVar;
		fail_unless(FC_FLT_EQUIV(temp_data[entityID],
					 elem_data[meshLU][varLU][k][m]),
			    "mismatch of elem data");
	      }
	    }
	  }
	}
      }

      // done with this seq variable
      fc_deleteSeqVariable(temp_numStepPerSeqVar[j], seqVars[j]);
      free(seqVars[j]);
    }
    free(temp_numStepPerSeqVar);
    free(seqVars);

    // done with this mesh
    fc_deleteMesh(meshes[i]);
  }
  free(meshes);

  // All done
  rc = fc_deleteDataset(dataset);
  fail_unless(rc == FC_SUCCESS, "failed to delete dataset at end of test");
}
END_TEST

// **** ls dyna read

// 1st & 2nd datasets. LD-Dyna files can come as big or little endian, and as 
//   4 or 8 bit words. We test two datasets: big endian/4 bit word and little 
//   endian/8 bit word. To be complete you'd also want to test the other two 
//   combos, but this should be sufficient.
// 2nd dataset also has multiple parts and tears
// 3rd dataset has a temperature field 
// 4th dataset has chunked elements (data for elements on a single part are
//   not listed consecutively -- instead there's a chunk of them, then
//   some elements of other parts, and then another chunk for this part, etc)
// 5th dataset has shells as well as hexes
// 6th dataset has shells and beams as well as hexes. Unfortunately, the vars
//   on the shells are all 0, so we're keeping the shell dataset to make
//   sure the vars are being read properly.

// FCLIB_DATA_DIR is sent in at compile time with a -D
static char be4b[100] = "../" FCLIB_DATA_DIR "/lsdynaData/can-crush/d3plot";
static char le8b[100] = "datalinks/run30-EMMI-screws/d3plot";
static char temperature[100] = "../" FCLIB_DATA_DIR "/lsdynaData/expanding_block/d3plot";
static char chunked[100] = "../" FCLIB_DATA_DIR "/lsdynaData/baseline/d3plot";
static char shells[100] = "../" FCLIB_DATA_DIR "/lsdynaData/withShells/d3plot";
static char multielemtype[100] = "../" FCLIB_DATA_DIR "/lsdynaData/ConvertTest/d3plot";

// Used sandbox/WSD/misc/partialdump.c to generate the data (after I knew
// that the lsdyna reader was working properly.

// We are confident of the given values.
// Test metadata on everything, test big data only on selection:
// 1st of that thing, middle thing of that thing, last of that thing..
// some of the middle things nest: e.g. only test big var data on
// meshes that we testing big data on.
// NOTE: float numbers were generated with %.17g so that there were
// extra digits past the significant digits so that FC_FLT_EQUIV worked.
START_TEST(lsdyna_bigendian_flt)
{
  int i, j, k, m, n;
  int bigMidID = 99;   // for the big collections of things
  int smallMidID = 5;   // for littler collections
  int numSeq = 1, numGlbVar = 0, numGlbSeqVar = 16, numMesh = 12;
  int numSubset = 0, numVar = 2, numSeqVar = 35;
  int numWholeVar = 4, numVertVar = 3; //numElemVar = 28;
  int temp_num, *temp_numStepPerSeqVar;
  FC_ReturnCode rc;
  FC_Dataset dataset;
  FC_Sequence* sequences;
  FC_Mesh* meshes;
  FC_Subset* subsets;
  FC_Variable *glbVars, **glbSeqVars, *vars, **seqVars;
  char* dataset_file_name = be4b; // big endian/4 bit word
  char dataset_name[1024] = "COARSE-MESH";
  char* temp_name;
  char sequence_name[1024] = "time";
  int numStep = 9;
  FC_DataType dataType = FC_DT_FLOAT;
  float seqCoords[3] = { 0, 0.0020565087, 0.0030000596 };
  FC_DataType temp_dataType;
  float* temp_seqCoords;
  char meshNames[12][1024] = { "Material_ID_1000",
			       "Material_ID_19",
			       "Material_ID_18",
			       "Material_ID_17",
			       "Material_ID_16",
			       "Material_ID_5",
			       "Material_ID_30",
			       "Material_ID_6",
			       "Material_ID_15",
			       "Material_ID_14",
			       "Material_ID_13",
			       "Material_ID_12" };
  int topodim = 3, numDim = 3, numVertPerElem;
  int numVertPerMesh[12] = { 156080, 216, 43548, 39984, 5526, 3170, 
			     49336, 1302, 216, 43548, 39984, 5526 };
  int numElemPerMesh[12] = {  113876, 108, 28388, 26040, 2456, 1933,
			      45333, 600, 108, 28388, 26040, 2456 };
  FC_ElementType elemType = FC_ET_HEX;
  // index by mesh case, vertex case, then dim
  double coords[3][3][3] = {
    //mesh0
    { { 27.58374, 30.637842, -55.066299 },
      { 6.9722013, -2.6258278, -80.648315 },
      { 28.807642, -44.508446, -19.174717 } },
    //mesh5
    { { 37.152214, -85.399429, -118.08385 },
      { 10.030272, 42.075848, -52.877518 },
      { -4.1224785, 29.296707, -72.225441 } },
    //mesh11
    { { 4.9517698, -20.720394, -94.111221 },
      { 6.2531195, -5.3984909, -84.862473 },
      { 4.6127472, -21.305172, -94.098297 } } };
  // index by mesh case, then element case, then by numVertPerElem
  int conns[3][3][8] = {
    //mesh0
    { { 145989, 145988, 147253, 147252, 144664, 144663, 145297, 145296 },
      { 147146, 147145, 147351, 147350, 144895, 144894, 145395, 145394 },
      { 144092, 143681, 144090, 144091, 142936, 142525, 142934, 142935 } },
    //mesh5
    { { 658, 657, 1502, 1501, 2, 3, 205, 204 },
      { 1362, 1363, 1590, 1589, 161, 162, 293, 292 },
      { 2329, 2330, 2404, 2403, 739, 740, 820, 819 } },
    //mesh11
    { { 1, 2, 8, 7, 137, 262, 2465, 876 },
      { 2488, 1875, 1646, 2182, 2489, 1876, 1645, 2183 },
      { 4, 8, 6, 3, 3858, 5525, 3025, 2773 } } };
  int temp_topodim, temp_numDim, temp_numVert, temp_numElem;
  FC_ElementType temp_elemType;
  int *temp_conns;
  double* temp_coords;
  char varNames[2][1024] = { "vert_IDs", "elem_IDs" };
  // index by mesh, then var, then vert/elem case
  // (global IDs is the var data)
  int globalIDs[12][2][3] = {
    { { 1, 6, 156080 }, { 1, 6, 113876 } },
    { { 215415, 215420, 282668 }, { 218627, 218632, 218734 } },
    { { 209890, 210027, 282588 }, { 190239, 190244, 218626 } },
    { { 209889, 209900, 253556 }, { 164199, 164204, 190238 } },
    { { 209889, 209894, 215414 }, { 161743, 161748, 164198 } },
    { { 205417, 205422, 208586 }, { 159210, 159215, 161142 } },
    { { 156081, 156086, 205416 }, { 113877, 113882, 159209 } },
    { { 208587, 208592, 209888 }, { 161143, 161148, 161742 } },
    { { 288195, 288200, 355448 }, { 275619, 275624, 275726 } },
    { { 282670, 282807, 355368 }, { 247231, 247236, 275618 } },
    { { 282669, 282680, 326336 }, { 221191, 221196, 247230 } },
    { { 282669, 282674, 288194 }, { 218735, 218740, 221190 } } };
  char glbSeqVarNames[16][1024] = { "global_KE",
                                    "global_IE",
                                    "global_TE",
                                    "global_velocity",
                                    "global_work",
                                    "force_on_rw_1",
                                    "force_on_rw_2",
                                    "force_on_rw_3",
                                    "force_on_rw_4",
                                    "force_on_rw_5",
                                    "force_on_rw_6",
                                    "force_on_rw_7",
                                    "force_on_rw_8",
                                    "force_on_rw_9",
                                    "force_on_rw_10",
                                    "force_on_rw_11" };
  int numCompPerGlbSeqVar[16] = { 1, 1, 1, 3, 1, 1, 1, 1, 1, 1,
                                  1, 1, 1, 1, 1, 1 };
  // index by numvar, then by time case, then by dim
  float global_data[16][3][3] = { 
    { { 0 }, { 51688.977 }, { 49671.965 } },
    { { 9.9999997e-21 }, { 1657385.1 }, { 2682572.5 } },
    { { 9.9999997e-21 }, { 1709074.1 }, { 2732244.5 } },
    { { 0, 0, 0 }, 
      { 22.361012, -4805.3276, -47.19849 }, 
      { 33.036293, -4615.2319, -94.87793 } },
    { { 0 }, { 1156636.5 }, { 1940765.5 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } } };
  char seqVarNames[35][1024] = { "mat_IE",
                                 "mat_KE",
                                 "mat_velocity",
                                 "mass",
                                 "displacement",
                                 "velocity",
                                 "acceleration",
                                 "sigma-xx",
                                 "sigma-yy",
                                 "sigma-zz",
                                 "sigma-xy",
                                 "sigma-yz",
                                 "sigma-zx",
                                 "plastic_strain",
                                 "elem_var_1",
                                 "elem_var_2",
                                 "elem_var_3",
                                 "elem_var_4",
                                 "elem_var_5",
                                 "elem_var_6",
                                 "elem_var_7",
                                 "elem_var_8",
                                 "elem_var_9",
                                 "elem_var_10",
                                 "elem_var_11",
                                 "elem_var_12",
                                 "elem_var_13",
                                 "elem_var_14",
                                 "elem_var_15",
                                 "elem_var_16",
                                 "elem_var_17",
                                 "elem_var_18",
                                 "elem_var_19",
                                 "elem_var_20",
                                 "elem_death" };
  int numCompPerSeqVar[35] = { 1, 1, 3, 1, 3, 3, 3, 1, 1, 1,
                               1, 1, 1, 1, 1, 1 ,1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1 ,1, 1, 1, 1,
                               1, 1, 1, 1, 1 };
  // index by mesh case, then numWholeVar, then by time case, then dim
  float whole_data[3][6][4][3] = {     
    //mesh0
    { { { 0 }, { 570.37268 }, { 730.60742 } },
      { { 0 }, { 12.432962 }, { 9.7183237 } },
      { { 0, 0, 0 },
        { -8841.9775, -8.420126, -281.75861 },
        { -7960.7324, -89.87162, -1473.2108 } },
      { { 3.4955909e-07 }, { 3.4955909e-07 }, { 3.4955909e-07 } } }, 
    //mesh5
    { { { 0 }, { 0 }, { 0 } },
      { { 0 }, { 0 }, { 0 } },
      { { 0, 0, 0 },
        { -9922.3428, -177.37772, 0 },
        { -10002.35, -295.36734, 0 } },
      { { 0.00048188126 }, { 0.00048188126 }, { 0.00048188126 } } },
    //mesh11
    { { { 0 }, { 16285.454 }, { 14596.959 } },
      { { 0 }, { -89.935822 }, { -82.487526 } },
      { { 0, 0, 0.00036007413 },
        { -10084.092, -92.660645, 0.00036007413 },
        { -9987.3721, -224.64195, 0.00036007413 } },
      { { 0 }, { 0 }, { 0 } } } };
  // index by mesh case, then numVertVar, then time case, then entity case
  // and finally by dim
  float vert_data[3][3][3][3][3] = {
    { //mesh0
      //seqVar24
      { { { -1.9073486e-06, -1.9073486e-06, 3.8146973e-06 },
	  { 0, 0, 0 },
	  { 0, 0, -1.9073486e-06 } },
	{ { 0.62839699, -20.521191, -0.34423065 },
	  { 0.48674011, -20.433207, -0.23488617 },
	  { -1.0847855, -20.299217, -0.86257744 } },
	{ { 0.93697548, -29.934429, -0.5581131 },
	  { 0.71344042, -29.850384, -0.35954285 },
	  { -1.4166031, -29.53717, -1.4171333 } } },
      //seqVar25
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 507.77423, -9763.2744, -295.55029 },
	  { 110.979, -9743.1182, 134.83623 },
	  { -866.60754, -9175.7617, -1011.0042 } },
	{ { 657.87946, -9814.5352, -711.28693 },
	  { 445.92691, -9871.0459, -436.90363 },
	  { 183.90578, -9692.0605, -969.75714 } } },
      //seqVar26
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 6.5681645e+08, 8.6150138e+08, -9.0543635e+08 },
	  { -3.4215824e+08, -11515770, -1.4032339e+09 },
	  { 6.1479232e+08, -98651968, -58599016 } },
	{ { -2.9858666e+08, -71258872, 2.6825365e+08 },
	  { -4.8953136e+08, -2.1311264e+08, 6.1796954e+08 },
	  { -1.8039651e+08, -78698048, -1.5270941e+08 } } } },
    { //mesh5
      //seqVar24
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 0.056987762, -20.576988, -0.17639923 },
	  { 0.64023113, -20.557556, -0.19729614 },
	  { 0.49704099, -20.56572, -0.074073792 } },
	{ { 0.17922592, -29.996941, -0.3825531 },
	  { 0.94307804, -29.993275, -0.33397675 },
	  { 0.74343443, -30.001226, -0.16578674 } } },
      //seqVar25
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { -799.68335, -9935.7207, -1036.651 },
	  { 415.28107, -9051.7217, -1158.759 },
	  { -86.28965, -9990.875, 442.16492 } },
	{ { 238.81912, -10637.809, -261.3266 },
	  { 662.66364, -9175.6035, -1023.7848 },
	  { 635.90198, -9990.875, -493.29553 } } },
      //seqVar26
      { { { -0, -0, -0 },
	  { 0, 0, 0 },
	  { 0, -3.1746035e+11, 0 } },
	{ { 6.1898662e+08, 2.681188e+08, -5.4476749e+08 },
	  { -3.9206397e+08, -4.4841219e+08, 1.1089972e+09 },
	  { -3.7020576e+08, -4.8056179e+08, 46883460 } },
	{ { 3.8326781e+08, -1.8786382e+08, 5.947049e+08 },
	  { 1.4716133e+08, 1.0761193e+09, -1.1767173e+08 },
	  { -3.3928429e+08, 4.8056179e+08, -3.5089997e+08 } } } },
    { //mesh11
      //seqVar24
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 0.33833265, -20.441994, -0.15910339 },
	  { 0.44170284, -20.424404, -0.23265839 },
	  { 0.33824158, -20.443378, -0.14944458 } },
	{ { 0.51027203, -29.895393, -0.22612762 },
	  { 0.65261793, -29.85516, -0.34385681 },
	  { 0.50859976, -29.895912, -0.21574402 } } },
      //seqVar25
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 218.17416, -10336.657, 468.07462 },
	  { 208.40149, -9768.2979, -881.54114 },
	  { -167.53772, -10298.715, 363.01544 } },
	{ { 443.94989, -9853.3535, 95.828682 },
	  { 419.58743, -10066.956, -142.8978 },
	  { 510.20441, -9795.123, 135.68974 } } },
      //seqVar26
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { -9.8237677e+08, 1.0711939e+09, -3.2086842e+08 },
	  { -1.094385e+09, 1.1315999e+09, 5.2446883e+08 },
	  { 8.1930093e+08, 3.9078298e+08, 2.7980259e+08 } },
	{ { -6.0776378e+08, 13161507, 1.3144408e+08 },
	  { -3.2627517e+08, 2.7031027e+08, -6.1174272e+08 },
	  { -3.399737e+08, 43223292, 66557348 } } } } };
  // index by mesh case, then numElemVar, then time case, then entity case
  float elem_data[3][28][3][3] = {
    { //mesh0
      //seqVar27
      { { 0, 0, 0 },
	{ 67.317116, 1102.7207, -260.01358 },
	{ -22.13028, 1128.9644, -732.08691 } },
      //seqVar28
      { { 0, 0, 0 },
	{ -100.58246, 1172.8938, -471.96964 },
	{ -113.05128, 1284.9244, 26.671978 } },
      //seqVar29
      { { 0, 0, 0 },
	{ 226.57695, 599.05804, 109.29796 },
	{ 97.916611, 649.03076, -24.684084 } },
      //seqVar30
      { { 0, 0, 0 },
	{ 80.736504, 548.0509, 521.76111 },
	{ 74.021362, 588.81946, 422.62494 } },
      //seqVar31
      { { 0, 0, 0 },
	{ -14.065974, -128.8979, -221.56978 },
	{ 13.209818, -135.84572, -343.99042 } },
      //seqVar32
      { { 0, 0, 0 },
	{ 111.09915, -198.85796, 168.23064 },
	{ 135.44189, -214.65965, 108.06888 } },
      //seqVar33
      { { 0, 0, 0 },
	{ 0.0016300472, 0.18971534, 0.091767378 },
	{ 0.0016300472, 0.22234799, 0.13564894 } },
      //seqVar34
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar35
      { { 2.8025969e-45, 2.8025969e-45, 2.8025969e-45 },
	{ 2.8025969e-45, 1.2611686e-44, 1.2611686e-44 },
	{ 2.8025969e-45, 1.2611686e-44, 1.2611686e-44 } },
      //seqVar36
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar37
      { { 28730.307, 28730.307, 28730.307 },
	{ 28730.307, 1499.9998, 1499.9998 },
	{ 28730.307, 1499.9998, 1499.9998 } },
      //seqVar38
      { { 676.95831, 676.95831, 676.95831 },
	{ 723.79004, 1291.573, 1144.6511 },
	{ 723.79004, 1340.522, 1210.4734 } },
      //seqVar39
      { { 0, 0, 0 },
	{ -41.293686, 666.06006, 174.966 },
	{ -104.42929, 695.80292, 242.5229 } },
      //seqVar40
      { { 0, 0, 0 },
	{ 151.37775, -53.54446, 4.7022214 },
	{ 163.14571, -92.625923, 106.42822 } },
      //seqVar41
      { { 0, 0, 0 },
	{ 16.89333, 787.64136, 88.935211 },
	{ 92.69146, 875.58948, 181.46394 } },
      //seqVar42
      { { 0, 0, 0 },
	{ 32.552025, 104.60704, -39.541218 },
	{ 39.156265, 257.12787, -10.774384 } },
      //seqVar43
      { { 0, 0, 0 },
	{ -20.528431, 235.65836, -83.466759 },
	{ -40.595768, 174.3195, 98.074249 } },
      //seqVar44
      { { 0, 0, 0 },
	{ 42.061569, -369.09412, -12.968647 },
	{ -1.3967688, -424.59134, 39.71384 } },
      //seqVar45
      { { 0, 0, -0 },
	{ 0, 0.17407368, -0.00051162555 },
	{ 0, 0.20169578, -0.0010103144 } },
      //seqVar46
      { { 0, 0, 0 },
	{ 0, 0, 187.81471 },
	{ 0, 0, 233.77718 } },
      //seqVar47
      { { 2.8025969e-45, 2.8025969e-45, 0 },
	{ 2.8025969e-45, 1.2611686e-44, 11.581635 },
	{ 2.8025969e-45, 1.2611686e-44, 70.777 } },
      //seqVar48
      { { 0, 0, 0 },
	{ 0, 0, 62.677975 },
	{ 0, 0, 106.97042 } },
      //seqVar49
      { { 28730.307, 28730.307, 0 },
	{ 28730.307, 1499.9998, -8.2307596 },
	{ 28730.307, 1499.9998, 9.1335039 } },
      //seqVar50
      { { 676.95831, 676.95831, 0 },
	{ 676.95831, 1268.1105, -34.550152 },
	{ 676.95831, 1309.5437, 73.156219 } },
      //seqVar51
      { { 0, 0, 0 },
	{ -101.87326, -299.69687, 16.607988 },
	{ -183.13454, -344.87842, 49.902725 } },
      //seqVar52
      { { 0, 0, -0 },
	{ 39.477684, -643.38623, -0.00049918913 },
	{ 19.211155, -751.84912, -0.00078385643 } },
      //seqVar53
      { { 0, 0, 0 },
	{ 63.878407, 283.69986, 153.20201 },
	{ 19.91754, 244.42986, 176.53783 } },
      //seqVar54
      { { 1, 1, 1 },
	{ 1, 1, 1 },
	{ 1, 1, 1 } } },
    { //mesh5
      //seqVar27
      { { 0, 0, 0 },
	{ 174.966, -42.757164, -11.928251 },
	{ 242.5229, -5.1515288, -3.6386998 } },
      //seqVar28
      { { 0, 0, 0 },
	{ 4.7022214, -3.8919623, -119.76709 },
	{ 106.42822, 14.043173, -173.93712 } },
      //seqVar29
      { { 0, 0, 0 },
	{ 88.935211, -13.475048, -44.09108 },
	{ 181.46394, 4.1609325, -42.243336 } },
      //seqVar30
      { { 0, 0, 0 },
	{ -39.541218, -5.1644144, 66.783264 },
	{ -10.774384, -9.984313, 85.585938 } },
      //seqVar31
      { { 0, 0, 0 },
	{ -83.466759, -6.394649, 9.4593048 },
	{ 98.074249, 2.9184473, -18.303253 } },
      //seqVar32
      { { 0, 0, 0 },
	{ -12.968647, -16.70241, 46.897781 },
	{ 39.71384, -14.264699, 72.934303 } },
      //seqVar33
      { { -0, -0, -0 },
	{ -0.00051162555, 0.00011452223, 0.00033483125 },
	{ -0.0010103144, -2.4862051e-05, 0.00041870313 } },
      //seqVar34
      { { 0, 0, 0 },
	{ 187.81471, -14.567968, -1.7115252 },
	{ 233.77718, 11.103835, 0.087839365 } },
      //seqVar35
      { { 0, 0, 0 },
	{ 11.581635, 0.21343151, 0.34435201 },
	{ 70.777, 1.8123965, 0.35092285 } },
      //seqVar36
      { { 0, 0, 0 },
	{ 62.677975, -2.2118266, 3.1508954 },
	{ 106.97042, -0.64360118, -0.31178385 } },
      //seqVar37
      { { 0, 0, 0 },
	{ -8.2307596, -8.9906721, -0.83991355 },
	{ 9.1335039, -12.918511, 0.20336328 } },
      //seqVar38
      { { 0, 0, 0 },
	{ -34.550152, -1.5787044, -0.0064632241 },
	{ 73.156219, 0.25989416, 0.95857918 } },
      //seqVar39
      { { 0, 0, 0 },
	{ 16.607988, 4.6525145, 0.91060305 },
	{ 49.902725, -0.73770779, 0.83608454 } },
      //seqVar40
      { { -0, -0, -0 },
	{ -0.00049918913, 3.1554977e-05, -3.3975664e-06 },
	{ -0.00078385643, -2.3376439e-05, -2.4186357e-07 } },
      //seqVar41
      { { 0, 0, 0 },
	{ 153.20201, 28.16894, 0.78963071 },
	{ 176.53783, 18.502979, -0.40617058 } },
      //seqVar42
      { { 0, 0, 0 },
	{ 28.647013, 7.6819663, -0.055246331 },
	{ 68.12545, -2.7825098, 0.23238273 } },
      //seqVar43
      { { 0, 0, 0 },
	{ 59.839592, 6.9418273, 0.084171027 },
	{ 98.664597, 10.6569, 0.58657527 } },
      //seqVar44
      { { 0, 0, 0 },
	{ -20.557575, -1.6731498, -0.74011862 },
	{ -19.435234, -4.3963923, 0.47894514 } },
      //seqVar45
      { { 0, 0, 0 },
	{ -21.100677, -0.56953764, -3.1592526 },
	{ 42.732212, -3.45612, 0.79073739 } },
      //seqVar46
      { { 0, 0, 0 },
	{ 5.4254212, 7.4463348, 0.2515552 },
	{ 10.299412, 2.1429672, 0.46147507 } },
      //seqVar47
      { { -0, -0, -0 },
	{ -0.00046035924, -8.1509963e-05, -1.5591531e-06 },
	{ -0.00065395783, -5.0242605e-05, -7.8626186e-07 } },
      //seqVar48
      { { 0, 0, 0 },
	{ 73.750816, 24.3571, 0.64841342 },
	{ 26.947868, 21.968025, 0.12320306 } },
      //seqVar49
      { { 0, 0, 0 },
	{ 35.608074, 14.687378, 0.29570264 },
	{ 14.505287, -0.73735607, -0.53095061 } },
      //seqVar50
      { { 0, 0, 0 },
	{ 101.14954, 12.82548, -1.5756555 },
	{ 55.151119, 6.6575656, -0.53394002 } },
      //seqVar51
      { { 0, 0, 0 },
	{ -30.945642, -9.3347654, 0.64278716 },
	{ 3.0560088, -3.3315251, -0.51700747 } },
      //seqVar52
      { { 0, 0, 0 },
	{ -46.368721, 8.2327261, -0.99142867 },
	{ -4.1838317, -7.0934463, 0.92324442 } },
      //seqVar53
      { { 0, 0, 0 },
	{ -9.0955725, 8.2591562, 2.2737858 },
	{ 4.1778722, 4.6985669, -0.70777702 } },
      //seqVar54
      { { 6, 6, 6 },
	{ 6, 6, 6 },
	{ 6, 6, 6 } } },
    { //mesh11
      //seqVar27
      { { 0, 0, 0 },
	{ 79.588142, 97.307228, 78.450195 },
	{ -0.67804533, 150.12524, 138.32011 } },
      //seqVar28
      { { 0, 0, 0 },
	{ -45.788185, -20.29768, 1.5439963 },
	{ -74.516899, -28.664251, -61.133724 } },
      //seqVar29
      { { 0, 0, 0 },
	{ -23.714762, -3.1070681, -15.727501 },
	{ -20.662518, -18.442608, -16.761568 } },
      //seqVar30
      { { 0, 0, 0 },
	{ 0.083652258, 0.38512462, 6.3157783 },
	{ 20.097445, -7.2225804, -15.268409 } },
      //seqVar31
      { { 0, 0, 0 },
	{ 6.7728591, 14.530106, -34.400967 },
	{ 4.2408943, 51.870785, -5.0835967 } },
      //seqVar32
      { { 0, 0, 0 },
	{ 9.2072725, 14.860899, 15.917188 },
	{ -13.555946, 36.292503, 57.317287 } },
      //seqVar33
      { { 0, 0, 0 },
	{ 0.015540224, 0.036537569, 0.027994392 },
	{ 0.015540224, 0.036537569, 0.027994392 } },
      //seqVar34
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar35
      { { 2.8025969e-45, 2.8025969e-45, 2.8025969e-45 },
	{ 5.6051939e-45, 5.6051939e-45, 5.6051939e-45 },
	{ 5.6051939e-45, 5.6051939e-45, 5.6051939e-45 } },
      //seqVar36
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar37
      { { 3978.0767, 3978.0767, 3978.0767 },
	{ 2341.2876, 2341.2876, 2341.2876 },
	{ 2341.2876, 2341.2876, 2341.2876 } },
      //seqVar38
      { { 272.1886, 272.1886, 272.1886 },
	{ 335.65411, 384.81494, 364.8129 },
	{ 335.65411, 384.81494, 364.8129 } },
      //seqVar39
      { { 0, 0, 0 },
	{ -81.918076, 50.800354, 87.738762 },
	{ -12.33576, -14.923436, 21.997665 } },
      //seqVar40
      { { 0, 0, 0 },
	{ -140.00752, -60.086967, 9.8475132 },
	{ -133.03481, -65.86953, -30.617512 } },
      //seqVar41
      { { 0, 0, 0 },
	{ -33.273487, -37.414238, 20.904245 },
	{ -16.615372, -15.886244, 9.8221931 } },
      //seqVar42
      { { 0, 0, 0 },
	{ 56.510124, -5.7034521, -10.908169 },
	{ 36.689137, 14.82524, 13.812354 } },
      //seqVar43
      { { 0, 0, 0 },
	{ -61.280891, -14.749485, 17.176712 },
	{ -45.933613, -14.726443, 4.4008718 } },
      //seqVar44
      { { 0, 0, 0 },
	{ -39.438408, 6.3653684, 21.308748 },
	{ 15.744594, 6.3546896, 15.466904 } },
      //seqVar45
      { { 0, 0, 0 },
	{ 0.037620265, 0.013617945, 0.0012856645 },
	{ 0.037620265, 0.013617945, 0.0012856645 } },
      //seqVar46
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar47
      { { 2.8025969e-45, 2.8025969e-45, 2.8025969e-45 },
	{ 7.0064923e-45, 4.2038954e-45, 2.8025969e-45 },
	{ 7.0064923e-45, 4.2038954e-45, 2.8025969e-45 } },
      //seqVar48
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar49
      { { 3978.0767, 3978.0767, 3978.0767 },
	{ 2246.7766, 4613.3379, 3978.0767 },
	{ 2246.7766, 4613.3379, 3978.0767 } },
      //seqVar50
      { { 272.1886, 272.1886, 272.1886 },
	{ 387.31958, 327.80893, 277.30307 },
	{ 387.31958, 327.80893, 277.30307 } },
      //seqVar51
      { { 0, 0, 0 },
	{ 70.192833, -38.971592, 94.339996 },
	{ -50.70937, 15.666517, 33.63541 } },
      //seqVar52
      { { 0, 0, 0 },
	{ -41.799355, -40.627464, 18.408937 },
	{ -127.91299, -10.533428, -30.121529 } },
      //seqVar53
      { { 0, 0, 0 },
	{ 49.182381, -20.988573, 13.799879 },
	{ -67.165573, 14.71161, 4.1699491 } },
      //seqVar54
      { { 12, 12, 12 },
	{ 12, 12, 12 },
	{ 12, 12, 12 } } } };
  int temp_numComp;
  FC_AssociationType temp_assoc;
  FC_MathType temp_mathType;
  float* temp_data;
  int* temp_int_data;
 

  // *** Test load dataset

  rc = fc_loadDataset(dataset_file_name, &dataset);
  fail_unless(rc == FC_SUCCESS, "failed to load dataset");

  // *** Test dataset

  rc = fc_getDatasetName(dataset, &temp_name);
  fail_unless(rc == FC_SUCCESS, "failed to get dataset name");
  fail_unless(!strcmp(temp_name, dataset_name), 
	      "mismatch of dataset name");
  free(temp_name);

  // *** Test sequences

  rc = fc_getSequences(dataset, &temp_num, &sequences);
  fail_unless(rc == FC_SUCCESS, "failed to get sequences");
  fail_unless(temp_num == numSeq, "mismatch of numSequence");
  for (i = 0; i < numSeq; i++) {

    // test sequence meta data
    rc = fc_getSequenceName(sequences[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence name");
    fail_unless(!strcmp(temp_name, sequence_name), 
		"mismatch of sequence name");
    free(temp_name);
    rc = fc_getSequenceInfo(sequences[i], &temp_num, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence info");
    fail_unless(temp_num == numStep, "mismatch of numStep");
    fail_unless(temp_dataType == dataType, 
		"mismatch of sequence dataType");

    // test sequence big data
    rc = fc_getSequenceCoordsPtr(sequences[i], (void**)&temp_seqCoords);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence coords");
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
	timeID = smallMidID;
      else if (j == 2)
	timeID = numStep-1;
      fail_unless(FC_FLT_EQUIV(seqCoords[j], temp_seqCoords[timeID]),
		  "mismatch of seq coords");
    }
  }
  free(sequences);

  // *** Test global vars

  rc = fc_getGlobalVariables(dataset, &temp_num, &glbVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global vars");
  fail_unless(temp_num == numGlbVar, "mismatch of numGlbVar");

  // *** Test global seq vars
  
  rc = fc_getGlobalSeqVariables(dataset, &temp_num, 
                                &temp_numStepPerSeqVar, &glbSeqVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global seq vars");
  fail_unless(temp_num == numGlbSeqVar, "mismatch of numGlbSeqVar");
  for (i = 0; i < numGlbSeqVar; i++) {

    // test glb seq variable meta data
    rc = fc_getVariableName(glbSeqVars[i][0], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable name");
    fail_unless(!strcmp(temp_name, glbSeqVarNames[i]), 
                "mismatch of glb seq variable name");
    free(temp_name);
    fail_unless(temp_numStepPerSeqVar[i] == numStep, 
                "mismatch of numStepPerSeqVar");
    rc = fc_getVariableInfo(glbSeqVars[i][0], &temp_num, &temp_numComp,
                            &temp_assoc, &temp_mathType, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable info");
    fail_unless(temp_numComp == numCompPerGlbSeqVar[i], "mismatch of numComp");
    fail_unless(temp_num == 1, "mismatch of numDataPoint");
    fail_unless(temp_assoc == FC_AT_WHOLE_DATASET, "mismatch of assoc");
    if (temp_numComp == 3)
      fail_unless(temp_mathType == FC_MT_VECTOR, 
                  "mismatch of glb seq var mathType");
    else
      fail_unless(temp_mathType == FC_MT_SCALAR, 
                  "mismatch of glb seq var mathType");
    fail_unless(temp_dataType == dataType, "mismatch of glb seq var dataType");
    
    // test glb seq variable big data
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
        timeID = smallMidID;
      else if (j == 2)
        timeID = numStep-1;
      rc = fc_getVariableDataPtr(glbSeqVars[i][timeID], (void**)&temp_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < temp_numComp; k++)        
        fail_unless(FC_FLT_EQUIV(temp_data[k], global_data[i][j][k]),
                    "mismatch of global data");
    }
    
    // done with this glb seq variable
    fc_deleteSeqVariable(temp_numStepPerSeqVar[i], glbSeqVars[i]);
    free(glbSeqVars[i]);
  }
  free(temp_numStepPerSeqVar);
  free(glbSeqVars);

  // *** Test meshes

  rc = fc_getMeshes(dataset, &temp_num, &meshes);
  fail_unless(rc == FC_SUCCESS, "failed to get meshes");
  fail_unless(temp_num == numMesh, "mismatch of numMesh");
  for (i = 0; i < numMesh; i++) {
    int meshLU = -1;
    if (i == 0)
      meshLU = 0;
    else if (i == smallMidID)
      meshLU = 1;
    else if (i == numMesh-1)
      meshLU = 2;

    // test mesh meta data
    rc = fc_getMeshName(meshes[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh name");
    fail_unless(!strcmp(temp_name, meshNames[i]), "mismatch of mesh name");
    free(temp_name);
    rc = fc_getMeshInfo(meshes[i], &temp_topodim, &temp_numDim,
			&temp_numVert, &temp_numElem, &temp_elemType);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh info");
    fail_unless(temp_topodim == topodim, "mismatch of topodim");
    fail_unless(temp_numDim == numDim, "mismatch of numDim");
    fail_unless(temp_numVert == numVertPerMesh[i], "mismatch of numVert");
    fail_unless(temp_numElem == numElemPerMesh[i], "mismatch of numElem");
    fail_unless(temp_elemType == elemType, "mismatch of elemType");

    // test mesh big data
    if (meshLU > -1) {
      rc = fc_getMeshCoordsPtr(meshes[i], &temp_coords);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh coords");
      rc = fc_getMeshElementConnsPtr(meshes[i], &temp_conns);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh elem conns");
      numVertPerElem = fc_getElementTypeNumVertex(temp_elemType);
      for (j = 0; j < 3; j++) { // do 1st entity, middle entity & last entity
	int vertID = 0;
	int elemID = 0;
	if (j == 1) {
	  vertID = bigMidID;
	  elemID = bigMidID;
	}
	else if (j == 2) {
	  vertID = numVertPerMesh[i]-1;
	  elemID = numElemPerMesh[i]-1;
	}
	for (k = 0; k < numDim; k++) 
	  fail_unless(FC_FLT_EQUIV(temp_coords[vertID*numDim+k], 
				   coords[meshLU][j][k]),
		      "mismatch of coords");
	fail_unless(!memcmp(&temp_conns[elemID*numVertPerElem], 
			    conns[meshLU][j], numVertPerElem*sizeof(int)),
		    "mismatch of conns");
      }
    }

    // *** Test subsets

    rc = fc_getSubsets(meshes[i], &temp_num, &subsets);
    fail_unless(rc == FC_SUCCESS, "failed to get subsets");
    fail_unless(temp_num == numSubset, "mismatch of numSubset");

    // *** Test variables

    rc = fc_getVariables(meshes[i], &temp_num, &vars);
    fail_unless(rc == FC_SUCCESS, "failed to get variables");
    fail_unless(temp_num == numVar, "mismatch of numVar");
    for (j = 0; j < numVar; j++) {
      
      // test var meta data
      rc = fc_getVariableName(vars[j], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get variable name");
      fail_unless(!strcmp(temp_name, varNames[j]),
		  "mismatch of variable name");
      free(temp_name);
      rc = fc_getVariableInfo(vars[j], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");
      fail_unless(temp_numComp == 1, "mismatch of numComp");
      if (j == 0) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      fail_unless(temp_mathType == FC_MT_SCALAR, "mismatch of var mathType");
      fail_unless(temp_dataType == FC_DT_INT, "mismatch of var dataType");

      // test variable big data
      rc = fc_getVariableDataPtr(vars[j], (void**)&temp_int_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < 3; k++) {
	int entityID = 0;
	if (k == 1)
	  entityID = smallMidID;
	else if (k == 2)
	  entityID = temp_num - 1;
	fail_unless(globalIDs[i][j][k] == temp_int_data[entityID],
		    "data mismatch");
      }
    }
    free(vars);

    // *** Test seq variables

    rc = fc_getSeqVariables(meshes[i], &temp_num, &temp_numStepPerSeqVar, 
			    &seqVars);
    fail_unless(rc == FC_SUCCESS, "failed to get seq variables");
    fail_unless(temp_num == numSeqVar, "mismatch of numSeqVar");
    for (j = 0; j < numSeqVar; j++) {

      // test seq variable meta data
      rc = fc_getVariableName(seqVars[j][0], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable name");
      fail_unless(!strcmp(temp_name, seqVarNames[j]), 
		  "mismatch of seq variable name");
      free(temp_name);
      fail_unless(temp_numStepPerSeqVar[j] == numStep, 
		  "mismatch of numStepPerSeqVar");
      rc = fc_getVariableInfo(seqVars[j][0], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");
      fail_unless(temp_numComp == numCompPerSeqVar[j], "mismatch of numComp");
      if (j < numWholeVar) {
	fail_unless(temp_num == 1, "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_WHOLE_MESH, "mismatch of assoc");
      }
      else if (j < numWholeVar + numVertVar) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      if (temp_numComp == 3)
	fail_unless(temp_mathType == FC_MT_VECTOR, 
		    "mismatch of seq var mathType");
      else
	fail_unless(temp_mathType == FC_MT_SCALAR, 
		    "mismatch of seq var mathType");
      fail_unless(temp_dataType == dataType, "mismatch of seq var dataType");

      // test seq variable big data
      if (meshLU > -1) {
	for (k = 0; k < 3; k++) {
	  int varLU;
	  int timeID = 0;
	  if (k == 1)
	    timeID = smallMidID;
	  else if (k == 2)
	    timeID = numStep-1;
	  rc = fc_getVariableDataPtr(seqVars[j][timeID], (void**)&temp_data);
	  fail_unless(rc == FC_SUCCESS, "failed to get variable data");
	  //printf("%d %d %d: temp = %g, known = %g\n", i, j, k,
	  //     temp_data[0], whole_data[meshLU][j][k]);
	  if (j < numWholeVar) {
            for (n = 0; n < temp_numComp; n++)
              fail_unless(FC_FLT_EQUIV(temp_data[n], whole_data[meshLU][j][k][n]),
			"mismatch of whole data");
          }
	  else {
	    for (m = 0; m < 3; m++) {
	      int entityID = 0;
	      if (m == 1)
		entityID = bigMidID;
	      else if (m == 2)
		entityID = temp_num-1;
	      if (j < numWholeVar + numVertVar) {
		varLU = j - numWholeVar;
		for (n = 0; n < temp_numComp; n++)
		  fail_unless(FC_FLT_EQUIV(temp_data[entityID*temp_numComp+n],
					   vert_data[meshLU][varLU][k][m][n]),
			      "mismatch of vert data");
	      }
	      else {
		// FIX? if we ever have a non scalar elem data, this'll change
		varLU = j - numWholeVar - numVertVar;
		fail_unless(FC_FLT_EQUIV(temp_data[entityID],
					 elem_data[meshLU][varLU][k][m]),
			    "mismatch of elem data");
	      }
	    }
	  }
	}
      }

      // done with this seq variable
      fc_deleteSeqVariable(temp_numStepPerSeqVar[j], seqVars[j]);
      free(seqVars[j]);
    }
    free(temp_numStepPerSeqVar);
    free(seqVars);

    // done with this mesh
    fc_deleteMesh(meshes[i]);
  }
  free(meshes);

  // All done
  rc = fc_deleteDataset(dataset);
  fail_unless(rc == FC_SUCCESS, "failed to delete dataset at end of test");
}
END_TEST

// We are confident of the given values.
// Test metadata on everything, test big data only on selection:
// 1st of that thing, middle thing of that thing, last of that thing..
// some of the middle things nest: e.g. only test big var data on
// meshes that we testing big data on.
// NOTE: double numbers were generated with %.17g so that there were
// extra digits past the significant digits so that FC_DBL_EQUIV worked.
START_TEST(lsdyna_littleendian_dbl)
{
  int i, j, k, m, n;
  int midID = 2;
  int numSeq = 1, numGlbVar = 0, numGlbSeqVar = 20, numMesh = 16;
  int numSubset = 0, numVar = 2, numSeqVar = 41;
  int numWholeVar = 4, numVertVar = 3; //numElemVar = 34
  int temp_num, *temp_numStepPerSeqVar;
  FC_ReturnCode rc;
  FC_Dataset dataset;
  FC_Sequence* sequences;
  FC_Mesh* meshes;
  FC_Subset* subsets;
  FC_Variable *glbVars, **glbSeqVars, *vars, **seqVars;
  char* dataset_file_name = le8b; // little endian/8 bit word
  char dataset_name[1024] = "EMMI CAN RUN RUN30-EMMI, FACTOR=0.9, DNUC1=11, FRICTION=0.4, 1/2 WELD, O";
  char* temp_name;
  char sequence_name[1024] = "time";
  int numStep = 8;
  FC_DataType dataType = FC_DT_DOUBLE;
  double seqCoords[3] = { 0, 0.00099994500000018618, 0.0030000375000011582 };
  FC_DataType temp_dataType;
  double* temp_seqCoords;
  char meshNames[16][1024] = { "Material_ID_10",
			       "Material_ID_20",
			       "Material_ID_1000",
			       "Material_ID_25",
			       "Material_ID_34",
			       "Material_ID_3",
			       "Material_ID_1",
			       "Material_ID_5",
			       "Material_ID_32",
			       "Material_ID_6",
			       "Material_ID_50",
			       "Material_ID_4",
			       "Material_ID_49",
			       "Material_ID_29",
			       "Material_ID_31",
			       "Material_ID_33" };
  int topodim = 3, numDim = 3, numVertPerElem;
  int numVertPerMesh[16] = { 11418, 11330, 156080, 866, 53152, 53152,
			      53152, 3170,  26864,  1302, 49336,
			     3157,  300, 7368, 7368, 7368 };
  int numElemPerMesh[16] = { 9639, 9555, 113876, 616, 25932, 25932, 
			     25932, 1933, 22336, 600, 45333,
			     1741, 171, 2456, 2456, 2456 };
  FC_ElementType elemType = FC_ET_HEX;
  // index by mesh case, vertex case, then dim
  double coords[3][3][3] = {
    //mesh0 - verts 0, 2, & 11417
    { { 29.525986, 5.1979410000000001, -69.153099999999995 },
      { 31.856767999999999, 6.9753949999999998, -67.405739999999994 },
      { 24.852986999999999, -71.488979999999998, -78.437325000000001 } },
    //mesh2 - verts 0, 2, & 156079
    { { 27.583739999999999, 30.637841999999999, -55.066299999999998 },
      { 27.105785000000001, 30.689436000000001, -55.18439 },
      { 28.807642000000001, -44.508445999999999, -19.174717000000001 } },
    //mesh15 - verts 0, 2, & 7367
    { { -12.906775, -54.044499999999999, -36.391390000000001 },
      { -12.902570000000001, -54.909264, -36.889397000000002 },
      { 46.577385, 9.8867419999999999, -61.170459999999999 } } };
  // index by mesh case, then element case, then by numVertPerElem
  int conns[3][3][8] = {
    //mesh0 - elems 0, 2, 9638
    { { 3010, 3009, 3043, 3042, 131, 130, 164, 163 },
      { 3009, 3008, 3046, 3045, 130, 129, 167, 166 },
      { 11031, 11030, 11062, 11061, 10630, 10629, 10661, 10660 } },
    //mesh2 - elems 0, 2, 113875
    { { 145989, 145988, 147253, 147252, 144664, 144663, 145297, 145296 },
      { 145987, 145986, 147255, 147254, 144662, 144661, 145299, 145298 },
      { 144092, 143681, 144090, 144091, 142936, 142525, 142934, 142935 } },
    //mesh15 - elems 0, 2, 2455
    { { 2456, 2459, 2458, 2457, 3684, 3687, 3686, 3685 },
      { 2462, 2463, 2459, 2456, 3690, 3691, 3687, 3684 },
      { 6001, 1602, 1601, 4916, 7229, 2216, 2215, 6144 } } };
  int temp_topodim, temp_numDim, temp_numVert, temp_numElem;
  FC_ElementType temp_elemType;
  int *temp_conns;
  double* temp_coords;
  char varNames[2][1024] = { "vert_IDs", "elem_IDs" };
  // index by mesh, then var, then vert/elem case
  // (global IDs is the var data)
  int globalIDs[16][2][3] = {
    { { 1, 3, 11418 }, { 1, 3, 9639 } },
    { { 11419, 11421, 22748 }, { 9640, 9642, 19194 } },
    { { 22749, 22751, 178828 }, { 19195, 19197, 133070 } },
    { { 186458, 186460, 187323 }, { 137345, 137347, 137960 } },
    { { 290100, 290102, 369827 }, { 257494, 257496, 283425 } },
    { { 276812, 276814, 356539 }, { 231562, 231564, 257493 } },
    { { 263524, 263526, 343251 }, { 205630, 205632, 231561 } },
    { { 178829, 178831, 181998 }, { 133071, 133073, 135003 } },
    { { 236660, 236662, 263523 }, { 183294, 183296, 205629 } },
    { { 181999, 182001, 183300 }, { 135004, 135006, 135603 } },
    { { 187324, 187326, 236659 }, { 137961, 137963, 183293 } },
    { { 183301, 183303, 186457 }, { 135604, 135606, 137344 } },
    { { 369828, 369830, 370127 }, { 283426, 283428, 283596 } },
    { { 263524, 263526, 377495 }, { 283597, 283599, 286052 } },
    { { 277791, 277794, 378723 }, { 286053, 286055, 288508 } },
    { { 291079, 291082, 379951 }, { 288509, 288511, 290964 } } };
  char glbSeqVarNames[20][1024] = { "global_KE",
                                    "global_IE",
                                    "global_TE",
                                    "global_velocity",
                                    "global_work",
                                    "force_on_rw_1",
                                    "force_on_rw_2",
                                    "force_on_rw_3",
                                    "force_on_rw_4",
                                    "force_on_rw_5",
                                    "force_on_rw_6",
                                    "force_on_rw_7",
                                    "force_on_rw_8",
                                    "force_on_rw_9",
                                    "force_on_rw_10",
                                    "force_on_rw_11",
                                    "force_on_rw_12",
                                    "force_on_rw_13",
                                    "force_on_rw_14",
                                    "force_on_rw_15" };
  int numCompPerGlbSeqVar[20] = { 1, 1, 1, 3, 1, 1, 1, 1, 1, 1,
                                  1, 1, 1, 1, 1, 1, 1, 1, 1, 1 };
  // index by numvar, then by time case, then by dim
double global_data[20][3][3] = {
  { { 0 }, { 85853.933026903571 }, { 89678.340041577932 } },
  { { 7.9999999999999996e-20 }, { 623778.89568102895 }, { 2821355.3833895475 } },
  { { 7.9999999999999996e-20 }, { 709632.82870793238 }, { 2911033.7234311253 } },
  { { 0, 0, 0 },
    { 85.668858490187219, -7297.836114927235, -1815.184243758142 },
    { 881.93802905091172, -6640.9984527798561, -2571.9489953915927 } },
  { { 0 }, { 423.55025891951323 }, { 3195.1138780704177 } },
  { { 0 }, { 5.6685140887440211 }, { 652.48568677156982 } },
  { { 0 }, { 37718.013919566969 }, { 100358.14627600649 } },
  { { 0 }, { 34.567175690218917 }, { 393.32043531499721 } },
  { { 0 }, { 16313.842254431231 }, { 87724.144491921732 } },
  { { 0 }, { 1978.3966388214881 }, { 13528.448184770363 } },
  { { 0 }, { 2359.4128426922298 }, { 18656.650272097635 } },
  { { 0 }, { 161.35355302272157 }, { 942.42517724479819 } },
  { { 0 }, { 102.52048917062589 }, { 2070.664189324084 } },
  { { 0 }, { 36.910280221898816 }, { 35.00118497436064 } },
  { { 0 }, { 88.974279074237074 }, { 679.30685748017561 } },
  { { 0 }, { 23.927756281694247 }, { 435.29058772175426 } },
  { { 0 }, { 0.56266410691523283 }, { 3.1034458393154947 } },
  { { 0 }, { 594.1246450222252 }, { 1803.4122995724642 } },
  { { 0 }, { 786.95532432653442 }, { 1572.978672618116 } },
  { { 0 }, { 692.5165249955154 }, { 3361.4545420425466 } } };
  char seqVarNames[41][1024] = { "mat_IE",
				 "mat_KE",
				 "mat_velocity",
				 "mass",
				 "displacement",
				 "velocity",
				 "acceleration",
				 "sigma-xx",
				 "sigma-yy",
				 "sigma-zz",
				 "sigma-xy",
				 "sigma-yz",
				 "sigma-zx",
				 "plastic_strain",
				 "elem_var_1",
				 "elem_var_2",
				 "elem_var_3",
				 "elem_var_4",
				 "elem_var_5",
				 "elem_var_6",
				 "elem_var_7",
				 "elem_var_8",
				 "elem_var_9",
				 "elem_var_10",
				 "elem_var_11",
				 "elem_var_12",
				 "elem_var_13",
				 "elem_var_14",
				 "elem_var_15",
				 "elem_var_16",
				 "elem_var_17",
				 "elem_var_18",
				 "elem_var_19",
				 "elem_var_20",
                                 "elem_var_21",
                                 "elem_var_22",
                                 "elem_var_23",
                                 "elem_var_24",
                                 "elem_var_25",
                                 "elem_var_26",				 
                                 "elem_death" };
  int numCompPerSeqVar[41] = { 1, 1, 3, 1, 3, 3, 3, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1 };
  // index by mesh case, then numWholeVar, then by time case, then dim
  double whole_data[3][4][3][3] = {
    //mesh0
    { { { 0 }, { 115.43568640493453 }, { 9819.2527537645146 } },
      { { 0 }, { 10753.724625945795 }, { 2410.3042655816093 } },
      { { 0, 0, 0 },
        { -10582.118931989291, -2944.9033989560103, -336.64672597041584 },
        { -9838.4382683922395, -4254.1529029523799, 3270.1650634108491 } },
      { { 0.00023630086706371317 }, { 0.00023630086706371317 }, { 0.00023630086706371317 } } },
    //mesh2
    { { { 0 }, { 792.8044693667016 }, { 4247.7469344298779 } },
      { { 0 }, { 138.10206503391632 }, { 234.36318546600975 } },
      { { 0, 0, 0 },
        { -9557.2180043343687, -2212.1399017222657, -647.46687708600086 },
        { -8236.1492801704226, -3267.4902679719939, -537.48488363435456 } },
      { { 2.7513095271258638e-06 }, { 2.7513095271258638e-06 }, { 2.6274584733661044e-06 } } },
    //mesh15
    { { { 0 }, { 14457.494785089639 }, { 13782.976014111888 } },
      { { 0 }, { 519.65640481280354 }, { 776.39728024726799 } },
      { { 0, 0, 0.00023630085279373889 },
        { -9205.114754697468, -2088.0689010960664, 0.00023630085279373889 },
        { -8414.2062703157844, -3355.5432466355419, 0.00023630085279373889 } },
      { { 0 }, { 4.5464271056825405 }, { 85.399943857030451 } } } };
  // index by mesh case, then numVertVar, then time case, then entity case
  // and finally by dim
  double vert_data[3][3][3][3][3] = {
    { //mesh0
      //seqVar4
      { { { -0.00058682300895895878, 0.0006022225782089663, -0.0008318504760183032 },
          { 0.00013837704711860965, -0.00064268556533164656, -0.00032822840793755859 },
          { 0, 0, 0 } },
        { { 0.506968332830116, -7.4283313963903668, -0.43910204591772128 },
          { 0.50917359370830795, -7.4287667922330778, -0.44153563333819079 },
          { 0.10105849718660309, -7.471183547646234, 0.1817113774717285 } },
        { { -0.53686059745045256, -26.702714104086688, -8.595670084865688 },
          { -0.48550827993630463, -26.706741914002304, -8.6602408199766074 },
          { -0.97044345993001713, -26.633989811165918, -8.433929355531248 } } },
      //seqVar5
      { { { 0, 0, 0 },
          { 0, 0, 0 },
          { 0, 0, 0 } },
        { { 773.10776838670745, -10716.480738071281, -2883.7533459863116 },
          { 763.82519957383147, -10959.746635387026, -2229.9698067703594 },
          { 1451.0772971478711, -11106.004325939761, -4841.820071374209 } },
        { { 1533.2205338166223, -9639.9476981241969, -4360.3824552058213 },
          { 1270.997461852791, -9736.8172701146777, -4050.9413251872925 },
          { 450.09171974195226, -9346.0165440293513, -3804.6283056787684 } } },
      //seqVar6
      { { { 0, 0, 0 },
          { 0, 0, 0 },
          { 0, 0, 0 } },
        { { 326687186.48696929, 381978003.45049119, 411480987.99426252 },
          { -477690138.63716513, 818304100.48519611, 267764471.86614659 },
          { 743846217.68952417, -881766498.86238587, 61069415.662260741 } },
        { { 936343058.8468281, 99911252.764796048, -912483324.93434048 },
          { 718222709.52050817, 474942155.38649189, -543187727.52788126 },
          { -988456023.78889954, -586194230.82339692, -333112936.65726399 } } } },
    { //mesh2
      //seqVar4
      { { { -8.6518149089442886e-08, 1.1603852101416123e-08, -2.0099314212984609e-08 },
          { 0, 0, 0 },
          { -3.8772689716637387e-05, -7.2365412925989858e-05, 0.00012522928096814212 } },
        { { 0.48869445941620882, -9.8648908078523441, -1.9148387469196777 },
          { 0.49208507270294177, -9.8645474520018048, -1.9148790174738153 },
          { -0.26385147725553892, -9.3963968549203045, -1.7893783156231642 } },
        { { 0.11557935175230583, -29.859065447777596, -10.310497807745278 },
          { 0.11746299784125114, -29.859975237398281, -10.295997716168337 },
          { -1.4511613155346872, -28.508548212027669, -10.223126763519268 } } },
      //seqVar5
      { { { 0, 0, 0 },
          { 0, 0, 0 },
          { 0, 0, 0 } },
        { { -253.95911191028398, -9718.5037525239295, -2580.7588086129076 },
          { 638.38321401278415, -9725.2831958709303, -1439.6591190569059 },
          { -1361.9279524119454, -10399.015035679515, -2869.0972707059927 } },
        { { 1983.4615645748963, -7779.5108241013741, -3484.2562321893083 },
          { 508.56297269522554, -11849.561524058568, -5621.9215232650067 },
          { 2299.6313894450618, -8933.0514293358719, -5230.1286390866408 } } },
      //seqVar6
      { { { 0, 0, 0 },
          { 0, 0, 0 },
          { 0, 0, 0 } },
        { { -4347709012.0888033, 447972799.18991721, -6560373739.6364326 },
          { -10006546194.617302, -4464430738.6215811, -16629301390.44742 },
          { 1074303774.9416084, -770131537.427966, 281709665.76715785 } },
        { { 3356114792.0456219, 14976640357.564245, 283397236.85028291 },
          { -8932133129.5043602, 7218954033.9927473, 848295471.92795956 },
          { -1052505136.8678221, -310834084.69637322, -30171350.051158369 } } } },
    { //mesh15
      //seqVar4
      { { { 0, 0, 0 },
          { 0, 0, 0 },
          { 0, 0, 0 } },
        { { -0.29128556950213991, -9.1953156111648156, -1.8791591986155964 },
          { -0.2952965893014543, -9.1952250854817734, -1.8786263820175719 },
          { 0.49756741059677267, -9.6930232794510669, -1.7198196467085154 } },
        { { -2.4204913968341764, -27.582633536473722, -8.4248064054147989 },
          { -2.4591007154936886, -27.589406346742869, -8.4107628171325928 },
          { -0.097992259706714435, -29.307217342147254, -10.307319409352395 } } },
      //seqVar5
      { { { 0, 0, 0 },
          { 0, 0, 0 },
          { 0, 0, 0 } },
        { { -605.94043380406538, -9657.5493711066756, -2787.7591514259152 },
          { -737.61763798437312, -9912.1668244294615, -2892.4610436323287 },
          { 1323.2643171870807, -10469.250534491963, -1205.8108691653174 } },
        { { 123.20264032453512, -8842.9904790376186, -2153.1143190803323 },
          { 103.3652408496803, -8635.9816111237615, -2069.2901277890851 },
          { 2114.1608000005785, -9360.0811967625123, -5574.6730115809405 } } },
      //seqVar6
      { { { 0, 0, 0 },
          { 0, 0, 0 },
          { 0, 0, 0 } },
        { { 111392699.56917647, 190826212.95803183, 977666842.4825083 },
          { 384912257.48771721, 1109054599.1047909, -394990431.95774925 },
          { -2944732203.1220579, 3177626177.4288139, 246260576.57547641 } },
        { { -238676900.39630628, 1806320418.0788333, -260488937.00337225 },
          { -851752634.39157963, -828373451.59041142, 42681451.481165566 },
          { -1810268518.395772, -1710438485.4045331, -484872094.18803126 } } } } };
  // index by mesh case, then numElemVar, then time case, then entity case
  double elem_data[3][34][3][3] = {
    { //mesh0
      //seqVar7
      { { 0, 0, 0 },
        { -4.9063649300116792, -1.2083396104493318, 3.0344454104602478 },
        { 11.089154620767756, 13.993660774628104, 2.4623822570813778 } },
      //seqVar8
      { { 0, 0, 0 },
        { -0.24598783133992091, 4.0472474876406812, -0.72266641559155387 },
        { 37.405566899557137, 45.234930992602671, 66.784233133507442 } },
      //seqVar9
      { { 0, 0, 0 },
        { -0.71610777612764143, -0.11954804970847777, 4.482512431547347 },
        { 11.563199648412185, 13.213961092092569, 54.148061837457561 } },
      //seqVar10
      { { 0, 0, 0 },
        { 3.9027381916780763, 2.8268878013741325, 0.92752865161372389 },
        { 3.116671331490791, -0.93763667411637952, -18.177881612464898 } },
      //seqVar11
      { { 0, 0, 0 },
        { 0.75987009914665926, 1.0824921023853473, -2.0373933086364295 },
        { 21.474150555145236, 22.062574267646582, 39.9844142129107 } },
      //seqVar12
      { { 0, 0, 0 },
        { 0.20311177276113596, 1.273119401285572, 2.2313790033244385 },
        { 4.7182170274991835, -1.3532866310640388, 7.1380964158181834 } },
      //seqVar13
      { { 0, 0, 0 },
        { 2.8503951182039353e-05, -1.3208319162058025e-05, -3.3000844071160225e-05 },
        { -0.00029170990281955091, -0.00035186382817382097, -0.00059934557510759364 } },
      //seqVar14
      { { 0, 0, 0 },
        { -0.57617632108472572, -2.7063615329538946, 1.8437346974536757 },
        { 15.530111878386458, 13.453696644407007, 39.295663169673126 } },
      //seqVar15
      { { 0, 0, 0 },
        { -0.27991781810935401, 3.8838304366491085, -2.3274328776228859 },
        { 49.798907967065318, 51.618951574703914, -88.623101206504728 } },
      //seqVar16
      { { 0, 0, 0 },
        { -1.4485190099605465, 1.4656500531256358, -1.6360543253333935 },
        { 16.87672207187854, 22.486937513780767, -150.08626581056384 } },
      //seqVar17
      { { 0, 0, 0 },
        { 1.1275253657559132, 0.35822449440707826, 1.0706332446337938 },
        { -1.7771738440955109, -1.4691799322586974, -43.70315917865495 } },
      //seqVar18
      { { 0, 0, 0 },
        { 1.0510291870331785, 3.2875844584939431, 0.6778720978347661 },
        { 17.297478623147367, 27.20780883108344, 88.202077826432784 } },
      //seqVar19
      { { 0, 0, 0 },
        { 1.4432348755645881, -0.44028487066740019, -4.8010143851647058 },
        { 5.5508411639090154, 3.0442747163380033, 71.75072592598616 } },
      //seqVar20
      { { 0, 0, 0 },
        { 1.1193835295893081e-05, -1.2838006361699934e-05, 1.0295940741011638e-05 },
        { -0.00039928503216984977, -0.00042528941641685995, 0.0009685808472586811 } },
      //seqVar21
      { { 0, 0, 0 },
        { -1.2083396104493318, -1.9715803971297838, 2.9391509563770759 },
        { 13.993660774628104, -1.8753794109598849, 25.161835805180658 } },
      //seqVar22
      { { 0, 0, 0 },
        { 4.0472474876406812, 3.1190027616119727, -0.92475748830973881 },
        { 45.234930992602671, 43.196871766302394, -105.30891050466437 } },
      //seqVar23
      { { 0, 0, 0 },
        { -0.11954804970847777, 0.66240351823087285, -0.45342242609556505 },
        { 13.213961092092569, 9.4952480523455627, -159.95820461041009 } },
      //seqVar24
      { { 0, 0, 0 },
        { 2.8268878013741325, 0.75685994048034555, 1.2503676007206304 },
        { -0.93763667411637952, 15.067056678045311, -56.853238145229319 } },
      //seqVar25
      { { 0, 0, 0 },
        { 1.0824921023853473, 2.230235132699145, 0.96235214759631804 },
        { 22.062574267646582, 38.691325508519164, 111.82299096329845 } },
      //seqVar26
      { { 0, 0, 0 },
        { 1.273119401285572, -0.96344762589718069, -3.9289350579303477 },
        { -1.3532866310640388, -6.6962695054438495, 86.89342629548193 } },
      //seqVar27
      { { 0, 0, 0 },
        { -1.3208319162058025e-05, -8.7905828588912638e-06, -7.5818593467193757e-06 },
        { -0.00035186382817382097, -0.00024682416769446019, 0.0011662256423622245 } },
      //seqVar28
      { { 0, 0, 0 },
        { -2.7063615329538946, -3.4180740496253157, 3.6900773376915859 },
        { 13.453696644407007, -19.806591920812753, 17.117341066015463 } },
      //seqVar29
      { { 0, 0, 0 },
        { 3.8838304366491085, 1.9050878493331798, -3.1780843828374015 },
        { 51.618951574703914, 17.513356857400112, -95.326927514403351 } },
      //seqVar30
      { { 0, 0, 0 },
        { 1.4656500531256358, 0.6175651073341698, -0.68273764246454061 },
        { 22.486937513780767, -4.3907400926495956, -160.32712363138197 } },
      //seqVar31
      { { 0, 0, 0 },
        { 0.35822449440707826, 2.1655229093624522, 0.72975562398199223 },
        { -1.4691799322586974, 19.194640992781409, -28.574503603835492 } },
      //seqVar32
      { { 0, 0, 0 },
        { 3.2875844584939431, 0.065944501979581488, 0.30772696463537297 },
        { 27.20780883108344, 42.155575152193528, 98.795304928570161 } },
      //seqVar33
      { { 0, 0, 0 },
        { -0.44028487066740019, 0.21655814154014616, -3.7955258689968496 },
        { 3.0442747163380033, -7.6286225872497093, 39.256367511416364 } },
      //seqVar34
      { { 0, 0, 0 },
        { -6.5555333993531133e-05, -3.5778291785244169e-05, 2.5624231788497671e-05 },
        { -7.2436262000895177e-05, -7.5635337333177847e-05, -0.00053493250119059717 } },
      //seqVar35
      { { 0, 0, 0 },
        { 2.299183088122795e-05, 6.4077863078467449e-05, -4.5760892906487954e-05 },
        { 0.00042757557129608989, 0.00051794879680835905, 0.00068718266546155689 } },
      //seqVar36
      { { 0, 0, 0 },
        { 1.4059551930264069e-05, -1.5091252131165625e-05, 5.3137505189149875e-05 },
        { -6.3429406475649328e-05, -9.0449631301356325e-05, 0.00044709541083660714 } },
      //seqVar37
      { { 0, 0, 0 },
        { 7.4152025641882244e-05, 5.3710868226106812e-05, 1.762304438066111e-05 },
        { 5.9216755298327405e-05, -1.7815096808212391e-05, -0.00034537975063683881 } },
      //seqVar38
      { { 0, 0, 0 },
        { 1.4437531883786158e-05, 2.0567349945324601e-05, -3.8710472864090224e-05 },
        { 0.00040800886054777059, 0.00041918891108528873, 0.00075970387004533149 } },
      //seqVar39
      { { 0, 0, 0 },
        { 3.8591236824616958e-06, 2.4189268624426568e-05, 4.2396201063164245e-05 },
        { 8.9646123522483612e-05, -2.5712445990215411e-05, 0.00013562383190054823 } },
      //seqVar40
      { { 1, 1, 1 },
        { 1, 1, 1 },
        { 1, 1, 1 } } },
    { //mesh2
      //seqVar7
      { { 0, 0, 0 },
        { -302.82338882253998, -566.34767958401937, -84.438176977867002 },
        { -406.97310606546233, -727.60565703241286, 26.576763816678302 } },
      //seqVar8
      { { 0, 0, 0 },
        { -331.52153002344545, -581.30262649850556, -606.92343502866379 },
        { -311.89307849728249, -883.95574627273561, -548.2118820993569 } },
      //seqVar9
      { { 0, 0, 0 },
        { 80.191285370967321, -73.234649373001972, -129.24057709148562 },
        { -3.3079615597905643, -51.712246319940725, 62.547102502628483 } },
      //seqVar10
      { { 0, 0, 0 },
        { -22.770720323684461, 92.504403514985356, 247.86772279280328 },
        { -106.42216222430015, 290.31726927833921, 222.12221530026866 } },
      //seqVar11
      { { 0, 0, 0 },
        { 6.3407233435278698, 129.2506629594389, -245.08597410170566 },
        { 219.88985893485523, 127.61354739656048, -142.96794448587221 } },
      //seqVar12
      { { 0, 0, 0 },
        { -76.263978843249603, -41.900077540013861, 112.21331790842696 },
        { -27.426359105362824, -115.51006176467175, 85.327032119459815 } },
      //seqVar13
      { { 0, 0, 0 },
        { 0.035449673038950053, 0.026673111342349645, 0.0025403577917187236 },
        { 0.15060684811631658, 0.09272033993768157, 0.85389416975182308 } },
      //seqVar14
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar15
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar16
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar17
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar18
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar19
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar20
      { { 0, 0, 0 },
        { 163.00737264444552, 139.46649205062647, 19.461374389942979 },
        { 171.6000564296566, 189.71706589587527, 75.710462024178923 } },
      //seqVar21
      { { 0.0001, 0.0001, 0.0001 },
        { 0.00012110052081058338, 0.00011448050771943278, 0.00010006133194154237 },
        { 0.00019684866608784971, 0.00016435694219187822, 0.00056636927126795184 } },
      //seqVar22
      { { 0, 0, 0 },
        { 0.86590940010455797, 4.6259299678259564, 0.00075412813251340245 },
        { 1.7203662309398653, 2.7671230188317164, 0.093002835888423757 } },
      //seqVar23
      { { 300, 300, 300 },
        { 308.15976960245683, 305.8819225075481, 300.46271877876273 },
        { 338.01851284299613, 322.9940214382637, 480.15922230122305 } },
      //seqVar24
      { { 0, 0, 0 },
        { 421529.9154465865, 1496337.2830131229, 16826.655278480957 },
        { 314543.54126303061, 601917.99645904591, 68738.924559431194 } },
      //seqVar25
      { { 0.9998999999999999, 0.99990000000000001, 0.99990000000000001 },
        { 1.0050970324684512, 1.013937735003295, 0.9983317382738619 },
        { 1.0063908030506499, 1.0197321662623655, 0.99864120084961405 } },
      //seqVar26
      { { 0, 0, 0 },
        { -0.40455355003663168, -0.65214495048774124, -0.3122480573149316 },
        { -0.3959831299914392, -0.53106196926819771, -0.1849191463350541 } },
      //seqVar27
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar28
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar29
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar30
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar31
      { { 0, 0, 0 },
        { 0.035449673038950053, 0.026673111342349645, 0.0025403577917187236 },
        { 0.15060684811631658, 0.09272033993768157, 0.85389416975182308 } },
      //seqVar32
      { { 0, 0, 0 },
        { 1684.9492835609199, 6193.0446932826235, 90.489538122248618 },
        { 1271.7088150955115, 2321.8037517127173, 396.36552837877582 } },
      //seqVar33
      { { 0.9998999999999999, 0.99990000000000001, 0.99990000000000001 },
        { 1.0050970324684512, 1.013937735003295, 0.9983317382738619 },
        { 1.0063908030506499, 1.0197321662623655, 0.99864120084961405 } },
      //seqVar34
      { { 0, 0, 0 },
        { -0.0041499402658294994, -0.0037168303616677821, 0.0015675316628929084 },
        { -0.0023415297102507742, -0.011305819156172023, 0.056115674774108608 } },
      //seqVar35
      { { 0, 0, 0 },
        { -0.013606446942479021, -0.010346611995468769, -0.0041351071458279251 },
        { -0.079376892428439996, -0.04713904285792539, -0.38285708450234462 } },
      //seqVar36
      { { 0, 0, 0 },
        { 0.016721899892272383, 0.011715048166511888, 0.0010069756254685162 },
        { 0.080438933022023457, 0.055237474381097454, 0.32597300470673329 } },
      //seqVar37
      { { 0, 0, 0 },
        { 0.0010093880866310348, -0.0069426789156606661, 0.0026987694668325008 },
        { 0.015885577213634178, -0.01071411586511662, 0.55273874569743675 } },
      //seqVar38
      { { 0, 0, 0 },
        { -0.012922706751820792, -0.010809149658718344, -0.0026926387325724582 },
        { -0.051518870549019859, -0.020567901759034054, 0.12303686008569613 } },
      //seqVar39
      { { 0, 0, 0 },
        { -0.0062876720094096686, -0.0055063955001025799, 0.0011948390821305197 },
        { -0.02405204400040058, -0.017609892127326537, -0.23525761058104888 } },
      //seqVar40
      { { 3, 3, 3 },
        { 3, 3, 3 },
        { 3, 3, 3 } } },
    { //mesh15
      //seqVar7
      { { 0, 0, 0 },
        { 45.351912138031324, 49.464176871535976, 0.31680727396590258 },
        { 91.66322707863516, 72.528399301427058, 9.4883716846552204 } },
      //seqVar8
      { { 0, 0, 0 },
        { -84.229588975993266, -86.314369659578261, -215.61400641625559 },
        { 94.401371924977227, 131.65957896993564, -171.23200901372903 } },
      //seqVar9
      { { 0, 0, 0 },
        { -67.822999141085262, -63.574385713191674, -142.90974928487404 },
        { -14.545773742862906, 14.286856286401626, -121.7025133143123 } },
      //seqVar10
      { { 0, 0, 0 },
        { -13.791580008222795, -10.423926455710909, -62.838195934145993 },
        { -26.180822579934368, -5.6354907569454671, -64.442076001468834 } },
      //seqVar11
      { { 0, 0, 0 },
        { -81.00111646982576, -80.385569634199527, -167.37225552569168 },
        { -169.15049614728812, -157.49358684158619, -168.47811514731166 } },
      //seqVar12
      { { 0, 0, 0 },
        { 6.3065785500068445, 11.700244374840832, -1.1381053725988151 },
        { 3.8930327697843348, 18.109665293885566, -42.729894054129176 } },
      //seqVar13
      { { 0, 0, 0 },
        { 0, 0, 2.0084855316389799e-05 },
        { 0.0010742828604548996, 0.0012906930507498072, 0.0021960760964930166 } },
      //seqVar14
      { { 0, 0, 0 },
        { 0, 0, 1.0088589009393261e-15 },
        { 6.2713126824449107e-14, 6.6763702449173765e-14, 1.8906758887227185e-13 } },
      //seqVar15
      { { 0, 0, 0 },
        { 0, 0, -1.2991001240564712e-15 },
        { 1.2256315042631757e-14, 2.9412590985614596e-14, -1.6775883245322312e-13 } },
      //seqVar16
      { { 0, 0, 0 },
        { 0, 0, 2.9344513848629928e-16 },
        { -7.9101983441198066e-14, -1.0065164687448437e-13, -3.7643596047046037e-14 } },
      //seqVar17
      { { 0, 0, 0 },
        { 0, 0, -8.3811287631954509e-16 },
        { -1.4219496134169918e-14, -9.5900034120512413e-15, -9.6516408658439344e-14 } },
      //seqVar18
      { { 0, 0, 0 },
        { 0, 0, -2.347225882668509e-15 },
        { -1.3050034583142929e-13, -1.5714993526057813e-13, -2.2514829226202063e-13 } },
      //seqVar19
      { { 0, 0, 0 },
        { 0, 0, -5.1997034595772475e-16 },
        { 3.8517932216362991e-15, 4.1760743363297773e-15, -1.5374319108080398e-15 } },
      //seqVar20
      { { 0, 0, 0 },
        { 0, 0, 0.025424420637554953 },
        { 1.3585634141367378, 1.6319152519822346, 2.774321527668445 } },
      //seqVar21
      { { 0.0001, 0.0001, 0.0001 },
        { 0.0001, 0.0001, 0.0001 },
        { 0.00010000010679591256, 0.00010000321769884164, 0.0001 } },
      //seqVar22
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar23
      { { 300, 300, 300 },
        { 300, 300, 300.00222663371915 },
        { 300.11970501190081, 300.14397216502203, 300.24432196598991 } },
      //seqVar24
      { { 0, 0, 0 },
        { 0, 0, 32987.166210183779 },
        { 34063.238395524844, 44705.331549596063, 41656.072804338713 } },
      //seqVar25
      { { 0.99990000000000001, 0.99990000000000023, 0.99989999999999979 },
        { 0.97961241936340016, 0.97988035810259655, 0.9972246020040898 },
        { 0.98008929400178146, 0.98044316786028418, 0.99668615192708854 } },
      //seqVar26
      { { 0, 0, 0 },
        { -0.17472177473296191, -0.16288489727298219, -0.30324528114468829 },
        { 0.16729452876006817, 0.22946312083212844, -0.24258707710581678 } },
      //seqVar27
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar28
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar29
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar30
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      //seqVar31
      { { 0, 0, 0 },
        { 0, 0, 2.0084855316389799e-05 },
        { 0.0010742828604548996, 0.0012906930507498072, 0.0021960760964930166 } },
      //seqVar32
      { { 0, 0, 0 },
        { 0, 0, 297.55341209466371 },
        { 304.78489184500137, 397.45815696937979, 368.45511439888651 } },
      //seqVar33
      { { 0.99990000000000001, 0.99990000000000023, 0.99989999999999979 },
        { 0.97961241936340016, 0.97988035810259655, 0.9972246020040898 },
        { 0.98008929400178146, 0.98044316786028418, 0.99668615192708854 } },
      //seqVar34
      { { 0, 0, 0 },
        { 0.00042142828539618314, 0.00043773715486272475, 0.00051294349547445918 },
        { 0.00074104251301192366, 0.00059745423903959224, 0.0016977624786670446 } },
      //seqVar35
      { { 0, 0, 0 },
        { -0.00036162307125658434, -0.00038371193350095716, -0.00082846852300895186 },
        { 0.00037236908420851033, 0.00063165539285472863, -0.0016840203182600833 } },
      //seqVar36
      { { 0, 0, 0 },
        { -0.00025892094922462354, -0.00024148029438162419, -0.00036494806790368027 },
        { -0.00079315503658927071, -0.00082102638949928968, -0.00055188427110271264 } },
      //seqVar37
      { { 0, 0, 0 },
        { -7.5512425235905805e-05, -5.4902706037811153e-05, -0.00039535010866077009 },
        { -0.000263589589915165, -0.00012330450849739241, -0.0010053582245094339 } },
      //seqVar38
      { { 0, 0, 0 },
        { -0.00049307482504463561, -0.00048869475166346207, -0.0010470168152058193 },
        { -0.0018303119835997265, -0.0019207322005800767, -0.0023982969258017814 } },
      //seqVar39
      { { 0, 0, 0 },
        { 4.3542128477859263e-05, 7.8068243780833951e-05, -1.5252848018349926e-05 },
        { 6.2407345562617435e-05, 0.00014696501630895049, -0.00027821165228802952 } },
      //seqVar40
      { { 16, 16, 16 },
        { 16, 16, 16 },
        { 16, 16, 16 } } } };
  int temp_numComp;
  FC_AssociationType temp_assoc;
  FC_MathType temp_mathType;
  double* temp_data;
  int* temp_int_data;

  // *** Test load dataset

  rc = fc_loadDataset(dataset_file_name, &dataset);
  fail_unless(rc == FC_SUCCESS, "failed to load dataset");

  // *** Test dataset

  rc = fc_getDatasetName(dataset, &temp_name);
  fail_unless(rc == FC_SUCCESS, "failed to get dataset name");
  fail_unless(!strcmp(temp_name, dataset_name), 
	      "mismatch of dataset name");
  free(temp_name);

  // *** Test sequences

  rc = fc_getSequences(dataset, &temp_num, &sequences);
  fail_unless(rc == FC_SUCCESS, "failed to get sequences");
  fail_unless(temp_num == numSeq, "mismatch of numSequence");
  for (i = 0; i < numSeq; i++) {

    // test sequence meta data
    rc = fc_getSequenceName(sequences[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence name");
    fail_unless(!strcmp(temp_name, sequence_name), 
		"mismatch of sequence name");
    free(temp_name);
    rc = fc_getSequenceInfo(sequences[i], &temp_num, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence info");
    fail_unless(temp_num == numStep, "mismatch of numStep");
    fail_unless(temp_dataType == dataType, 
		"mismatch of sequence dataType");

   // test sequence big data
    rc = fc_getSequenceCoordsPtr(sequences[i], (void**)&temp_seqCoords);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence coords");
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
	timeID = midID;
      else if (j == 2)
	timeID = numStep-1;
      fail_unless(FC_DBL_EQUIV(seqCoords[j], temp_seqCoords[timeID]),
		  "mismatch of seq coords");
    }
  }
  free(sequences);
 
  // *** Test global vars

  rc = fc_getGlobalVariables(dataset, &temp_num, &glbVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global vars");
  fail_unless(temp_num == numGlbVar, "mismatch of numGlbVar");

  // *** Test global seq vars
  
  rc = fc_getGlobalSeqVariables(dataset, &temp_num, 
                                &temp_numStepPerSeqVar, &glbSeqVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global seq vars");
  fail_unless(temp_num == numGlbSeqVar, "mismatch of numGlbSeqVar");
  for (i = 0; i < numGlbSeqVar; i++) {

    // test glb seq variable meta data
    rc = fc_getVariableName(glbSeqVars[i][0], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable name");
    fail_unless(!strcmp(temp_name, glbSeqVarNames[i]), 
                "mismatch of glb seq variable name");
    free(temp_name);
    fail_unless(temp_numStepPerSeqVar[i] == numStep, 
                "mismatch of numStepPerSeqVar");
    rc = fc_getVariableInfo(glbSeqVars[i][0], &temp_num, &temp_numComp,
                            &temp_assoc, &temp_mathType, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable info");
    fail_unless(temp_numComp == numCompPerGlbSeqVar[i], "mismatch of numComp");
    fail_unless(temp_num == 1, "mismatch of numDataPoint");
    fail_unless(temp_assoc == FC_AT_WHOLE_DATASET, "mismatch of assoc");
    if (temp_numComp == 3)
      fail_unless(temp_mathType == FC_MT_VECTOR, 
                  "mismatch of glb seq var mathType");
    else
      fail_unless(temp_mathType == FC_MT_SCALAR, 
                  "mismatch of glb seq var mathType");
    fail_unless(temp_dataType == dataType, "mismatch of glb seq var dataType");
    
    // test glb seq variable big data
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
        timeID = midID;
      else if (j == 2)
        timeID = numStep-1;
      rc = fc_getVariableDataPtr(glbSeqVars[i][timeID], (void**)&temp_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < temp_numComp; k++)
      fail_unless(FC_FLT_EQUIV(temp_data[k], global_data[i][j][k]),
                  "mismatch of global data");
    }
    
    // done with this glb seq variable
    fc_deleteSeqVariable(temp_numStepPerSeqVar[i], glbSeqVars[i]);
    free(glbSeqVars[i]);
  }
  free(temp_numStepPerSeqVar);
  free(glbSeqVars);

  // *** Test meshes

  rc = fc_getMeshes(dataset, &temp_num, &meshes);
  fail_unless(rc == FC_SUCCESS, "failed to get meshes");
  fail_unless(temp_num == numMesh, "mismatch of numMesh");
  for (i = 0; i < numMesh; i++) {
    int meshLU = -1;
    if (i == 0)
      meshLU = 0;
    else if (i == midID)
      meshLU = 1;
    else if (i == numMesh-1)
      meshLU = 2;
  
    // test mesh meta data
    rc = fc_getMeshName(meshes[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh name");
    fail_unless(!strcmp(temp_name, meshNames[i]), "mismatch of mesh name");
    free(temp_name);
  
    rc = fc_getMeshInfo(meshes[i], &temp_topodim, &temp_numDim,
			&temp_numVert, &temp_numElem, &temp_elemType);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh info");
    fail_unless(temp_topodim == topodim, "mismatch of topodim");
    fail_unless(temp_numDim == numDim, "mismatch of numDim");
    fail_unless(temp_numVert == numVertPerMesh[i], "mismatch of numVert");
    fail_unless(temp_numElem == numElemPerMesh[i], "mismatch of numElem");
    fail_unless(temp_elemType == elemType, "mismatch of elemType");

    // test mesh big data
    if (meshLU > -1) {
      rc = fc_getMeshCoordsPtr(meshes[i], &temp_coords);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh coords");
      rc = fc_getMeshElementConnsPtr(meshes[i], &temp_conns);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh elem conns");
      numVertPerElem = fc_getElementTypeNumVertex(temp_elemType);
      for (j = 0; j < 3; j++) { // do 1st entity, middle entity & last entity
	int vertID = 0;
	int elemID = 0;
	if (j == 1) {
	  vertID = midID;
	  elemID = midID;
	}
	else if (j == 2) {
	  vertID = numVertPerMesh[i]-1;
	  elemID = numElemPerMesh[i]-1;
	}
	for (k = 0; k < numDim; k++) 
	  fail_unless(FC_DBL_EQUIV(temp_coords[vertID*numDim+k], 
				   coords[meshLU][j][k]),
		      "mismatch of coords");
	fail_unless(!memcmp(&temp_conns[elemID*numVertPerElem], 
			    conns[meshLU][j], numVertPerElem*sizeof(int)),
		    "mismatch of conns");
      }
    }

    // *** Test subsets

    rc = fc_getSubsets(meshes[i], &temp_num, &subsets);
    fail_unless(rc == FC_SUCCESS, "failed to get subsets");
    fail_unless(temp_num == numSubset, "mismatch of numSubset");

    // *** Test variables

    rc = fc_getVariables(meshes[i], &temp_num, &vars);
    fail_unless(rc == FC_SUCCESS, "failed to get variables");
    fail_unless(temp_num == numVar, "mismatch of numVar");
    for (j = 0; j < numVar; j++) {
      
      // test var meta data
      rc = fc_getVariableName(vars[j], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get variable name");
      fail_unless(!strcmp(temp_name, varNames[j]),
		  "mismatch of variable name");
      free(temp_name);
      rc = fc_getVariableInfo(vars[j], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");
      fail_unless(temp_numComp == 1, "mismatch of numComp");
      if (j == 0) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      fail_unless(temp_mathType == FC_MT_SCALAR, "mismatch of var mathType");
      fail_unless(temp_dataType == FC_DT_INT, "mismatch of var dataType");

      // test variable big data
      rc = fc_getVariableDataPtr(vars[j], (void**)&temp_int_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < 3; k++) {
	int entityID = 0;
	if (k == 1)
	  entityID = midID;
	else if (k == 2)
	  entityID = temp_num - 1;
	fail_unless(globalIDs[i][j][k] == temp_int_data[entityID],
		    "data mismatch");
      }
    }
    free(vars);
  
    // *** Test seq variables

    rc = fc_getSeqVariables(meshes[i], &temp_num, &temp_numStepPerSeqVar, 
			    &seqVars);
    fail_unless(rc == FC_SUCCESS, "failed to get seq variables");
    fail_unless(temp_num == numSeqVar, "mismatch of numSeqVar");
    for (j = 0; j < numSeqVar; j++) {
      
      // test seq variable meta data
      rc = fc_getVariableName(seqVars[j][0], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable name");
      fail_unless(!strcmp(temp_name, seqVarNames[j]), 
		  "mismatch of seq variable name");
      free(temp_name);
      fail_unless(temp_numStepPerSeqVar[j] == numStep, 
		  "mismatch of numStepPerSeqVar");
      rc = fc_getVariableInfo(seqVars[j][0], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");;
      fail_unless(temp_numComp == numCompPerSeqVar[j], "mismatch of numComp");
      if (j < numWholeVar) {
	fail_unless(temp_num == 1, "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_WHOLE_MESH, "mismatch of assoc");
      }
      else if (j < numWholeVar + numVertVar) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      if (temp_numComp == 3)
	fail_unless(temp_mathType == FC_MT_VECTOR, 
		    "mismatch of seq var mathType");
      else
	fail_unless(temp_mathType == FC_MT_SCALAR, 
		    "mismatch of seq var mathType");
      fail_unless(temp_dataType == dataType, "mismatch of seq var dataType");

      // test seq variable big data
      if (meshLU > -1) {
	for (k = 0; k < 3; k++) {
	  int varLU;
	  int timeID = 0;
	  if (k == 1)
	    timeID = midID;
	  else if (k == 2)
	    timeID = numStep-1;
	  rc = fc_getVariableDataPtr(seqVars[j][timeID], (void**)&temp_data);
	  fail_unless(rc == FC_SUCCESS, "failed to get variable data");
	  //printf("%d %d %d: temp = %g, known = %g\n", i, j, k,
	  //     temp_data[0], whole_data[meshLU][j][k]);
          if (j < numWholeVar) {
            for (n = 0; n < temp_numComp; n++)
              fail_unless(FC_DBL_EQUIV(temp_data[n], whole_data[meshLU][j][k][n]),
			"mismatch of whole data");
	  }
	  else {
	    for (m = 0; m < 3; m++) {
	      int entityID = 0;
	      if (m == 1)
		entityID = midID;
	      else if (m == 2)
		entityID = temp_num-1;
	      if (j < numWholeVar + numVertVar) {
		varLU = j - numWholeVar;
		for (n = 0; n < temp_numComp; n++)
		  fail_unless(FC_DBL_EQUIV(temp_data[entityID*temp_numComp+n],
					   vert_data[meshLU][varLU][k][m][n]),
			      "mismatch of vert data");
	      }
	      else {
		// FIX? if we ever have a non scalar elem data, this'll change
		varLU = j - numWholeVar - numVertVar;
		fail_unless(FC_DBL_EQUIV(temp_data[entityID],
					 elem_data[meshLU][varLU][k][m]),
			    "mismatch of elem data");
	      }
	    }
	  }
	}
      }
 
      // done with this seq variable
      fc_deleteSeqVariable(temp_numStepPerSeqVar[j], seqVars[j]);
      free(seqVars[j]);
    }
    free(temp_numStepPerSeqVar);
    free(seqVars);

    // done with this mesh
    fc_deleteMesh(meshes[i]);
  }
  free(meshes);

  // All done
  rc = fc_deleteDataset(dataset);
  fail_unless(rc == FC_SUCCESS, "failed to delete dataset at end of test");
}
END_TEST

// Test a dataset with temperature
// We are confident of the given values.
// Test metadata on everything, test big data only on selection:
// 1st of that thing, middle thing of that thing, last of that thing..
// some of the middle things nest: e.g. only test big var data on
// meshes that we testing big data on.
// NOTE: double numbers were generated with %.17g so that there were
// extra digits past the significant digits so that FC_DBL_EQUIV worked.
START_TEST(lsdyna_temperature)
{
  int i, j, k, m, n;
  int midID = 5;  
  int numSeq = 1, numGlbVar = 0, numGlbSeqVar = 5, numMesh = 1;
  int numSubset = 0, numVar = 2, numSeqVar = 16;
  int numWholeVar = 4, numVertVar = 4; //numElemVar = 8
  int temp_num, *temp_numStepPerSeqVar;
  FC_ReturnCode rc;
  FC_Dataset dataset;
  FC_Sequence* sequences;
  FC_Mesh* meshes;
  FC_Subset* subsets;
  FC_Variable *glbVars, **glbSeqVars, *vars, **seqVars;
  char* dataset_file_name = temperature;
  char dataset_name[1024] = "THERMAL EXPANSION OF A BLOCK";
  char* temp_name;
  char sequence_name[1024] = "time";
  int numStep = 302;
  FC_DataType dataType = FC_DT_DOUBLE;
  double seqCoords[3] = { 0, 0.050000000000000003, 3.0099999999999798 };
  FC_DataType temp_dataType;
  double* temp_seqCoords;
  char meshNames[16][1024] = { "part_1" };
  int topodim = 3, numDim = 3, numVertPerElem;
  int numVertPerMesh[1] = { 8 };
  int numElemPerMesh[1] = { 1 };
  FC_ElementType elemType = FC_ET_HEX;
  // index by mesh case, vertex case, then dim
  double coords[8][3] = { { 0, 0, 0 },
			  { 1, 0, 0 },
			  { 1, 1, 0 },
			  { 0, 1, 0 },
			  { 0, 0, 1 },
			  { 1, 0, 1 },
			  { 1, 1, 1 },
			  { 0, 1, 1 } };
  int conns[8] = { 0, 1, 2, 3, 4, 5, 6, 7 };
  int temp_topodim, temp_numDim, temp_numVert, temp_numElem;
  FC_ElementType temp_elemType;
  int *temp_conns;
  double* temp_coords;
  char varNames[2][1024] = { "vert_IDs", "elem_IDs" };
  char glbSeqVarNames[5][1024] = { "global_KE",
                                   "global_IE",
                                   "global_TE",
                                   "global_velocity",
                                   "global_work" };
  int numCompPerGlbSeqVar[5] = { 1, 1, 1, 3, 1 };
  // index by numvar, then time case, then dim
  double global_data[5][3][3] = { 
    { { 0 }, { 7.3466891263004455e-10 }, { 4.6285146708309387e-11 } },
    { { 9.9999999999999995e-21 }, { -0.0001370320974888631 }, { -0.0037727616946945687 } },
    { { 9.9999999999999995e-21 }, { -0.00013703136281995048 }, { -0.003772761648409422 } },
    { { 0, 0, 0 },
      { 1.5648950046036578e-05, 1.5648950046036575e-05, 1.5648950046036578e-05 },
      { 3.9278979411515115e-06, 3.9278979411516572e-06,3.9278979411516894e-06 } },
    { { 0 }, { -0.0001370320974888631 }, { -0.0037727616946945687 } } };
  char seqVarNames[16][1024] = { "mat_IE",
				 "mat_KE",
				 "mat_velocity",
				 "mass",
				 "displacement",
				 "temperature",
				 "velocity",
				 "acceleration",
				 "sigma-xx",
				 "sigma-yy",
				 "sigma-zz",
				 "sigma-xy",
				 "sigma-yz",
				 "sigma-zx",
				 "plastic_strain",
				 "elem_death" };
  int numCompPerSeqVar[16] = { 1, 1, 3, 1, 3, 1, 3, 3, 1, 1,
                               1, 1, 1, 1, 1, 1 };
  // index by numWholeVar, then by time case, dim
  double whole_data[6][3][3] = 
    { { { 0 }, { 2.772093718109619e-09 }, { 5.7461072941167069e-09 } },
      { { 0 }, { 3.0397882152707169e-05 }, { 4.3764930001530901e-05 } },
      { { 0, 0, 1 },
        { 3.0397882152707165e-05, 3.0397882152707169e-05, 1 },
        { 4.3764930001530975e-05, 4.3764930001530921e-05, 1 } },
      { { 0 }, { 0 }, { 0 } } };
  // index by numVertVar, then time case, then entity case
  // and finally by dim
  double vert_data[4][3][3][3] = { 
    //seqVar13
    { { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      { { 0, 0, 0 },
	{ 1.2219806000413058e-06, 0, 1.2219806000413058e-06 },
	{ 0, 1.2219806000413058e-06, 1.2219806000413058e-06 } },
      { { 0, 0, 0 },
	{ 0.00015043538212844432, 0, 0.00015043538212844432 },
	{ 0, 0.00015043538212844432, 0.00015043538212844432 } } },
    //seqVar14
    { { { 10 },
	{ 10 },
	{ 10 } },
      { { 10.499999999999998 },
	{ 10.499999999999998 },
	{ 10.499999999999998 } },
      { { 39.987826996509696 },
	{ 39.987826996509682 },
	{ 39.987826996509682 } } },
    //seqVar15
    { { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      { { 0, 0, 0 },
	{ 6.0795764305414338e-05, 0, 6.0795764305414338e-05 },
	{ 0, 6.0795764305414331e-05, 6.0795764305414338e-05 } },
      { { 0, 0, 0 },
	{ 3.4413817255889282e-05, 0, 3.4413817255889533e-05 },
	{ 0, 3.4413817255889526e-05, 3.4413817255889533e-05 } } },
    //seqVar16
    { { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      { { 0, 0, 0 },
	{ -0.005899572842668236, 0, -0.005899572842668236 },
	{ 0, -0.005899572842668236, -0.005899572842668236 } },
      { { 0, 0, 0 },
	{ -0.0053116042747172517, 0, -0.0053116042747172309 },
	{ 0, -0.0053116042747172422, -0.0053116042747172309 } } } };
  // index by numElemVar, then time case, then entity case
  double elem_data[8][3][1] = {
    //seqVar17
    { { 0 },
      { 4924.4871828166351 },
      { 4432.3786978608759 } },
    //seqVar18
    { { 0 },
      { 4924.4871828166351 },
      { 4432.3786978608678 } },
    //seqVar19
    { { 0 },
      { 4924.4871828166351 },
      { 4432.3786978608587 } },
    //seqVar20
    { { 0 },
      { 0 },
      { 0 } },
    //seqVar21
    { { 0 },
      { 0 },
      { 0 } },
    //seqVar22
    { { 0 },
      { 0 },
      { 0 } },
    //seqVar23
    { { 0 },
      { 0 },
      { 0 } },
    //seqVar24
    { { 1 },
      { 1 },
      { 1 } } };
  int temp_numComp;
  FC_AssociationType temp_assoc;
  FC_MathType temp_mathType;
  double* temp_data;
  int* temp_int_data;

  // *** Test load dataset

  rc = fc_loadDataset(dataset_file_name, &dataset);
  fail_unless(rc == FC_SUCCESS, "failed to load dataset");

  // *** Test dataset

  rc = fc_getDatasetName(dataset, &temp_name);
  fail_unless(rc == FC_SUCCESS, "failed to get dataset name");
  fail_unless(!strcmp(temp_name, dataset_name), 
	      "mismatch of dataset name");
  free(temp_name);

  // *** Test sequences

  rc = fc_getSequences(dataset, &temp_num, &sequences);
  fail_unless(rc == FC_SUCCESS, "failed to get sequences");
  fail_unless(temp_num == numSeq, "mismatch of numSequence");
  for (i = 0; i < numSeq; i++) {

    // test sequence meta data
    rc = fc_getSequenceName(sequences[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence name");
    fail_unless(!strcmp(temp_name, sequence_name), 
		"mismatch of sequence name");
    free(temp_name);
    rc = fc_getSequenceInfo(sequences[i], &temp_num, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence info");
    fail_unless(temp_num == numStep, "mismatch of numStep");
    fail_unless(temp_dataType == dataType, 
		"mismatch of sequence dataType");

   // test sequence big data
    rc = fc_getSequenceCoordsPtr(sequences[i], (void**)&temp_seqCoords);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence coords");
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
	timeID = midID;
      else if (j == 2)
	timeID = numStep-1;
      fail_unless(FC_DBL_EQUIV(seqCoords[j], temp_seqCoords[timeID]),
		  "mismatch of seq coords");
    }
  }
  free(sequences);

  // *** Test global vars

  rc = fc_getGlobalVariables(dataset, &temp_num, &glbVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global vars");
  fail_unless(temp_num == numGlbVar, "mismatch of numGlbVar");

  // *** Test global seq vars
  
  rc = fc_getGlobalSeqVariables(dataset, &temp_num, 
                                &temp_numStepPerSeqVar, &glbSeqVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global seq vars");
  fail_unless(temp_num == numGlbSeqVar, "mismatch of numGlbSeqVar");
  for (i = 0; i < numGlbSeqVar; i++) {

    // test glb seq variable meta data
    rc = fc_getVariableName(glbSeqVars[i][0], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable name");
    fail_unless(!strcmp(temp_name, glbSeqVarNames[i]), 
                "mismatch of glb seq variable name");
    free(temp_name);
    fail_unless(temp_numStepPerSeqVar[i] == numStep, 
                "mismatch of numStepPerSeqVar");
    rc = fc_getVariableInfo(glbSeqVars[i][0], &temp_num, &temp_numComp,
                            &temp_assoc, &temp_mathType, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable info");
    fail_unless(temp_numComp == numCompPerGlbSeqVar[i], "mismatch of numComp");
    fail_unless(temp_num == 1, "mismatch of numDataPoint");
    fail_unless(temp_assoc == FC_AT_WHOLE_DATASET, "mismatch of assoc");
    if (temp_numComp == 3)
      fail_unless(temp_mathType == FC_MT_VECTOR, 
                  "mismatch of glb seq var mathType");
    else
      fail_unless(temp_mathType == FC_MT_SCALAR, 
                  "mismatch of glb seq var mathType");
    fail_unless(temp_dataType == dataType, "mismatch of glb seq var dataType");
    
    // test glb seq variable big data
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
        timeID = midID;
      else if (j == 2)
        timeID = numStep-1;
      rc = fc_getVariableDataPtr(glbSeqVars[i][timeID], (void**)&temp_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < temp_numComp; k++)
        fail_unless(FC_FLT_EQUIV(temp_data[k], global_data[i][j][k]),
                    "mismatch of global data");
    }
    
    // done with this glb seq variable
    fc_deleteSeqVariable(temp_numStepPerSeqVar[i], glbSeqVars[i]);
    free(glbSeqVars[i]);
  }
  free(temp_numStepPerSeqVar);
  free(glbSeqVars);

  // *** Test meshes

  rc = fc_getMeshes(dataset, &temp_num, &meshes);
  fail_unless(rc == FC_SUCCESS, "failed to get meshes");
  fail_unless(temp_num == numMesh, "mismatch of numMesh");
  fail_unless(numMesh == 1, "abort: following tests expect 1 mesh");
  for (i = 0; i < numMesh; i++) {

    // test mesh meta data
    rc = fc_getMeshName(meshes[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh name");
    fail_unless(!strcmp(temp_name, meshNames[i]), "mismatch of mesh name");
    free(temp_name);
    
    rc = fc_getMeshInfo(meshes[i], &temp_topodim, &temp_numDim,
			&temp_numVert, &temp_numElem, &temp_elemType);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh info");
    fail_unless(temp_topodim == topodim, "mismatch of topodim");
    fail_unless(temp_numDim == numDim, "mismatch of numDim");
    fail_unless(temp_numVert == numVertPerMesh[i], "mismatch of numVert");
    fail_unless(temp_numElem == numElemPerMesh[i], "mismatch of numElem");
    fail_unless(temp_elemType == elemType, "mismatch of elemType");
 
    // test mesh big data
    rc = fc_getMeshCoordsPtr(meshes[i], &temp_coords);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh coords");
    rc = fc_getMeshElementConnsPtr(meshes[i], &temp_conns);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh elem conns");
    numVertPerElem = fc_getElementTypeNumVertex(temp_elemType);
    for (j = 0; j < numVertPerMesh[i]; j++) 
      for (k = 0; k < numDim; k++) 
	fail_unless(FC_DBL_EQUIV(temp_coords[j*numDim+k], 
				 coords[j][k]),
		    "mismatch of coords");
    fail_unless(!memcmp(temp_conns, conns, numVertPerMesh[i]*sizeof(int)),
		"mismatch of conns");
   
    // *** Test subsets

    rc = fc_getSubsets(meshes[i], &temp_num, &subsets);
    fail_unless(rc == FC_SUCCESS, "failed to get subsets");
    fail_unless(temp_num == numSubset, "mismatch of numSubset");

    // *** Test variables

    rc = fc_getVariables(meshes[i], &temp_num, &vars);
    fail_unless(rc == FC_SUCCESS, "failed to get variables");
    fail_unless(temp_num == numVar, "mismatch of numVar");
    for (j = 0; j < numVar; j++) {
      
      // test var meta data
      rc = fc_getVariableName(vars[j], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get variable name");
      fail_unless(!strcmp(temp_name, varNames[j]),
		  "mismatch of variable name");
      free(temp_name);
      rc = fc_getVariableInfo(vars[j], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");
      fail_unless(temp_numComp == 1, "mismatch of numComp");
      if (j == 0) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      fail_unless(temp_mathType == FC_MT_SCALAR, "mismatch of var mathType");
      fail_unless(temp_dataType == FC_DT_INT, "mismatch of var dataType");

      // test variable big data
      rc = fc_getVariableDataPtr(vars[j], (void**)&temp_int_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < temp_num; k++) 
	fail_unless(temp_int_data[k] == k + 1, "data mismatch");
    }
    free(vars);

    // *** Test seq variables

    rc = fc_getSeqVariables(meshes[i], &temp_num, &temp_numStepPerSeqVar, 
			    &seqVars);
    fail_unless(rc == FC_SUCCESS, "failed to get seq variables");
    fail_unless(temp_num == numSeqVar, "mismatch of numSeqVar");
    for (j = 0; j < numSeqVar; j++) {
       
      // test seq variable meta data
      rc = fc_getVariableName(seqVars[j][0], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable name");
      fail_unless(!strcmp(temp_name, seqVarNames[j]), 
		  "mismatch of seq variable name");
      free(temp_name);
      fail_unless(temp_numStepPerSeqVar[j] == numStep, 
		  "mismatch of numStepPerSeqVar");
      rc = fc_getVariableInfo(seqVars[j][0], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");;
      fail_unless(temp_numComp == numCompPerSeqVar[j], "mismatch of numComp");
      if (j < numWholeVar) {
	fail_unless(temp_num == 1, "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_WHOLE_MESH, "mismatch of assoc");
      }
      else if (j < numWholeVar + numVertVar) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      if (temp_numComp == 3)
	fail_unless(temp_mathType == FC_MT_VECTOR, 
		    "mismatch of seq var mathType");
      else
	fail_unless(temp_mathType == FC_MT_SCALAR, 
		    "mismatch of seq var mathType");
      fail_unless(temp_dataType == dataType, "mismatch of seq var dataType");
      
      // test seq variable big data
      for (k = 0; k < 3; k++) {
	int varLU;
	int timeID = 0;
	if (k == 1)
	  timeID = midID;
	else if (k == 2)
	  timeID = numStep-1;
	rc = fc_getVariableDataPtr(seqVars[j][timeID], (void**)&temp_data);
	fail_unless(rc == FC_SUCCESS, "failed to get variable data");
	//printf("%d %d %d: temp = %g, known = %g\n", i, j, k,
	//     temp_data[0], whole_data[meshLU][j][k]);
	if (j < numWholeVar) {
          for (n = 0; n < temp_numComp; n++)
            fail_unless(FC_DBL_EQUIV(temp_data[n], whole_data[j][k][n]),
                        "mismatch of whole data");
	}
	else if (j < numWholeVar + numVertVar) {
	  varLU = j - numWholeVar;
	  for (m = 0; m < 3; m++) {
	    int entityID = 0;
	    if (m == 1)
	      entityID = midID;
	    else if (m == 2)
	      entityID = temp_num-1;
	    if (j < numWholeVar + numVertVar) {
	      varLU = j - numWholeVar;
	      if (varLU == 1) {
		fail_unless(FC_DBL_EQUIV(temp_data[entityID],
					 vert_data[varLU][k][m][0]),
		    "mismatch of vert data");
	      }
	      else {
		for (n = 0; n < temp_numComp; n++)
		  fail_unless(FC_DBL_EQUIV(temp_data[entityID*temp_numComp+n],
					   vert_data[varLU][k][m][n]),
			      "mismatch of vert data");
	      }
	    }
	  }
	}
	else { // for this mesh, only 1 element
	  varLU = j - numWholeVar - numVertVar;
	  fail_unless(FC_DBL_EQUIV(temp_data[0],
				   elem_data[varLU][k][0]),
		      "Mismatch elem data");
	}
      }
      
      // done with this seq variable
      fc_deleteSeqVariable(temp_numStepPerSeqVar[j], seqVars[j]);
      free(seqVars[j]);
    }
    free(temp_numStepPerSeqVar);
    free(seqVars);

    // done with this mesh
    fc_deleteMesh(meshes[i]);
  }
  free(meshes);

  // All done
  rc = fc_deleteDataset(dataset);
  fail_unless(rc == FC_SUCCESS, "failed to delete dataset at end of test");
}
END_TEST

// We are confident of the given values.
// Test metadata on everything, test big data only on selection:
// 1st of that thing, middle thing of that thing, last of that thing..
// some of the middle things nest: e.g. only test big var data on
// meshes that we testing big data on.
// NOTE: double numbers were generated with %.17g so that there were
// extra digits past the significant digits so that FC_DBL_EQUIV worked.
START_TEST(lsdyna_chunked)
{
  int i, j, k, m, n;
  int bigMidID = 99;   // for the big collections of things
  int smallMidID = 2;   // for littler collections
  int numSeq = 1, numGlbVar = 0, numGlbSeqVar = 12, numMesh = 4;
  int numSubset = 0, numVar = 2, numSeqVar = 35;
  int numWholeVar = 4, numVertVar = 3; //numElemVar = 28
  int temp_num, *temp_numStepPerSeqVar;
  FC_ReturnCode rc;
  FC_Dataset dataset;
  FC_Sequence* sequences;
  FC_Mesh* meshes;
  FC_Subset* subsets;
  FC_Variable *glbVars, **glbSeqVars, *vars, **seqVars;
  char* dataset_file_name = chunked; // little endian/8 bit word
  char dataset_name[1024] = "";
  char* temp_name;
  char sequence_name[1024] = "time";
  int numStep = 12;
  FC_DataType dataType = FC_DT_DOUBLE;
  double seqCoords[3] = { 0, 0.00059999564244603949, 0.003000002732954826 };
  FC_DataType temp_dataType;
  double* temp_seqCoords;
  char meshNames[4][1024] = { "Material_ID_10",
			      "Material_ID_1",
			      "Material_ID_2",
			      "Material_ID_3" };
  int topodim = 3, numDim = 3, numVertPerElem;
  int numVertPerMesh[4] = { 1371, 88550, 43596, 6776 };
  int numElemPerMesh[4] = { 660, 64680, 28444, 2772 };
  FC_ElementType elemType = FC_ET_HEX;
  // index by mesh case, vertex case, then dim
  double coords[3][3][3] = {
    //mesh0
    { { 17.145, 34.616140000000001, -57.149999999999999 },
      { 30.48001, 128.21010000000001, 15.420310000000001 },
      { 106.045, 161.1335, 76.19999 } },
    //mesh2
    { { 38.220419999999997, 54.586069999999999, 64.132689999999997 },
      { 33.040219999999998, 56.582410000000003, 61.138829999999999 },
      { 29.97917, 97.807820000000007, -2.481811 } },
    //mesh3
    { { 39.933, 54.129579999999997, 64.817300000000003 },
      { 39.933, 58.744959999999999, 67.894869999999997 },
      { 30.41225, 98.307879999999997, -3.231735 } } };
  //index by mesh case, then elem case, then numVertPerElem
  int conns[3][3][8] = {
    //mesh0
    { { 0, 55, 60, 5, 1, 56, 61, 6 },
      { 266, 321, 326, 271, 267, 322, 327, 272 },
      { 1317, 1356, 1369, 1330, 1318, 1357, 1370, 1331 } },
    //mesh2
    { { 1, 7, 9, 3, 0, 6, 8, 2 },
      { 103, 119, 121, 105, 102, 118, 120, 104 },
      { 43595, 42830, 17387, 25333, 43471, 42704, 17292, 25248 } },
    //mesh3
    { { 1, 10, 13, 4, 0, 9, 12, 3 },
      { 892, 901, 904, 895, 891, 900, 903, 894 },
      { 6773, 6161, 6163, 6775, 6772, 6160, 6162, 6774 } } };
  int temp_topodim, temp_numDim, temp_numVert, temp_numElem;
  FC_ElementType temp_elemType;
  int *temp_conns;
  double* temp_coords;
  char varNames[2][1024] = { "vert_IDs", "elem_IDs" };
  // index by mesh, then var, then vert/elem case
  // (global IDs is the var data)
  int globalIDs[4][2][3] = {
    { { 132455, 132457, 133825 }, { 95897, 95899, 96556 } },
    { { 32047, 32049, 132454 }, { 29985, 29987, 95896 } },
    { { 1, 3, 95648 }, { 1, 3, 69408 } },
    { { 32047, 32049, 95524 }, { 20745, 20747, 68729 } } };
  char glbSeqVarNames[12][1024] = { "global_KE",
                                    "global_IE",
                                    "global_TE",
                                    "global_velocity",
                                    "global_work",
                                    "force_on_rw_1",
                                    "force_on_rw_2",
                                    "force_on_rw_3",
                                    "force_on_rw_4",
                                    "force_on_rw_5",
                                    "force_on_rw_6",
                                    "force_on_rw_7" };
  int numCompPerGlbSeqVar[12] = { 1, 1, 1, 3, 1, 1, 1, 1, 1, 1,
                                  1, 1 };
  // index by numvar, then by time case, then dim
  double global_data[12][3][3] = {
    { { 279523.79180466209 }, { 279335.82515721756 }, { 277633.39313545934 } },
    { { 1.5999999999999999e-19 }, { 170717.05529447208 }, { 1526526.7256418262 } },
    { { 279523.79180466209 }, { 450052.88045168959 }, { 1804160.1187772853 } },
    { { 0, -9999.9993977896702, 0},
      { 2.7734610188395568, -9984.088039474389, 19.069022676027867 },
      { -127.45199412341701, -9878.11328875033, -24.370905898023089 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 6119.9154970181689 }, { 92334.870909530335 } },
    { { 0 }, { 5069.615414559592 }, { 43604.505104288262 } },
    { { 0 }, { 670.33119041222199 }, { 1071.4135404405579 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } } };
  char seqVarNames[35][1024] = { "mat_IE",
				 "mat_KE",
				 "mat_velocity",
				 "mass",
				 "displacement",
				 "velocity",
				 "acceleration",
				 "sigma-xx",
				 "sigma-yy",
				 "sigma-zz",
				 "sigma-xy",
				 "sigma-yz",
				 "sigma-zx",
				 "plastic_strain",
				 "elem_var_1",
				 "elem_var_2",
				 "elem_var_3",
				 "elem_var_4",
				 "elem_var_5",
				 "elem_var_6",
				 "elem_var_7",
				 "elem_var_8",
				 "elem_var_9",
				 "elem_var_10",
				 "elem_var_11",
				 "elem_var_12",
				 "elem_var_13",
				 "elem_var_14",
				 "elem_var_15",
				 "elem_var_16",
				 "elem_var_17",
				 "elem_var_18",
				 "elem_var_19",
				 "elem_var_20",
				 "elem_death" };
  int numCompPerSeqVar[35] = { 1, 1, 3, 1, 3, 3, 3, 1, 1, 1, 
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1 };
  // index by mesh case, then numWholeVar, then time case, dim
  double whole_data[3][6][3][3] = {
    //mesh0
    { { { 0 }, { 88807.649481308574 }, { 949718.80284505396 } },
      { { 18272.507019106772 }, { 18025.029743366998 }, { 15292.025106031322 } },
      { { -10000.000000000002, 0, 0 },
        { -10000, 0, 94.147579330204906 },
        { -10000, 0, -1332.1649278144564 } },
      { { 0.00036545014038213698 }, { 0.0003644504705634498 }, { 0.00035410571803541591 } } },
    //mesh2
    { { { 0 }, { 8256.6239061093474 }, { 24300.601159291975 } },
      { { 242.34254490993845 }, { 228.07756454042843 }, { 208.43698970676724 } },
      { { -9999.9999999999745, 0, 0 },
        { -9859.0839639013993, 292.42785868343276, -11.577547735538644 },
        { -8146.7631113364496, -396.64095670576529, -1087.2117977015992 } },
      { { 4.8468508981987737e-06 }, { 4.8468508981987737e-06 }, { 4.5516372848211839e-06 } } },
    //mesh3
    { { { 253364.31178539552 }, { 253364.31178539543 }, { 253364.31178539543 } },
      { { 0 }, { 0 }, { 0 } },
      { { -9999.9999999999927, 0, 0.0050672862357079088 },
        { -9479.6379282239868, 147.75590796193566, 0.0050672862357079088 },
        { -8609.9022399457808, -92.799359184659664, 0.0050672862357079088 } },
      { { 0 }, { 0 }, { 0 } } } };
  // index by mesh case, then numVertVar, then time case
  // then entity case, and finally dim
  double vert_data[3][3][3][3][3] = {
    { //mesh0
      //seqVar20
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 0, -5.9999564244604429, 0 },
	  { 0, -5.9999564244604358, 0 },
	  { 0, -5.9999564244604358, 0 } },
	{ { 0, -30.000027329548598, 0 },
	  { 0, -30.000027329548601, 0 },
	  { 0, -30.000027329548601, 0 } } },
      //seqVar21
      { { { 0, -10000.000000000002, 0 },
	  { 0, -10000.000000000002, 0 },
	  { 0, -10000.000000000002, 0 } },
	{ { 0, -10000, 0 },
	  { 0, -10000, 0 },
	  { 0, -10000, 0 } },
	{ { 0, -10000, 0 },
	  { 0, -10000, 0 },
	  { 0, -10000, 0 } } },
      //seqVar22
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } } } },
    { //mesh2
      //seqVar20
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { -0.32086989994397896, -5.7921856421288638, -0.03137107142988782 },
	  { -0.3198508724984066, -5.7814562714306774, -0.029507923851930684 },
	  { -0.001831145073644791, -5.9029562258721313, 0.068883794908184193 } },
	{ { -3.9486990323590945, -28.403593585039278, -1.7956195735435898 },
	  { -3.7517500897990139, -28.012677699535931, -1.8535177458553349 },
	  { -0.05671005668473228, -29.279034328267443, 0.67047039584419466 } } },
      //seqVar21
      { { { 0, -10000, 0 },
	  { 0, -10000, 0 },
	  { 0, -10000, 0 } },
	{ { -229.81660022524864, -9075.2277766099014, -747.04262972556671 },
	  { 6.1044564994426782, -9968.3518534105133, 27.894963628624279 },
	  { -203.70276907999582, -10241.425748539465, -342.93508429088365 } },
	{ { -2585.27606908288, -8873.7536787042991, -1946.4129995328228 },
	  { -2314.3355720570939, -8693.3774479204858, -1853.8393584587834 },
	  { -100.79704392630534, -9601.4494621838057, -111.20792519101127 } } },
      //seqVar22
      { { { -8.542206407535231e-06, 3.0876065651518864e-06, 5.1360883054513501e-06 },
	  { 5.7956295696603842e-06, 1.5936175720717993e-06, 5.7198207848806033e-06 },
	  { 1.5949624136388367e-07, -2.5079928687011999e-07, 3.8150151008691537e-07 } },
	{ { -164524914.41935262, -147267179.00107133, 31541871.22058339 },
	  { 405124341.22745544, -316220617.84900677, 305601537.73729938 },
	  { -1006527579.2047399, 180803926.83646262, 800355138.66438925 } },
	{ { 571176814.57518888, 271982939.80056471, -1279040873.6411488 },
	  { -1104911041.2635636, 249449272.32702214, 97202445.759577259 },
	  { 939945399.05706525, 559242336.23385823, 686075968.38644207 } } } },
    { //mesh3
      //seqVar20
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { -0.32244358431904629, -5.7958556203660194, -0.031075064276365083 },
	  { -0.31597148560985744, -5.8034699613410154, -0.02950054513695477 },
	  { -0.00044725953362956261, -5.9034942479498227, 0.069068581434690302 } },
	{ { -4.0129814986565862, -28.525928458000877, -1.7591482731339667 },
	  { -3.8188384142811245, -28.625123506481547, -1.6168015981410093 },
	  { -0.010180624911658498, -29.297147616554312, 0.67827654715682062 } } },
      //seqVar21
      { { { 0, -10000, 0 },
	  { 0, -10000, 0 },
	  { 0, -10000, 0 } },
	{ { -153.9572546674006, -9397.2233003862475, -379.0648335769493 },
	  { -18.144309680098008, -10511.750632379588, 219.34441512715071 },
	  { -203.27344531104524, -10153.731942205668, 240.51510629346546 } },
	{ { -3183.2184526575988, -9196.9455507653201, -1739.3137673923936 },
	  { -3009.1960559264921, -9435.0968565570001, -1456.6173949443037 },
	  { 512.36085227678211, -9559.8719076438429, 61.214247386236835 } } },
      //seqVar22
      { { { 0, 0, 0 },
	  { -7.3970226003145985e-06, -1.6780302240578456e-06, 1.7153021274139731e-05 },
	  { -5.7467857133368827e-07, -3.6458422943800967e-07, -5.6153400012778268e-08 } },
	{ { -1542227931.2440321, 217865853.07227987, 1023532444.1741354 },
	  { 1600337272.35518, 924497054.27467573, -1134705113.3778169 },
	  { 5613481.6188645847, -257040980.46731716, 62562785.971550271 } },
	{ { 1221315569.2644784, -19713672.41466685, -1021964417.264284 },
	  { -162415699.46872979, 550853850.77575767, -2191704579.6673765 },
	  { -394227178.75097102, 1038847388.5511992, -1469598766.9016268 } } } } };
  // index by mesh case, then numElemVar, then time case
  // then entity case
  double elem_data[3][28][3][3] = {
    { //mesh0
      //seqVar23
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar24
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar25
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar26
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar27
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar28
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar29
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar30
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar31
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar32
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar33
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar34
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar35
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar36
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar37
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar38
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar39
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar40
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar41
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar42
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar43
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar44
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar45
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar46
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar47
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar48
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar49
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar50
      { { 1, 1, 1 },
	{ 1, 1, 1 },
	{ 1, 1, 1 } } },
    { //mesh2
      //seqVar23
      { { 0, 0, 0 },
	{ -4.7917331276736803, 33.485345369652777, -3.4974792719462955 },
	{ -28.208831154284212, -30.917661506250944, -128.22077673374076 } },
      //seqVar24
      { { 0, 0, 0 },
	{ -138.29300602433099, -84.067206617645738, -212.84589818462916 },
	{ -191.01960127274324, -158.06618043110547, -169.36535017628731 } },
      //seqVar25
      { { 0, 0, 0 },
	{ -79.266765468328032, -28.317525194706423, -118.42190460502795 },
	{ 37.888995255011707, 83.618346354851809, -165.23746306303374 } },
      //seqVar26
      { { 0, 0, 0 },
	{ 1.9046581699977632, -7.8803588925064663, -25.741041525170299 },
	{ 171.8899937916031, 166.32789986479855, -74.054348308781172 } },
      //seqVar27
      { { 0, 0, 0 },
	{ -91.819522052113101, -51.146112068624284, -147.05017898580172 },
	{ -15.868040713484035, 4.0969489322168409, -191.04416642995795 } },
      //seqVar28
      { { 0, 0, 0 },
	{ -11.55263887941909, 9.6689637615619972, -28.448397806411446 },
	{ 100.15673288194516, 122.32720181424513, -134.71977492686977 } },
      //seqVar29
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0.0031230813294037584, 0.0037757010968847786, 0.01061624905647828 } },
      //seqVar30
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 1.1422354007482532e-13, 2.4751546571050718e-14, 7.260968466264913e-13 } },
      //seqVar31
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ -2.8400877371922721e-13, -2.9477842690130092e-13, -5.7421366220965024e-13 } },
      //seqVar32
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 1.6165442485560329e-13, 2.4934086605525112e-13, -1.4164130834113906e-13 } },
      //seqVar33
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 2.923437455078746e-13, 3.76032794763217e-13, -3.7199829963390953e-13 } },
      //seqVar34
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ -1.2942828125132607e-13, -3.8433074788218995e-14, -1.153015751174648e-12 } },
      //seqVar35
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 1.3912459126098291e-13, 2.3453008152925904e-13, -4.3171610565808384e-13 } },
      //seqVar36
      { { 100, 100, 100 },
	{ 100, 100, 100 },
	{ 103.38208447555564, 104.08583928331406, 111.4076035335996 } },
      //seqVar37
      { { 0.0001, 0.0001, 0.0001 },
	{ 0.0001, 0.0001, 0.0001 },
	{ 0.00010093146865853407, 0.00010352597957580947, 0.00010163432488860121 } },
      //seqVar38
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0.031535149097877573, 0.040709300713861273, 0.017578713854274723 } },
      //seqVar39
      { { 300, 300, 300 },
	{ 300, 300, 300 },
	{ 300.34877209576689, 300.42049719915661, 301.23439239515903 } },
      //seqVar40
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 3845.5686316706306, 3411.5679430483033, 5449.6500066315903 } },
      //seqVar41
      { { 0.99989999999992984, 0.99990000000000823, 0.99990000000019608 },
	{ 0.99947638077051715, 0.99974932163084484, 0.9992624645384085 },
	{ 0.99954925773365999, 0.9996907709438575, 0.99901578280224312 } },
      //seqVar42
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar43
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar44
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar45
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar46
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar47
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0.0031230813294037584, 0.0037757010968847786, 0.01061624905647828 } },
      //seqVar48
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 34.361081116684183, 30.431765401715563, 46.340072524981757 } },
      //seqVar49
      { { 0, 0, 0 },
	{ -2.4111743551172009, 28.564061133544165, -16.16199025894862 },
	{ -47.969707095823566, -16.877663755295671, -311.95098036464992 } },
      //seqVar50
      { { 3, 3, 3 },
	{ 3, 3, 3 },
	{ 3, 3, 3 } } },
    { //mesh3
      //seqVar23
      { { 0, 0, 0 },
	{ -95.293615963207898, -94.6152669450628, -32.417774083047782 },
	{ -195.72589704910274, -371.08484742973582, -227.00645339685474 } },
      //seqVar24
      { { 0, 0, 0 },
	{ -185.64174179843306, -135.88568880697252, -222.90420125723793 },
	{ -202.87890730398053, -350.62114996427442, -134.57393203087472 } },
      //seqVar25
      { { 0, 0, 0 },
	{ -98.650475888514947, -67.524358413190754, -143.86891377526274 },
	{ -177.62598279010112, -259.80213105337788, -210.6176151867372 } },
      //seqVar26
      { { 0, 0, 0 },
	{ 45.374538669059014, 63.577889545760613, -21.288962260668427 },
	{ 169.35770926736816, 161.66461906878743, -59.498533544656347 } },
      //seqVar27
      { { 0, 0, 0 },
	{ -103.83297014062451, -59.207151773742574, -156.75742747934476 },
	{ 60.468083572796949, 1.7947209825713277, -160.88713784006904 } },
      //seqVar28
      { { 0, 0, 0 },
	{ -92.007133226496492, -64.840902915903214, -44.982715985305134 },
	{ -29.517538889697207, -151.26407481927029, -163.5600143551562 } },
      //seqVar29
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0.011305459200881982, 0.0093123303450548117, 0.015105167067974372 } },
      //seqVar30
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ -2.3680202548505193e-13, -2.420119673018799e-13, 6.2695861192746742e-13 } },
      //seqVar31
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 1.6104382589647506e-13, -1.9508906860543269e-13, -2.2602605782556772e-13 } },
      //seqVar32
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 5.4193763207295163e-14, 4.1550651894835495e-13, -3.6212577780702633e-13 } },
      //seqVar33
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 1.0185398799678143e-12, 9.2140162507350863e-13, -5.7685256279831753e-13 } },
      //seqVar34
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ -3.2369866854936832e-14, -1.0746303088668954e-13, -1.5577500280053092e-12 } },
      //seqVar35
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ -8.5738869852302368e-13, -7.988403774849409e-13, -9.8594526726257007e-13 } },
      //seqVar36
      { { 100, 100, 100 },
	{ 100, 100, 100 },
	{ 112.13803641747795, 110.01883463980933, 116.15448133707694 } },
      //seqVar37
      { { 0.0001, 0.0001, 0.0001 },
	{ 0.0001, 0.0001, 0.0001 },
	{ 0.00011426533072148567, 0.00011221736000958944, 0.0001043838080784127 } },
      //seqVar38
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0.094584209748630493, 0.078624395977759595, 0.058258257132198295 } },
      //seqVar39
      { { 300, 300, 300 },
	{ 300, 300, 300 },
	{ 301.31755063940176, 301.08675998601103, 301.78241506866863 } },
      //seqVar40
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 7627.126853299952, 7394.2271871804996, 8885.2400444942632 } },
      //seqVar41
      { { 0.99990000000018386, 0.99990000000042722, 0.99989999999999801 },
	{ 0.99917714966589255, 0.99933242004942491, 0.99056882963109849 },
	{ 0.99878370421087115, 0.99801902880858961, 0.99024018236504863 } },
      //seqVar42
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar43
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar44
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar45
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar46
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar47
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0.011305459200881982, 0.0093123303450548117, 0.015105167067974372 } },
      //seqVar48
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 64.215139872524972, 62.990337668719292, 73.059302237429407 } },
      //seqVar49
      { { 0, 0, 0 },
	{ -115.92317020448634, -101.51298208608132, -92.281754804814369 },
	{ -217.57245596371203, -365.81842290854456, -201.48737354168208 } },
      //seqVar50
      { { 4, 4, 4 },
	{ 4, 4, 4 },
	{ 4, 4, 4 } } } };
  int temp_numComp;
  FC_AssociationType temp_assoc;
  FC_MathType temp_mathType;
  double* temp_data;
  int* temp_int_data;

  // *** Test load dataset

  rc = fc_loadDataset(dataset_file_name, &dataset);
  fail_unless(rc == FC_SUCCESS, "failed to load dataset");

  // *** Test dataset

  rc = fc_getDatasetName(dataset, &temp_name);
  fail_unless(rc == FC_SUCCESS, "failed to get dataset name");
  fail_unless(!strcmp(temp_name, dataset_name), 
	      "mismatch of dataset name");
  free(temp_name);

  // *** Test sequences

  rc = fc_getSequences(dataset, &temp_num, &sequences);
  fail_unless(rc == FC_SUCCESS, "failed to get sequences");
  fail_unless(temp_num == numSeq, "mismatch of numSequence");
  for (i = 0; i < numSeq; i++) {

    // test sequence meta data
    rc = fc_getSequenceName(sequences[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence name");
    fail_unless(!strcmp(temp_name, sequence_name), 
		"mismatch of sequence name");
    free(temp_name);
    rc = fc_getSequenceInfo(sequences[i], &temp_num, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence info");
    fail_unless(temp_num == numStep, "mismatch of numStep");
    fail_unless(temp_dataType == dataType, 
		"mismatch of sequence dataType");

   // test sequence big data
    rc = fc_getSequenceCoordsPtr(sequences[i], (void**)&temp_seqCoords);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence coords");
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
	timeID = smallMidID;
      else if (j == 2)
	timeID = numStep-1;
      fail_unless(FC_DBL_EQUIV(seqCoords[j], temp_seqCoords[timeID]),
		  "mismatch of seq coords");
    }
  }
  free(sequences);

  // *** Test global vars

  rc = fc_getGlobalVariables(dataset, &temp_num, &glbVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global vars");
  fail_unless(temp_num == numGlbVar, "mismatch of numGlbVar");

  // *** Test global seq vars
  
  rc = fc_getGlobalSeqVariables(dataset, &temp_num, 
                                &temp_numStepPerSeqVar, &glbSeqVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global seq vars");
  fail_unless(temp_num == numGlbSeqVar, "mismatch of numGlbSeqVar");
  for (i = 0; i < numGlbSeqVar; i++) {

    // test glb seq variable meta data
    rc = fc_getVariableName(glbSeqVars[i][0], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable name");
    fail_unless(!strcmp(temp_name, glbSeqVarNames[i]), 
                "mismatch of glb seq variable name");
    free(temp_name);
    fail_unless(temp_numStepPerSeqVar[i] == numStep, 
                "mismatch of numStepPerSeqVar");
    rc = fc_getVariableInfo(glbSeqVars[i][0], &temp_num, &temp_numComp,
                            &temp_assoc, &temp_mathType, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable info");
    fail_unless(temp_numComp == numCompPerGlbSeqVar[i], "mismatch of numComp");
    fail_unless(temp_num == 1, "mismatch of numDataPoint");
    fail_unless(temp_assoc == FC_AT_WHOLE_DATASET, "mismatch of assoc");
    if (temp_numComp == 3)
      fail_unless(temp_mathType == FC_MT_VECTOR, 
                  "mismatch of glb seq var mathType");
    else
      fail_unless(temp_mathType == FC_MT_SCALAR, 
                  "mismatch of glb seq var mathType");
    fail_unless(temp_dataType == dataType, "mismatch of glb seq var dataType");
    
    // test glb seq variable big data
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
        timeID = smallMidID;
      else if (j == 2)
        timeID = numStep-1;
      rc = fc_getVariableDataPtr(glbSeqVars[i][timeID], (void**)&temp_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < temp_numComp; k++)
        fail_unless(FC_FLT_EQUIV(temp_data[k], global_data[i][j][k]),
                    "mismatch of global data");
    }
    
    // done with this glb seq variable
    fc_deleteSeqVariable(temp_numStepPerSeqVar[i], glbSeqVars[i]);
    free(glbSeqVars[i]);
  }
  free(temp_numStepPerSeqVar);
  free(glbSeqVars);

  // *** Test meshes

  rc = fc_getMeshes(dataset, &temp_num, &meshes);
  fail_unless(rc == FC_SUCCESS, "failed to get meshes");
  fail_unless(temp_num == numMesh, "mismatch of numMesh");
  for (i = 0; i < numMesh; i++) {
    int meshLU = -1;
    if (i == 0)
      meshLU = 0;
    else if (i == smallMidID)
      meshLU = 1;
    else if (i == numMesh-1)
      meshLU = 2;
  
    // test mesh meta data
    rc = fc_getMeshName(meshes[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh name");
    fail_unless(!strcmp(temp_name, meshNames[i]), "mismatch of mesh name");
    free(temp_name);
  
    rc = fc_getMeshInfo(meshes[i], &temp_topodim, &temp_numDim,
			&temp_numVert, &temp_numElem, &temp_elemType);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh info");
    fail_unless(temp_topodim == topodim, "mismatch of topodim");
    fail_unless(temp_numDim == numDim, "mismatch of numDim");
    fail_unless(temp_numVert == numVertPerMesh[i], "mismatch of numVert");
    fail_unless(temp_numElem == numElemPerMesh[i], "mismatch of numElem");
    fail_unless(temp_elemType == elemType, "mismatch of elemType");

    // test mesh big data
    if (meshLU > -1) {
      rc = fc_getMeshCoordsPtr(meshes[i], &temp_coords);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh coords");
      rc = fc_getMeshElementConnsPtr(meshes[i], &temp_conns);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh elem conns");
      numVertPerElem = fc_getElementTypeNumVertex(temp_elemType);
      for (j = 0; j < 3; j++) { // do 1st entity, middle entity & last entity
	int vertID = 0;
	int elemID = 0;
	if (j == 1) {
	  vertID = bigMidID;
	  elemID = bigMidID;
	}
	else if (j == 2) {
	  vertID = numVertPerMesh[i]-1;
	  elemID = numElemPerMesh[i]-1;
	}
	for (k = 0; k < numDim; k++) 
	  fail_unless(FC_DBL_EQUIV(temp_coords[vertID*numDim+k], 
				   coords[meshLU][j][k]),
		      "mismatch of coords");
	fail_unless(!memcmp(&temp_conns[elemID*numVertPerElem], 
			    conns[meshLU][j], numVertPerElem*sizeof(int)),
		    "mismatch of conns");
      }
    }

    // *** Test subsets

    rc = fc_getSubsets(meshes[i], &temp_num, &subsets);
    fail_unless(rc == FC_SUCCESS, "failed to get subsets");
    fail_unless(temp_num == numSubset, "mismatch of numSubset");

    // *** Test variables
 
    rc = fc_getVariables(meshes[i], &temp_num, &vars);
    fail_unless(rc == FC_SUCCESS, "failed to get variables");
    fail_unless(temp_num == numVar, "mismatch of numVar");
    for (j = 0; j < numVar; j++) {
      
      // test var meta data
      rc = fc_getVariableName(vars[j], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get variable name");
      fail_unless(!strcmp(temp_name, varNames[j]),
		  "mismatch of variable name");
      free(temp_name);
      rc = fc_getVariableInfo(vars[j], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");
      fail_unless(temp_numComp == 1, "mismatch of numComp");
      if (j == 0) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      fail_unless(temp_mathType == FC_MT_SCALAR, "mismatch of var mathType");
      fail_unless(temp_dataType == FC_DT_INT, "mismatch of var dataType");

      // test variable big data
      rc = fc_getVariableDataPtr(vars[j], (void**)&temp_int_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < 3; k++) {
	int entityID = 0;
	if (k == 1)
	  entityID = smallMidID;
	else if (k == 2)
	  entityID = temp_num - 1;
	fail_unless(globalIDs[i][j][k] == temp_int_data[entityID],
		    "data mismatch");
      }
    }
    free(vars);
  
    // *** Test seq variables

    rc = fc_getSeqVariables(meshes[i], &temp_num, &temp_numStepPerSeqVar, 
			    &seqVars);
    fail_unless(rc == FC_SUCCESS, "failed to get seq variables");
    fail_unless(temp_num == numSeqVar, "mismatch of numSeqVar");
    for (j = 0; j < numSeqVar; j++) {
      
      // test seq variable meta data
      rc = fc_getVariableName(seqVars[j][0], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable name");
      fail_unless(!strcmp(temp_name, seqVarNames[j]), 
		  "mismatch of seq variable name");
      free(temp_name);
      fail_unless(temp_numStepPerSeqVar[j] == numStep, 
		  "mismatch of numStepPerSeqVar");
      rc = fc_getVariableInfo(seqVars[j][0], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");;
      fail_unless(temp_numComp == numCompPerSeqVar[j], "mismatch of numComp");
      if (j < numWholeVar) {
	fail_unless(temp_num == 1, "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_WHOLE_MESH, "mismatch of assoc");
      }
      else if (j < numWholeVar + numVertVar) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      if (temp_numComp == 3)
	fail_unless(temp_mathType == FC_MT_VECTOR, 
		    "mismatch of seq var mathType");
      else
	fail_unless(temp_mathType == FC_MT_SCALAR, 
		    "mismatch of seq var mathType");
      fail_unless(temp_dataType == dataType, "mismatch of seq var dataType");

      // test seq variable big data
      if (meshLU > -1) {
	for (k = 0; k < 3; k++) {
	  int varLU;
	  int timeID = 0;
	  if (k == 1)
	    timeID = smallMidID;
	  else if (k == 2)
	    timeID = numStep-1;
	  rc = fc_getVariableDataPtr(seqVars[j][timeID], (void**)&temp_data);
	  fail_unless(rc == FC_SUCCESS, "failed to get variable data");
	  //printf("%d %d %d: temp = %g, known = %g\n", i, j, k,
	  //     temp_data[0], whole_data[meshLU][j][k]);
	  if (j < numWholeVar) {
            for (n = 0; n < temp_numComp; n++)
              fail_unless(FC_DBL_EQUIV(temp_data[n], 
                                       whole_data[meshLU][j][k][n]),
			"mismatch of whole data");
	  }
	  else {
	    for (m = 0; m < 3; m++) {
	      int entityID = 0;
	      if (m == 1)
		entityID = bigMidID;
	      else if (m == 2)
		entityID = temp_num-1;
	      if (j < numWholeVar + numVertVar) {
		varLU = j - numWholeVar;
		for (n = 0; n < temp_numComp; n++)
		  fail_unless(FC_DBL_EQUIV(temp_data[entityID*temp_numComp+n],
					   vert_data[meshLU][varLU][k][m][n]),
			      "mismatch of vert data");
	      }
	      else {
		// FIX? if we ever have a non scalar elem data, this'll change
		varLU = j - numWholeVar - numVertVar;
		fail_unless(FC_DBL_EQUIV(temp_data[entityID],
					 elem_data[meshLU][varLU][k][m]),
			    "mismatch of elem data");
	      }
	    }
	  }
	}
      }

      // done with this seq variable
      fc_deleteSeqVariable(temp_numStepPerSeqVar[j], seqVars[j]);
      free(seqVars[j]);
    }
    free(temp_numStepPerSeqVar);
    free(seqVars);

    // done with this mesh
    fc_deleteMesh(meshes[i]);
  }
  free(meshes);

  // All done
  rc = fc_deleteDataset(dataset);
  fail_unless(rc == FC_SUCCESS, "failed to delete dataset at end of test");
}
END_TEST

// We are confident of the given values.
// Test metadata on everything, test big data only on selection:
// 1st of that thing, middle thing of that thing, last of that thing..
// some of the middle things nest: e.g. only test big var data on
// meshes that we testing big data on.
// NOTE: float numbers were generated with %.8g so that there were
// extra digits past the significant digits so that FC_FT_EQUIV worked.
START_TEST(lsdyna_shells)
{
  int i, j, k, m, n;
  int midID = 2;   // for littler collections
  int numSeq = 1, numGlbVar = 0, numGlbSeqVar = 9, numMesh = 5;
  int numSubset = 0, numVar = 2;
  int numSeqVarPerMesh[5] = { 15, 15, 15, 15, 41 };
  int numWholeVar = 4, numVertVar = 3; //numElemVar = 8 or 34;
  int temp_num, *temp_numStepPerSeqVar;
  FC_ReturnCode rc;
  FC_Dataset dataset;
  FC_Sequence* sequences;
  FC_Mesh* meshes;
  FC_Subset* subsets;
  FC_Variable *glbVars, **glbSeqVars, *vars, **seqVars;
  char* dataset_file_name = shells; // has 2D elements
  char dataset_name[1024] = "AAAASCREWS";
  char* temp_name;
  char sequence_name[1024] = "time";
  int numStep = 5;
  FC_DataType dataType = FC_DT_DOUBLE;
  double seqCoords[3] = { 0, 2.9988344567694576e-05, 5.0023065894468063e-05 };
  FC_DataType temp_dataType;
  double* temp_seqCoords;
  char meshNames[5][1024] = { "Material_ID_1",
			      "Material_ID_6",
			      "Material_ID_7",
			      "Material_ID_362",
                              "Material_ID_50000" };
  int numDim = 3, numVertPerElem;
  int topodimPerMesh[5] = { 3, 3, 3, 3, 2 };
  int numVertPerMesh[5] = { 8679, 450, 416, 376, 23 };
  int numElemPerMesh[5] = { 7150, 297, 273, 249, 14 };
  FC_ElementType elemTypePerMesh[5] = { FC_ET_HEX, FC_ET_HEX, FC_ET_HEX,
					FC_ET_HEX, FC_ET_QUAD };
  //index by mesh case, then vert case, then numDim
  double coords[3][3][3] = {
    //mesh0 - verts 0, 2, & 8678
    { { 0.71181625000000004, -0.038183769999999999, -0.44999999000000002 },
      { 0.74487174, -0.085768990000000003, -0.44999999000000002 },
      { 0.25715292000000001, -0.27543287999999999, 0 } },
    //mesh2 - verts 0, 2, & 415
    { { 6.9388938999999995e-18, -0.067000000000000004, -0.44999999000000002 },
      { 4.1024312000000002e-18, -0.067000000000000004, -0.5 },
      { -0.00028005800999999998, 0.00057986972000000005, 0.24099999999999999 } },
    //mesh4 - verts 0, 2, & 22
    { { -1.32500017, 0.074999930000000006, -0.50999998999999996 },
      { -1.2000000500000001, 0.20000005000000001, -0.50999998999999996 },
      { -0.94999999000000002, -0.42500007000000001, -0.50999998999999996 } } };
  //index by mesh case, then elem case, then numVertPerElem
  int conns[3][3][8] = {
    //mesh0 - elems 0, 2, 7149
    { { 0, 1, 2, 3, 4, 5, 6, 7 },
      { 8, 12, 13, 9, 10, 14, 15, 11 },
      { 8526, 8525, 8598, 8599, 7737, 7736, 7809, 7810 } },
    //mesh2 - elems 0, 2, 272
    { { 88, 89, 90, 91, 92, 93, 94, 95 },
      { 96, 100, 101, 97, 98, 102, 103, 99 },
      { 415, 407, 409, 410, 406, 398, 400, 401 } },
    //mesh4 - elems 0, 2, 13
    { { 0, 3, 4, 1 },
      { 5, 7, 8, 6 },
      { 15, 16, 22, 21 } } };
  int temp_topodim, temp_numDim, temp_numVert, temp_numElem;
  FC_ElementType temp_elemType;
  int *temp_conns;
  double* temp_coords;
  char varNames[2][1024] = { "vert_IDs", "elem_IDs" };
  // index by mesh, then var, then vert/elem case
  // (global IDs is the var data)
  int globalIDs[5][2][3] = {
    { { 1, 3, 8679 }, { 1, 3, 7150 } },
    { { 555, 559, 9041 }, { 7151, 7153, 7447 } },
    { { 593, 597, 9369 }, { 7448, 7450, 7720 } },
    { { 1, 5, 9657 }, { 7721, 7723, 7969 } },
    { { 50000, 50002, 50022 }, { 50000, 50002, 50013 } } };
  char glbSeqVarNames[9][1024] = { "global_KE",
                                   "global_IE",
                                   "global_TE",
                                   "global_velocity",
                                   "global_work",
                                   "force_on_rw_1",
                                   "force_on_rw_2",
                                   "force_on_rw_3",
                                   "force_on_rw_4" };
  int numCompPerGlbSeqVar[9] = { 1, 1, 1, 3, 1, 1, 1, 1, 1 };
  // index by numvar, then time case, then dim
  double global_data[9][3][3] = { 
    { { 986.60069001481543 }, { 902.38898135491695 }, { 896.19609182840634 } },
    { { 9.9999999999999995e-21 }, { 65.227628879144987 }, { 28.67887975262461 } },
    { { 986.60069001481543 }, { 967.61661023406191 }, { 924.87497158103099 } },
    { { 0, 0, -558.46456121075425 },
      { -0.013215034362620054, 0.10118724752379069, -533.95594890179677 },
      { 0.0040359303713204753, 0.0083887107066174544, -531.89140996912829 } },
    { { 0 }, { 0.71890628591010319 }, { 0.42292270794776415 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } } };
  // index by mesh, then seqvar
  char seqVarNames[5][41][1024] = { { "mat_IE",
				      "mat_KE",
				      "mat_velocity",
				      "mass",
                                      "displacement",
				      "velocity",
				      "acceleration",
				      "sigma-xx",
				      "sigma-yy",
				      "sigma-zz",
				      "sigma-xy",
				      "sigma-yz",
				      "sigma-zx",
				      "plastic_strain",
				      "elem_death" },
				    { "mat_IE",
				      "mat_KE",
				      "mat_velocity",
				      "mass",
				      "displacement",
				      "velocity",
				      "acceleration",
				      "sigma-xx",
				      "sigma-yy",
				      "sigma-zz",
				      "sigma-xy",
				      "sigma-yz",
				      "sigma-zx",
				      "plastic_strain",
				      "elem_death" },
				    { "mat_IE",
				      "mat_KE",
				      "mat_velocity",
				      "mass",
				      "displacement",
				      "velocity",
				      "acceleration",
				      "sigma-xx",
				      "sigma-yy",
				      "sigma-zz",
				      "sigma-xy",
				      "sigma-yz",
				      "sigma-zx",
				      "plastic_strain",
				      "elem_death" }, 
				    { "mat_IE",
				      "mat_KE",
				      "mat_velocity",
				      "mass",
				      "displacement",
				      "velocity",
				      "acceleration",
				      "sigma-xx",
				      "sigma-yy",
				      "sigma-zz",
				      "sigma-xy",
				      "sigma-yz",
				      "sigma-zx",
				      "plastic_strain",
				      "elem_death" },
				    { "mat_IE",
				      "mat_KE",
				      "mat_velocity",
				      "mass",
				      "displacement",
				      "velocity",
				      "acceleration",
				      "mid-sigma-xx",
				      "mid-sigma-yy",
				      "mid-sigma-zz",
				      "mid-sigma-xy",
				      "mid-sigma-yz",
				      "mid-sigma-zx",
				      "mid-plastic_strain",
				      "in-sigma-xx",
				      "in-sigma-yy",
				      "in-sigma-zz",
				      "in-sigma-xy",
				      "in-sigma-yz",
				      "in-sigma-zx",
				      "in-plastic_strain",
				      "out-sigma-xx",
				      "out-sigma-yy",
				      "out-sigma-zz",
				      "out-sigma-xy",
				      "out-sigma-yz",
				      "out-sigma-zx",
				      "out-plastic_strain",
				      "mxx",
				      "myy",
				      "mxy",
				      "qx",
				      "qy",
				      "nxx",
				      "nyy",
				      "nxy",
				      "thickness",
				      "dv01",
				      "dv02",
				      "IE",
				      "elem_death" } };
  int numCompPerSeqVar[41] = { 1, 1, 3, 1, 3, 3, 3, 1, 1, 1, 
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1 };
  // index by mesh case, then numWholeVar, then time case, dim
  double whole_data[3][4][3][3] = {
    //mesh0
    { { { 0 }, { 26.086931314941591 }, { 13.903287460147377 } },
      { { 0.29672915899063723 }, { 0.65409858074099791 }, { 0.6436518593240721 } },
      { { 0, -561.00000000000364, 0 },
        { 0.10414076293827713, -535.56694842768354, 0.82652892780976017 },
        { 0.025522088175402788, -533.48248482041788, -1.0122814340569153 } },
      { { 1.3201463336890593e-05 }, { 1.3125650080812815e-05 }, { 1.2571598276874423e-05 } } },
    //mesh2
    { { { 0 }, { 6.7353672250788739 }, { 6.7177022164519657 } },
      { { 0.19197885354071725 }, { 0.53413026823860554 }, { 0.44283376731848323 } },
      { { 0, -86.340279548770198, 0 },
        { -0.7468547302928088, -206.49471807769137, 0.1084143614602829 },
        { -2.7720467507602442, -203.84637926203862, -0.48862821311511506 } },
      { { 7.4896428953756656e-06 }, { 7.1500197133082192e-06 }, { 7.1500197133082192e-06 } } },
    //mesh4
    { { { 985.81780219996324 }, { 900.19874687338279 }, { 893.5413386202232 } },
      { { 0 }, { -0.0036056293549465309 }, { 0.033654415832169687 } },
      { { 0, 0, 0.0062647093914925027 },
        { -0.0034471104224245062, -1.9722949358928081, 0.0062647093914925027 },
        { 0.010693318283067303, -2.6428836638680537, 0.0062647093914925027 } },
      { { 0 }, { 0 }, { 0 } } } };
  // index by mesh case, then numVertVar, then time case
  // then entity case, and finally dim
  double vert_data[3][3][3][3][3] = {
    { //mesh0
      //seqVar17
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { -9.9949416564326654e-05, 0.00023150220443644842, -0.016235964160646377 },
	  { -0.00010019631955981989, 0.00022920377018446902, -0.016308559232867059 },
	  { 2.3296388943605528e-05, -0.00034594775626117791, -0.016464106889684835 } },
	{ { -0.00016024647434020878, 0.00058478195236055103, -0.026820970785149723 },
	  { -0.00015933672422585587, 0.00058349915374963923, -0.026986241083182483 },
	  { 0.00013302850508967179, -0.00077120188294321768, -0.027170152124883093 } } },
      //seqVar18
      { { { 0, 0, -561 },
	  { 0, 0, -561 },
	  { 0, 0, -561 } },
	{ { -2.6486490987529692, 18.276811157361063, -526.98493383091045 },
	  { -3.1704043181464847, 17.280213094326264, -533.64724809415873 },
	  { 4.5359344965326285, -21.011443680992535, -528.21194151081954 } },
	{ { 3.1871861192368045, 24.994365314787419, -522.18149295060994 },
	  { 1.768975003436694, 24.719889329803639, -527.51767944394828 },
	  { 4.2677175722186727, -8.246368355091219, -535.56103128664108 } } },
      //seqVar19
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { -2748313.9473671648, -3093008.2008315246, -3202404.1552395979 },
	  { -902919.05637062562, -385286.03854831815, -4698412.2030936694 },
	  { 12176.153869640375, -2692932.5827112966, -1480858.8276511387 } },
	{ { -3188539.3786707167, -3471113.7584733409, 824577.73687963909 },
	  { -2347780.1560799377, -1805789.228486917, 792997.39038306789 },
	  { -3304517.2900337339, 792857.69422811223, -1069486.608313442 } } } },
    { //mesh2
      //seqVar17
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { -1.392982810202853e-05, 0.00029135172078895155, -0.016086829728419738 },
	  { -1.9611323485236023e-05, 0.00037360199551025874, -0.016093030369007 },
	  { -2.5938453423615475e-06, 5.8769644216469632e-06, -0.00028244752416622942 } },
	{ { -4.0897156665918355e-05, 0.00059831232363387332, -0.026388219432885163 },
	  { -6.3976087679412096e-05, 0.00075562368529645541, -0.026399909320822368 },
	  { -3.0247984245362469e-07, -6.9027989030453173e-06, -1.758527159875789e-05 } } },
      //seqVar18
      { { { 0, 0, -561 },
	  { 0, 0, -561 },
	  { 0, 0, 0 } },
	{ { -1.4284058308920184, 19.637503706844445, -514.26618598877928 },
	  { -1.4575550129681611, 25.031889463268016, -514.77181172544636 },
	  { -0.18410329949261586, 0.12054931260258889, -7.0120347203593081 } },
	{ { 2.3679079865017925, 5.6317561544302226, -512.85439271652263 },
	  { -1.0453167077468377, 7.6244917238154191, -513.57040728373727 },
	  { -1.9866913186681066, -1.2366253309794255, 20.413595099436662 } } },
      //seqVar19
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 553734.62180426961, 303812.54426907364, -14384084.999693358 },
	  { 908800.01746510004, -13783387.640384037, -16551139.816438656 },
	  { 6040.7463255870434, -12901.37899655836, 6228266.7451382484 } },
	{ { -311882.3954806687, 180515.42322597466, -5788084.6165899336 },
	  { 1796168.5032793295, -4991797.760587059, -5363897.3597103748 },
	  { 2685049.5048470013, -5812671.010158414, 47456374.349188812 } } } },
    { //mesh4
      //seqVar17
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 0, 0, 0 },
	  { -0.0013912106110685052, 1.106872419501248e-05, -0.018978571363834074 },
	  { -0.001952984898678678, -0.00012862596387563929, -0.027477963429240915 } },
	{ { 0, 0, 0 },
	  { -0.0047202494538713946, 5.2305356605525377e-05, -0.034751259927327527 },
	  { -0.0089341884402397431, -0.00026525963887463755, -0.076248101339123742 } } },
      //seqVar18
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 0, 0, 0 },
	  { -132.381804544234, -24.056779676911916, -1086.3225568691773 },
	  { -168.28999679214016, -6.0578048373344275, -1775.9561535764749 } },
	{ { 0, 0, 0 },
	  { -238.70966423257588, 11.135414425808124, -638.59566142652682 },
	  { -593.50647038577472, -16.79255238267482, -2882.071452615307 } } },
      //seqVar19
      { { { 0, 0, 0 },
	  { 0, 0, 0 },
	  { 0, 0, 0 } },
	{ { 0, 0, 0 },
	  { 17802352.665916067, 41306634.829919517, -238821588.96271068 },
	  { -28144067.75928086, -8178502.1866325913, -252247062.97125119 } },
	{ { 0, 0, 0 },
	  { 45064290.443946868, -8645107.6092578582, -153187375.1016573 },
	  { 84235531.366954088, -11069271.256362891, 494265700.93137622 } } } } };
  // index by mesh case, then numElemVar, then time case
  // then entity case
  double elem_data[3][34][3][3] = {
    { //mesh0
      //seqVar20
      { { 0, 0, 0 },
	{ -6010.7616517196666, -4203.2711945125884, -4577.1973169933826 },
	{ 409.72633773574989, 1953.1038661893508, -2627.4533209784026 } },
      //seqVar21
      { { 0, 0, 0 },
	{ -1674.1434686671064, -1125.1743518639673, -1954.2860190760118 },
	{ 2144.5210526911405, 2640.8046703427453, -2139.5311474057016 } },
      //seqVar22
      { { 0, 0, 0 },
	{ -642.81526723527315, -392.15741623113615, 395.82858570940067 },
	{ -366.62659524454432, -253.43286828007811, 13.540760904331174 } },
      //seqVar23
      { { 0, 0, 0 },
	{ -2337.0632999894478, -3071.4954838255499, 5022.6180149065058 },
	{ -1146.7384535644046, -1574.3728338567851, 1486.727462757648 } },
      //seqVar24
      { { 0, 0, 0 },
	{ -621.20917877435829, -348.77299137354714, 184.45951704580284 },
	{ -653.11714038521598, -440.16824810319918, 68.848509315278008 } },
      //seqVar25
      { { 0, 0, 0 },
	{ -510.47058442647483, -510.77673469749578, -854.43703859581308 },
	{ -1095.018681498924, -628.09095747282754, 102.62039654769664 } },
      //seqVar26
      { { 0, 0, 0 },
	{ 0.00011103627183494927, 7.6274706168094847e-05, 8.1808730004791344e-05 },
	{ -2.9168277269095188e-05, -5.7873008910021226e-05, 6.3379249433057235e-05 } },
      //seqVar27
      { { 1, 1, 1 },
	{ 1, 1, 1 },
	{ 1, 1, 1 } } },
    { //mesh2
      //seqVar20
      { { 0, 0, 0 },
	{ 5870.5371949360497, -3507.63384369195, -7187.6551890486371 },
	{ 310.64294517304324, -379.79558360756403, 1113.899477582986 } },
      //seqVar21
      { { 0, 0, 0 },
	{ 889.4397910964824, 2243.156825061048, -7355.1416832162704 },
	{ -53.165141960302563, -416.83410441562103, 710.43016245285276 } },
      //seqVar22
      { { 0, 0, 0 },
	{ -12887.807748207368, -16370.18098436326, 1242.6470534237801 },
	{ -2833.6265874095839, -2782.1686986216882, 2483.2099241610726 } },
      //seqVar23
      { { 0, 0, 0 },
	{ -4108.5452944020199, 4729.7767561097899, -65.008273957819085 },
	{ -340.32064163560233, 450.43133833951231, 78.651750318914992 } },
      //seqVar24
      { { 0, 0, 0 },
	{ 7385.1094304592152, 394.6223675048609, 681.3564292131573 },
	{ 458.93007051721497, -376.08439068381205, -261.44713539736705 } },
      //seqVar25
      { { 0, 0, 0 },
	{ -5046.7071355140024, -1820.9675087750213, 396.86761936957225 },
	{ -11.787009856784083, -142.01440627756298, 163.35269482462192 } },
      //seqVar26
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar27
      { { 3, 3, 3 },
	{ 3, 3, 3 },
	{ 3, 3, 3 } } },
    { //mesh4
      //seqVar20
      { { 0, 0, 0 },
	{ -1626.2427546865747, 3880.9418349119323, -160.85225910140991 },
	{ 961.54934988939135, 3456.6799365782949, -871.34611827285414 } },
      //seqVar21
      { { 0, 0, 0 },
	{ -953.81250130273827, 1987.4476071735955, -707.76634843978547 },
	{ -1164.5270226656319, 1022.9917114068411, 285.08757019569043 } },
      //seqVar22
      { { 0, 0, 0 },
	{ 359.47009143986236, -226.97770450836987, 217.91417659075614 },
	{ -164.18901860666412, -1914.6396377509523, 1029.213710029356 } },
      //seqVar23
      { { 0, 0, 0 },
	{ -2279.1722707928552, 367.24264872110791, -601.94552253163488 },
	{ -1494.9817287551132, -699.63153089809998, 1051.7928451518305 } },
      //seqVar24
      { { 0, 0, 0 },
	{ -668.02047000606751, 4957.772664762686, 1828.7967983041451 },
	{ -2208.2143989028382, -3049.2097694132781, 4381.9780941100544 } },
      //seqVar25
      { { 0, 0, 0 },
	{ -1072.8986248040183, 409.51467271811634, 6197.7409180769864 },
	{ 124.80867207912792, 2633.1415274706678, -3679.6359863557382 } },
      //seqVar26
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar27
      { { 0, 0, 0 },
	{ 53071.015301178399, 54934.840793816031, 38408.956101952339 },
	{ 80142.943734139539, 69384.571117289786, 28989.999122227844 } },
      //seqVar28
      { { 0, 0, 0 },
	{ 11070.815317448629, 17564.922780096913, -1621.4194834107539 },
	{ 23097.703988541729, 23653.178607434518, 6386.007790295529 } },
      //seqVar29
      { { 0, 0, 0 },
	{ 1616.924455745346, 1075.7913360921179, 226.57800254117842 },
	{ 6470.5384502856141, 4060.5620287302272, 1410.4265607119382 } },
      //seqVar30
      { { 0, 0, 0 },
	{ 4617.6854431393058, -655.9643535748022, 398.31202194678036 },
	{ 4340.3223006681937, -78.040959475131331, 1439.1212573974742 } },
      //seqVar31
      { { 0, 0, 0 },
	{ -1692.2464815990793, 5125.68117124337, 1835.1257785079995 },
	{ -3846.6038106138294, -3181.5878403917104, 4465.4397936457744 } },
      //seqVar32
      { { 0, 0, 0 },
	{ -9366.0912890773125, -7745.9358791588847, 6778.5097159671332 },
	{ -22795.453596480107, -17214.369902170598, -7041.8419278835436 } },
      //seqVar33
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar34
      { { 0, 0, 0 },
	{ -56323.500810551552, -47172.957123992157, -38730.660620155162 },
	{ -78219.845034360755, -62471.21124413317, -30732.691358773551 } },
      //seqVar35
      { { 0, 0, 0 },
	{ -12978.440320054107, -13590.027565749722, 205.88678653118285 },
	{ -25426.758033872993, -21607.195184620836, -5815.8326499041477 } },
      //seqVar36
      { { 0, 0, 0 },
	{ -897.98427286562128, -1529.7467451088582, 209.25035064033386 },
	{ -6798.916487498941, -7889.8413042321326, 648.00085934677372 } },
      //seqVar37
      { { 0, 0, 0 },
	{ -9176.0299847250153, 1390.4496510170179, -1602.2030670100501 },
	{ -7330.285758178421, -1321.2221023210686, 664.46443290618663 } },
      //seqVar38
      { { 0, 0, 0 },
	{ 356.20554158694461, 4789.8641582820019, 1822.467818100291 },
	{ -569.82498719184684, -2916.8316984348457, 4298.5163945743343 } },
      //seqVar39
      { { 0, 0, 0 },
	{ 7220.294039469275, 8564.9652245951183, 5616.9721201868388 },
	{ 23045.070940638365, 22480.652957111939, -317.43004482793248 } },
      //seqVar40
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar41
      { { 0, 0, 0 },
	{ 0.34712236288159704, 0.44968301024934998, -0.026337986026743948 },
	{ 0.70039320800749216, 0.65328073271392806, 0.17623611554798965 } },
      //seqVar42
      { { 0, 0, 0 },
	{ 1.6152721564321362, 1.5114067821390409, 1.1136276569602401 },
	{ 2.4772951249016564, 2.0756599926423949, 0.87290973376734216 } },
      //seqVar43
      { { 0, 0, 0 },
	{ -0.20127787087587745, 0.029932235683439948, -0.029639162658652268 },
	{ -0.17495900915152843, -0.018283667279230451, -0.01212160883499511 } },
      //seqVar44
      { { 0, 0, 0 },
	{ 10.008304484235746, -49.530724805548999, -18.482464574119234 },
	{ 25.34555212770255, 31.238174183973953, -44.5938801315585 } },
      //seqVar45
      { { 0, 0, 0 },
	{ -13.151847690025717, 10.291124178408735, 62.044682587382262 },
	{ 4.0797676344727032, 36.777122926015338, -38.177214507985454 } },
      //seqVar46
      { { 0, 0, 0 },
	{ -9.5762573998442804, 19.902518121780957, -6.7424591072931168 },
	{ -11.748958937018131, 10.085198029621054, 4.7198579487225913 } },
      //seqVar47
      { { 0, 0, 0 },
	{ -12.629594245650253, 36.511599253990596, 0.23541479778873509 },
	{ 8.0772920231891021, 15.565122072720783, -0.29030632920066068 } },
      //seqVar48
      { { 0, 0, 0 },
	{ 21.555465587718498, 4.1908533608597356, 5.1667497932559963 },
	{ 8.2083433957094627, -2.1764924026758625, -4.7399990221314017 } },
      //seqVar49
      { { 0.01, 0.01, 0.01 },
	{ 0.01, 0.01, 0.01 },
	{ 0.01, 0.01, 0.01 } },
      //seqVar50
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar51
      { { 0, 0, 0 },
	{ 0, 0, 0 },
	{ 0, 0, 0 } },
      //seqVar52
      { { 0, 0, 0 },
	{ 49.639434410774172, 42.068334089573447, 27.138330046938339 },
	{ 111.42350596821294, 77.722612315456459, 15.363575254609426 } },
      //seqVar53
      { { 5, 5, 5 },
	{ 5, 5, 5 },
	{ 5, 5, 5 } } } };
  int temp_numComp;
  FC_AssociationType temp_assoc;
  FC_MathType temp_mathType;
  double* temp_data;
  int* temp_int_data;

  // *** Test load dataset

  rc = fc_loadDataset(dataset_file_name, &dataset);
  fail_unless(rc == FC_SUCCESS, "failed to load dataset");

  // *** Test dataset

  rc = fc_getDatasetName(dataset, &temp_name);
  fail_unless(rc == FC_SUCCESS, "failed to get dataset name");
  fail_unless(!strcmp(temp_name, dataset_name), 
	      "mismatch of dataset name");
  free(temp_name);

  // *** Test sequences

  rc = fc_getSequences(dataset, &temp_num, &sequences);
  fail_unless(rc == FC_SUCCESS, "failed to get sequences");
  fail_unless(temp_num == numSeq, "mismatch of numSequence");
  for (i = 0; i < numSeq; i++) {

    // test sequence meta data
    rc = fc_getSequenceName(sequences[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence name");
    fail_unless(!strcmp(temp_name, sequence_name), 
		"mismatch of sequence name");
    free(temp_name);
    rc = fc_getSequenceInfo(sequences[i], &temp_num, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence info");
    fail_unless(temp_num == numStep, "mismatch of numStep");
    fail_unless(temp_dataType == dataType, 
		"mismatch of sequence dataType");

    // test sequence big data
    rc = fc_getSequenceCoordsPtr(sequences[i], (void**)&temp_seqCoords);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence coords");
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
	timeID = midID;
      else if (j == 2)
	timeID = numStep-1;
      fail_unless(FC_DBL_EQUIV(seqCoords[j], temp_seqCoords[timeID]),
		  "mismatch of seq coords");
    }
  }
  free(sequences);

  // *** Test global vars

  rc = fc_getGlobalVariables(dataset, &temp_num, &glbVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global vars");
  fail_unless(temp_num == numGlbVar, "mismatch of numGlbVar");

  // *** Test global seq vars
  
  rc = fc_getGlobalSeqVariables(dataset, &temp_num, 
                                &temp_numStepPerSeqVar, &glbSeqVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global seq vars");
  fail_unless(temp_num == numGlbSeqVar, "mismatch of numGlbSeqVar");
  for (i = 0; i < numGlbSeqVar; i++) {

    // test glb seq variable meta data
    rc = fc_getVariableName(glbSeqVars[i][0], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable name");
    fail_unless(!strcmp(temp_name, glbSeqVarNames[i]), 
                "mismatch of glb seq variable name");
    free(temp_name);
    fail_unless(temp_numStepPerSeqVar[i] == numStep, 
                "mismatch of numStepPerSeqVar");
    rc = fc_getVariableInfo(glbSeqVars[i][0], &temp_num, &temp_numComp,
                            &temp_assoc, &temp_mathType, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable info");
    fail_unless(temp_numComp == numCompPerGlbSeqVar[i], "mismatch of numComp");
    fail_unless(temp_num == 1, "mismatch of numDataPoint");
    fail_unless(temp_assoc == FC_AT_WHOLE_DATASET, "mismatch of assoc");
    if (temp_numComp == 3)
      fail_unless(temp_mathType == FC_MT_VECTOR, 
                  "mismatch of glb seq var mathType");
    else
      fail_unless(temp_mathType == FC_MT_SCALAR, 
                  "mismatch of glb seq var mathType");
    fail_unless(temp_dataType == dataType, "mismatch of glb seq var dataType");
    
    // test glb seq variable big data
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
        timeID = midID;
      else if (j == 2)
        timeID = numStep-1;
      rc = fc_getVariableDataPtr(glbSeqVars[i][timeID], (void**)&temp_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < temp_numComp; k++)
        fail_unless(FC_FLT_EQUIV(temp_data[k], global_data[i][j][k]),
                    "mismatch of global data");
    }
    
    // done with this glb seq variable
    fc_deleteSeqVariable(temp_numStepPerSeqVar[i], glbSeqVars[i]);
    free(glbSeqVars[i]);
  }
  free(temp_numStepPerSeqVar);
  free(glbSeqVars);

  // *** Test meshes
 
  rc = fc_getMeshes(dataset, &temp_num, &meshes);
  fail_unless(rc == FC_SUCCESS, "failed to get meshes");
  fail_unless(temp_num == numMesh, "mismatch of numMesh");
  for (i = 0; i < numMesh; i++) {
    int meshLU = -1;
    if (i == 0)
      meshLU = 0;
    else if (i == midID)
      meshLU = 1;
    else if (i == numMesh-1)
      meshLU = 2;
    
    // test mesh meta data
    rc = fc_getMeshName(meshes[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh name");
    fail_unless(!strcmp(temp_name, meshNames[i]), "mismatch of mesh name");
    free(temp_name);
    rc = fc_getMeshInfo(meshes[i], &temp_topodim, &temp_numDim,
			&temp_numVert, &temp_numElem, &temp_elemType);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh info");
    fail_unless(temp_topodim == topodimPerMesh[i], "mismatch of topodim");
    fail_unless(temp_numDim == numDim, "mismatch of numDim");
    fail_unless(temp_numVert == numVertPerMesh[i], "mismatch of numVert");
    fail_unless(temp_numElem == numElemPerMesh[i], "mismatch of numElem");
    fail_unless(temp_elemType == elemTypePerMesh[i], "mismatch of elemType");
   
    // test mesh big data
    if (meshLU > -1) {
      rc = fc_getMeshCoordsPtr(meshes[i], &temp_coords);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh coords");
      rc = fc_getMeshElementConnsPtr(meshes[i], &temp_conns);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh elem conns");
      numVertPerElem = fc_getElementTypeNumVertex(temp_elemType);
      for (j = 0; j < 3; j++) { // do 1st entity, middle entity & last entity
	int vertID = 0;
	int elemID = 0;
	if (j == 1) {
	  vertID = midID;
	  elemID = midID;
	}
	else if (j == 2) {
	  vertID = numVertPerMesh[i]-1;
	  elemID = numElemPerMesh[i]-1;
	}
	for (k = 0; k < numDim; k++) 
	  fail_unless(FC_DBL_EQUIV(temp_coords[vertID*numDim+k], 
				   coords[meshLU][j][k]),
		      "mismatch of coords");
	fail_unless(!memcmp(&temp_conns[elemID*numVertPerElem], 
			    conns[meshLU][j], numVertPerElem*sizeof(int)),
		    "mismatch of conns");
      }
    }
    
    // *** Test subsets

    rc = fc_getSubsets(meshes[i], &temp_num, &subsets);
    fail_unless(rc == FC_SUCCESS, "failed to get subsets");
    fail_unless(temp_num == numSubset, "mismatch of numSubset");
  
    // *** Test variables

    rc = fc_getVariables(meshes[i], &temp_num, &vars);
    fail_unless(rc == FC_SUCCESS, "failed to get variables");
    fail_unless(temp_num == numVar, "mismatch of numVar");
    for (j = 0; j < numVar; j++) {
      
      // test var meta data
      rc = fc_getVariableName(vars[j], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get variable name");
      fail_unless(!strcmp(temp_name, varNames[j]),
		  "mismatch of variable name");
      free(temp_name);
      rc = fc_getVariableInfo(vars[j], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");
      fail_unless(temp_numComp == 1, "mismatch of numComp");
      if (j == 0) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      fail_unless(temp_mathType == FC_MT_SCALAR, "mismatch of var mathType");
      fail_unless(temp_dataType == FC_DT_INT, "mismatch of var dataType");

      // test variable big data
      rc = fc_getVariableDataPtr(vars[j], (void**)&temp_int_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < 3; k++) {
	int entityID = 0;
	if (k == 1)
	  entityID = midID;
	else if (k == 2)
	  entityID = temp_num - 1;
	fail_unless(globalIDs[i][j][k] == temp_int_data[entityID],
		    "data mismatch");
      }
    }
    free(vars);
      
    // *** Test seq variables

    rc = fc_getSeqVariables(meshes[i], &temp_num, &temp_numStepPerSeqVar, 
			    &seqVars);
    fail_unless(rc == FC_SUCCESS, "failed to get seq variables");
    fail_unless(temp_num == numSeqVarPerMesh[i], "mismatch of numSeqVar");

    for (j = 0; j < numSeqVarPerMesh[i]; j++) {
      
      // test seq variable meta data
      rc = fc_getVariableName(seqVars[j][0], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable name");
      fail_unless(!strcmp(temp_name, seqVarNames[i][j]), 
		  "mismatch of seq variable name");
      free(temp_name);
      fail_unless(temp_numStepPerSeqVar[j] == numStep, 
		  "mismatch of numStepPerSeqVar");
      rc = fc_getVariableInfo(seqVars[j][0], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");
      fail_unless(temp_numComp == numCompPerSeqVar[j], "mismatch of numComp");
      if (j < numWholeVar) {
	fail_unless(temp_num == 1, "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_WHOLE_MESH, "mismatch of assoc");
      }
      else if (j < numWholeVar + numVertVar) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      if (temp_numComp == 3)
	fail_unless(temp_mathType == FC_MT_VECTOR, 
		    "mismatch of seq var mathType");
      else
	fail_unless(temp_mathType == FC_MT_SCALAR, 
		    "mismatch of seq var mathType");
      fail_unless(temp_dataType == dataType, "mismatch of seq var dataType");
      
      // test seq variable big data
      if (meshLU > -1) {
	for (k = 0; k < 3; k++) {
	  int varLU;
	  int timeID = 0;
	  if (k == 1)
	    timeID = midID;
	  else if (k == 2)
	    timeID = numStep-1;
	  rc = fc_getVariableDataPtr(seqVars[j][timeID], (void**)&temp_data);
	  fail_unless(rc == FC_SUCCESS, "failed to get variable data");
	  //printf("%d %d %d: temp = %g, known = %g\n", i, j, k,
	  //     temp_data[0], whole_data[meshLU][j][k]);
          if (j < numWholeVar) {
            for (n = 0; n < temp_numComp; n++) 
              fail_unless(FC_DBL_EQUIV(temp_data[n], 
                                       whole_data[meshLU][j][k][n]),
                          "mismatch of whole data");
	  }
	  else {
	    for (m = 0; m < 3; m++) {
	      int entityID = 0;
	      if (m == 1)
		entityID = midID;
	      else if (m == 2)
		entityID = temp_num-1;
	      if (j < numWholeVar + numVertVar) {
		varLU = j - numWholeVar;
		for (n = 0; n < temp_numComp; n++) {
		  fail_unless(FC_FLT_EQUIV(temp_data[entityID*temp_numComp+n],
					   vert_data[meshLU][varLU][k][m][n]),
			      "mismatch of vert data");
		}
	      }
	      else {
	      // FIX? if we ever have a non scalar elem data, this'll change
		varLU = j - numWholeVar - numVertVar;
		fail_unless(FC_DBL_EQUIV(temp_data[entityID],
					 elem_data[meshLU][varLU][k][m]),
			    "mismatch of elem data");
	      }
	    }
	  }
	}
      }
      
      // done with this seq variable
      fc_deleteSeqVariable(temp_numStepPerSeqVar[j], seqVars[j]);
      free(seqVars[j]);
    }
   
    free(temp_numStepPerSeqVar);
    free(seqVars);

    // done with this mesh
    fc_deleteMesh(meshes[i]);
  }
  free(meshes);
 
  // All done
  rc = fc_deleteDataset(dataset);
  fail_unless(rc == FC_SUCCESS, "failed to delete dataset at end of test");
}
END_TEST

// We are confident of the given values.
// Test metadata on everything, test big data only on selection:
// 1st of that thing, middle thing of that thing, last of that thing..
// some of the middle things nest: e.g. only test big var data on
// meshes that we testing big data on.
// NOTE: float numbers were generated with %.8g so that there were
// extra digits past the significant digits so that FC_FT_EQUIV worked.
// NOTE: quad mesh big data and children NOT TESTED!! If the shells
// test gets deleted, should expand this one.
START_TEST(lsdyna_multielemtype)
{
  int i, j, k, m, n;
  // we're going to have 4 mesh cases this time
  int midMeshID1 = 1; // the quad mesh
  int midMeshID2 = 2; // the line mesh
  int midID = 2; // the  
  int numSeq = 1, numGlbVar = 0, numGlbSeqVar = 12, numMesh = 8;
  int numSubset = 0, numVar = 2;
  int numSeqVarPerMesh[8] = { 15, 41, 14, 15, 15, 15, 15, 15 };
  int numWholeVar = 4, numVertVar = 3; //numElemVar = 8 or 34;
  int temp_num, *temp_numStepPerSeqVar;
  FC_ReturnCode rc;
  FC_Dataset dataset;
  FC_Sequence* sequences;
  FC_Mesh* meshes;
  FC_Subset* subsets;
  FC_Variable *glbVars, **glbSeqVars, *vars, **seqVars;
  char* dataset_file_name = multielemtype; // has 3D, 2D & 1D elements
  char dataset_name[1024] = "CONVERTTEST";
  char* temp_name;
  char sequence_name[1024] = "time";
  int numStep = 22;
  FC_DataType dataType = FC_DT_DOUBLE;
  double seqCoords[3] = { 0, 9.9941137960302576e-05, 0.0010000730593311114 };
  FC_DataType temp_dataType;
  double* temp_seqCoords;
  char meshNames[8][1024] = { "Material_ID_3",
                              "Material_ID_8",
                              "Material_ID_1",
                              "Material_ID_2",
                              "Material_ID_5",
                              "Material_ID_6",
                              "Material_ID_7",
                              "Material_ID_4" };
  int numDim = 3, numVertPerElem;
  int topodimPerMesh[8] = { 3, 2, 1, 3, 3, 3, 3, 3 };
  int numVertPerMesh[8] = { 4340, 325, 2, 200, 555, 2946, 123, 266 };
  int numElemPerMesh[8] = { 2892, 288, 1, 81, 420, 2112, 64, 102 };
  FC_ElementType elemTypePerMesh[8] = { FC_ET_HEX, FC_ET_QUAD, 
                                        FC_ET_LINE, FC_ET_HEX, 
                                        FC_ET_HEX, FC_ET_HEX, 
                                        FC_ET_HEX, FC_ET_HEX };
  //index by mesh case, then vert case, then numDim
  double coords[4][3][3] = {
    //mesh0 - verts 0, 2, & 4339
    { { -10.547191, 17.271999999999998, -12.054845 },
      { -10.513954999999999, 17.271999999999998, -12.20144 },
      { -10.251616, 15.897, -12.733454 } },
    //mesh1 - verts 0, 2, & 324
    { { -13.771872999999999, 15.968325, -8.1446629999999995 },
      { -13.771872999999999, 16.970963999999999, -8.1446629999999995 },
      { -4.4638577000000002, 21.984161, -15.364699 } },
    //mesh2 - verts 0, NA, & 1 (only 2)
    { { -11.114255999999999, 17.216953, -13.970928000000001 },
      {  },
      { -25.109553999999999, -3.2701172999999999, -33.271976000000002 } },
    //mesh7 - verts 0, 2, & 265
    { { -10.547191, 17.271999999999998, -12.054845 },
      { -10.664223, 17.271999999999998, -12.201974999999999 },
      { -9.2261480000000002, 17.271999999999998, -13.105649 } } };
  //index by mesh case, then elem case, then numVertPerElem
  int conns[4][3][8] = {
    //mesh0 - elems 0, 2, 2891
    { { 0, 1, 2, 3, 4, 5, 6, 7 },
      { 12, 13, 14, 15, 16, 17, 18, 19 },
      { 4289, 440, 438, 4299, 4329, 482, 480, 4339 } },
    //mesh1 - elems 0, 2, 287
    { { 0, 1, 14, 13 },
      { 2, 3, 16, 15 },
      { 310, 311, 324, 323 } },
    //mesh2 - elems 0 (only 1)
    { { 0, 1 } },
    //mesh7 - elems 0, 2, 101
    { { 114, 68, 69, 115, 116, 66, 67, 117 },
      { 118, 120, 114, 115, 119, 121, 116, 117 },
      { 264, 265, 262, 263, 260, 261, 258, 259 } } };
  int temp_topodim, temp_numDim, temp_numVert, temp_numElem;
  FC_ElementType temp_elemType;
  int *temp_conns;
  double* temp_coords;
  char varNames[2][1024] = { "vert_IDs", "elem_IDs" };
  // index by mesh, then var, then vert/elem case
  // (global IDs is the var data)
  int globalIDs[8][2][3] = {
    { { 526, 528, 4865 }, { 83, 85, 2974 } },
    { { 1, 3, 325 }, { 5673, 5675, 5960 } },
    { { 8531, -1, 8560 }, { 1, -1, -1 } }, // -1 = N/A
    { { 326, 328, 525 }, { 2, 4, 82 } },
    { { 5018, 5020, 5572 }, { 3077, 3079, 3496 } },
    { { 5573, 5575, 8518 }, { 3497, 3499, 5608 } },
    { { 5841, 5843, 8559 }, { 5609, 5611, 5672 } },
    { { 526, 534, 5017 }, { 2975, 2977, 3076 } } };
  char glbSeqVarNames[12][1024] = { "global_KE",
                                    "global_IE",
                                    "global_TE",
                                    "global_velocity",
                                    "global_work",
                                    "force_on_rw_1",
                                    "force_on_rw_2",
                                    "force_on_rw_3",
                                    "force_on_rw_4",
                                    "force_on_rw_5",
                                    "force_on_rw_6",
                                    "force_on_rw_7" };
  int numCompPerGlbSeqVar[12] = {1, 1, 1, 3, 1, 1, 1, 1, 1, 1, 1, 1 };
  // index by numvar, then time case, then dim
  double global_data[12][3][3] = {
    { { 0 }, { 23104.895315195194 }, { 1005.4976603039936 } },
    { { 9.9999999999999995e-21 }, { 0.021808265456726015 }, { 2.6621061045402898 } },
    { { 9.9999999999999995e-21 }, { 23104.917123460651 }, { 1008.1597664085339 } },
    { { 0, 0, 0 }, 
      { -119.19505017137847, -174.46251226392832, 164.35359449797707 }, 
      { -24.89021369705436, -36.431125048577329, 34.254726564541443 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 2.2688122126702191e-11 }, { 1.9687550340853042e-08 } },
    { { 0 }, { 0 }, { 0 } },
    { { 0 }, { 2.4008980273662081e-16 }, { 1.4115568892327564e-16 } } };
  // index by mesh, then seqvar
  char seqVarNames[8][41][1024] = { { "mat_IE",
                                      "mat_KE",
                                      "mat_velocity",
                                      "mass",
                                      "displacement",
                                      "velocity",
                                      "acceleration",
                                      "sigma-xx",
                                      "sigma-yy",
                                      "sigma-zz",
                                      "sigma-xy",
                                      "sigma-yz",
                                      "sigma-zx",
                                      "plastic_strain",
                                      "elem_death" },
                                    { "mat_IE",
                                      "mat_KE",
                                      "mat_velocity",
                                      "mass",
                                      "displacement",
                                      "velocity",
                                      "acceleration",
                                      "mid-sigma-xx",
                                      "mid-sigma-yy",
                                      "mid-sigma-zz",
                                      "mid-sigma-xy",
                                      "mid-sigma-yz",
                                      "mid-sigma-zx",
                                      "mid-plastic_strain",
                                      "in-sigma-xx",
                                      "in-sigma-yy",
                                      "in-sigma-zz",
                                      "in-sigma-xy",
                                      "in-sigma-yz",
                                      "in-sigma-zx",
                                      "in-plastic_strain",
                                      "out-sigma-xx",
                                      "out-sigma-yy",
                                      "out-sigma-zz",
                                      "out-sigma-xy",
                                      "out-sigma-yz",
                                      "out-sigma-zx",
                                      "out-plastic_strain",
                                      "mxx",
                                      "myy",
                                      "mxy",
                                      "qx",
                                      "qy",
                                      "nxx",
                                      "nyy",
                                      "nxy",
                                      "thickness",
                                      "dv01",
                                      "dv02",
                                      "IE",
                                      "elem_death" },
                                    { "mat_IE",
                                      "mat_KE",
                                      "mat_velocity",
                                      "mass",
                                      "displacement",
                                      "velocity",
                                      "acceleration",
                                      "axial_force",
                                      "s-shear",
                                      "t-shear",
                                      "s-bending",
                                      "t-bending",
                                      "torsion",
                                      "elem_death" },
                                    { "mat_IE",
                                      "mat_KE",
                                      "mat_velocity",
                                      "mass",
                                      "displacement",
                                      "velocity",
                                      "acceleration",
                                      "sigma-xx",
                                      "sigma-yy",
                                      "sigma-zz",
                                      "sigma-xy",
                                      "sigma-yz",
                                      "sigma-zx",
                                      "plastic_strain",
                                      "elem_death" },
                                    { "mat_IE",
                                      "mat_KE",
                                      "mat_velocity",
                                      "mass",
                                      "displacement",
                                      "velocity",
                                      "acceleration",
                                      "sigma-xx",
                                      "sigma-yy",
                                      "sigma-zz",
                                      "sigma-xy",
                                      "sigma-yz",
                                      "sigma-zx",
                                      "plastic_strain",
                                      "elem_death" },
                                    { "mat_IE",
                                      "mat_KE",
                                      "mat_velocity",
                                      "mass",
                                      "displacement",
                                      "velocity",
                                      "acceleration",
                                      "sigma-xx",
                                      "sigma-yy",
                                      "sigma-zz",
                                      "sigma-xy",
                                      "sigma-yz",
                                      "sigma-zx",
                                      "plastic_strain",
                                      "elem_death" },
                                    { "mat_IE",
                                      "mat_KE",
                                      "mat_velocity",
                                      "mass",
                                      "displacement",
                                      "velocity",
                                      "acceleration",
                                      "sigma-xx",
                                      "sigma-yy",
                                      "sigma-zz",
                                      "sigma-xy",
                                      "sigma-yz",
                                      "sigma-zx",
                                      "plastic_strain",
                                      "elem_death" },
                                    { "mat_IE",
                                      "mat_KE",
                                      "mat_velocity",
                                      "mass",
                                      "displacement",
                                      "velocity",
                                      "acceleration",
                                      "sigma-xx",
                                      "sigma-yy",
                                      "sigma-zz",
                                      "sigma-xy",
                                      "sigma-yz",
                                      "sigma-zx",
                                      "plastic_strain",
                                      "elem_death" } };
  // index by mesh, then seqvar
  int numCompPerSeqVar[41] = { 1, 1, 3, 1, 3, 3, 3, 1, 1, 1, 
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
                               1 }; 
  // index by mesh case, then numWholeVar, then time case, dim
  double whole_data[4][4][3][3] = {
    //mesh0
    { { { 0 }, { 0 }, { 0 } },
      { { 0 }, { 9.5822203879325198e-17 }, { 6.1421246517668482e-18 } },
      { { 0, 0, 0 },
        { 1.133206841688276e-08, -3.0989210377843994e-07, -2.6268140765506044e-07 },
        { -7.4899921763495759e-08, 1.2188635634862921e-07, -7.9282966485960588e-09 } },
      { { 0.002197139961761848 }, { 0.002197139961761848 }, { 0.002197139961761848 } } },
    //mesh1
    { { { 0 }, { 0.021808264963170669 }, { 2.6621056394439977 } },
      { { 0 }, { 23104.895315190861 }, { 23104.896188926396 } },
      { { 0, 0, 0 },
        { -6.3135032712073417e-09, 1.2985743463045309e-07, -890.56566574053124 },
        { 2.9945951996644327e-08, -4.3456711817585913e-08, -890.74500967341532 } },
      { { 0.011552126603651045 }, { 0.011552126603651045 }, { 0.011552126603651045 } } },
    //mesh2
    { { { 0 }, { 0 }, { 0 } },
      { { 0 }, { 0 }, { 0 } },
      { { 0, 0, 0 },
        { -1303.4964040055331, 1227.9677230237071, 0 },
        { -1303.7509119382105, 1227.740823627244, 0 } },
      { { 0.059535000000000067 }, { 0.059535000000000067 }, { 0.059535000000000067 } } },
    //mesh7
    { { { 0 }, { 2.9464029660688298e-16 }, { 2.4839462582945232e-16 } },
      { { 0 }, { 6.5920157957346564e-07 }, { 2.2598498412155672e-08 } },
      { { 0, 0, 0.00086486238702921682 },
        { 2.4144396674611803e-07, -1.2225734678479886e-06, 0.00086486238702921682 },
        { -9.7286590503653743e-08, -6.4942197560022594e-07, 0.00086486238702921682 } },
      { { 0 }, { 0 }, { 0 } } } };
  // index by mesh case, then numVertVar, then time case
  // then entity case, and finally dim
double vert_data[4][3][3][3][3] = {
  { //mesh0
    //seqVar4
    { { { -0.027069452479688394, 0, -0.031694233628293489 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      { { -0.027069452469991262, 1.4033219031261979e-12, -0.031694233627451496 },
        { 9.2050811417720979e-12, 1.3820056210533949e-12, 5.844214001626824e-13 },
        { 6.8922645368729718e-12, 1.2754242106893798e-12, -2.8421709430404007e-13 } },
      { { -0.027069452477599398, 2.4513724383723456e-13, -0.031694233628874358 },
        { 2.014388655879884e-12, 2.4868995751603507e-13, -6.1994853695068741e-13 },
        { 1.7923440509548527e-12, 2.7178259642823832e-13, -7.8870243669371121e-13 } } },
    //seqVar5
    { { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      { { 1.1384890389391046e-06, 2.9729389736265495e-08, -5.4407176204158758e-08 },
        { 1.0593937411257844e-06, 2.6722003550111745e-08, -9.592019543127296e-08 },
        { 6.5134989848607078e-07, 1.33107756005679e-08, -2.6246726976119927e-07 } },
      { { 1.0613054721135018e-06, -7.8587652149813669e-08, 5.6728021229308945e-07 },
        { 9.0563464143447479e-07, -7.8034041640629003e-08, 4.8557666776140683e-07 },
        { 1.686755386012325e-07, -7.5272097364000281e-08, 1.1503982576409989e-07 } } },
    //seqVar6
    { { { 0, 0, -0 },
        { 0, 0, -0 },
        { 0, 0, -0 } },
      { { -0.090824283915521595, -0.013831324978831425, -0.026422547797463631 },
        { -0.083524125064253413, -0.012684263371920995, -0.022591073068445992 },
        { -0.044565885763090292, -0.0074364717192253607, -0.016943567518603177 } },
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } } } },
  { //mesh1
    //seqVar4
    { { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      { { -2.042810365310288e-12, -5.8619775700208265e-13, 8.4732221239391947e-13 },
        { -2.1067592115286971e-12, -5.8619775700208265e-13, 8.0291329140891321e-13 },
        { -2.9851676686121209e-12, -3.0908609005564358e-13, -1.3500311979441904e-13 } },
      { { 4.0500935938325711e-13, -1.7763568394002505e-14, 1.3553602684623911e-12 },
        { 4.0323300254385686e-13, -1.7763568394002505e-14, 1.3322676295501878e-12 },
        { -1.2603251775544777e-12, -1.7408297026122455e-13, -9.2015284280932974e-13 } } },
    //seqVar5
    { { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      { { -2.0918893795964515e-07, -2.4855357528738643e-08, 1.7003505254177702e-07 },
        { -2.1344676458352736e-07, -2.4855357528738908e-08, 1.7020687989029229e-07 },
        { -3.0474313740986914e-07, 1.5909578806169099e-08, 8.0813228866590015e-08 } },
      { { -7.6802469306846217e-08, 3.0010961209912844e-08, -1.0575141242252904e-07 },
        { -7.6556550554977851e-08, 3.001096120991285e-08, -1.0565586424275322e-07 },
        { 3.3702119886259719e-08, 2.8416016062928149e-08, 3.5381329643560559e-08 } } },
    //seqVar6
    { { { -0, -0, 0 },
        { -0, -0, 0 },
        { -0, -0, 0 } },
      { { 0.015352579888145139, 0.0056966666768414331, -0.0042177760956088588 },
        { 0.016541891900241606, 0.0056966666768415771, -0.002987350112679935 },
        { 0.021543402764566112, 0.0035160069249426835, 0.0019464289878684531 } },
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } } } },
  { //mesh2 (only 2 verts)
    //seqVar4
    { { { 0, 0, 0 },
        {  }, 
        { 0, 0, 0 } },
      { { -5.5611875993122339e-08, -8.0462399409952923e-08, -7.6171263074797935e-08 },
        {  },
        { -0.089143520074351557, -0.13047691525347371, 0.12291712706296209 } },
      { { -5.8862785518698502e-05, -8.3561381625685272e-05, -7.6139285823728642e-05 },
        {  },
        { -0.89070354048786982, -1.3036982415690472, 1.2281624078818467 } } },
    //seqVar5
    { { { 0, 0, 0 },
        {  },
        { -0, -0, 0 } },
      { { -0.0016657405617913252, -0.0024040057174266496, -0.0022769761937338896 },
        {  },
        { -890.5639999999695, -1303.4939999998157, 1227.9699999999009 } },
      { { -0.18106237110940426, -0.25698687603143555, -0.22924033499388954 },
        {  },
        { -420.70928635896394, -615.78059579485011, 580.10247704953076 } } },
    //seqVar6
    { { { 0, 0, 0 },
        {  },
        { -11367370864.139797, -16638107667.928457, 15674101356.037014 } },
      { { -33.403918341914498, -47.980292524039349, -45.47502301166471 },
        {  },
        { -0.00044579251997253614, -0.0015959864803436652, 0.0013365565792178432 } },
      { { 0, 0, 0 },
        {  },
        { 3393019449.8558245, 4966269122.4459295, -4678525174.858119 } } } },
  { //mesh7
    //seqVar4
    { { { -0.027069452479688394, 0, -0.031694233628293489 },
        { 0, 0, 0 },
        { -0.017571884746164557, 0, -0.025002287630710995 } },
      { { -0.027069452469991262, 1.4033219031261979e-12, -0.031694233627451496 },
        { 9.2033047849326977e-12, 1.3855583347321954e-12, 1.2274625760255731e-12 },
        { -0.017571884746750754, -4.9240611588174943e-12, -0.025002287636578302 } },
      { { -0.027069452477599398, 2.4513724383723456e-13, -0.031694233628874358 },
        { 2.014388655879884e-12, 2.3803181647963356e-13, -5.2224891078367364e-13 },
        { -0.017571884745059663, -4.8459014578838833e-12, -0.025002287633114406 } } },
    //seqVar5
    { { { 0, 0, 0 },
        { 0, 0, 0 },
        { 0, 0, 0 } },
      { { 1.1384890389391046e-06, 2.9729389736265495e-08, -5.4407176204158758e-08 },
        { 1.0590254582533903e-06, 3.1286487225423286e-08, 7.5211704281655856e-09 },
        { 3.5092516120826025e-06, -2.0249576573836878e-06, 9.4163672643127635e-06 } },
      { { 1.0613054721135018e-06, -7.8587652149813669e-08, 5.6728021229308945e-07 },
        { 9.0490980819767315e-07, -7.6260858601558549e-08, 6.8916403382644155e-07 },
        { 5.1186006290740977e-07, 2.1293730075492728e-06, -6.6632947019957456e-07 } } },
    //seqVar6
    { { { 0, 0, -0 },
        { 0, 0, -0 },
        { 5.889886380877714, -28.804105222657622, -4.1382853876079935 } },
      { { -0.090824283915521595, -0.013831324978831425, -0.026422547797463631 },
        { -0.083490134124871912, -0.013243564041327876, -0.032138270227356186 },
        { 6.5874993652868543, -5.8810725597196889, 22.38556057252147 } },
      { { 0, 0, 0 },
        { 0, 0, 0 },
        { -2.0827904958720609, 1.0543023044245146, 2.2385474731192416 } } } } };
  // index by mesh case, then numElemVar, then time case
  // then entity case
 double elem_data[4][34][3][3] = {
   { //mesh0
     //seqVar7
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar8
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar9
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar10
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar11
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar12
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar13
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar14
     { { 1, 1, 1 },
       { 1, 1, 1 },
       { 1, 1, 1 } } },
   { //mesh1
     //seqVar7
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar8
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar9
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar10
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar11
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar12
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar13
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar14
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar15
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar16
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar17
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar18
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar19
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar20
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar21
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar22
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar23
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar24
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar25
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar26
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar27
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar28
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar29
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar30
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar31
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar32
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar33
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar34
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar35
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar36
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar37
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar38
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar39
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar40
     { { 2, 2, 2 },
       { 2, 2, 2 },
       { 2, 2, 2 } } },
   { //mesh2 (only 1 element)
     //seqVar7
     { { 0 },
       { 0.87491815080067026 },
       { 9.6665177282681203 } },
     //seqVar8
     { { 0 },
       { 0 },
       { 0 } },
     //seqVar9
     { { 0 },
       { 0 },
       { 0 } },
     //seqVar10
     { { 0 },
       { 0 },
       { 0 } },
     //seqVar11
     { { 0 },
       { 0 },
       { 0 } },
     //seqVar12
     { { 0 },
       { 0 },
       { 0 } },
     //seqVar13
     { { 3 },
       { 3 },
       { 3 } } },
   { //mesh7
     //seqVar7
     { { 0, 0, 0 },
       { -3.0436281626414336e-05, -0.00021101555139548987, -0.00020417224674456282 },
       { 9.4187393233936236e-06, -4.9840002736017234e-05, -0.00010398625487706034 } },
     //seqVar8
     { { 0, 0, 0 },
       { 7.3851517997526066e-05, -0.0002759230927622314, -8.4822473628157603e-05 },
       { -2.2419124761688243e-06, -0.00025877691335491417, -9.2839168938166567e-05 } },
     //seqVar9
     { { 0, 0, 0 },
       { -1.1364086780036912e-05, -8.6249757905556044e-05, -0.00011423293902907723 },
       { 8.4082592287436096e-05, -9.9320711121050437e-05, -0.00015318314905184304 } },
     //seqVar10
     { { 0, 0, 0 },
       { 7.5887705056091459e-05, -7.6235662309848503e-05, -0.00013043020975455821 },
       { 2.2749282675956839e-05, 6.4339997601985281e-05, -0.00012361280053798963 } },
     //seqVar11
     { { 0, 0, 0 },
       { -3.0575226716272252e-05, -4.8505696930344561e-05, -0.00012480516773581517 },
       { 9.1140870563894287e-06, 6.3734790401794063e-07, -5.2039872392786911e-05 } },
     //seqVar12
     { { 0, 0, 0 },
       { -3.5695373061544672e-05, -5.2417587768696503e-06, 6.0847252145659355e-06 },
       { -1.5625366110325633e-05, 3.7705320616581453e-05, 3.9112342916078451e-06 } },
     //seqVar13
     { { 0, 0, 0 },
       { 0, 0, 0 },
       { 0, 0, 0 } },
     //seqVar14
     { { 8, 8, 8 },
       { 8, 8, 8 },
       { 8, 8, 8 } } } };
  int temp_numComp;
  FC_AssociationType temp_assoc;
  FC_MathType temp_mathType;
  double* temp_data;
  int* temp_int_data;

  // *** Test load dataset

  rc = fc_loadDataset(dataset_file_name, &dataset);
  fail_unless(rc == FC_SUCCESS, "failed to load dataset");

  // *** Test dataset

  rc = fc_getDatasetName(dataset, &temp_name);
  fail_unless(rc == FC_SUCCESS, "failed to get dataset name");
  fail_unless(!strcmp(temp_name, dataset_name), 
	      "mismatch of dataset name");
  free(temp_name);

  // *** Test sequences

  rc = fc_getSequences(dataset, &temp_num, &sequences);
  fail_unless(rc == FC_SUCCESS, "failed to get sequences");
  fail_unless(temp_num == numSeq, "mismatch of numSequence");
  for (i = 0; i < numSeq; i++) {

    // test sequence meta data
    rc = fc_getSequenceName(sequences[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence name");
    fail_unless(!strcmp(temp_name, sequence_name), 
		"mismatch of sequence name");
    free(temp_name);
    rc = fc_getSequenceInfo(sequences[i], &temp_num, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence info");
    fail_unless(temp_num == numStep, "mismatch of numStep");
    fail_unless(temp_dataType == dataType, 
		"mismatch of sequence dataType");

    // test sequence big data
    rc = fc_getSequenceCoordsPtr(sequences[i], (void**)&temp_seqCoords);
    fail_unless(rc == FC_SUCCESS, "failed to get sequence coords");
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
	timeID = midID;
      else if (j == 2)
	timeID = numStep-1;
      fail_unless(FC_DBL_EQUIV(seqCoords[j], temp_seqCoords[timeID]),
		  "mismatch of seq coords");
    }
  }
  free(sequences);

  // *** Test global vars

  rc = fc_getGlobalVariables(dataset, &temp_num, &glbVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global vars");
  fail_unless(temp_num == numGlbVar, "mismatch of numGlbVar");

  // *** Test global seq vars
  
  rc = fc_getGlobalSeqVariables(dataset, &temp_num, 
                                &temp_numStepPerSeqVar, &glbSeqVars);
  fail_unless(rc == FC_SUCCESS, "failed to get global seq vars");
  fail_unless(temp_num == numGlbSeqVar, "mismatch of numGlbSeqVar");
  for (i = 0; i < numGlbSeqVar; i++) {

    // test glb seq variable meta data
    rc = fc_getVariableName(glbSeqVars[i][0], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable name");
    fail_unless(!strcmp(temp_name, glbSeqVarNames[i]), 
                "mismatch of glb seq variable name");
    free(temp_name);
    fail_unless(temp_numStepPerSeqVar[i] == numStep, 
                "mismatch of numStepPerSeqVar");
    rc = fc_getVariableInfo(glbSeqVars[i][0], &temp_num, &temp_numComp,
                            &temp_assoc, &temp_mathType, &temp_dataType);
    fail_unless(rc == FC_SUCCESS, "failed to get glb seq variable info");
    fail_unless(temp_numComp == numCompPerGlbSeqVar[i], "mismatch of numComp");
    fail_unless(temp_num == 1, "mismatch of numDataPoint");
    fail_unless(temp_assoc == FC_AT_WHOLE_DATASET, "mismatch of assoc");
    if (temp_numComp == 3)
      fail_unless(temp_mathType == FC_MT_VECTOR, 
                  "mismatch of glb seq var mathType");
    else
      fail_unless(temp_mathType == FC_MT_SCALAR, 
                  "mismatch of glb seq var mathType");
    fail_unless(temp_dataType == dataType, "mismatch of glb seq var dataType");
    
    // test glb seq variable big data
    for (j = 0; j < 3; j++) {
      int timeID = 0;
      if (j == 1)
        timeID = midID;
      else if (j == 2)
        timeID = numStep-1;
      rc = fc_getVariableDataPtr(glbSeqVars[i][timeID], (void**)&temp_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < temp_numComp; k++)
        fail_unless(FC_FLT_EQUIV(temp_data[k], global_data[i][j][k]),
                    "mismatch of global data");
    }
    
    // done with this glb seq variable
    fc_deleteSeqVariable(temp_numStepPerSeqVar[i], glbSeqVars[i]);
    free(glbSeqVars[i]);
  }
  free(temp_numStepPerSeqVar);
  free(glbSeqVars);

  // *** Test meshes
 
  rc = fc_getMeshes(dataset, &temp_num, &meshes);
  fail_unless(rc == FC_SUCCESS, "failed to get meshes");
  fail_unless(temp_num == numMesh, "mismatch of numMesh");
  for (i = 0; i < numMesh; i++) {
    int meshLU = -1;
    if (i == 0)
      meshLU = 0;
    else if (i == midMeshID1)
      meshLU = 1;
    else if (i == midMeshID2)
      meshLU = 2;
    else if (i == numMesh-1)
      meshLU = 3;

    // test mesh meta data
    rc = fc_getMeshName(meshes[i], &temp_name);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh name");
    fail_unless(!strcmp(temp_name, meshNames[i]), "mismatch of mesh name");
    free(temp_name);
    rc = fc_getMeshInfo(meshes[i], &temp_topodim, &temp_numDim,
			&temp_numVert, &temp_numElem, &temp_elemType);
    fail_unless(rc == FC_SUCCESS, "failed to get mesh info");
    fail_unless(temp_topodim == topodimPerMesh[i], "mismatch of topodim");
    fail_unless(temp_numDim == numDim, "mismatch of numDim");
    fail_unless(temp_numVert == numVertPerMesh[i], "mismatch of numVert");
    fail_unless(temp_numElem == numElemPerMesh[i], "mismatch of numElem");
    fail_unless(temp_elemType == elemTypePerMesh[i], "mismatch of elemType");
 
    // test mesh big data
    if (meshLU > -1) {
      rc = fc_getMeshCoordsPtr(meshes[i], &temp_coords);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh coords");
      rc = fc_getMeshElementConnsPtr(meshes[i], &temp_conns);
      fail_unless(rc == FC_SUCCESS, "failed to get mesh elem conns");
      numVertPerElem = fc_getElementTypeNumVertex(temp_elemType);
      for (j = 0; j < 3; j++) { // do 1st entity, middle entity & last entity
	int vertID = 0;
	int elemID = 0;
	if (j == 1) {
	  vertID = midID;
	  elemID = midID;
	}
	else if (j == 2) {
	  vertID = numVertPerMesh[i]-1;
	  elemID = numElemPerMesh[i]-1;
	}
        if (vertID < numVertPerMesh[i] && !(vertID == 0 && j == 2)) {
          for (k = 0; k < numDim; k++) 
              fail_unless(FC_DBL_EQUIV(temp_coords[vertID*numDim+k], 
                                       coords[meshLU][j][k]),
                          "mismatch of coords");
        }
        if (elemID < numElemPerMesh[i] && !(elemID == 0 && j == 2)) {
          fail_unless(!memcmp(&temp_conns[elemID*numVertPerElem], 
                              conns[meshLU][j], numVertPerElem*sizeof(int)),
                      "mismatch of conns");
        }
      }
    }

    // *** Test subsets

    rc = fc_getSubsets(meshes[i], &temp_num, &subsets);
    fail_unless(rc == FC_SUCCESS, "failed to get subsets");
    fail_unless(temp_num == numSubset, "mismatch of numSubset");
    
    // *** Test variables

    rc = fc_getVariables(meshes[i], &temp_num, &vars);
    fail_unless(rc == FC_SUCCESS, "failed to get variables");
    fail_unless(temp_num == numVar, "mismatch of numVar");
    for (j = 0; j < numVar; j++) {
      
      // test var meta data
      rc = fc_getVariableName(vars[j], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get variable name");
      fail_unless(!strcmp(temp_name, varNames[j]),
		  "mismatch of variable name");
      free(temp_name);
      rc = fc_getVariableInfo(vars[j], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");
      fail_unless(temp_numComp == 1, "mismatch of numComp");
      if (j == 0) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      fail_unless(temp_mathType == FC_MT_SCALAR, "mismatch of var mathType");
      fail_unless(temp_dataType == FC_DT_INT, "mismatch of var dataType");
     
      // test variable big data
      rc = fc_getVariableDataPtr(vars[j], (void**)&temp_int_data);
      fail_unless(rc == FC_SUCCESS, "failed to get variable data");
      for (k = 0; k < 3; k++) {
	int entityID = 0;
	if (k == 1)
	  entityID = midID;
	else if (k == 2)
	  entityID = temp_num - 1;
        if (entityID >= temp_num || (entityID == 0 && k == 2))
          continue; // skip if entity doesn't exist
	fail_unless(globalIDs[i][j][k] == temp_int_data[entityID],
		    "data mismatch");
      }
    }
    free(vars);
      
    // *** Test seq variables

    rc = fc_getSeqVariables(meshes[i], &temp_num, &temp_numStepPerSeqVar, 
			    &seqVars);
    fail_unless(rc == FC_SUCCESS, "failed to get seq variables");
    fail_unless(temp_num == numSeqVarPerMesh[i], "mismatch of numSeqVar");

    for (j = 0; j < numSeqVarPerMesh[i]; j++) {
      
      // test seq variable meta data
      rc = fc_getVariableName(seqVars[j][0], &temp_name);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable name");
      fail_unless(!strcmp(temp_name, seqVarNames[i][j]), 
		  "mismatch of seq variable name");
      free(temp_name);
      fail_unless(temp_numStepPerSeqVar[j] == numStep, 
		  "mismatch of numStepPerSeqVar");
      rc = fc_getVariableInfo(seqVars[j][0], &temp_num, &temp_numComp,
			      &temp_assoc, &temp_mathType, &temp_dataType);
      fail_unless(rc == FC_SUCCESS, "failed to get seq variable info");
      fail_unless(temp_numComp == numCompPerSeqVar[j], "mismatch of numComp");
      if (j < numWholeVar) {
	fail_unless(temp_num == 1, "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_WHOLE_MESH, "mismatch of assoc");
      }
      else if (j < numWholeVar + numVertVar) {
	fail_unless(temp_num == numVertPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_VERTEX, "mismatch of assoc");
      }
      else {
	fail_unless(temp_num == numElemPerMesh[i], "mismatch of numDataPoint");
	fail_unless(temp_assoc == FC_AT_ELEMENT, "mismatch of assoc");
      }
      if (temp_numComp == 3)
	fail_unless(temp_mathType == FC_MT_VECTOR, 
		    "mismatch of seq var mathType");
      else
	fail_unless(temp_mathType == FC_MT_SCALAR, 
		    "mismatch of seq var mathType");
      fail_unless(temp_dataType == dataType, "mismatch of seq var dataType");

      // test seq variable big data
      if (meshLU > -1) {
	for (k = 0; k < 3; k++) {
	  int varLU;
	  int timeID = 0;
	  if (k == 1)
	    timeID = midID;
	  else if (k == 2)
	    timeID = numStep-1;
	  rc = fc_getVariableDataPtr(seqVars[j][timeID], (void**)&temp_data);
	  fail_unless(rc == FC_SUCCESS, "failed to get variable data");
	  //printf("%d %d %d: temp = %g, known = %g\n", i, j, k,
	  //     temp_data[0], whole_data[meshLU][j][k]);
          if (j < numWholeVar) {
            for (n = 0; n < temp_numComp; n++) 
              fail_unless(FC_DBL_EQUIV(temp_data[n], 
                                       whole_data[meshLU][j][k][n]),
                          "mismatch of whole data");
	  }
	  else {
	    for (m = 0; m < 3; m++) {
	      int entityID = 0;
	      if (m == 1)
		entityID = midID;
	      else if (m == 2)
		entityID = temp_num-1;
              if (entityID >= temp_num || (entityID == 0 && m == 2))
                continue; // skip if entity doesn't exist
	      if (j < numWholeVar + numVertVar) {
		varLU = j - numWholeVar;
		for (n = 0; n < temp_numComp; n++) {
		  fail_unless(FC_FLT_EQUIV(temp_data[entityID*temp_numComp+n],
					   vert_data[meshLU][varLU][k][m][n]),
			      "mismatch of vert data");
		}
	      }
	      else {
	      // FIX? if we ever have a non scalar elem data, this'll change
		varLU = j - numWholeVar - numVertVar;
		fail_unless(FC_DBL_EQUIV(temp_data[entityID],
					 elem_data[meshLU][varLU][k][m]),
			    "mismatch of elem data");
	      }
	    }
	  }
	}
      }
 
      // done with this seq variable
      fc_deleteSeqVariable(temp_numStepPerSeqVar[j], seqVars[j]);
      free(seqVars[j]);
    }
      
    free(temp_numStepPerSeqVar);
    free(seqVars);

    // done with this mesh
    fc_deleteMesh(meshes[i]);
  }
  free(meshes);

  // All done
  rc = fc_deleteDataset(dataset);
  fail_unless(rc == FC_SUCCESS, "failed to delete dataset at end of test");
}
END_TEST

// *********************************************
// ***** Populate the Suite with the tests
// *********************************************

Suite *fileio2_suite(void)
{
  Suite *suite = suite_create("FileIO2");

#ifdef HAVE_EXODUS
  TCase *tc_exodus = tcase_create(" - Exodus IO ");
#endif
  TCase *tc_lsdyna = tcase_create(" - LSDyna IO ");

  // exodus file io
#ifdef HAVE_EXODUS
  suite_add_tcase(suite, tc_exodus);
  tcase_add_checked_fixture(tc_exodus, fileio_setup, fileio_teardown);
  tcase_add_test(tc_exodus, oldoldexo);
#endif

  // lsdyna file io
  suite_add_tcase(suite, tc_lsdyna);
  tcase_add_checked_fixture(tc_lsdyna, fileio_setup, fileio_teardown);
  tcase_add_test(tc_lsdyna, lsdyna_bigendian_flt);
  tcase_add_test(tc_lsdyna, lsdyna_littleendian_dbl);
  tcase_add_test(tc_lsdyna, lsdyna_temperature);
  tcase_add_test(tc_lsdyna, lsdyna_chunked);
  tcase_add_test(tc_lsdyna, lsdyna_shells);
  tcase_add_test(tc_lsdyna, lsdyna_multielemtype);

  return suite;
}
