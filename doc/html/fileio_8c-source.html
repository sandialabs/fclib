<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>FCLib: modules/fileio.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>modules/fileio.c</h1><a href="fileio_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (2000) Sandia Corporation. Under the terms of Contract</span>
<a name="l00003"></a>00003 <span class="comment"> * DE-AC04-94AL85000 with Sandia Corporation, the U.S. Government retains</span>
<a name="l00004"></a>00004 <span class="comment"> * certain rights in this software.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00007"></a>00007 <span class="comment"> * modification, are permitted provided that the following conditions are met:</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *   * Redistributions of source code must retain the above copyright</span>
<a name="l00010"></a>00010 <span class="comment"> *     notice, this list of conditions and the following disclaimer.</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> *   * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00013"></a>00013 <span class="comment"> *     notice, this list of conditions and the following disclaimer in the</span>
<a name="l00014"></a>00014 <span class="comment"> *     documentation and/or other materials provided with the</span>
<a name="l00015"></a>00015 <span class="comment"> *     distribution.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> *   * Neither the name of Sandia nor the names of any contributors may</span>
<a name="l00018"></a>00018 <span class="comment"> *     be used to endorse or promote products derived from this software</span>
<a name="l00019"></a>00019 <span class="comment"> *     without specific prior written permission.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> *   * Modified source versions must be plainly marked as such, and must</span>
<a name="l00022"></a>00022 <span class="comment"> *     not be misrepresented as being the original software.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</span>
<a name="l00025"></a>00025 <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00026"></a>00026 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00027"></a>00027 <span class="comment"> * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR</span>
<a name="l00028"></a>00028 <span class="comment"> * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<a name="l00029"></a>00029 <span class="comment"> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<a name="l00030"></a>00030 <span class="comment"> * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="l00031"></a>00031 <span class="comment"> * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00032"></a>00032 <span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
<a name="l00033"></a>00033 <span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
<a name="l00034"></a>00034 <span class="comment"> * DAMAGE.</span>
<a name="l00035"></a>00035 <span class="comment"> */</span>
<a name="l00036"></a>00036 <span class="comment"></span>
<a name="l00037"></a>00037 <span class="comment">/**</span>
<a name="l00038"></a>00038 <span class="comment"> * \file fileio.c</span>
<a name="l00039"></a>00039 <span class="comment"> * \brief Implementation for \ref FileIO module.</span>
<a name="l00040"></a>00040 <span class="comment"> * </span>
<a name="l00041"></a>00041 <span class="comment"> * $Source: /home/Repositories/fcdmf/fclib/modules/fileio.c,v $</span>
<a name="l00042"></a>00042 <span class="comment"> * $Revision: 1.40 $ </span>
<a name="l00043"></a>00043 <span class="comment"> * $Date: 2006/11/07 23:49:02 $</span>
<a name="l00044"></a>00044 <span class="comment"> */</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment">// C library includes</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span> <span class="comment">// for stat() call to see if vald file</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">// aux file types</span>
<a name="l00053"></a>00053 <span class="preprocessor">#ifdef HAVE_LIBXML2</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="comment">//#include &lt;libxml/tree.h&gt; // already included from fileioP.h</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;libxml/parser.h&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#endif</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>
<a name="l00058"></a>00058 <span class="comment">// fc library dependencies</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include "<a class="code" href="base_8h.html">base.h</a>"</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include "<a class="code" href="storage_8h.html">storage.h</a>"</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include "<a class="code" href="library_8h.html">library.h</a>"</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include "<a class="code" href="dataset_8h.html">dataset.h</a>"</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include "<a class="code" href="sequence_8h.html">sequence.h</a>"</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include "<a class="code" href="mesh_8h.html">mesh.h</a>"</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include "<a class="code" href="subset_8h.html">subset.h</a>"</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include "<a class="code" href="variable_8h.html">variable.h</a>"</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include "<a class="code" href="tableP_8h.html">tableP.h</a>"</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include "<a class="code" href="libraryP_8h.html">libraryP.h</a>"</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include "<a class="code" href="datasetP_8h.html">datasetP.h</a>"</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include "<a class="code" href="sequenceP_8h.html">sequenceP.h</a>"</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include "<a class="code" href="subsetP_8h.html">subsetP.h</a>"</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include "<a class="code" href="meshP_8h.html">meshP.h</a>"</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include "<a class="code" href="variableP_8h.html">variableP.h</a>"</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">// this module (specific io types embedded in fileioP.h"</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include "<a class="code" href="fileio_8h.html">fileio.h</a>"</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include "<a class="code" href="fileioP_8h.html">fileioP.h</a>"</span>
<a name="l00079"></a>00079 <span class="comment"></span>
<a name="l00080"></a>00080 <span class="comment">/**</span>
<a name="l00081"></a>00081 <span class="comment"> * \addtogroup FileIO</span>
<a name="l00082"></a>00082 <span class="comment"> * \brief Generic file IO.</span>
<a name="l00083"></a>00083 <span class="comment"> *</span>
<a name="l00084"></a>00084 <span class="comment"> * \description</span>
<a name="l00085"></a>00085 <span class="comment"> *</span>
<a name="l00086"></a>00086 <span class="comment"> *    This file provides wrappers to the various file IO options to hide the</span>
<a name="l00087"></a>00087 <span class="comment"> *    specific implementations (the specific implementations should generally</span>
<a name="l00088"></a>00088 <span class="comment"> *    not be used). We used to support certian SAF conventions, but</span>
<a name="l00089"></a>00089 <span class="comment"> *    no longer. For details about a specific type of IO</span>
<a name="l00090"></a>00090 <span class="comment"> *    see \ref ExodusFileIO \ref LSDynaFileIO.</span>
<a name="l00091"></a>00091 <span class="comment"> *</span>
<a name="l00092"></a>00092 <span class="comment"> * \modifications</span>
<a name="l00093"></a>00093 <span class="comment"> *    - 07/13/2005 WSD created to separate file IO out more so that it is</span>
<a name="l00094"></a>00094 <span class="comment"> *      easier to add new types.</span>
<a name="l00095"></a>00095 <span class="comment"> *    - 10/15/2007 ACG removed saf</span>
<a name="l00096"></a>00096 <span class="comment"> */</span>
<a name="l00097"></a>00097 <span class="comment"></span>
<a name="l00098"></a>00098 <span class="comment">/**</span>
<a name="l00099"></a>00099 <span class="comment"> * \ingroup FileIO</span>
<a name="l00100"></a>00100 <span class="comment"> * \defgroup PrivateFileIO (Private Generic IO)</span>
<a name="l00101"></a>00101 <span class="comment"> * \brief Generic file IO.</span>
<a name="l00102"></a>00102 <span class="comment"> */</span>
<a name="l00103"></a>00103 <span class="comment"></span>
<a name="l00104"></a>00104 <span class="comment">/**</span>
<a name="l00105"></a>00105 <span class="comment"> * \ingroup FileIO</span>
<a name="l00106"></a>00106 <span class="comment"> * \defgroup ExodusFileIO (Private Exodus IO)</span>
<a name="l00107"></a>00107 <span class="comment"> */</span>
<a name="l00108"></a>00108 <span class="comment"></span>
<a name="l00109"></a>00109 <span class="comment">/**</span>
<a name="l00110"></a>00110 <span class="comment"> * \ingroup FileIO</span>
<a name="l00111"></a>00111 <span class="comment"> * \defgroup LSDynaFileIO (Private LS-Dyna IO)</span>
<a name="l00112"></a>00112 <span class="comment"> */</span>
<a name="l00113"></a>00113 <span class="comment"></span>
<a name="l00114"></a>00114 <span class="comment">/**</span>
<a name="l00115"></a>00115 <span class="comment"> * \ingroup  PrivateFileIO</span>
<a name="l00116"></a>00116 <span class="comment"> * \brief  Read FC vertex file.</span>
<a name="l00117"></a>00117 <span class="comment"> *</span>
<a name="l00118"></a>00118 <span class="comment"> * \description  </span>
<a name="l00119"></a>00119 <span class="comment"> *</span>
<a name="l00120"></a>00120 <span class="comment"> *    This routine is used to bootstrap example dataset files. The file</span>
<a name="l00121"></a>00121 <span class="comment"> *    contains the coordinates of a set of points. The coords are returned</span>
<a name="l00122"></a>00122 <span class="comment"> *    interleaved, e.g. Vert0Coord0 Vert0Coord1 Vert0Coord2 Vert1Coord0</span>
<a name="l00123"></a>00123 <span class="comment"> *    Vert1Coord1 Vert1Coord2 ... VertNCoord0 VertNCoord1 VertNCoord2.</span>
<a name="l00124"></a>00124 <span class="comment"> *</span>
<a name="l00125"></a>00125 <span class="comment"> *    Currently this assumes 3D coordinates.</span>
<a name="l00126"></a>00126 <span class="comment"> *</span>
<a name="l00127"></a>00127 <span class="comment"> * \todo Modify this and _fc_readDataFile() to take numDim/numComponent.</span>
<a name="l00128"></a>00128 <span class="comment"> *</span>
<a name="l00129"></a>00129 <span class="comment"> * \modifications  </span>
<a name="l00130"></a>00130 <span class="comment"> *   - 8/24/2005 WSD, created.</span>
<a name="l00131"></a>00131 <span class="comment"> */</span>
<a name="l00132"></a><a class="code" href="group__PrivateFileIO.html#gea1070ada8cacfb9e2028a7c6aa07b11">00132</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#gea1070ada8cacfb9e2028a7c6aa07b11">_fc_readVertexFile</a>(
<a name="l00133"></a>00133   <span class="keywordtype">char</span>* vertfilename, <span class="comment">/**&lt; input - file with vertex coords. */</span>
<a name="l00134"></a>00134   <span class="keywordtype">int</span>* numVert,       <span class="comment">/**&lt; output - number of vertices. */</span>
<a name="l00135"></a>00135   <span class="keywordtype">int</span>* numDim,        <span class="comment">/**&lt; output - dimensionality of the coords. */</span>
<a name="l00136"></a>00136   <span class="keywordtype">double</span>** coords     <span class="comment">/**&lt; output - the coordinates of the vertes. */</span>
<a name="l00137"></a>00137 ) {
<a name="l00138"></a>00138   <span class="keywordtype">int</span> i, count, temp_numVert, temp_numDim;
<a name="l00139"></a>00139   FILE* vertfile;
<a name="l00140"></a>00140   <span class="keywordtype">double</span>* temp_coords;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142   <span class="comment">// default return</span>
<a name="l00143"></a>00143   <span class="keywordflow">if</span> (numVert)
<a name="l00144"></a>00144     *numVert = -1;
<a name="l00145"></a>00145   <span class="keywordflow">if</span> (numDim)
<a name="l00146"></a>00146     *numDim = -1;
<a name="l00147"></a>00147   <span class="keywordflow">if</span> (coords)
<a name="l00148"></a>00148     *coords = NULL;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150   <span class="comment">// check inputs</span>
<a name="l00151"></a>00151   <span class="keywordflow">if</span> (!vertfilename || !numVert || !numDim || !coords)
<a name="l00152"></a>00152     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l00153"></a>00153   
<a name="l00154"></a>00154   <span class="comment">// Attempt to open the files</span>
<a name="l00155"></a>00155   vertfile = fopen(vertfilename, <span class="stringliteral">"r"</span>);
<a name="l00156"></a>00156   <span class="keywordflow">if</span> (!vertfile) {
<a name="l00157"></a>00157     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Could not open vert file '%s'"</span>, vertfilename);
<a name="l00158"></a>00158     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l00159"></a>00159   }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   <span class="comment">// Read metada</span>
<a name="l00162"></a>00162   temp_numDim = 3; <span class="comment">// ASSUMPTION!</span>
<a name="l00163"></a>00163   count = fscanf(vertfile, <span class="stringliteral">"%d"</span>, &amp;temp_numVert);
<a name="l00164"></a>00164   <span class="keywordflow">if</span> (count != 1 || temp_numVert &lt; 1) {
<a name="l00165"></a>00165     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Error reading number of verts in vert file '%s'"</span>,
<a name="l00166"></a>00166                  vertfilename);
<a name="l00167"></a>00167     fclose(vertfile);
<a name="l00168"></a>00168     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00169"></a>00169   }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171   <span class="comment">// Read coords</span>
<a name="l00172"></a>00172   temp_coords = malloc(temp_numVert*temp_numDim*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00173"></a>00173   <span class="keywordflow">if</span> (!temp_coords) {
<a name="l00174"></a>00174     fclose(vertfile);
<a name="l00175"></a>00175     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l00176"></a>00176   }
<a name="l00177"></a>00177   <span class="keywordflow">for</span> (i = 0; i &lt; temp_numVert*temp_numDim; i++) {
<a name="l00178"></a>00178     <span class="keywordflow">if</span> (fscanf(vertfile, <span class="stringliteral">"%lf"</span>, &amp;temp_coords[i]) != 1) {
<a name="l00179"></a>00179       <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"error reading coords for vert %d"</span>, i/temp_numDim);
<a name="l00180"></a>00180       free(temp_coords);
<a name="l00181"></a>00181       fclose(vertfile);
<a name="l00182"></a>00182       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184   }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   <span class="comment">// All dones</span>
<a name="l00187"></a>00187   fclose(vertfile);
<a name="l00188"></a>00188   *numVert = temp_numVert;
<a name="l00189"></a>00189   *numDim = temp_numDim;
<a name="l00190"></a>00190   *coords = temp_coords;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 <span class="comment"></span>
<a name="l00195"></a>00195 <span class="comment">/**</span>
<a name="l00196"></a>00196 <span class="comment"> * \ingroup  PrivateFileIO</span>
<a name="l00197"></a>00197 <span class="comment"> * \brief  Read FC element file.</span>
<a name="l00198"></a>00198 <span class="comment"> *</span>
<a name="l00199"></a>00199 <span class="comment"> * \description</span>
<a name="l00200"></a>00200 <span class="comment"> *  </span>
<a name="l00201"></a>00201 <span class="comment"> *    This routine is used to bootstrap example dataset files. The file</span>
<a name="l00202"></a>00202 <span class="comment"> *    contains the element connetivities for a mesh. The conns are </span>
<a name="l00203"></a>00203 <span class="comment"> *    returned interleaved, e.g. Elem0Vert0 Elem0Vert1 .. Elem0VertN</span>
<a name="l00204"></a>00204 <span class="comment"> *    Elem1Vert0 Elem1Vert1 .. Elem1VertN ... ElemMVert0 ElemMVert1 ..</span>
<a name="l00205"></a>00205 <span class="comment"> *    ElemMVertN.</span>
<a name="l00206"></a>00206 <span class="comment"> *</span>
<a name="l00207"></a>00207 <span class="comment"> * \modifications  </span>
<a name="l00208"></a>00208 <span class="comment"> *   - 8/24/2005 WSD, created.</span>
<a name="l00209"></a>00209 <span class="comment"> */</span>
<a name="l00210"></a><a class="code" href="group__PrivateFileIO.html#g1fbb524b92169e663ad9c68a0ccf0572">00210</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g1fbb524b92169e663ad9c68a0ccf0572">_fc_readElementFile</a>(
<a name="l00211"></a>00211   <span class="keywordtype">char</span>* elemfilename, <span class="comment">/**&lt; input - file with element conns */</span>
<a name="l00212"></a>00212   <span class="keywordtype">int</span>* numVert,       <span class="comment">/**&lt; output - number of vertices */</span>
<a name="l00213"></a>00213   <span class="keywordtype">int</span>* numElem,       <span class="comment">/**&lt; output - number of elements */</span>
<a name="l00214"></a>00214   <a class="code" href="group__DataTypes.html#g5d0bf8bd47afb81d89d4c5d60c7d62b4">FC_ElementType</a>* elemType, <span class="comment">/**&lt; output - element type */</span>
<a name="l00215"></a>00215   <span class="keywordtype">char</span>** name,  <span class="comment">/**&lt; output - name of mesh (user responsible for freeing */</span>
<a name="l00216"></a>00216   <span class="keywordtype">int</span>** conns         <span class="comment">/**&lt; output - element conns */</span>
<a name="l00217"></a>00217 ) {
<a name="l00218"></a>00218   <span class="keywordtype">int</span> i, count;
<a name="l00219"></a>00219   <span class="keywordtype">int</span> numVertPerElem, temp_numVert, temp_numElem;
<a name="l00220"></a>00220   FILE* elemfile;
<a name="l00221"></a>00221   <span class="keywordtype">char</span> temp_name[1024];
<a name="l00222"></a>00222   <a class="code" href="group__DataTypes.html#g5d0bf8bd47afb81d89d4c5d60c7d62b4">FC_ElementType</a> temp_elemType;
<a name="l00223"></a>00223   <span class="keywordtype">int</span>* temp_conns;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225   <span class="comment">// default return</span>
<a name="l00226"></a>00226   <span class="keywordflow">if</span> (numVert)
<a name="l00227"></a>00227     *numVert = -1;
<a name="l00228"></a>00228   <span class="keywordflow">if</span> (numElem)
<a name="l00229"></a>00229     *numElem = -1;
<a name="l00230"></a>00230   <span class="keywordflow">if</span> (elemType)
<a name="l00231"></a>00231     *elemType = <a class="code" href="group__DataTypes.html#gg5d0bf8bd47afb81d89d4c5d60c7d62b482f13396326035faaa6778b457101a3e">FC_ET_UNKNOWN</a>;
<a name="l00232"></a>00232   <span class="keywordflow">if</span> (name)
<a name="l00233"></a>00233     *name = NULL;
<a name="l00234"></a>00234   <span class="keywordflow">if</span> (conns)
<a name="l00235"></a>00235     *conns = NULL;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   <span class="comment">// check inputs</span>
<a name="l00238"></a>00238   <span class="keywordflow">if</span> (!elemfilename || !numVert || !numElem || !elemType || !name || !conns)
<a name="l00239"></a>00239     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l00240"></a>00240   
<a name="l00241"></a>00241   <span class="comment">// Attempt to open the file</span>
<a name="l00242"></a>00242   elemfile = fopen(elemfilename, <span class="stringliteral">"r"</span>);
<a name="l00243"></a>00243   <span class="keywordflow">if</span> (!elemfile) {
<a name="l00244"></a>00244     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Could not open elem file '%s'"</span>, elemfilename);
<a name="l00245"></a>00245     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l00246"></a>00246   }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248   <span class="comment">// Read metadata</span>
<a name="l00249"></a>00249   <span class="comment">// FIX? don't have to put in mesh name?</span>
<a name="l00250"></a>00250   count = fscanf(elemfile, <span class="stringliteral">"%d%d"</span>, &amp;temp_numVert, &amp;temp_numElem);
<a name="l00251"></a>00251   <span class="keywordflow">if</span> (count != 2 || temp_numVert &lt; 1 || temp_numElem &lt; 1) {
<a name="l00252"></a>00252     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"error reading number of verts and elems in "</span>
<a name="l00253"></a>00253                  <span class="stringliteral">"elem file '%s'"</span>, elemfilename);
<a name="l00254"></a>00254     fclose(elemfile);
<a name="l00255"></a>00255     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00256"></a>00256   }
<a name="l00257"></a>00257   fscanf(elemfile, <span class="stringliteral">"%s\n"</span>, temp_name);
<a name="l00258"></a>00258   <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"POINT"</span>))
<a name="l00259"></a>00259     temp_elemType = <a class="code" href="group__DataTypes.html#gg5d0bf8bd47afb81d89d4c5d60c7d62b4011f9f91ef1e03bf40940c68b44f4c30">FC_ET_POINT</a>;
<a name="l00260"></a>00260   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"LINE"</span>))
<a name="l00261"></a>00261     temp_elemType = <a class="code" href="group__DataTypes.html#gg5d0bf8bd47afb81d89d4c5d60c7d62b4e17a2f7fa15c69d4f9c2f89ecbab0c18">FC_ET_LINE</a>;
<a name="l00262"></a>00262   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"TRI"</span>))
<a name="l00263"></a>00263     temp_elemType = <a class="code" href="group__DataTypes.html#gg5d0bf8bd47afb81d89d4c5d60c7d62b4eb83ad249f4296eaf2609e27b6a59aa1">FC_ET_TRI</a>;
<a name="l00264"></a>00264   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"QUAD"</span>))
<a name="l00265"></a>00265     temp_elemType = <a class="code" href="group__DataTypes.html#gg5d0bf8bd47afb81d89d4c5d60c7d62b406121f0d65d618dcb6111ba50740b4ad">FC_ET_QUAD</a>;
<a name="l00266"></a>00266   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"TET"</span>))
<a name="l00267"></a>00267     temp_elemType = <a class="code" href="group__DataTypes.html#gg5d0bf8bd47afb81d89d4c5d60c7d62b493889d88ac4d5cbd3f0c5b6ddcb7022d">FC_ET_TET</a>;
<a name="l00268"></a>00268   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"PYRAMID"</span>))
<a name="l00269"></a>00269     temp_elemType = <a class="code" href="group__DataTypes.html#gg5d0bf8bd47afb81d89d4c5d60c7d62b43b1aa291ea6a8432b07075f53b38756d">FC_ET_PYRAMID</a>;
<a name="l00270"></a>00270   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"PRISM"</span>))
<a name="l00271"></a>00271     temp_elemType = <a class="code" href="group__DataTypes.html#gg5d0bf8bd47afb81d89d4c5d60c7d62b401f884cd916ee4eda7dbbc791446b9f1">FC_ET_PRISM</a>;
<a name="l00272"></a>00272   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"HEX"</span>))
<a name="l00273"></a>00273     temp_elemType = <a class="code" href="group__DataTypes.html#gg5d0bf8bd47afb81d89d4c5d60c7d62b49e84aa94138112a229fbaf4f69b4735b">FC_ET_HEX</a>;
<a name="l00274"></a>00274   <span class="keywordflow">else</span> {
<a name="l00275"></a>00275     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"unknown element type encountered '%s'"</span>,
<a name="l00276"></a>00276                  temp_name);
<a name="l00277"></a>00277     fclose(elemfile);
<a name="l00278"></a>00278     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00279"></a>00279   }
<a name="l00280"></a>00280   numVertPerElem = <a class="code" href="group__DataTypes.html#gf75ed80296bf7b5631bf464ea4a4de25">fc_getElementTypeNumVertex</a>(temp_elemType);
<a name="l00281"></a>00281   fscanf(elemfile, <span class="stringliteral">"%[^\n]"</span>, temp_name); <span class="comment">// now the mesh name</span>
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   <span class="comment">// Read conns</span>
<a name="l00284"></a>00284   temp_conns = malloc(temp_numElem*numVertPerElem*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00285"></a>00285   <span class="keywordflow">if</span> (!temp_conns) {
<a name="l00286"></a>00286     fclose(elemfile);
<a name="l00287"></a>00287     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l00288"></a>00288   }
<a name="l00289"></a>00289   <span class="keywordflow">for</span> (i = 0; i &lt; temp_numElem*numVertPerElem; i++) {
<a name="l00290"></a>00290     <span class="keywordflow">if</span> (fscanf(elemfile, <span class="stringliteral">"%d"</span>, &amp;temp_conns[i]) != 1) {
<a name="l00291"></a>00291       <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"error reading conns for element %d"</span>,
<a name="l00292"></a>00292                    i/numVertPerElem);
<a name="l00293"></a>00293       free(temp_conns);
<a name="l00294"></a>00294       fclose(elemfile);
<a name="l00295"></a>00295       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297   }
<a name="l00298"></a>00298   fclose(elemfile);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="comment">// All done</span>
<a name="l00301"></a>00301   *name = malloc((strlen(temp_name)+1)*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00302"></a>00302   <span class="keywordflow">if</span> (!(*name)) {
<a name="l00303"></a>00303     free(temp_conns);
<a name="l00304"></a>00304     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l00305"></a>00305   }
<a name="l00306"></a>00306   strcpy(*name, temp_name);
<a name="l00307"></a>00307   *numVert = temp_numVert;
<a name="l00308"></a>00308   *numElem = temp_numElem;
<a name="l00309"></a>00309   *elemType = temp_elemType;
<a name="l00310"></a>00310   *conns = temp_conns;
<a name="l00311"></a>00311   
<a name="l00312"></a>00312   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 <span class="comment"></span>
<a name="l00315"></a>00315 <span class="comment">/**</span>
<a name="l00316"></a>00316 <span class="comment"> * \ingroup  PrivateFileIO</span>
<a name="l00317"></a>00317 <span class="comment"> * \brief  Read FC data file.</span>
<a name="l00318"></a>00318 <span class="comment"> *</span>
<a name="l00319"></a>00319 <span class="comment"> * \description</span>
<a name="l00320"></a>00320 <span class="comment"> *  </span>
<a name="l00321"></a>00321 <span class="comment"> *    This routine is used to bootstrap example dataset files. The file</span>
<a name="l00322"></a>00322 <span class="comment"> *    contains data values for a mesh. The values are </span>
<a name="l00323"></a>00323 <span class="comment"> *    returned interleaved, e.g. Point0Comp0 Point0Comp1 .. Point0CompN</span>
<a name="l00324"></a>00324 <span class="comment"> *    Point1Comp0 Point1Comp1 .. Point1CompN ... PointMComp0 PointMComp1 ..</span>
<a name="l00325"></a>00325 <span class="comment"> *    PointMCompN.</span>
<a name="l00326"></a>00326 <span class="comment"> *</span>
<a name="l00327"></a>00327 <span class="comment"> *    Only supports scalars, 3D vectors and 3 component symmetric tensors.</span>
<a name="l00328"></a>00328 <span class="comment"> *</span>
<a name="l00329"></a>00329 <span class="comment"> * \todo Make this read doubles? or make able to read multiple types</span>
<a name="l00330"></a>00330 <span class="comment"> *</span>
<a name="l00331"></a>00331 <span class="comment"> * \modifications  </span>
<a name="l00332"></a>00332 <span class="comment"> *   - 8/24/2005 WSD, created.</span>
<a name="l00333"></a>00333 <span class="comment"> *   - 5/11/2006 WSD modified to read vectors and 3 component symtensor.</span>
<a name="l00334"></a>00334 <span class="comment"> */</span>
<a name="l00335"></a><a class="code" href="group__PrivateFileIO.html#g4d826e51d3a8150d155124274b411056">00335</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g4d826e51d3a8150d155124274b411056">_fc_readDataFile</a>(
<a name="l00336"></a>00336   <span class="keywordtype">char</span>* datafilename, <span class="comment">/**&lt; input - file with data values */</span>
<a name="l00337"></a>00337   <span class="keywordtype">int</span>* numPoint,      <span class="comment">/**&lt; output - number of data points */</span>
<a name="l00338"></a>00338   <span class="keywordtype">int</span>* numComp,       <span class="comment">/**&lt; output - number of components */</span>
<a name="l00339"></a>00339   <a class="code" href="group__DataTypes.html#g63044bd7bb5313d8a79ea8a71f1b3040">FC_AssociationType</a>* assoc, <span class="comment">/**&lt; output - how data is associated with mesh */</span>
<a name="l00340"></a>00340   <a class="code" href="group__DataTypes.html#gf4416c02a52bd37e799d442b985151b3">FC_MathType</a>* mathType, <span class="comment">/**&lt; output - math type of data (scalar or vector) */</span>
<a name="l00341"></a>00341   <span class="keywordtype">char</span>** name,  <span class="comment">/**&lt; output - name of variable (user responsible for freeing) */</span>
<a name="l00342"></a>00342   <span class="keywordtype">float</span>** data        <span class="comment">/**&lt; output - data values */</span>
<a name="l00343"></a>00343 ) {
<a name="l00344"></a>00344   <span class="keywordtype">int</span> i, count;
<a name="l00345"></a>00345   <span class="keywordtype">int</span> temp_numPoint, temp_numComp;
<a name="l00346"></a>00346   FILE* datafile;
<a name="l00347"></a>00347   <span class="keywordtype">char</span> temp_name[1024];
<a name="l00348"></a>00348   <span class="keywordtype">float</span>* temp_data;
<a name="l00349"></a>00349   <a class="code" href="group__DataTypes.html#g63044bd7bb5313d8a79ea8a71f1b3040">FC_AssociationType</a> temp_assoc;
<a name="l00350"></a>00350   <a class="code" href="group__DataTypes.html#gf4416c02a52bd37e799d442b985151b3">FC_MathType</a> temp_mathType;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <span class="comment">// default return</span>
<a name="l00353"></a>00353   <span class="keywordflow">if</span> (numPoint)
<a name="l00354"></a>00354     *numPoint = -1;
<a name="l00355"></a>00355   <span class="keywordflow">if</span> (numComp)
<a name="l00356"></a>00356     *numComp = -1;
<a name="l00357"></a>00357   <span class="keywordflow">if</span> (assoc)
<a name="l00358"></a>00358     *assoc = <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b3040dc201b7d1982fc7cf126faa5d610fa25">FC_AT_UNKNOWN</a>;
<a name="l00359"></a>00359   <span class="keywordflow">if</span> (mathType)
<a name="l00360"></a>00360     *mathType = <a class="code" href="group__DataTypes.html#ggf4416c02a52bd37e799d442b985151b360243d4fe6e959788b2d492ed4b11867">FC_MT_UNKNOWN</a>;
<a name="l00361"></a>00361   <span class="keywordflow">if</span> (name)
<a name="l00362"></a>00362     *name = NULL;
<a name="l00363"></a>00363   <span class="keywordflow">if</span> (data)
<a name="l00364"></a>00364     *data = NULL;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   <span class="comment">// check inputs</span>
<a name="l00367"></a>00367   <span class="keywordflow">if</span> (!datafilename || !numPoint || !numComp || !assoc || !mathType ||
<a name="l00368"></a>00368       !name || !data)
<a name="l00369"></a>00369     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l00370"></a>00370   
<a name="l00371"></a>00371   <span class="comment">// Attempt to open the file</span>
<a name="l00372"></a>00372   datafile = fopen(datafilename, <span class="stringliteral">"r"</span>);
<a name="l00373"></a>00373   <span class="keywordflow">if</span> (!datafile) {
<a name="l00374"></a>00374     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Could not open data file '%s'"</span>, datafilename);
<a name="l00375"></a>00375     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l00376"></a>00376   }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378   <span class="comment">// Read metadata</span>
<a name="l00379"></a>00379   count = fscanf(datafile, <span class="stringliteral">"%d"</span>, &amp;temp_numPoint);
<a name="l00380"></a>00380   <span class="keywordflow">if</span> (count != 1 || temp_numPoint &lt; 1) {
<a name="l00381"></a>00381     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"error reading number of points in data "</span>
<a name="l00382"></a>00382                  <span class="stringliteral">"file '%s'"</span>, datafilename);
<a name="l00383"></a>00383     fclose(datafile);
<a name="l00384"></a>00384     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00385"></a>00385   }
<a name="l00386"></a>00386   fscanf(datafile, <span class="stringliteral">"%s\n"</span>, temp_name);
<a name="l00387"></a>00387   <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"VERTEX"</span>))
<a name="l00388"></a>00388     temp_assoc = <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b30408cc812de98bed6c7106d5fa72e11f726">FC_AT_VERTEX</a>;
<a name="l00389"></a>00389   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"ELEMENT"</span>))
<a name="l00390"></a>00390     temp_assoc = <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b3040f4be04f2efb0e31c558b6146cf83f191">FC_AT_ELEMENT</a>;
<a name="l00391"></a>00391   <span class="keywordflow">else</span> {
<a name="l00392"></a>00392     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"unknown assoc type encountered '%s'"</span>,
<a name="l00393"></a>00393                  temp_name);
<a name="l00394"></a>00394     fclose(datafile);
<a name="l00395"></a>00395     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00396"></a>00396   }
<a name="l00397"></a>00397   fscanf(datafile, <span class="stringliteral">"%s\n"</span>, temp_name);
<a name="l00398"></a>00398   <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"SCALAR"</span>)) {
<a name="l00399"></a>00399     temp_numComp = 1; 
<a name="l00400"></a>00400     temp_mathType = <a class="code" href="group__DataTypes.html#ggf4416c02a52bd37e799d442b985151b3599bbbe8f8e41851a17f1037bd44a83f">FC_MT_SCALAR</a>;
<a name="l00401"></a>00401   }
<a name="l00402"></a>00402   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"VECTOR"</span>)) {
<a name="l00403"></a>00403     temp_numComp = 3;  <span class="comment">// ASSUMPTION!</span>
<a name="l00404"></a>00404     temp_mathType = <a class="code" href="group__DataTypes.html#ggf4416c02a52bd37e799d442b985151b367e06c1812f7a0127035e27d14fd597d">FC_MT_VECTOR</a>;
<a name="l00405"></a>00405   }
<a name="l00406"></a>00406   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(temp_name, <span class="stringliteral">"SYMTENSOR"</span>)) {
<a name="l00407"></a>00407     temp_numComp = 3;  <span class="comment">// ASSUMPTION!</span>
<a name="l00408"></a>00408     temp_mathType = <a class="code" href="group__DataTypes.html#ggf4416c02a52bd37e799d442b985151b3bc4bd4318d6c17e9cbd658c05ad858b8">FC_MT_SYMTENSOR</a>;
<a name="l00409"></a>00409   }
<a name="l00410"></a>00410   <span class="keywordflow">else</span> {
<a name="l00411"></a>00411     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"unknown math type encountered '%s'"</span>,
<a name="l00412"></a>00412                  temp_name);
<a name="l00413"></a>00413     fclose(datafile);
<a name="l00414"></a>00414     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00415"></a>00415   }
<a name="l00416"></a>00416   fscanf(datafile, <span class="stringliteral">"%[^\n]"</span>, temp_name); <span class="comment">// now the mesh name</span>
<a name="l00417"></a>00417 
<a name="l00418"></a>00418   <span class="comment">// Read conns</span>
<a name="l00419"></a>00419   temp_data = malloc(temp_numPoint*temp_numComp*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00420"></a>00420   <span class="keywordflow">if</span> (!temp_data) {
<a name="l00421"></a>00421     fclose(datafile);
<a name="l00422"></a>00422     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l00423"></a>00423   }
<a name="l00424"></a>00424   <span class="keywordflow">for</span> (i = 0; i &lt; temp_numPoint*temp_numComp; i++) {
<a name="l00425"></a>00425     <span class="keywordflow">if</span> (fscanf(datafile, <span class="stringliteral">"%f"</span>, &amp;temp_data[i]) != 1) {
<a name="l00426"></a>00426       <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"error reading data for point %d"</span>,
<a name="l00427"></a>00427                    i/temp_numComp);
<a name="l00428"></a>00428       free(temp_data);
<a name="l00429"></a>00429       fclose(datafile);
<a name="l00430"></a>00430       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l00431"></a>00431     }
<a name="l00432"></a>00432   }
<a name="l00433"></a>00433   fclose(datafile);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435   <span class="comment">// All done</span>
<a name="l00436"></a>00436   *name = malloc((strlen(temp_name)+1)*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00437"></a>00437   <span class="keywordflow">if</span> (!(*name)) {
<a name="l00438"></a>00438     free(temp_data);
<a name="l00439"></a>00439     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l00440"></a>00440   }
<a name="l00441"></a>00441   *numComp = temp_numComp;
<a name="l00442"></a>00442   *numPoint = temp_numPoint;
<a name="l00443"></a>00443   *assoc = temp_assoc;
<a name="l00444"></a>00444   *mathType = temp_mathType;
<a name="l00445"></a>00445   strcpy(*name, temp_name);
<a name="l00446"></a>00446   *data = temp_data;
<a name="l00447"></a>00447   
<a name="l00448"></a>00448   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l00449"></a>00449 }
<a name="l00450"></a>00450 <span class="comment"></span>
<a name="l00451"></a>00451 <span class="comment">/**</span>
<a name="l00452"></a>00452 <span class="comment"> * \ingroup  PrivateFileIO</span>
<a name="l00453"></a>00453 <span class="comment"> * \brief  Read in vert and elem files and make a mesh.</span>
<a name="l00454"></a>00454 <span class="comment"> *</span>
<a name="l00455"></a>00455 <span class="comment"> * \description</span>
<a name="l00456"></a>00456 <span class="comment"> *  </span>
<a name="l00457"></a>00457 <span class="comment"> *    This routine is used to bootstrap example dataset files.</span>
<a name="l00458"></a>00458 <span class="comment"> *</span>
<a name="l00459"></a>00459 <span class="comment"> * \modifications  </span>
<a name="l00460"></a>00460 <span class="comment"> *   - 8/24/2005 WSD, created.</span>
<a name="l00461"></a>00461 <span class="comment"> */</span>
<a name="l00462"></a><a class="code" href="group__PrivateFileIO.html#g8d39a476bfae6661264328aba451244e">00462</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g8d39a476bfae6661264328aba451244e">_fc_makeMeshFromFiles</a>(
<a name="l00463"></a>00463   <a class="code" href="structFC__Dataset.html">FC_Dataset</a> dataset, <span class="comment">/**&lt; input - dataset to add mesh too. */</span>
<a name="l00464"></a>00464   <span class="keywordtype">char</span>* vertfilename, <span class="comment">/**&lt; input - file with vertex coords */</span>
<a name="l00465"></a>00465   <span class="keywordtype">char</span>* elemfilename, <span class="comment">/**&lt; input - file with element conns */</span>
<a name="l00466"></a>00466   <a class="code" href="structFC__Mesh.html">FC_Mesh</a>* mesh       <span class="comment">/**&lt; output - the created mesh. */</span>
<a name="l00467"></a>00467 ) {
<a name="l00468"></a>00468   <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> rc;
<a name="l00469"></a>00469   <span class="keywordtype">int</span> numVert, numElem, temp_numVert, numDim;
<a name="l00470"></a>00470   <span class="keywordtype">char</span>* name;
<a name="l00471"></a>00471   <a class="code" href="group__DataTypes.html#g5d0bf8bd47afb81d89d4c5d60c7d62b4">FC_ElementType</a> elemType;
<a name="l00472"></a>00472   <span class="keywordtype">double</span>* coords;
<a name="l00473"></a>00473   <span class="keywordtype">int</span>* conns;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   <span class="comment">// default return</span>
<a name="l00476"></a>00476   <span class="keywordflow">if</span> (mesh)
<a name="l00477"></a>00477     *mesh = <a class="code" href="group__Handles.html#gae2d5f3d9f81cdfbf228e0dca85c9c75">FC_NULL_MESH</a>;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479   <span class="comment">// check inputs</span>
<a name="l00480"></a>00480   <span class="keywordflow">if</span> (!<a class="code" href="group__Dataset.html#g77092c7248e1cff8cf5a4035e19658da">fc_isDatasetValid</a>(dataset) || !vertfilename || !elemfilename || !mesh)
<a name="l00481"></a>00481     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l00482"></a>00482   
<a name="l00483"></a>00483   <span class="comment">// Get info we need</span>
<a name="l00484"></a>00484   rc = <a class="code" href="group__PrivateFileIO.html#gea1070ada8cacfb9e2028a7c6aa07b11">_fc_readVertexFile</a>(vertfilename, &amp;numVert, &amp;numDim, &amp;coords);
<a name="l00485"></a>00485   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l00486"></a>00486     <span class="keywordflow">return</span> rc;
<a name="l00487"></a>00487   rc = <a class="code" href="group__PrivateFileIO.html#g1fbb524b92169e663ad9c68a0ccf0572">_fc_readElementFile</a>(elemfilename, &amp;temp_numVert, &amp;numElem, &amp;elemType,
<a name="l00488"></a>00488                   &amp;name, &amp;conns);
<a name="l00489"></a>00489   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>) {
<a name="l00490"></a>00490     free(coords);
<a name="l00491"></a>00491     <span class="keywordflow">return</span> rc;
<a name="l00492"></a>00492   }
<a name="l00493"></a>00493 
<a name="l00494"></a>00494   <span class="comment">// a little more checking</span>
<a name="l00495"></a>00495   <span class="keywordflow">if</span> (temp_numVert != numVert) {
<a name="l00496"></a>00496     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"The number of verts in vertfile '%s' and "</span>
<a name="l00497"></a>00497                  <span class="stringliteral">"elemfile '%s' do not agree (%d != %d)"</span>,
<a name="l00498"></a>00498                  vertfilename, elemfilename, numVert, temp_numVert);
<a name="l00499"></a>00499     free(coords);
<a name="l00500"></a>00500     free(conns);
<a name="l00501"></a>00501     free(name);
<a name="l00502"></a>00502     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00503"></a>00503   }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505   <span class="comment">// Make the mesh</span>
<a name="l00506"></a>00506   rc = <a class="code" href="group__Mesh.html#gfeb2fbc7f7fce6d00b6946d43b56e0bb">fc_createMesh</a>(dataset, name, mesh);
<a name="l00507"></a>00507   free(name);
<a name="l00508"></a>00508   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>) {
<a name="l00509"></a>00509     free(coords);
<a name="l00510"></a>00510     free(conns);
<a name="l00511"></a>00511     <span class="keywordflow">return</span> rc;
<a name="l00512"></a>00512   }
<a name="l00513"></a>00513   rc = <a class="code" href="group__Mesh.html#gd49edafdfdda60b392d3a24803869b50">fc_setMeshCoordsPtr</a>(*mesh, numDim, numVert, coords);
<a name="l00514"></a>00514   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>) {
<a name="l00515"></a>00515     free(coords);
<a name="l00516"></a>00516     free(conns);
<a name="l00517"></a>00517     <span class="keywordflow">return</span> rc;
<a name="l00518"></a>00518   }
<a name="l00519"></a>00519   rc = <a class="code" href="group__Mesh.html#gbb354f851c7ec2f20f2921fd5a76cf02">fc_setMeshElementConnsPtr</a>(*mesh, elemType, numElem, conns);
<a name="l00520"></a>00520   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>) {
<a name="l00521"></a>00521     free(conns);
<a name="l00522"></a>00522     <span class="keywordflow">return</span> rc;
<a name="l00523"></a>00523   }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l00526"></a>00526 }
<a name="l00527"></a>00527 <span class="comment"></span>
<a name="l00528"></a>00528 <span class="comment">/**</span>
<a name="l00529"></a>00529 <span class="comment"> * \ingroup  PrivateFileIO</span>
<a name="l00530"></a>00530 <span class="comment"> * \brief  Read in data file and add to a mesh.</span>
<a name="l00531"></a>00531 <span class="comment"> *</span>
<a name="l00532"></a>00532 <span class="comment"> * \description</span>
<a name="l00533"></a>00533 <span class="comment"> *  </span>
<a name="l00534"></a>00534 <span class="comment"> *    This routine is used to bootstrap example dataset files.</span>
<a name="l00535"></a>00535 <span class="comment"> *</span>
<a name="l00536"></a>00536 <span class="comment"> * \modifications  </span>
<a name="l00537"></a>00537 <span class="comment"> *   - 8/24/2005 WSD, created.</span>
<a name="l00538"></a>00538 <span class="comment"> */</span>
<a name="l00539"></a><a class="code" href="group__PrivateFileIO.html#g2a26a9b0e63254bedc3b63bb8f9e54c9">00539</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g2a26a9b0e63254bedc3b63bb8f9e54c9">_fc_makeVariableFromFile</a>(
<a name="l00540"></a>00540   <a class="code" href="structFC__Mesh.html">FC_Mesh</a> mesh,          <span class="comment">/**&lt; input - mesh to add data too. */</span>
<a name="l00541"></a>00541   <span class="keywordtype">char</span>* datafilename,    <span class="comment">/**&lt; input - file with data values */</span>
<a name="l00542"></a>00542   <a class="code" href="structFC__Variable.html">FC_Variable</a>* variable  <span class="comment">/**&lt; output - the created variable. */</span>
<a name="l00543"></a>00543 ) {
<a name="l00544"></a>00544   <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> rc;
<a name="l00545"></a>00545   <span class="keywordtype">int</span> numPoint, numComp, numEntity;
<a name="l00546"></a>00546   <span class="keywordtype">char</span>* name;
<a name="l00547"></a>00547   <a class="code" href="group__DataTypes.html#g63044bd7bb5313d8a79ea8a71f1b3040">FC_AssociationType</a> assoc;
<a name="l00548"></a>00548   <a class="code" href="group__DataTypes.html#gf4416c02a52bd37e799d442b985151b3">FC_MathType</a> mathType;
<a name="l00549"></a>00549   <span class="keywordtype">float</span>* data;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551   <span class="comment">// default return</span>
<a name="l00552"></a>00552   <span class="keywordflow">if</span> (variable)
<a name="l00553"></a>00553     *variable = <a class="code" href="group__Handles.html#ge44060288d9dc607cfddcc314cdf48cf">FC_NULL_VARIABLE</a>;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555   <span class="comment">// check inputs</span>
<a name="l00556"></a>00556   <span class="keywordflow">if</span> (!<a class="code" href="group__Mesh.html#gdc4cdd6e7f6a9151458bcb2c25715fd5">fc_isMeshValid</a>(mesh) || !datafilename || !variable)
<a name="l00557"></a>00557     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l00558"></a>00558   
<a name="l00559"></a>00559   <span class="comment">// Get info we need</span>
<a name="l00560"></a>00560   rc = <a class="code" href="group__PrivateFileIO.html#g4d826e51d3a8150d155124274b411056">_fc_readDataFile</a>(datafilename, &amp;numPoint, &amp;numComp, &amp;assoc, &amp;mathType, 
<a name="l00561"></a>00561                &amp;name, &amp;data);
<a name="l00562"></a>00562   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l00563"></a>00563     <span class="keywordflow">return</span> rc;
<a name="l00564"></a>00564 
<a name="l00565"></a>00565   <span class="comment">// A little more checking</span>
<a name="l00566"></a>00566   rc = <a class="code" href="group__Mesh.html#gf169a555056c84bdfd59839bab4f8d76">fc_getMeshNumEntity</a>(mesh, assoc, &amp;numEntity);
<a name="l00567"></a>00567   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l00568"></a>00568     <span class="keywordflow">return</span> rc;
<a name="l00569"></a>00569   <span class="keywordflow">if</span> (numEntity != numPoint) {
<a name="l00570"></a>00570     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"The number of mesh entities in datafile '%s' "</span>
<a name="l00571"></a>00571                  <span class="stringliteral">"does not agree with the mesh (%d != %d)"</span>,
<a name="l00572"></a>00572                  datafilename, numPoint, numEntity);
<a name="l00573"></a>00573     free(data);
<a name="l00574"></a>00574     free(name);
<a name="l00575"></a>00575     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00576"></a>00576   }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578   <span class="comment">// Make the variable</span>
<a name="l00579"></a>00579   rc = <a class="code" href="group__Variable.html#g2f498c4fbd85d8094f0f640a17341cb3">fc_createVariable</a>(mesh, name, variable);
<a name="l00580"></a>00580   free(name);
<a name="l00581"></a>00581   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>) {
<a name="l00582"></a>00582     free(data);
<a name="l00583"></a>00583     <span class="keywordflow">return</span> rc;
<a name="l00584"></a>00584   }
<a name="l00585"></a>00585   rc = <a class="code" href="group__Variable.html#g4491a3d96b7252fd5d0de54089d6838d">fc_setVariableDataPtr</a>(*variable, numPoint, numComp, assoc, mathType, 
<a name="l00586"></a>00586                     <a class="code" href="group__DataTypes.html#ggbbab9b2f35d4bc42e868e4f5853a6297ad59da2c9908f7fd6dcc81b25680057b">FC_DT_FLOAT</a>, data);
<a name="l00587"></a>00587   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>) {
<a name="l00588"></a>00588     free(data);
<a name="l00589"></a>00589     <span class="keywordflow">return</span> rc;
<a name="l00590"></a>00590   }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l00593"></a>00593 }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595 <span class="preprocessor">#ifdef HAVE_LIBXML2</span>
<a name="l00596"></a>00596 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00597"></a>00597 <span class="comment">/**</span>
<a name="l00598"></a>00598 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l00599"></a>00599 <span class="comment"> * \brief Write header of an already opened xml file</span>
<a name="l00600"></a>00600 <span class="comment"> *</span>
<a name="l00601"></a>00601 <span class="comment"> * \todo ? reference dataset? date?</span>
<a name="l00602"></a>00602 <span class="comment"> *</span>
<a name="l00603"></a>00603 <span class="comment"> * \modifications</span>
<a name="l00604"></a>00604 <span class="comment"> *    - 06/05/2006 WSD Created.</span>
<a name="l00605"></a>00605 <span class="comment"> */</span>
<a name="l00606"></a>00606 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_writeAuxFileHeader(
<a name="l00607"></a>00607   FILE* file <span class="comment">/**&lt; input - writable file handle */</span>
<a name="l00608"></a>00608 ) {
<a name="l00609"></a>00609   fprintf(file, <span class="stringliteral">"&lt;?xml version=\"1.0\"?&gt;\n"</span>);
<a name="l00610"></a>00610   fprintf(file, <span class="stringliteral">"&lt;FC_AuxFile&gt;\n"</span>);
<a name="l00611"></a>00611   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l00612"></a>00612 }
<a name="l00613"></a>00613 <span class="comment"></span>
<a name="l00614"></a>00614 <span class="comment">/**</span>
<a name="l00615"></a>00615 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l00616"></a>00616 <span class="comment"> * \brief Write footer into xml file</span>
<a name="l00617"></a>00617 <span class="comment"> *</span>
<a name="l00618"></a>00618 <span class="comment"> * \modifications</span>
<a name="l00619"></a>00619 <span class="comment"> *    - 06/05/2006 WSD Created.</span>
<a name="l00620"></a>00620 <span class="comment"> */</span>
<a name="l00621"></a>00621 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_writeAuxFileFooter(
<a name="l00622"></a>00622   FILE* file <span class="comment">/**&lt; input - writable file handle */</span>
<a name="l00623"></a>00623 ) {
<a name="l00624"></a>00624   fprintf(file, <span class="stringliteral">"&lt;/FC_AuxFile&gt;\n"</span>);
<a name="l00625"></a>00625   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l00626"></a>00626 }
<a name="l00627"></a>00627 <span class="comment"></span>
<a name="l00628"></a>00628 <span class="comment">/**</span>
<a name="l00629"></a>00629 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l00630"></a>00630 <span class="comment"> * \brief Write a subset element to a subset file</span>
<a name="l00631"></a>00631 <span class="comment"> *</span>
<a name="l00632"></a>00632 <span class="comment"> * \modifications</span>
<a name="l00633"></a>00633 <span class="comment"> *    - 06/05/2006 WSD Created.</span>
<a name="l00634"></a>00634 <span class="comment"> */</span>
<a name="l00635"></a>00635 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_writeAuxFileSubset(
<a name="l00636"></a>00636   FILE* file,       <span class="comment">/**&lt; input - writable file handle */</span>
<a name="l00637"></a>00637   <a class="code" href="structFC__Subset.html">FC_Subset</a> subset  <span class="comment">/**&lt; input - the subset */</span>
<a name="l00638"></a>00638 ) {
<a name="l00639"></a>00639   <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> rc;
<a name="l00640"></a>00640   <a class="code" href="structFC__Mesh.html">FC_Mesh</a> mesh;
<a name="l00641"></a>00641   <span class="keywordtype">char</span>* meshName, *subsetName;
<a name="l00642"></a>00642   <a class="code" href="group__DataTypes.html#g63044bd7bb5313d8a79ea8a71f1b3040">FC_AssociationType</a> assoc;
<a name="l00643"></a>00643   <span class="keywordtype">int</span> numMember, maxNumMember, *memberIDs;
<a name="l00644"></a>00644   
<a name="l00645"></a>00645   <span class="comment">// check input</span>
<a name="l00646"></a>00646   <span class="keywordflow">if</span> (!<a class="code" href="group__Subset.html#g4ceb4c71219255a80166405a22773952">fc_isSubsetValid</a>(subset))
<a name="l00647"></a>00647     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649   <span class="comment">// get info</span>
<a name="l00650"></a>00650   rc = <a class="code" href="group__Subset.html#g095c5b064f4ae81a17682666aadd420b">fc_getMeshFromSubset</a>(subset, &amp;mesh);
<a name="l00651"></a>00651   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l00652"></a>00652     <span class="keywordflow">return</span> rc;
<a name="l00653"></a>00653   rc = <a class="code" href="group__Mesh.html#g9f5a1b484e4b5ab4e0e137bfe34e10d6">fc_getMeshName</a>(mesh, &amp;meshName);
<a name="l00654"></a>00654   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l00655"></a>00655     <span class="keywordflow">return</span> rc;
<a name="l00656"></a>00656   rc = <a class="code" href="group__Subset.html#gf8d751f06ea68d6944e19816147d35a9">fc_getSubsetName</a>(subset, &amp;subsetName);
<a name="l00657"></a>00657   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l00658"></a>00658     <span class="keywordflow">return</span> rc;
<a name="l00659"></a>00659   rc = <a class="code" href="group__Subset.html#g23f364364af36ff74b89ffecf1c4ae28">fc_getSubsetInfo</a>(subset, &amp;numMember, &amp;maxNumMember, &amp;assoc);
<a name="l00660"></a>00660   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l00661"></a>00661     <span class="keywordflow">return</span> rc;
<a name="l00662"></a>00662   rc = <a class="code" href="group__Subset.html#g7a79d4d1e13846ae12abe55ef2db3c3d">fc_getSubsetMembersAsArray</a>(subset, &amp;numMember, &amp;memberIDs);
<a name="l00663"></a>00663   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l00664"></a>00664     <span class="keywordflow">return</span> rc;
<a name="l00665"></a>00665 
<a name="l00666"></a>00666   <span class="comment">// do it</span>
<a name="l00667"></a>00667   rc = _fc_writeAuxFileSubsetCore(file, subsetName, meshName, assoc, 
<a name="l00668"></a>00668                       maxNumMember, numMember, memberIDs);
<a name="l00669"></a>00669   free(meshName);
<a name="l00670"></a>00670   free(subsetName);
<a name="l00671"></a>00671   free(memberIDs);
<a name="l00672"></a>00672   <span class="keywordflow">return</span> rc;
<a name="l00673"></a>00673 }
<a name="l00674"></a>00674 <span class="comment"></span>
<a name="l00675"></a>00675 <span class="comment">/**</span>
<a name="l00676"></a>00676 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l00677"></a>00677 <span class="comment"> * \brief Write a subset to a subset file</span>
<a name="l00678"></a>00678 <span class="comment"> *</span>
<a name="l00679"></a>00679 <span class="comment"> * \modifications</span>
<a name="l00680"></a>00680 <span class="comment"> *    - 06/05/2006 WSD Created.</span>
<a name="l00681"></a>00681 <span class="comment"> */</span>
<a name="l00682"></a>00682 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_writeAuxFileSubsetCore(
<a name="l00683"></a>00683   FILE* file,                 <span class="comment">/**&lt; input - writable file handle */</span>
<a name="l00684"></a>00684   <span class="keywordtype">char</span>* subsetName,           <span class="comment">/**&lt; input - name of subset */</span>
<a name="l00685"></a>00685   <span class="keywordtype">char</span>* meshName,             <span class="comment">/**&lt; input - name of parent mesh */</span>
<a name="l00686"></a>00686   <a class="code" href="group__DataTypes.html#g63044bd7bb5313d8a79ea8a71f1b3040">FC_AssociationType</a> assoc,   <span class="comment">/**&lt; input - association type of subset */</span>
<a name="l00687"></a>00687   <span class="keywordtype">int</span> maxNumMember,           <span class="comment">/**&lt; input - max possible number of members */</span>
<a name="l00688"></a>00688   <span class="keywordtype">int</span> numMember,              <span class="comment">/**&lt; input - number of members */</span>
<a name="l00689"></a>00689   <span class="keywordtype">int</span>* memberIDs              <span class="comment">/**&lt; input - array of member IDs */</span>
<a name="l00690"></a>00690 ) {
<a name="l00691"></a>00691   <span class="keywordtype">int</span> i;
<a name="l00692"></a>00692   <span class="keywordtype">char</span>* typeName = <span class="stringliteral">""</span>;
<a name="l00693"></a>00693 
<a name="l00694"></a>00694   <span class="comment">// check input - minimal amount because we don't expect external use)</span>
<a name="l00695"></a>00695   <span class="keywordflow">if</span> (!file || !subsetName || !meshName)
<a name="l00696"></a>00696     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698   <span class="comment">// setup</span>
<a name="l00699"></a>00699   <span class="keywordflow">switch</span>(assoc) {
<a name="l00700"></a>00700   <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b3040dc201b7d1982fc7cf126faa5d610fa25">FC_AT_UNKNOWN</a>: typeName = <span class="stringliteral">"unknown"</span>; <span class="keywordflow">break</span>;
<a name="l00701"></a>00701   <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b30408cc812de98bed6c7106d5fa72e11f726">FC_AT_VERTEX</a>:  typeName = <span class="stringliteral">"vertex"</span>;  <span class="keywordflow">break</span>;
<a name="l00702"></a>00702   <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b3040fb5fd66bec9d026fbfab895c518842d4">FC_AT_EDGE</a>:    typeName = <span class="stringliteral">"edge"</span>;    <span class="keywordflow">break</span>;
<a name="l00703"></a>00703   <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b30402787462c13709118df8e232282a530a4">FC_AT_FACE</a>:    typeName = <span class="stringliteral">"face"</span>;    <span class="keywordflow">break</span>;
<a name="l00704"></a>00704   <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b3040f4be04f2efb0e31c558b6146cf83f191">FC_AT_ELEMENT</a>: typeName = <span class="stringliteral">"element"</span>; <span class="keywordflow">break</span>;
<a name="l00705"></a>00705   <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b304008f144f8c1298e5724d7a601ed063099">FC_AT_WHOLE_MESH</a>:   typeName = <span class="stringliteral">"whole"</span>;   <span class="keywordflow">break</span>;
<a name="l00706"></a>00706   <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b3040fea6eb08c0f82d61de1d1daab7c5d761">FC_AT_WHOLE_DATASET</a>: 
<a name="l00707"></a>00707     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00708"></a>00708   }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710   <span class="comment">// do it - write an XML element</span>
<a name="l00711"></a>00711   fprintf(file, <span class="stringliteral">"&lt;FC_Subset\n"</span>);
<a name="l00712"></a>00712   fprintf(file, <span class="stringliteral">"  Name=\"%s\"\n"</span>, subsetName);
<a name="l00713"></a>00713   fprintf(file, <span class="stringliteral">"  ParentMeshName=\"%s\"\n"</span>, meshName);
<a name="l00714"></a>00714   fprintf(file, <span class="stringliteral">"  Type=\"%s\"\n"</span>, typeName);
<a name="l00715"></a>00715   fprintf(file, <span class="stringliteral">"  MaxNumMember=\"%d\"\n"</span>, maxNumMember);
<a name="l00716"></a>00716   fprintf(file, <span class="stringliteral">"  NumMember=\"%d\"\n"</span>, numMember);
<a name="l00717"></a>00717   fprintf(file, <span class="stringliteral">"  MemberIDs=\"%d"</span>, memberIDs[0]);
<a name="l00718"></a>00718   <span class="keywordflow">for</span> (i = 1; i &lt; numMember; i++)
<a name="l00719"></a>00719     fprintf(file, <span class="stringliteral">" %d"</span>, memberIDs[i]);
<a name="l00720"></a>00720   fprintf(file, <span class="stringliteral">"\"\n"</span>);
<a name="l00721"></a>00721   fprintf(file, <span class="stringliteral">"/&gt;\n"</span>);
<a name="l00722"></a>00722   
<a name="l00723"></a>00723   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l00724"></a>00724 }
<a name="l00725"></a>00725 <span class="comment"></span>
<a name="l00726"></a>00726 <span class="comment">/**</span>
<a name="l00727"></a>00727 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l00728"></a>00728 <span class="comment"> * \brief Write a tear to a subset file</span>
<a name="l00729"></a>00729 <span class="comment"> *</span>
<a name="l00730"></a>00730 <span class="comment"> * \description</span>
<a name="l00731"></a>00731 <span class="comment"> *</span>
<a name="l00732"></a>00732 <span class="comment"> *    The tear is required to have at least one subset. All subset names</span>
<a name="l00733"></a>00733 <span class="comment"> *    have to be non-NULL.</span>
<a name="l00734"></a>00734 <span class="comment"> *</span>
<a name="l00735"></a>00735 <span class="comment"> * \todo How many digits of a double should we print out?</span>
<a name="l00736"></a>00736 <span class="comment"> *</span>
<a name="l00737"></a>00737 <span class="comment"> * \modifications</span>
<a name="l00738"></a>00738 <span class="comment"> *    - 06/05/2006 WSD Created.</span>
<a name="l00739"></a>00739 <span class="comment"> */</span>
<a name="l00740"></a>00740 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_writeAuxFileTear(
<a name="l00741"></a>00741   FILE* file,           <span class="comment">/**&lt; input - writable file handle */</span>
<a name="l00742"></a>00742   <span class="keywordtype">char</span>* tearName,       <span class="comment">/**&lt; input - name of tear */</span>
<a name="l00743"></a>00743   <span class="keywordtype">int</span> numSubset,        <span class="comment">/**&lt; input - number of subsets that make up tear */</span>
<a name="l00744"></a>00744   <span class="keywordtype">char</span>** subsetNames,   <span class="comment">/**&lt; input - names of the subsets */</span>
<a name="l00745"></a>00745   <span class="keywordtype">double</span> length         <span class="comment">/**&lt; input - length of tear */</span>
<a name="l00746"></a>00746 ) {
<a name="l00747"></a>00747   <span class="keywordtype">int</span> i;
<a name="l00748"></a>00748 
<a name="l00749"></a>00749   <span class="comment">// check input - minimal amount because we don't expect external use)</span>
<a name="l00750"></a>00750   <span class="keywordflow">if</span> (!file || !tearName || numSubset &lt; 1 || !subsetNames)
<a name="l00751"></a>00751     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l00752"></a>00752   <span class="keywordflow">for</span> (i = 0; i &lt; numSubset; i++)
<a name="l00753"></a>00753     <span class="keywordflow">if</span> (!subsetNames[i])
<a name="l00754"></a>00754       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756   <span class="comment">// do it - write an XML element</span>
<a name="l00757"></a>00757   fprintf(file, <span class="stringliteral">"&lt;FC_Tear\n"</span>);
<a name="l00758"></a>00758   fprintf(file, <span class="stringliteral">"  Name=\"%s\"\n"</span>, tearName);
<a name="l00759"></a>00759   fprintf(file, <span class="stringliteral">"  Length=\"%.11g\"\n"</span>, length);
<a name="l00760"></a>00760   fprintf(file, <span class="stringliteral">"  NumSubset=\"%d\"&gt;\n"</span>, numSubset);
<a name="l00761"></a>00761   <span class="keywordflow">for</span> (i = 0; i &lt; numSubset; i++)
<a name="l00762"></a>00762     fprintf(file, <span class="stringliteral">"  &lt;SubsetName&gt;%s&lt;/SubsetName&gt;\n"</span>, subsetNames[i]);
<a name="l00763"></a>00763   fprintf(file, <span class="stringliteral">"&lt;/FC_Tear&gt;\n"</span>);
<a name="l00764"></a>00764   
<a name="l00765"></a>00765   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l00766"></a>00766 }
<a name="l00767"></a>00767 <span class="comment"></span>
<a name="l00768"></a>00768 <span class="comment">/**</span>
<a name="l00769"></a>00769 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l00770"></a>00770 <span class="comment"> * \brief Import an aux file to create an xmlDoc.</span>
<a name="l00771"></a>00771 <span class="comment"> *</span>
<a name="l00772"></a>00772 <span class="comment"> * \description</span>
<a name="l00773"></a>00773 <span class="comment"> *</span>
<a name="l00774"></a>00774 <span class="comment"> *    This reads the xml file and creats a libxml2 xmlDoc object.</span>
<a name="l00775"></a>00775 <span class="comment"> *    The user is responsible for freeing the xmlDoc using xmlFreeDoc().</span>
<a name="l00776"></a>00776 <span class="comment"> *</span>
<a name="l00777"></a>00777 <span class="comment"> * \todo Can we control error reporting from libxml2?</span>
<a name="l00778"></a>00778 <span class="comment"> *</span>
<a name="l00779"></a>00779 <span class="comment"> * \modifications</span>
<a name="l00780"></a>00780 <span class="comment"> *    - 06/27/2006 WSD Created.</span>
<a name="l00781"></a>00781 <span class="comment"> */</span>
<a name="l00782"></a>00782 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_importAuxFileXMLDoc(
<a name="l00783"></a>00783   <span class="keywordtype">char</span>* filename,      <span class="comment">/**&lt; input - file name */</span>
<a name="l00784"></a>00784   xmlDocPtr* xmldoc    <span class="comment">/**&lt; output - pointer to the xml Doc object */</span>
<a name="l00785"></a>00785 ) {
<a name="l00786"></a>00786   xmlDocPtr doc;
<a name="l00787"></a>00787   xmlNode* root = NULL;
<a name="l00788"></a>00788    
<a name="l00789"></a>00789   <span class="comment">// default return</span>
<a name="l00790"></a>00790   <span class="keywordflow">if</span> (xmldoc)
<a name="l00791"></a>00791     *xmldoc = NULL;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793   <span class="comment">// test input</span>
<a name="l00794"></a>00794   <span class="keywordflow">if</span> (!filename || !xmldoc)
<a name="l00795"></a>00795     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797   <span class="comment">// parse the file</span>
<a name="l00798"></a>00798   doc = xmlParseFile(filename);
<a name="l00799"></a>00799   <span class="keywordflow">if</span> (doc == NULL) 
<a name="l00800"></a>00800     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802   <span class="comment">// must be an aux doc</span>
<a name="l00803"></a>00803   root = xmlDocGetRootElement(doc);
<a name="l00804"></a>00804   <span class="keywordflow">if</span> (!root || !root-&gt;name || xmlStrcmp(root-&gt;name,(<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"FC_AuxFile"</span>)) {
<a name="l00805"></a>00805     xmlFreeDoc(doc);
<a name="l00806"></a>00806     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"XML document is not of type FC_AuxFile"</span>);
<a name="l00807"></a>00807     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00808"></a>00808   }
<a name="l00809"></a>00809 
<a name="l00810"></a>00810   <span class="comment">// return</span>
<a name="l00811"></a>00811   *xmldoc = doc;
<a name="l00812"></a>00812   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l00813"></a>00813 }
<a name="l00814"></a>00814 <span class="comment"></span>
<a name="l00815"></a>00815 <span class="comment">/**</span>
<a name="l00816"></a>00816 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l00817"></a>00817 <span class="comment"> * \brief Get subsets from an aux file.</span>
<a name="l00818"></a>00818 <span class="comment"> *</span>
<a name="l00819"></a>00819 <span class="comment"> * \description</span>
<a name="l00820"></a>00820 <span class="comment"> *</span>
<a name="l00821"></a>00821 <span class="comment"> *    This creates a bunch of data which the user has the responsibility</span>
<a name="l00822"></a>00822 <span class="comment"> *    of freeing. The xml file has to have already been parsed into</span>
<a name="l00823"></a>00823 <span class="comment"> *    an xmlDocPtr.</span>
<a name="l00824"></a>00824 <span class="comment"> *</span>
<a name="l00825"></a>00825 <span class="comment"> *    NOTE: we're assuming that xmlChar* and char* can be cast back and</span>
<a name="l00826"></a>00826 <span class="comment"> *    forth w/o worry. That is, libxml2 uses UTF-8 and we cast to</span>
<a name="l00827"></a>00827 <span class="comment"> *    char* hoping that our words are the proper size.</span>
<a name="l00828"></a>00828 <span class="comment"> *</span>
<a name="l00829"></a>00829 <span class="comment"> * \modifications</span>
<a name="l00830"></a>00830 <span class="comment"> *    - 06/27/2006 WSD Created.</span>
<a name="l00831"></a>00831 <span class="comment"> */</span>
<a name="l00832"></a>00832 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_getAuxFileSubsets(
<a name="l00833"></a>00833   xmlDocPtr doc,    <span class="comment">/**&lt; input - xml Doc ptr */</span>
<a name="l00834"></a>00834   <span class="keywordtype">int</span>* numSubset,      <span class="comment">/**&lt; output - the number of subset */</span>
<a name="l00835"></a>00835   <span class="keywordtype">char</span>*** subsetNames, <span class="comment">/**&lt; output - the names of each subset */</span>
<a name="l00836"></a>00836   <span class="keywordtype">char</span>*** meshNames,   <span class="comment">/**&lt; output - the names of the parent meshes */</span>
<a name="l00837"></a>00837   <a class="code" href="group__DataTypes.html#g63044bd7bb5313d8a79ea8a71f1b3040">FC_AssociationType</a>** assocs, <span class="comment">/**&lt; output - the association types */</span>
<a name="l00838"></a>00838   <span class="keywordtype">int</span>** maxNumMembers, <span class="comment">/**&lt; output - the max possible number of members */</span>
<a name="l00839"></a>00839   <span class="keywordtype">int</span>** numMembers,    <span class="comment">/**&lt; output - the number of members */</span>
<a name="l00840"></a>00840   <span class="keywordtype">int</span>*** memberIDs     <span class="comment">/**&lt; output - the member IDs */</span>
<a name="l00841"></a>00841 ) {
<a name="l00842"></a>00842   <span class="keywordtype">int</span> i;
<a name="l00843"></a>00843   xmlNode* root = NULL, *cur_node;
<a name="l00844"></a>00844   <span class="keywordtype">char</span>* prop, *token;
<a name="l00845"></a>00845   <span class="keywordtype">int</span> num = 0, len = 0;
<a name="l00846"></a>00846   <span class="keywordtype">char</span>** sNames = NULL, **mNames = NULL;
<a name="l00847"></a>00847   <a class="code" href="group__DataTypes.html#g63044bd7bb5313d8a79ea8a71f1b3040">FC_AssociationType</a>* asss = NULL;
<a name="l00848"></a>00848   <span class="keywordtype">int</span>* maxs = NULL, *nums = NULL, **ids = NULL;
<a name="l00849"></a>00849   <span class="keywordtype">void</span>* temp1, *temp2, *temp3, *temp4, *temp5, *temp6;
<a name="l00850"></a>00850 
<a name="l00851"></a>00851   <span class="comment">// test input</span>
<a name="l00852"></a>00852   <span class="keywordflow">if</span> (!doc || !numSubset || !subsetNames || !meshNames || !assocs ||
<a name="l00853"></a>00853       !maxNumMembers || !numMembers || !memberIDs )
<a name="l00854"></a>00854     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l00855"></a>00855 
<a name="l00856"></a>00856   <span class="comment">// must be an aux doc</span>
<a name="l00857"></a>00857   root = xmlDocGetRootElement(doc);
<a name="l00858"></a>00858   <span class="keywordflow">if</span> (!root || !root-&gt;name || xmlStrcmp(root-&gt;name,(<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"FC_AuxFile"</span>)) {
<a name="l00859"></a>00859     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"XML document is not of type FC_AuxFile"</span>);
<a name="l00860"></a>00860     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00861"></a>00861   }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863   <span class="comment">// walk the tree looking for subsets</span>
<a name="l00864"></a>00864   <span class="keywordflow">for</span> (cur_node = root-&gt;children; cur_node != NULL; cur_node = cur_node-&gt;next)
<a name="l00865"></a>00865   {
<a name="l00866"></a>00866     <span class="keywordflow">if</span> (cur_node-&gt;type == XML_ELEMENT_NODE &amp;&amp; 
<a name="l00867"></a>00867      !xmlStrcmp(cur_node-&gt;name, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"FC_Subset"</span>)) {
<a name="l00868"></a>00868       <span class="keywordflow">if</span> (num == len) {
<a name="l00869"></a>00869      <span class="keywordflow">if</span> (len == 0)
<a name="l00870"></a>00870        len = 2;
<a name="l00871"></a>00871      <span class="keywordflow">else</span>
<a name="l00872"></a>00872        len *= 2;
<a name="l00873"></a>00873      temp1 = realloc(sNames, len*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
<a name="l00874"></a>00874      temp2 = realloc(mNames, len*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
<a name="l00875"></a>00875      temp3 = realloc(asss, len*<span class="keyword">sizeof</span>(<a class="code" href="group__DataTypes.html#g63044bd7bb5313d8a79ea8a71f1b3040">FC_AssociationType</a>));
<a name="l00876"></a>00876      temp4 = realloc(maxs, len*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00877"></a>00877      temp5 = realloc(nums, len*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00878"></a>00878      temp6 = realloc(ids, len*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>*));
<a name="l00879"></a>00879      <span class="keywordflow">if</span> (!temp1 || !temp2 || !temp3 || !temp4 || !temp5 || !temp6)
<a name="l00880"></a>00880        <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l00881"></a>00881      sNames = temp1;
<a name="l00882"></a>00882      mNames = temp2;
<a name="l00883"></a>00883      asss = temp3;
<a name="l00884"></a>00884      maxs = temp4;
<a name="l00885"></a>00885      nums = temp5;
<a name="l00886"></a>00886      ids = temp6;
<a name="l00887"></a>00887       }
<a name="l00888"></a>00888       sNames[num] = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"Name"</span>);
<a name="l00889"></a>00889       mNames[num] = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, 
<a name="l00890"></a>00890                            (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"ParentMeshName"</span>);
<a name="l00891"></a>00891       prop = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"Type"</span>);
<a name="l00892"></a>00892       <span class="keywordflow">if</span> (!strcmp(prop, <span class="stringliteral">"vertex"</span>))
<a name="l00893"></a>00893      asss[num] = <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b30408cc812de98bed6c7106d5fa72e11f726">FC_AT_VERTEX</a>;
<a name="l00894"></a>00894       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(prop, <span class="stringliteral">"edge"</span>))
<a name="l00895"></a>00895      asss[num] = <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b3040fb5fd66bec9d026fbfab895c518842d4">FC_AT_EDGE</a>;
<a name="l00896"></a>00896       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(prop, <span class="stringliteral">"face"</span>))
<a name="l00897"></a>00897      asss[num] = <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b30402787462c13709118df8e232282a530a4">FC_AT_FACE</a>;
<a name="l00898"></a>00898       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(prop, <span class="stringliteral">"element"</span>))
<a name="l00899"></a>00899      asss[num] = <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b3040f4be04f2efb0e31c558b6146cf83f191">FC_AT_ELEMENT</a>;
<a name="l00900"></a>00900       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(prop, <span class="stringliteral">"whole"</span>))
<a name="l00901"></a>00901      asss[num] = <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b304008f144f8c1298e5724d7a601ed063099">FC_AT_WHOLE_MESH</a>;
<a name="l00902"></a>00902       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(prop,<span class="stringliteral">"unknown"</span>))
<a name="l00903"></a>00903      asss[num] = <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b3040dc201b7d1982fc7cf126faa5d610fa25">FC_AT_UNKNOWN</a>;
<a name="l00904"></a>00904       <span class="keywordflow">else</span> {
<a name="l00905"></a>00905      <a class="code" href="group__Library.html#gbf7b424a5a96a9887547a6545f03e3e2">fc_printfWarningMessage</a>(<span class="stringliteral">"nonvalid assocation type '%s' encountered"</span>,
<a name="l00906"></a>00906                     prop);
<a name="l00907"></a>00907      asss[num] = <a class="code" href="group__DataTypes.html#gg63044bd7bb5313d8a79ea8a71f1b3040dc201b7d1982fc7cf126faa5d610fa25">FC_AT_UNKNOWN</a>;
<a name="l00908"></a>00908       }
<a name="l00909"></a>00909       free(prop);
<a name="l00910"></a>00910       prop = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"MaxNumMember"</span>);
<a name="l00911"></a>00911       maxs[num] = atoi(prop);
<a name="l00912"></a>00912       free(prop);
<a name="l00913"></a>00913       prop = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"NumMember"</span>);
<a name="l00914"></a>00914       nums[num] = atoi(prop);
<a name="l00915"></a>00915       free(prop);
<a name="l00916"></a>00916       ids[num] = calloc(nums[num], <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00917"></a>00917       <span class="keywordflow">if</span> (!ids[num])
<a name="l00918"></a>00918      <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l00919"></a>00919       prop = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"MemberIDs"</span>);
<a name="l00920"></a>00920       token = strtok(prop,<span class="stringliteral">" ,\t\n"</span>);
<a name="l00921"></a>00921       i = 0;
<a name="l00922"></a>00922       <span class="keywordflow">while</span> (token != NULL &amp;&amp; i &lt; nums[num]) {
<a name="l00923"></a>00923      ids[num][i] = atoi(token);
<a name="l00924"></a>00924      token = strtok(NULL, <span class="stringliteral">" ,\t\n"</span>);
<a name="l00925"></a>00925      i++;
<a name="l00926"></a>00926       }
<a name="l00927"></a>00927       free(prop);
<a name="l00928"></a>00928       <span class="keywordflow">if</span> (i &gt; nums[num])
<a name="l00929"></a>00929      <a class="code" href="group__Library.html#gbf7b424a5a96a9887547a6545f03e3e2">fc_printfWarningMessage</a>(<span class="stringliteral">"MemberIDs attribute had more members than specified"</span>);
<a name="l00930"></a>00930       num++;
<a name="l00931"></a>00931     }
<a name="l00932"></a>00932   }
<a name="l00933"></a>00933 
<a name="l00934"></a>00934   <span class="comment">// return values</span>
<a name="l00935"></a>00935   *numSubset = num;
<a name="l00936"></a>00936   *subsetNames = sNames;
<a name="l00937"></a>00937   *meshNames = mNames;
<a name="l00938"></a>00938   *assocs = asss;
<a name="l00939"></a>00939   *maxNumMembers = maxs;
<a name="l00940"></a>00940   *numMembers = nums;
<a name="l00941"></a>00941   *memberIDs = ids;
<a name="l00942"></a>00942 
<a name="l00943"></a>00943   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l00944"></a>00944 }<span class="comment"></span>
<a name="l00945"></a>00945 <span class="comment">/**</span>
<a name="l00946"></a>00946 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l00947"></a>00947 <span class="comment"> * \brief Get tears from an aux file.</span>
<a name="l00948"></a>00948 <span class="comment"> *</span>
<a name="l00949"></a>00949 <span class="comment"> * \description</span>
<a name="l00950"></a>00950 <span class="comment"> *</span>
<a name="l00951"></a>00951 <span class="comment"> *    This creates a bunch of data which the user has the responsibility</span>
<a name="l00952"></a>00952 <span class="comment"> *    of freeing. The xml file has to have already been parsed into</span>
<a name="l00953"></a>00953 <span class="comment"> *    an xmlDocPtr.</span>
<a name="l00954"></a>00954 <span class="comment"> *</span>
<a name="l00955"></a>00955 <span class="comment"> *    NOTE: we're assuming that xmlChar* and char* can be cast back and</span>
<a name="l00956"></a>00956 <span class="comment"> *    forth w/o worry. That is, libxml2 uses UTF-8 and we cast to</span>
<a name="l00957"></a>00957 <span class="comment"> *    char* hoping that our words are the proper size.</span>
<a name="l00958"></a>00958 <span class="comment"> *</span>
<a name="l00959"></a>00959 <span class="comment"> * \modifications</span>
<a name="l00960"></a>00960 <span class="comment"> *    - 07/03/2006 WSD Created.</span>
<a name="l00961"></a>00961 <span class="comment"> */</span>
<a name="l00962"></a>00962 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_getAuxFileTears(
<a name="l00963"></a>00963   xmlDocPtr doc,        <span class="comment">/**&lt; input - xml Doc ptr */</span>
<a name="l00964"></a>00964   <span class="keywordtype">int</span>* numTear,            <span class="comment">/**&lt; output - the number of tears */</span>
<a name="l00965"></a>00965   <span class="keywordtype">char</span>*** tearNames,       <span class="comment">/**&lt; output - the names of each tear */</span>
<a name="l00966"></a>00966   <span class="keywordtype">int</span>** numSubsetPerTear,  <span class="comment">/**&lt; output - the number of subsets in each tear */</span>
<a name="l00967"></a>00967   <span class="keywordtype">char</span>**** subsetNames,    <span class="comment">/**&lt; output - the names of the subsets */</span>
<a name="l00968"></a>00968   <span class="keywordtype">double</span>** lengths         <span class="comment">/**&lt; output - the lengths of the tears */</span> 
<a name="l00969"></a>00969 ) {
<a name="l00970"></a>00970   xmlNode* root = NULL, *cur_node, *cur_child_node;
<a name="l00971"></a>00971   <span class="keywordtype">char</span>* prop;
<a name="l00972"></a>00972   <span class="keywordtype">int</span> num = 0, len = 0, count;
<a name="l00973"></a>00973   <span class="keywordtype">char</span>** tNames = NULL, ***sNames = NULL;
<a name="l00974"></a>00974   <span class="keywordtype">double</span>* lens = NULL;
<a name="l00975"></a>00975   <span class="keywordtype">int</span> *numSubsets = NULL;
<a name="l00976"></a>00976   <span class="keywordtype">void</span>* temp1, *temp2, *temp3, *temp4;
<a name="l00977"></a>00977 
<a name="l00978"></a>00978   <span class="comment">// test input</span>
<a name="l00979"></a>00979   <span class="keywordflow">if</span> (!doc || !numTear || !tearNames || ! numSubsetPerTear || !subsetNames)
<a name="l00980"></a>00980     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l00981"></a>00981 
<a name="l00982"></a>00982   <span class="comment">// must be an aux doc</span>
<a name="l00983"></a>00983   root = xmlDocGetRootElement(doc);
<a name="l00984"></a>00984   <span class="keywordflow">if</span> (!root || !root-&gt;name || xmlStrcmp(root-&gt;name,(<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"FC_AuxFile"</span>)) {
<a name="l00985"></a>00985     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"XML document is not of type FC_AuxFile"</span>);
<a name="l00986"></a>00986     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l00987"></a>00987   }
<a name="l00988"></a>00988   
<a name="l00989"></a>00989   <span class="comment">// walk the tree looking for subsets</span>
<a name="l00990"></a>00990   <span class="keywordflow">for</span> (cur_node = root-&gt;children; cur_node != NULL; 
<a name="l00991"></a>00991        cur_node = cur_node-&gt;next) {
<a name="l00992"></a>00992     <span class="keywordflow">if</span> (cur_node-&gt;type == XML_ELEMENT_NODE &amp;&amp; 
<a name="l00993"></a>00993      !xmlStrcmp(cur_node-&gt;name, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"FC_Tear"</span>)) {
<a name="l00994"></a>00994       <span class="keywordflow">if</span> (num == len) {
<a name="l00995"></a>00995      <span class="keywordflow">if</span> (len == 0)
<a name="l00996"></a>00996        len = 2;
<a name="l00997"></a>00997      <span class="keywordflow">else</span>
<a name="l00998"></a>00998        len *= 2;
<a name="l00999"></a>00999      temp1 = realloc(tNames, len*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
<a name="l01000"></a>01000      temp2 = realloc(sNames, len*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>**));
<a name="l01001"></a>01001      temp3 = realloc(numSubsets, len*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l01002"></a>01002      temp4 = realloc(lens, len*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01003"></a>01003      <span class="keywordflow">if</span> (!temp1 || !temp2 || !temp3 || !temp4)
<a name="l01004"></a>01004        <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l01005"></a>01005      tNames = temp1;
<a name="l01006"></a>01006      sNames = temp2;
<a name="l01007"></a>01007      numSubsets = temp3;
<a name="l01008"></a>01008      lens = temp4;
<a name="l01009"></a>01009       }
<a name="l01010"></a>01010       tNames[num] = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"Name"</span>);
<a name="l01011"></a>01011       prop = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"NumSubset"</span>);
<a name="l01012"></a>01012       numSubsets[num] = atoi(prop);
<a name="l01013"></a>01013       free(prop);
<a name="l01014"></a>01014       sNames[num] = (<span class="keywordtype">char</span>**) calloc(numSubsets[num], <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
<a name="l01015"></a>01015       <span class="keywordflow">if</span> (!sNames[num])
<a name="l01016"></a>01016      <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l01017"></a>01017       prop = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"Length"</span>);
<a name="l01018"></a>01018       lens[num] = atof(prop);
<a name="l01019"></a>01019       free(prop);
<a name="l01020"></a>01020 
<a name="l01021"></a>01021       count = 0;
<a name="l01022"></a>01022       <span class="keywordflow">for</span> (cur_child_node = cur_node-&gt;children; 
<a name="l01023"></a>01023         cur_child_node != NULL; cur_child_node = cur_child_node-&gt;next) {
<a name="l01024"></a>01024      <span class="keywordflow">if</span> (cur_child_node-&gt;type == XML_ELEMENT_NODE &amp;&amp;
<a name="l01025"></a>01025          !xmlStrcmp(cur_child_node-&gt;name, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"SubsetName"</span>)) {
<a name="l01026"></a>01026        <span class="keywordflow">if</span> (count == numSubsets[num]) {
<a name="l01027"></a>01027          <a class="code" href="group__Library.html#gbf7b424a5a96a9887547a6545f03e3e2">fc_printfWarningMessage</a>(<span class="stringliteral">"Tear %s has more subset subset names than"</span>  
<a name="l01028"></a>01028                         <span class="stringliteral">" expected (%d != %d)"</span>, tNames[num],
<a name="l01029"></a>01029                         count+1, numSubsets[num]);
<a name="l01030"></a>01030        }
<a name="l01031"></a>01031        <span class="keywordflow">else</span> {
<a name="l01032"></a>01032          prop = (<span class="keywordtype">char</span>*) xmlNodeGetContent(cur_child_node);
<a name="l01033"></a>01033          sNames[num][count] = prop;
<a name="l01034"></a>01034        }
<a name="l01035"></a>01035        count++;
<a name="l01036"></a>01036      }
<a name="l01037"></a>01037       } <span class="comment">// loop over child nodes</span>
<a name="l01038"></a>01038 
<a name="l01039"></a>01039       num++;
<a name="l01040"></a>01040     }
<a name="l01041"></a>01041   }
<a name="l01042"></a>01042 
<a name="l01043"></a>01043   <span class="comment">// return values</span>
<a name="l01044"></a>01044   *numTear = num;
<a name="l01045"></a>01045   *tearNames = tNames;
<a name="l01046"></a>01046   *subsetNames = sNames;
<a name="l01047"></a>01047   *numSubsetPerTear = numSubsets;
<a name="l01048"></a>01048   *lengths = lens;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l01051"></a>01051 }
<a name="l01052"></a>01052 <span class="comment"></span>
<a name="l01053"></a>01053 <span class="comment">/**</span>
<a name="l01054"></a>01054 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l01055"></a>01055 <span class="comment"> * \brief Write header of an already opened bb file</span>
<a name="l01056"></a>01056 <span class="comment"> *</span>
<a name="l01057"></a>01057 <span class="comment"> * \modifications</span>
<a name="l01058"></a>01058 <span class="comment"> *    - 06/29/2006 WSD Created.</span>
<a name="l01059"></a>01059 <span class="comment"> */</span>
<a name="l01060"></a>01060 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_writeBBFileHeader(
<a name="l01061"></a>01061   FILE* bb_file <span class="comment">/**&lt; input - writable file handle */</span>
<a name="l01062"></a>01062 ) {
<a name="l01063"></a>01063   <span class="comment">//fprintf(bb_file, "&lt;?xml version=\"1.0\"?&gt;\n");</span>
<a name="l01064"></a>01064   fprintf(bb_file, <span class="stringliteral">"&lt;BoundingBoxFile&gt;\n"</span>);
<a name="l01065"></a>01065   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l01066"></a>01066 }
<a name="l01067"></a>01067 <span class="comment"></span>
<a name="l01068"></a>01068 <span class="comment">/**</span>
<a name="l01069"></a>01069 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l01070"></a>01070 <span class="comment"> * \brief Write footer into xml file</span>
<a name="l01071"></a>01071 <span class="comment"> *</span>
<a name="l01072"></a>01072 <span class="comment"> * \modifications</span>
<a name="l01073"></a>01073 <span class="comment"> *    - 06/29/2006 WSD Created.</span>
<a name="l01074"></a>01074 <span class="comment"> */</span>
<a name="l01075"></a>01075 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_writeBBFileFooter(
<a name="l01076"></a>01076                         FILE* bb_file <span class="comment">/**&lt; */</span>
<a name="l01077"></a>01077 ) {
<a name="l01078"></a>01078   fprintf(bb_file, <span class="stringliteral">"&lt;/BoundingBoxFile&gt;\n"</span>);
<a name="l01079"></a>01079   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l01080"></a>01080 }
<a name="l01081"></a>01081 <span class="comment"></span>
<a name="l01082"></a>01082 <span class="comment">/**</span>
<a name="l01083"></a>01083 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l01084"></a>01084 <span class="comment"> * \brief Write a bounding box element</span>
<a name="l01085"></a>01085 <span class="comment"> *</span>
<a name="l01086"></a>01086 <span class="comment"> * \description</span>
<a name="l01087"></a>01087 <span class="comment"> *   </span>
<a name="l01088"></a>01088 <span class="comment"> *    If numDim &lt; 3, the extra dimensions are padded with zeros.</span>
<a name="l01089"></a>01089 <span class="comment"> *</span>
<a name="l01090"></a>01090 <span class="comment"> * \modifications</span>
<a name="l01091"></a>01091 <span class="comment"> *    - 06/29/2006 WSD Created.</span>
<a name="l01092"></a>01092 <span class="comment"> */</span>
<a name="l01093"></a>01093 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_writeBBFileBoundingBox(
<a name="l01094"></a>01094   FILE* bb_file, <span class="comment">/**&lt; input - writable file handle */</span>
<a name="l01095"></a>01095   <span class="keywordtype">char</span>* name,    <span class="comment">/**&lt; input - the name of the bounding box */</span>
<a name="l01096"></a>01096   <span class="keywordtype">int</span> stepID,    <span class="comment">/**&lt; input - the step ID */</span>
<a name="l01097"></a>01097   <span class="keywordtype">char</span>* comment_str, <span class="comment">/**&lt; input - comments */</span>
<a name="l01098"></a>01098   <span class="keywordtype">int</span> numDim,    <span class="comment">/**&lt; input - number of dimensions */</span>
<a name="l01099"></a>01099   <a class="code" href="group__SimpleDataObjects.html#g9687c6aad22d56c60f87659f533869c2">FC_Coords</a> lowers, <span class="comment">/**&lt; input - the lower corner coords */</span>
<a name="l01100"></a>01100   <a class="code" href="group__SimpleDataObjects.html#g9687c6aad22d56c60f87659f533869c2">FC_Coords</a> uppers  <span class="comment">/**&lt; input - the upper corner coords */</span>
<a name="l01101"></a>01101 ) {
<a name="l01102"></a>01102   <span class="keywordtype">int</span> i;
<a name="l01103"></a>01103   <span class="keywordtype">char</span> axisName[3] = { <span class="charliteral">'X'</span>, <span class="charliteral">'Y'</span>, <span class="charliteral">'Z'</span> };
<a name="l01104"></a>01104 
<a name="l01105"></a>01105   fprintf(bb_file, <span class="stringliteral">"  &lt;BoundingBox\n"</span>);
<a name="l01106"></a>01106   fprintf(bb_file, <span class="stringliteral">"    Name=\"%s\" Timestep=\"%d\"\n"</span>, name, stepID);
<a name="l01107"></a>01107   fprintf(bb_file, <span class="stringliteral">"    Comments=\"%s\"\n"</span>, comment_str);
<a name="l01108"></a>01108   <span class="keywordflow">for</span> (i = 0; i &lt; numDim; i++)
<a name="l01109"></a>01109     fprintf(bb_file, <span class="stringliteral">"    Min%c=\"%g\" Max%c=\"%g\"\n"</span>, axisName[i], lowers[i],
<a name="l01110"></a>01110          axisName[i], uppers[i]);
<a name="l01111"></a>01111   <span class="keywordflow">for</span> (i = numDim; i &lt; 3; i++)
<a name="l01112"></a>01112     fprintf(bb_file, <span class="stringliteral">"    Min%c=\"0\" Max%c=\"0\"\n"</span>, axisName[i], axisName[i]);
<a name="l01113"></a>01113   fprintf(bb_file, <span class="stringliteral">"  /&gt;\n"</span>);
<a name="l01114"></a>01114   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l01115"></a>01115 }
<a name="l01116"></a>01116 <span class="comment"></span>
<a name="l01117"></a>01117 <span class="comment">/**</span>
<a name="l01118"></a>01118 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l01119"></a>01119 <span class="comment"> * \brief Read an xml bounding box file</span>
<a name="l01120"></a>01120 <span class="comment"> *</span>
<a name="l01121"></a>01121 <span class="comment"> * \description</span>
<a name="l01122"></a>01122 <span class="comment"> *</span>
<a name="l01123"></a>01123 <span class="comment"> *    This creates a bunch of data which the user has the responsibility</span>
<a name="l01124"></a>01124 <span class="comment"> *    of freeing.</span>
<a name="l01125"></a>01125 <span class="comment"> *</span>
<a name="l01126"></a>01126 <span class="comment"> *    NOTE: we're assuming that xmlChar* and char* can be cast back and</span>
<a name="l01127"></a>01127 <span class="comment"> *    forth w/o worry. That is, libxml2 uses UTF-8 and we cast to</span>
<a name="l01128"></a>01128 <span class="comment"> *    char* hoping that our words are the proper size.</span>
<a name="l01129"></a>01129 <span class="comment"> *</span>
<a name="l01130"></a>01130 <span class="comment"> * \modifications</span>
<a name="l01131"></a>01131 <span class="comment"> *    - 06/29/2006 WSD Created.</span>
<a name="l01132"></a>01132 <span class="comment"> */</span>
<a name="l01133"></a>01133 <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> _fc_readBBFile(
<a name="l01134"></a>01134   <span class="keywordtype">char</span>* filename,       <span class="comment">/**&lt; input - file name */</span>
<a name="l01135"></a>01135   <span class="keywordtype">int</span>* numBB,           <span class="comment">/**&lt; output - the number of bounding boxes */</span>
<a name="l01136"></a>01136   <span class="keywordtype">char</span>*** bbNames,      <span class="comment">/**&lt; output - the names of the bbs */</span>
<a name="l01137"></a>01137   <span class="keywordtype">int</span>** bbStepIDs,      <span class="comment">/**&lt; output - step IDs */</span>
<a name="l01138"></a>01138   <span class="keywordtype">char</span>*** bbComments,   <span class="comment">/**&lt; output - comment strings */</span>
<a name="l01139"></a>01139   <a class="code" href="group__SimpleDataObjects.html#g9687c6aad22d56c60f87659f533869c2">FC_Coords</a>** bbLowers, <span class="comment">/**&lt; output - lower corners of the bbs */</span>
<a name="l01140"></a>01140   <a class="code" href="group__SimpleDataObjects.html#g9687c6aad22d56c60f87659f533869c2">FC_Coords</a>** bbUppers  <span class="comment">/**&lt; output - upper corners of the bb */</span>
<a name="l01141"></a>01141 ) {
<a name="l01142"></a>01142   <span class="keywordtype">int</span> i;
<a name="l01143"></a>01143   xmlDocPtr doc;
<a name="l01144"></a>01144   xmlNode* root = NULL, *cur_node;
<a name="l01145"></a>01145   <span class="keywordtype">char</span>* prop;
<a name="l01146"></a>01146   <span class="keywordtype">int</span> num = 0, len = 0;
<a name="l01147"></a>01147   <span class="keywordtype">char</span>** names = NULL, **comments = NULL;
<a name="l01148"></a>01148   <span class="keywordtype">int</span>* stepIDs = NULL;
<a name="l01149"></a>01149   <a class="code" href="group__SimpleDataObjects.html#g9687c6aad22d56c60f87659f533869c2">FC_Coords</a>* lowers = NULL, *uppers = NULL;
<a name="l01150"></a>01150   <span class="keywordtype">void</span>* temp1, *temp2, *temp3, *temp4, *temp5;
<a name="l01151"></a>01151   <span class="keywordtype">char</span>* MinAttNames[3] = { <span class="stringliteral">"MinX"</span>, <span class="stringliteral">"MinY"</span>, <span class="stringliteral">"MinZ"</span> };
<a name="l01152"></a>01152   <span class="keywordtype">char</span>* MaxAttNames[3] = { <span class="stringliteral">"MaxX"</span>, <span class="stringliteral">"MaxY"</span>, <span class="stringliteral">"MaxZ"</span> };
<a name="l01153"></a>01153 
<a name="l01154"></a>01154   <span class="comment">// test input</span>
<a name="l01155"></a>01155   <span class="keywordflow">if</span> (!filename || !numBB || !bbNames || !bbComments || !bbStepIDs || 
<a name="l01156"></a>01156       !bbLowers || !bbUppers)
<a name="l01157"></a>01157     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l01158"></a>01158 
<a name="l01159"></a>01159   <span class="comment">// parse the doc</span>
<a name="l01160"></a>01160   doc = xmlParseFile(filename);
<a name="l01161"></a>01161   <span class="keywordflow">if</span> (doc == NULL) 
<a name="l01162"></a>01162     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l01163"></a>01163 
<a name="l01164"></a>01164   <span class="comment">// must be an bounding box file</span>
<a name="l01165"></a>01165   root = xmlDocGetRootElement(doc);
<a name="l01166"></a>01166   <span class="keywordflow">if</span> (!root || !root-&gt;name || 
<a name="l01167"></a>01167       xmlStrcmp(root-&gt;name,(<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"BoundingBoxFile"</span>)) {
<a name="l01168"></a>01168     xmlFreeDoc(doc);
<a name="l01169"></a>01169     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"XML document is not of type BoundingBoxFile"</span>);
<a name="l01170"></a>01170     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l01171"></a>01171   }
<a name="l01172"></a>01172 
<a name="l01173"></a>01173   <span class="comment">// walk the tree looking for bounding boxes</span>
<a name="l01174"></a>01174   <span class="keywordflow">for</span> (cur_node = root-&gt;children; cur_node != NULL; cur_node = cur_node-&gt;next)
<a name="l01175"></a>01175   {
<a name="l01176"></a>01176     <span class="keywordflow">if</span> (cur_node-&gt;type == XML_ELEMENT_NODE &amp;&amp; 
<a name="l01177"></a>01177      !xmlStrcmp(cur_node-&gt;name, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"BoundingBox"</span>)) {
<a name="l01178"></a>01178       <span class="keywordflow">if</span> (num == len) {
<a name="l01179"></a>01179      <span class="keywordflow">if</span> (len == 0)
<a name="l01180"></a>01180        len = 2;
<a name="l01181"></a>01181      <span class="keywordflow">else</span>
<a name="l01182"></a>01182        len *= 2;
<a name="l01183"></a>01183      temp1 = realloc(names, len*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
<a name="l01184"></a>01184      temp2 = realloc(comments, len*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
<a name="l01185"></a>01185      temp3 = realloc(stepIDs, len*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l01186"></a>01186      temp4 = realloc(lowers, len*<span class="keyword">sizeof</span>(<a class="code" href="group__SimpleDataObjects.html#g9687c6aad22d56c60f87659f533869c2">FC_Coords</a>));
<a name="l01187"></a>01187      temp5 = realloc(uppers, len*<span class="keyword">sizeof</span>(<a class="code" href="group__SimpleDataObjects.html#g9687c6aad22d56c60f87659f533869c2">FC_Coords</a>));
<a name="l01188"></a>01188      <span class="keywordflow">if</span> (!temp1 || !temp2 || !temp3 || !temp4 || !temp5)
<a name="l01189"></a>01189        <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l01190"></a>01190      names = temp1;
<a name="l01191"></a>01191      comments = temp2;
<a name="l01192"></a>01192      stepIDs = temp3;
<a name="l01193"></a>01193      lowers = temp4;
<a name="l01194"></a>01194      uppers = temp5;
<a name="l01195"></a>01195       }
<a name="l01196"></a>01196       names[num] = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"Name"</span>);
<a name="l01197"></a>01197       comments[num] = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, 
<a name="l01198"></a>01198                           (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"Comments"</span>);
<a name="l01199"></a>01199       prop = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)<span class="stringliteral">"Timestep"</span>);
<a name="l01200"></a>01200       stepIDs[num] = atoi(prop);
<a name="l01201"></a>01201       free(prop);
<a name="l01202"></a>01202       <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {
<a name="l01203"></a>01203      prop = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)MinAttNames[i]);
<a name="l01204"></a>01204      lowers[num][i] = atof(prop);
<a name="l01205"></a>01205      free(prop);
<a name="l01206"></a>01206      prop = (<span class="keywordtype">char</span>*) xmlGetProp(cur_node, (<span class="keyword">const</span> xmlChar*)MaxAttNames[i]);
<a name="l01207"></a>01207      uppers[num][i] = atof(prop);
<a name="l01208"></a>01208      free(prop);
<a name="l01209"></a>01209       }
<a name="l01210"></a>01210       num++;
<a name="l01211"></a>01211     }
<a name="l01212"></a>01212   }
<a name="l01213"></a>01213 
<a name="l01214"></a>01214   <span class="comment">// done with doc</span>
<a name="l01215"></a>01215   xmlFreeDoc(doc);
<a name="l01216"></a>01216 
<a name="l01217"></a>01217   <span class="comment">// return values</span>
<a name="l01218"></a>01218   *numBB = num;
<a name="l01219"></a>01219   *bbNames = names;
<a name="l01220"></a>01220   *bbComments = comments;
<a name="l01221"></a>01221   *bbStepIDs = stepIDs;
<a name="l01222"></a>01222   *bbLowers = lowers;
<a name="l01223"></a>01223   *bbUppers = uppers;
<a name="l01224"></a>01224 
<a name="l01225"></a>01225   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l01226"></a>01226 }
<a name="l01227"></a>01227 
<a name="l01228"></a>01228 <span class="preprocessor">#endif // HAVE_LIBXML2</span>
<a name="l01229"></a>01229 <span class="preprocessor"></span><span class="comment"></span>
<a name="l01230"></a>01230 <span class="comment">/**</span>
<a name="l01231"></a>01231 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l01232"></a>01232 <span class="comment"> * \brief Read a .names file</span>
<a name="l01233"></a>01233 <span class="comment"> *</span>
<a name="l01234"></a>01234 <span class="comment"> * \description</span>
<a name="l01235"></a>01235 <span class="comment"> *</span>
<a name="l01236"></a>01236 <span class="comment"> *    Originally for Exodus files, but being coopted for LSDyna files.  File</span>
<a name="l01237"></a>01237 <span class="comment"> *    format is 'block' or 'nodeset' or 'sideset' on a single line. All lines</span>
<a name="l01238"></a>01238 <span class="comment"> *    between these descriptors are of the listed type.</span>
<a name="l01239"></a>01239 <span class="comment"> *</span>
<a name="l01240"></a>01240 <span class="comment"> *    The returned sorted blob arrays hold pointers to \ref _FC_IntStringPair</span>
<a name="l01241"></a>01241 <span class="comment"> *    objects. The string on each object will need to be deleted and each</span>
<a name="l01242"></a>01242 <span class="comment"> *    object will need to be deleted. A helper function </span>
<a name="l01243"></a>01243 <span class="comment"> *    \ref _fc_freeNamesFileNames() can be used.</span>
<a name="l01244"></a>01244 <span class="comment"> *</span>
<a name="l01245"></a>01245 <span class="comment"> *    It is not an error to not find a names file and the sorted blob</span>
<a name="l01246"></a>01246 <span class="comment"> *    arrays will come back empty.</span>
<a name="l01247"></a>01247 <span class="comment"> *</span>
<a name="l01248"></a>01248 <span class="comment"> * \modifications</span>
<a name="l01249"></a>01249 <span class="comment"> *    - 6/19/2006 WSD Created to replaced duplicated code in exodusio and</span>
<a name="l01250"></a>01250 <span class="comment"> *      lsdynaio modules.</span>
<a name="l01251"></a>01251 <span class="comment"> *    - 8/10/2006 WSD Changed to use sorted blob arrays instead of linked lists.</span>
<a name="l01252"></a>01252 <span class="comment"> */</span>
<a name="l01253"></a><a class="code" href="group__PrivateFileIO.html#g7fd390122ab4f73934ab95f22972d806">01253</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g7fd390122ab4f73934ab95f22972d806">_fc_readNamesFile</a>(
<a name="l01254"></a>01254   <span class="keywordtype">char</span>* datasetfilename,     <span class="comment">/**&lt; input - path to and name of dataset file */</span>
<a name="l01255"></a>01255   <a class="code" href="structFC__SortedBlobArray.html">FC_SortedBlobArray</a>* block_names,    <span class="comment">/**&lt; output- the block names,</span>
<a name="l01256"></a>01256 <span class="comment">                        caller is responsible for freeing internal data */</span>
<a name="l01257"></a>01257   <a class="code" href="structFC__SortedBlobArray.html">FC_SortedBlobArray</a>* nodeset_names,  <span class="comment">/**&lt; output - the nodeset names,</span>
<a name="l01258"></a>01258 <span class="comment">                        caller is responsible for freeing internal data */</span>
<a name="l01259"></a>01259   <a class="code" href="structFC__SortedBlobArray.html">FC_SortedBlobArray</a>* sideset_names   <span class="comment">/**&lt; output - the sideset names,</span>
<a name="l01260"></a>01260 <span class="comment">                        caller is responsible for freeing internal data */</span>
<a name="l01261"></a>01261 ) 
<a name="l01262"></a>01262 {
<a name="l01263"></a>01263   <span class="keywordtype">int</span> rc;
<a name="l01264"></a>01264   <span class="keywordtype">char</span>* dirname, *basefilename, *namesfilename;
<a name="l01265"></a>01265   FILE* namesfile;
<a name="l01266"></a>01266   size_t len;
<a name="l01267"></a>01267   <a class="code" href="structFC__SortedBlobArray.html">FC_SortedBlobArray</a> *sba_p;
<a name="l01268"></a>01268   <a class="code" href="struct__FC__IntStringPair.html">_FC_IntStringPair</a> *blob;
<a name="l01269"></a>01269   <span class="keywordtype">char</span> strbuf[1024];  <span class="comment">// FIX!!!! overrun possible!</span>
<a name="l01270"></a>01270 
<a name="l01271"></a>01271   <span class="comment">// default return - leave blob arrays alone</span>
<a name="l01272"></a>01272 
<a name="l01273"></a>01273   <span class="comment">// checkinputs</span>
<a name="l01274"></a>01274   <span class="keywordflow">if</span> (!datasetfilename || !block_names || !nodeset_names || !sideset_names ){
<a name="l01275"></a>01275     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l01276"></a>01276   }
<a name="l01277"></a>01277 
<a name="l01278"></a>01278   <span class="comment">// init lists (so will return empties if no file found)</span>
<a name="l01279"></a>01279   rc = <a class="code" href="group__SimpleDataObjects.html#g4c4466bfa0c8c01723d4580473fcb245">fc_initSortedBlobArray</a>(block_names);
<a name="l01280"></a>01280   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l01281"></a>01281     <span class="keywordflow">return</span> rc;
<a name="l01282"></a>01282   rc = <a class="code" href="group__SimpleDataObjects.html#g4c4466bfa0c8c01723d4580473fcb245">fc_initSortedBlobArray</a>(nodeset_names);
<a name="l01283"></a>01283   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l01284"></a>01284     <span class="keywordflow">return</span> rc;
<a name="l01285"></a>01285   rc = <a class="code" href="group__SimpleDataObjects.html#g4c4466bfa0c8c01723d4580473fcb245">fc_initSortedBlobArray</a>(sideset_names);
<a name="l01286"></a>01286   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l01287"></a>01287     <span class="keywordflow">return</span> rc;
<a name="l01288"></a>01288 
<a name="l01289"></a>01289   <span class="comment">// attempt to open the names file</span>
<a name="l01290"></a>01290   dirname = <a class="code" href="group__FilePathUtilities.html#g5b8585efffde7252cd91727e40b3ee95">fc_getDirname</a>(datasetfilename);
<a name="l01291"></a>01291   basefilename = <a class="code" href="group__FilePathUtilities.html#g3d751b21619bdac2b578e3edbb61a775">fc_getBasenameWOExtension</a>(datasetfilename, 1);
<a name="l01292"></a>01292   len = strlen(dirname) + 1 + strlen(basefilename) + 7;
<a name="l01293"></a>01293   namesfilename = (<span class="keywordtype">char</span>*)malloc(len*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l01294"></a>01294   <span class="keywordflow">if</span> (!namesfilename) {
<a name="l01295"></a>01295     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g97ca6452d8a5b6625a2c02166dc87bb7">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>));
<a name="l01296"></a>01296     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l01297"></a>01297   }
<a name="l01298"></a>01298   <span class="keywordflow">if</span> (dirname != NULL)
<a name="l01299"></a>01299     sprintf(namesfilename, <span class="stringliteral">"%s/%s.names"</span>, dirname, basefilename);
<a name="l01300"></a>01300   <span class="keywordflow">else</span>
<a name="l01301"></a>01301     sprintf(namesfilename, <span class="stringliteral">"%s.names"</span>, basefilename);
<a name="l01302"></a>01302   free(dirname);
<a name="l01303"></a>01303   free(basefilename);
<a name="l01304"></a>01304   namesfile = fopen(namesfilename, <span class="stringliteral">"r"</span>);
<a name="l01305"></a>01305   free(namesfilename);
<a name="l01306"></a>01306 
<a name="l01307"></a>01307   <span class="comment">// early return - no names file</span>
<a name="l01308"></a>01308   <span class="keywordflow">if</span> (!namesfile)
<a name="l01309"></a>01309     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l01310"></a>01310 
<a name="l01311"></a>01311   <span class="comment">// scan file</span>
<a name="l01312"></a>01312   <span class="keywordflow">while</span>(fscanf(namesfile, <span class="stringliteral">"%s"</span>, strbuf) &gt; 0) {
<a name="l01313"></a>01313     <span class="keywordflow">if</span> (!strcmp(strbuf, <span class="stringliteral">"blocks"</span>)) 
<a name="l01314"></a>01314       sba_p = block_names; <span class="comment">// switch to block list</span>
<a name="l01315"></a>01315     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(strbuf, <span class="stringliteral">"sidesets"</span>))
<a name="l01316"></a>01316       sba_p = sideset_names; <span class="comment">// switch to sidesets list</span>
<a name="l01317"></a>01317     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(strbuf, <span class="stringliteral">"nodesets"</span>))
<a name="l01318"></a>01318       sba_p = nodeset_names; <span class="comment">// switch to nodests list</span>
<a name="l01319"></a>01319     <span class="keywordflow">else</span> { <span class="comment">// add to current list</span>
<a name="l01320"></a>01320       blob = (<a class="code" href="struct__FC__IntStringPair.html">_FC_IntStringPair</a>*)malloc(<span class="keyword">sizeof</span>(<a class="code" href="struct__FC__IntStringPair.html">_FC_IntStringPair</a>));
<a name="l01321"></a>01321       <span class="keywordflow">if</span> (blob == NULL) {
<a name="l01322"></a>01322      <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g97ca6452d8a5b6625a2c02166dc87bb7">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>));
<a name="l01323"></a>01323      <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l01324"></a>01324       }
<a name="l01325"></a>01325       blob-&gt;<a class="code" href="struct__FC__IntStringPair.html#7ceb15a9a9c546ff360740ba580cbc41">id</a> = atoi(strbuf);
<a name="l01326"></a>01326       fscanf(namesfile, <span class="stringliteral">"%[ \t]"</span>, strbuf); <span class="comment">// discard spaces</span>
<a name="l01327"></a>01327       <span class="keywordflow">if</span> (fscanf(namesfile, <span class="stringliteral">"%[^\n]"</span>, strbuf) &lt; 1) { <span class="comment">// read rest of line</span>
<a name="l01328"></a>01328      <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Error reading names from '%s'"</span>,
<a name="l01329"></a>01329                      namesfilename);
<a name="l01330"></a>01330      <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l01331"></a>01331       }
<a name="l01332"></a>01332       blob-&gt;<a class="code" href="struct__FC__IntStringPair.html#6b1ea39a8804c3b61510bba345bb3d40">string</a> = (<span class="keywordtype">char</span>*)malloc((strlen(strbuf)+1)*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l01333"></a>01333       <span class="keywordflow">if</span> (blob-&gt;<a class="code" href="struct__FC__IntStringPair.html#6b1ea39a8804c3b61510bba345bb3d40">string</a> == NULL) {
<a name="l01334"></a>01334      <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g97ca6452d8a5b6625a2c02166dc87bb7">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>));
<a name="l01335"></a>01335      <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>;
<a name="l01336"></a>01336       }
<a name="l01337"></a>01337       strcpy(blob-&gt;<a class="code" href="struct__FC__IntStringPair.html#6b1ea39a8804c3b61510bba345bb3d40">string</a>, strbuf);
<a name="l01338"></a>01338       <a class="code" href="group__SimpleDataObjects.html#g814151838c85aed15a00447043f72a5d">fc_addBlobToSortedBlobArray</a>(sba_p, blob, <a class="code" href="group__MiscUtilities.html#g2c22d9adffbebb62e0bb6b8f920545a8">fc_intCompare</a>);
<a name="l01339"></a>01339     }
<a name="l01340"></a>01340   }
<a name="l01341"></a>01341 
<a name="l01342"></a>01342   <span class="comment">// all done</span>
<a name="l01343"></a>01343   fclose(namesfile);
<a name="l01344"></a>01344   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l01345"></a>01345 }
<a name="l01346"></a>01346 <span class="comment"></span>
<a name="l01347"></a>01347 <span class="comment">/**</span>
<a name="l01348"></a>01348 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l01349"></a>01349 <span class="comment"> * \brief Delete the contents returned from _fc_readNamesFile.</span>
<a name="l01350"></a>01350 <span class="comment"> *</span>
<a name="l01351"></a>01351 <span class="comment"> * \description</span>
<a name="l01352"></a>01352 <span class="comment"> *</span>
<a name="l01353"></a>01353 <span class="comment"> *    Deletes the blob data in the sorted blob arrays return from</span>
<a name="l01354"></a>01354 <span class="comment"> *    \ref _fc_readNamesFile. It is assumed that the blobs are</span>
<a name="l01355"></a>01355 <span class="comment"> *    malloc'd \ref _FC_IntStringPair objects with malloc'd strings.</span>
<a name="l01356"></a>01356 <span class="comment"> *</span>
<a name="l01357"></a>01357 <span class="comment"> * \modifications</span>
<a name="l01358"></a>01358 <span class="comment"> *    - 8/10/2006 WSD Created.</span>
<a name="l01359"></a>01359 <span class="comment"> */</span>
<a name="l01360"></a><a class="code" href="group__PrivateFileIO.html#gd96b9f70719cc9b0dd5267981a500d92">01360</a> <span class="keywordtype">void</span> <a class="code" href="group__PrivateFileIO.html#gd96b9f70719cc9b0dd5267981a500d92">_fc_freeNamesFileNames</a>(
<a name="l01361"></a>01361   <a class="code" href="structFC__SortedBlobArray.html">FC_SortedBlobArray</a>* block_names,    <span class="comment">/**&lt; input/output- the block names */</span>
<a name="l01362"></a>01362   <a class="code" href="structFC__SortedBlobArray.html">FC_SortedBlobArray</a>* nodeset_names,  <span class="comment">/**&lt; input/output - the nodeset names */</span>
<a name="l01363"></a>01363   <a class="code" href="structFC__SortedBlobArray.html">FC_SortedBlobArray</a>* sideset_names   <span class="comment">/**&lt; input/output - the sideset names */</span>
<a name="l01364"></a>01364 ) 
<a name="l01365"></a>01365 {
<a name="l01366"></a>01366   <span class="keywordtype">int</span> i, j;
<a name="l01367"></a>01367   <a class="code" href="structFC__SortedBlobArray.html">FC_SortedBlobArray</a> *sba_p;
<a name="l01368"></a>01368   <a class="code" href="struct__FC__IntStringPair.html">_FC_IntStringPair</a> *blob;
<a name="l01369"></a>01369 
<a name="l01370"></a>01370   <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {
<a name="l01371"></a>01371     <span class="keywordflow">switch</span>(i) {
<a name="l01372"></a>01372     <span class="keywordflow">case</span> 0: sba_p = block_names;   <span class="keywordflow">break</span>;
<a name="l01373"></a>01373     <span class="keywordflow">case</span> 1: sba_p = nodeset_names; <span class="keywordflow">break</span>;
<a name="l01374"></a>01374     <span class="keywordflow">case</span> 2: sba_p = sideset_names; <span class="keywordflow">break</span>;
<a name="l01375"></a>01375     }
<a name="l01376"></a>01376     <span class="keywordflow">if</span> (<a class="code" href="group__SimpleDataObjects.html#ge30e7aef8be697d765a02989fb2ff54c">fc_isSortedBlobArrayValid</a>(sba_p)) {
<a name="l01377"></a>01377       <span class="keywordflow">for</span> (j = 0; j &lt; sba_p-&gt;<a class="code" href="structFC__SortedBlobArray.html#cc191073db67e6908e5af541524afd1b">numBlob</a>; j++) {
<a name="l01378"></a>01378      blob = sba_p-&gt;<a class="code" href="structFC__SortedBlobArray.html#6962b1ec25cc07e8c55aa09924a39a61">blobs</a>[j];
<a name="l01379"></a>01379      free(blob-&gt;<a class="code" href="struct__FC__IntStringPair.html#6b1ea39a8804c3b61510bba345bb3d40">string</a>);
<a name="l01380"></a>01380      free(blob);
<a name="l01381"></a>01381       }
<a name="l01382"></a>01382       <a class="code" href="group__SimpleDataObjects.html#g3e9fd6e342884a7dba87aa6637aa7aee">fc_freeSortedBlobArray</a>(sba_p);
<a name="l01383"></a>01383     }
<a name="l01384"></a>01384   }
<a name="l01385"></a>01385 }
<a name="l01386"></a>01386 <span class="comment"></span>
<a name="l01387"></a>01387 <span class="comment">/** \name Queries of File IO enumerated type. */</span>
<a name="l01388"></a>01388 <span class="comment">//-------------------------------</span><span class="comment"></span>
<a name="l01389"></a>01389 <span class="comment">//@{</span>
<a name="l01390"></a>01390 <span class="comment"></span><span class="comment"></span>
<a name="l01391"></a>01391 <span class="comment">/**</span>
<a name="l01392"></a>01392 <span class="comment"> * \ingroup   FileIO</span>
<a name="l01393"></a>01393 <span class="comment"> * \brief  Verify that the given value is valid for this enum</span>
<a name="l01394"></a>01394 <span class="comment"> *</span>
<a name="l01395"></a>01395 <span class="comment"> * \modifications   </span>
<a name="l01396"></a>01396 <span class="comment"> *    - 7/14/2005 WSD, Created</span>
<a name="l01397"></a>01397 <span class="comment"> */</span>
<a name="l01398"></a><a class="code" href="group__FileIO.html#g4b010da246d95680cd57de6d5cc059e6">01398</a> <span class="keywordtype">int</span> <a class="code" href="group__FileIO.html#g4b010da246d95680cd57de6d5cc059e6">fc_isFileIOTypeValid</a>(
<a name="l01399"></a>01399   <a class="code" href="group__FileIO.html#g4647ac3054682609036d15ddf55055d5">FC_FileIOType</a> fileType   
<a name="l01400"></a>01400 ) {
<a name="l01401"></a>01401   <span class="keywordflow">switch</span>(fileType) {
<a name="l01402"></a>01402   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>:     <span class="comment">// fall through</span>
<a name="l01403"></a>01403   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:   <span class="comment">// fall through</span>
<a name="l01404"></a>01404   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>:   <span class="comment">// fall through</span>
<a name="l01405"></a>01405   <span class="comment">// no default case so will get warning if new values added to enum</span>
<a name="l01406"></a>01406     <span class="keywordflow">return</span> 1;
<a name="l01407"></a>01407   }
<a name="l01408"></a>01408   <span class="keywordflow">return</span> 0;
<a name="l01409"></a>01409 }
<a name="l01410"></a>01410 <span class="comment"></span>
<a name="l01411"></a>01411 <span class="comment">/**</span>
<a name="l01412"></a>01412 <span class="comment"> * \ingroup   FileIO</span>
<a name="l01413"></a>01413 <span class="comment"> * \brief  Return name of the FC_FileIOType's value.</span>
<a name="l01414"></a>01414 <span class="comment"> *</span>
<a name="l01415"></a>01415 <span class="comment"> * \modifications   </span>
<a name="l01416"></a>01416 <span class="comment"> *    - 7/14/2005 WSD, Created</span>
<a name="l01417"></a>01417 <span class="comment"> */</span>
<a name="l01418"></a><a class="code" href="group__FileIO.html#g41eb2bb3f38f2c30f7c63b7eac69fd06">01418</a> <span class="keywordtype">char</span> *<a class="code" href="group__FileIO.html#g41eb2bb3f38f2c30f7c63b7eac69fd06">fc_getFileIOTypeText</a>(
<a name="l01419"></a>01419   <a class="code" href="group__FileIO.html#g4647ac3054682609036d15ddf55055d5">FC_FileIOType</a> fileType   
<a name="l01420"></a>01420 ) {
<a name="l01421"></a>01421   <span class="keywordflow">switch</span>(fileType) {
<a name="l01422"></a>01422   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>:    <span class="keywordflow">return</span> <span class="stringliteral">"FC_FT_NONE"</span>;
<a name="l01423"></a>01423   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:  <span class="keywordflow">return</span> <span class="stringliteral">"FC_FT_EXODUS"</span>;
<a name="l01424"></a>01424   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>:  <span class="keywordflow">return</span> <span class="stringliteral">"FC_FT_LSDYNA"</span>;
<a name="l01425"></a>01425   <span class="comment">// no default case so will get warning if new values added to enum</span>
<a name="l01426"></a>01426   }
<a name="l01427"></a>01427   <span class="keywordflow">return</span> <span class="stringliteral">"invalid value for enum FC_FileIOType"</span>;
<a name="l01428"></a>01428 }
<a name="l01429"></a>01429 <span class="comment"></span>
<a name="l01430"></a>01430 <span class="comment">/**</span>
<a name="l01431"></a>01431 <span class="comment"> * \ingroup   FileIO</span>
<a name="l01432"></a>01432 <span class="comment"> * \brief  Verify that a file IO type can be read.</span>
<a name="l01433"></a>01433 <span class="comment"> *</span>
<a name="l01434"></a>01434 <span class="comment"> * \description</span>
<a name="l01435"></a>01435 <span class="comment"> *</span>
<a name="l01436"></a>01436 <span class="comment"> *    The library can be build with or without support for various file types</span>
<a name="l01437"></a>01437 <span class="comment"> *    and some types are supported only for reading.  Use this routine to</span>
<a name="l01438"></a>01438 <span class="comment"> *    determine if the requested file type is supported for reading.</span>
<a name="l01439"></a>01439 <span class="comment"> *    </span>
<a name="l01440"></a>01440 <span class="comment"> *    Note that a file IO type of FC_FT_NONE is considered supported</span>
<a name="l01441"></a>01441 <span class="comment"> *    since it requires no support.</span>
<a name="l01442"></a>01442 <span class="comment"> *</span>
<a name="l01443"></a>01443 <span class="comment"> * \todo Think more about what FC_FT_NONE should return.</span>
<a name="l01444"></a>01444 <span class="comment"> *</span>
<a name="l01445"></a>01445 <span class="comment"> * \modifications   </span>
<a name="l01446"></a>01446 <span class="comment"> *    - 2/1/2006 WSD, Created</span>
<a name="l01447"></a>01447 <span class="comment"> */</span>
<a name="l01448"></a><a class="code" href="group__FileIO.html#g2879ce67249222c9e393a5d8bd55b5cb">01448</a> <span class="keywordtype">int</span> <a class="code" href="group__FileIO.html#g2879ce67249222c9e393a5d8bd55b5cb">fc_isFileIOTypeReadSupported</a>(
<a name="l01449"></a>01449   <a class="code" href="group__FileIO.html#g4647ac3054682609036d15ddf55055d5">FC_FileIOType</a> fileType   
<a name="l01450"></a>01450 ) {
<a name="l01451"></a>01451   <span class="keywordflow">switch</span>(fileType) {
<a name="l01452"></a>01452   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>:     
<a name="l01453"></a>01453     <span class="keywordflow">return</span> 1;  <span class="comment">// requires no support, so supported by default</span>
<a name="l01454"></a>01454   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:  
<a name="l01455"></a>01455 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l01456"></a>01456 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 1;
<a name="l01457"></a>01457 <span class="preprocessor">#else</span>
<a name="l01458"></a>01458 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
<a name="l01459"></a>01459 <span class="preprocessor">#endif</span>
<a name="l01460"></a>01460 <span class="preprocessor"></span>  <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>:
<a name="l01461"></a>01461     <span class="keywordflow">return</span> 1;
<a name="l01462"></a>01462   <span class="comment">// no default case so will get warning if new values added to enum</span>
<a name="l01463"></a>01463   }
<a name="l01464"></a>01464   <span class="keywordflow">return</span> 0;
<a name="l01465"></a>01465 }
<a name="l01466"></a>01466 <span class="comment"></span>
<a name="l01467"></a>01467 <span class="comment">/**</span>
<a name="l01468"></a>01468 <span class="comment"> * \ingroup   FileIO</span>
<a name="l01469"></a>01469 <span class="comment"> * \brief  Verify that a file IO type can be written.</span>
<a name="l01470"></a>01470 <span class="comment"> *</span>
<a name="l01471"></a>01471 <span class="comment"> * \description</span>
<a name="l01472"></a>01472 <span class="comment"> *</span>
<a name="l01473"></a>01473 <span class="comment"> *    The library can be build with or without support for various file types</span>
<a name="l01474"></a>01474 <span class="comment"> *    and some types are supported only for reading.  Use this routine to</span>
<a name="l01475"></a>01475 <span class="comment"> *    determine if the requested file type is supported for writing.</span>
<a name="l01476"></a>01476 <span class="comment"> *    </span>
<a name="l01477"></a>01477 <span class="comment"> *    Note that a file IO type of FC_FT_NONE is considered supported</span>
<a name="l01478"></a>01478 <span class="comment"> *    since it requires no support.</span>
<a name="l01479"></a>01479 <span class="comment"> *</span>
<a name="l01480"></a>01480 <span class="comment"> * \todo Think more about what FC_FT_NONE should return.</span>
<a name="l01481"></a>01481 <span class="comment"> *</span>
<a name="l01482"></a>01482 <span class="comment"> * \modifications   </span>
<a name="l01483"></a>01483 <span class="comment"> *    - 2/1/2006 WSD, Created</span>
<a name="l01484"></a>01484 <span class="comment"> */</span>
<a name="l01485"></a><a class="code" href="group__FileIO.html#gd4620277127682158f23e5dc99077f19">01485</a> <span class="keywordtype">int</span> <a class="code" href="group__FileIO.html#gd4620277127682158f23e5dc99077f19">fc_isFileIOTypeWriteSupported</a>(
<a name="l01486"></a>01486   <a class="code" href="group__FileIO.html#g4647ac3054682609036d15ddf55055d5">FC_FileIOType</a> fileType   
<a name="l01487"></a>01487 ) {
<a name="l01488"></a>01488   <span class="keywordflow">switch</span>(fileType) {
<a name="l01489"></a>01489   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>:     
<a name="l01490"></a>01490     <span class="keywordflow">return</span> 0;  <span class="comment">// can't do, so not supported</span>
<a name="l01491"></a>01491   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:  
<a name="l01492"></a>01492 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l01493"></a>01493 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 1;
<a name="l01494"></a>01494 <span class="preprocessor">#else</span>
<a name="l01495"></a>01495 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
<a name="l01496"></a>01496 <span class="preprocessor">#endif</span>
<a name="l01497"></a>01497 <span class="preprocessor"></span>  <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>:
<a name="l01498"></a>01498     <span class="keywordflow">return</span> 0;
<a name="l01499"></a>01499   <span class="comment">// no default case so will get warning if new values added to enum</span>
<a name="l01500"></a>01500   }
<a name="l01501"></a>01501   <span class="keywordflow">return</span> 0;
<a name="l01502"></a>01502 }
<a name="l01503"></a>01503 <span class="comment"></span>
<a name="l01504"></a>01504 <span class="comment">//@}</span>
<a name="l01505"></a>01505 <span class="comment"></span><span class="comment"></span>
<a name="l01506"></a>01506 <span class="comment">/** \name File IO operations on datasets. */</span>
<a name="l01507"></a>01507 <span class="comment">//-------------------------------</span><span class="comment"></span>
<a name="l01508"></a>01508 <span class="comment">//@{</span>
<a name="l01509"></a>01509 <span class="comment"></span><span class="comment"></span>
<a name="l01510"></a>01510 <span class="comment">/** </span>
<a name="l01511"></a>01511 <span class="comment"> * \ingroup FileIO</span>
<a name="l01512"></a>01512 <span class="comment"> * \brief Get type of file format.</span>
<a name="l01513"></a>01513 <span class="comment"> *</span>
<a name="l01514"></a>01514 <span class="comment"> * \modifications</span>
<a name="l01515"></a>01515 <span class="comment"> *    - 7/14/2005 WSD Created.</span>
<a name="l01516"></a>01516 <span class="comment"> */</span>
<a name="l01517"></a><a class="code" href="group__FileIO.html#gfb3dc55acedbf51e3bfee747122e69e1">01517</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__FileIO.html#gfb3dc55acedbf51e3bfee747122e69e1">fc_getDatasetFileIOType</a>(
<a name="l01518"></a>01518   <a class="code" href="structFC__Dataset.html">FC_Dataset</a> dataset,      <span class="comment">/**&lt; input - dataset handle */</span>
<a name="l01519"></a>01519   <a class="code" href="group__FileIO.html#g4647ac3054682609036d15ddf55055d5">FC_FileIOType</a>* fileType  <span class="comment">/**&lt; output - file format type */</span>
<a name="l01520"></a>01520 ) {
<a name="l01521"></a>01521   <a class="code" href="struct__FC__DsSlot.html">_FC_DsSlot</a>* dsSlot;
<a name="l01522"></a>01522 
<a name="l01523"></a>01523   <span class="comment">// default return value</span>
<a name="l01524"></a>01524   <span class="keywordflow">if</span> (fileType)
<a name="l01525"></a>01525     *fileType = <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>;
<a name="l01526"></a>01526 
<a name="l01527"></a>01527   <span class="comment">// check input</span>
<a name="l01528"></a>01528   dsSlot = <a class="code" href="group__PrivateDataset.html#g42016ac71c44a0188d75d5753adc47b2">_fc_getDsSlot</a>(dataset);
<a name="l01529"></a>01529   <span class="keywordflow">if</span> (dsSlot == NULL || fileType == NULL) {
<a name="l01530"></a>01530     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g97ca6452d8a5b6625a2c02166dc87bb7">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>));
<a name="l01531"></a>01531     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l01532"></a>01532   }
<a name="l01533"></a>01533   
<a name="l01534"></a>01534   <span class="comment">// log message</span>
<a name="l01535"></a>01535   <a class="code" href="group__Library.html#g523b10264df36531b23de2260393db30">fc_printfLogMessage</a>(<span class="stringliteral">"Getting file type for dataset '%s'"</span>, 
<a name="l01536"></a>01536                 dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#e4b7a27c95934413a822422c50d24f25">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>);
<a name="l01537"></a>01537   
<a name="l01538"></a>01538   <span class="comment">// do it</span>
<a name="l01539"></a>01539   *fileType = dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#202208502c0ef7a4dc5b7a7616f1f2ef">fileType</a>;
<a name="l01540"></a>01540   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l01541"></a>01541 }
<a name="l01542"></a>01542 <span class="comment"></span>
<a name="l01543"></a>01543 <span class="comment">/**</span>
<a name="l01544"></a>01544 <span class="comment"> * \ingroup  FileIO</span>
<a name="l01545"></a>01545 <span class="comment"> * \brief  Load a dataset and it's members from a file.</span>
<a name="l01546"></a>01546 <span class="comment"> *</span>
<a name="l01547"></a>01547 <span class="comment"> * \description </span>
<a name="l01548"></a>01548 <span class="comment"> *</span>
<a name="l01549"></a>01549 <span class="comment"> *    Given a the name of a database file, this routine loads the dataset and</span>
<a name="l01550"></a>01550 <span class="comment"> *    makes all of it's members available for use.</span>
<a name="l01551"></a>01551 <span class="comment"> *</span>
<a name="l01552"></a>01552 <span class="comment"> *    This routine automatically picks file format based on the name of the</span>
<a name="l01553"></a>01553 <span class="comment"> *    file. If this is unsatisfactory, use fc_loadDatasetWithFormat.  See</span>
<a name="l01554"></a>01554 <span class="comment"> *    FC_FileIOType for supported formats.</span>
<a name="l01555"></a>01555 <span class="comment"> *</span>
<a name="l01556"></a>01556 <span class="comment"> *    For some formats the members are loaded lazily: that is all of</span>
<a name="l01557"></a>01557 <span class="comment"> *    their metadata data is loaded immediately, but the big data arrays are</span>
<a name="l01558"></a>01558 <span class="comment"> *    not loaded until needed (this happens automatically). (this was</span>
<a name="l01559"></a>01559 <span class="comment"> *    true with saf and is only partially true with exodus)</span>
<a name="l01560"></a>01560 <span class="comment"> *</span>
<a name="l01561"></a>01561 <span class="comment"> * \modifications</span>
<a name="l01562"></a>01562 <span class="comment"> *   - 7/13/2004 WSD. Old method contents moved to fc_loadDatasetWithFormat.</span>
<a name="l01563"></a>01563 <span class="comment"> *     This is a convenience function w/o the fileType arg. </span>
<a name="l01564"></a>01564 <span class="comment"> */</span>
<a name="l01565"></a><a class="code" href="group__FileIO.html#g953a8c4a7feb785e0091b7cf58626092">01565</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__FileIO.html#g953a8c4a7feb785e0091b7cf58626092">fc_loadDataset</a>(
<a name="l01566"></a>01566  <span class="keywordtype">char</span> *filename,         <span class="comment">/**&lt; input - name of dataset to open */</span>
<a name="l01567"></a>01567  <a class="code" href="structFC__Dataset.html">FC_Dataset</a> *dataset     <span class="comment">/**&lt; output - handle for this dataset */</span>
<a name="l01568"></a>01568 ) {
<a name="l01569"></a>01569   <span class="keywordflow">return</span> <a class="code" href="group__FileIO.html#g86d2f3028d317ec00dbfe3ff94ca516b">fc_loadDatasetWithFormat</a>(filename, <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>, dataset);
<a name="l01570"></a>01570 }
<a name="l01571"></a>01571 <span class="comment"></span>
<a name="l01572"></a>01572 <span class="comment">/**</span>
<a name="l01573"></a>01573 <span class="comment"> * \ingroup  FileIO</span>
<a name="l01574"></a>01574 <span class="comment"> * \brief  Load a dataset and it's members from a file.</span>
<a name="l01575"></a>01575 <span class="comment"> *</span>
<a name="l01576"></a>01576 <span class="comment"> * \description </span>
<a name="l01577"></a>01577 <span class="comment"> *</span>
<a name="l01578"></a>01578 <span class="comment"> *    Given a the name of a database file, this routine loads the dataset and</span>
<a name="l01579"></a>01579 <span class="comment"> *    makes all of it's members available for use.</span>
<a name="l01580"></a>01580 <span class="comment"> *</span>
<a name="l01581"></a>01581 <span class="comment"> *    If a specific filetype is passed in, the load will fail if the file is</span>
<a name="l01582"></a>01582 <span class="comment"> *    not of that type. If FC_FT_NONE is passed in, this routine automatically</span>
<a name="l01583"></a>01583 <span class="comment"> *    determines the dataset type.  See FC_FileIOType for supported formats.</span>
<a name="l01584"></a>01584 <span class="comment"> *</span>
<a name="l01585"></a>01585 <span class="comment"> *    For some formats, the members are loaded lazily: that is all of</span>
<a name="l01586"></a>01586 <span class="comment"> *    their metadata data is loaded immediately, but the big data arrays are</span>
<a name="l01587"></a>01587 <span class="comment"> *    not loaded until needed (this happens automatically). (This was</span>
<a name="l01588"></a>01588 <span class="comment"> *    true with saf, and is ony partially true with exodus)</span>
<a name="l01589"></a>01589 <span class="comment"> *</span>
<a name="l01590"></a>01590 <span class="comment"> * \modifications</span>
<a name="l01591"></a>01591 <span class="comment"> *   - Nancy Collins  Created.</span>
<a name="l01592"></a>01592 <span class="comment"> *   - Aug 5, 2002  W Koegler  Now calls _fc_setupDsSlot() so that </span>
<a name="l01593"></a>01593 <span class="comment"> *       fc_openDataset() and  use_dataset() can use the same code to setup </span>
<a name="l01594"></a>01594 <span class="comment"> *       the ftable slot. (RM comment: use_dataset() does not exist anymore.)</span>
<a name="l01595"></a>01595 <span class="comment"> *   - 11/20/03 RM changed behavior: when library is not initialized - </span>
<a name="l01596"></a>01596 <span class="comment"> *       return an error.</span>
<a name="l01597"></a>01597 <span class="comment"> *   - 11/25/03 RM, always return default NULL dataset handle if anything</span>
<a name="l01598"></a>01598 <span class="comment"> *       goes wrong.</span>
<a name="l01599"></a>01599 <span class="comment"> *   - 09/07/04 WSK, changed name from fc_openDataset to fc_loadDataset.</span>
<a name="l01600"></a>01600 <span class="comment"> *   - 01/13/05 WSK, this code now wraps calls to database type specific</span>
<a name="l01601"></a>01601 <span class="comment"> *       codes. Most of the old contents have been moved to</span>
<a name="l01602"></a>01602 <span class="comment"> *       _fc_loadSAFDataset(). </span>
<a name="l01603"></a>01603 <span class="comment"> *   - 7/13/02005 WSD Moved to fileio.c.</span>
<a name="l01604"></a>01604 <span class="comment"> *   - 7/13/2004 WSD Added flag for file format type. Name changed.</span>
<a name="l01605"></a>01605 <span class="comment"> *   - 4/17/2007 CDU Added check to see if file is a regular file</span>
<a name="l01606"></a>01606 <span class="comment"> */</span>
<a name="l01607"></a><a class="code" href="group__FileIO.html#g86d2f3028d317ec00dbfe3ff94ca516b">01607</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__FileIO.html#g86d2f3028d317ec00dbfe3ff94ca516b">fc_loadDatasetWithFormat</a>(
<a name="l01608"></a>01608  <span class="keywordtype">char</span> *filename,         <span class="comment">/**&lt; input - name of dataset to open */</span>
<a name="l01609"></a>01609  <a class="code" href="group__FileIO.html#g4647ac3054682609036d15ddf55055d5">FC_FileIOType</a> fileType, <span class="comment">/**&lt; input - File Type (pass FC_FT_NONE if unknonw */</span>
<a name="l01610"></a>01610  <a class="code" href="structFC__Dataset.html">FC_Dataset</a> *dataset     <span class="comment">/**&lt; output - handle for this dataset */</span>
<a name="l01611"></a>01611 ) {
<a name="l01612"></a>01612   <span class="keyword">struct </span>stat f_stat;
<a name="l01613"></a>01613   <span class="keywordtype">int</span> res;
<a name="l01614"></a>01614   <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> rc;
<a name="l01615"></a>01615   
<a name="l01616"></a>01616   <span class="comment">// default return value</span>
<a name="l01617"></a>01617   <span class="keywordflow">if</span> (dataset != NULL)
<a name="l01618"></a>01618     *dataset = <a class="code" href="group__Handles.html#g35df506577292042278b200ea30e9885">FC_NULL_DATASET</a>;
<a name="l01619"></a>01619   
<a name="l01620"></a>01620   <span class="comment">// check input</span>
<a name="l01621"></a>01621   <span class="keywordflow">if</span> ((filename == NULL) || (dataset == NULL)) {
<a name="l01622"></a>01622     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g97ca6452d8a5b6625a2c02166dc87bb7">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>));
<a name="l01623"></a>01623     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l01624"></a>01624   }
<a name="l01625"></a>01625 
<a name="l01626"></a>01626   <span class="comment">// make sure library is ready, return error if it's not</span>
<a name="l01627"></a>01627   <span class="keywordflow">if</span> (!<a class="code" href="group__PrivateLibrary.html#g428e93218a576ec3a55d5ecc11be1bc5">_fc_isLibraryInit</a>()) {
<a name="l01628"></a>01628     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Cannot load a dataset until library is initialized."</span>);
<a name="l01629"></a>01629     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l01630"></a>01630   }
<a name="l01631"></a>01631   
<a name="l01632"></a>01632   <span class="comment">// log message</span>
<a name="l01633"></a>01633   <a class="code" href="group__Library.html#g523b10264df36531b23de2260393db30">fc_printfLogMessage</a>(<span class="stringliteral">"Loading dataset '%s'"</span>, filename);
<a name="l01634"></a>01634 
<a name="l01635"></a>01635   <span class="comment">// Make sure this is a readable file in case lower io libs </span>
<a name="l01636"></a>01636   <span class="comment">// don't check (ie, exodus)</span>
<a name="l01637"></a>01637   res=stat(filename, &amp;f_stat);
<a name="l01638"></a>01638   <span class="keywordflow">if</span>(res || !S_ISREG(f_stat.st_mode)){
<a name="l01639"></a>01639     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"File %s is not a regular file."</span>, filename);
<a name="l01640"></a>01640     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l01641"></a>01641   }
<a name="l01642"></a>01642 
<a name="l01643"></a>01643   <span class="comment">// Pick a type </span>
<a name="l01644"></a>01644   <span class="comment">// FIX make this smarter?</span>
<a name="l01645"></a>01645   <span class="keywordflow">if</span> (fileType == <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>) {
<a name="l01646"></a>01646     <span class="keywordtype">char</span> *basename = <a class="code" href="group__FilePathUtilities.html#ga308169a1dbaf32b0c13657d3f12818a">fc_getBasename</a>(filename);
<a name="l01647"></a>01647     <span class="keywordtype">char</span> *extension = <a class="code" href="group__FilePathUtilities.html#g46570b582949a27ce044874d834843f5">fc_getExtension</a>(filename, 1);
<a name="l01648"></a>01648     <span class="keywordflow">if</span> (!strcasecmp(basename, <span class="stringliteral">"d3plot"</span>)) <span class="comment">// test this first</span>
<a name="l01649"></a>01649       fileType = <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>;
<a name="l01650"></a>01650     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (extension) {
<a name="l01651"></a>01651       <span class="keywordflow">if</span> (!strcasecmp(extension, <span class="stringliteral">"e"</span>) || !strcasecmp(extension, <span class="stringliteral">"e2"</span>) ||
<a name="l01652"></a>01652        !strcasecmp(extension, <span class="stringliteral">"exo"</span>))
<a name="l01653"></a>01653      fileType = <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>;
<a name="l01654"></a>01654     }
<a name="l01655"></a>01655     free(basename);
<a name="l01656"></a>01656     free(extension);
<a name="l01657"></a>01657   }
<a name="l01658"></a>01658 
<a name="l01659"></a>01659   <span class="keywordflow">switch</span> (fileType) {
<a name="l01660"></a>01660   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:
<a name="l01661"></a>01661 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l01662"></a>01662 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="group__ExodusFileIO.html#gb5ef8dd0e4369fcbc07182492a801ad9">_fc_loadExodusDataset</a>(filename, dataset);
<a name="l01663"></a>01663 <span class="preprocessor">#else</span>
<a name="l01664"></a>01664 <span class="preprocessor"></span>    <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Exodus module not available"</span>);
<a name="l01665"></a>01665     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l01666"></a>01666 <span class="preprocessor">#endif</span>
<a name="l01667"></a>01667 <span class="preprocessor"></span>  <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>:
<a name="l01668"></a>01668     <span class="keywordflow">return</span> <a class="code" href="group__LSDynaFileIO.html#gfe86dcac53085f0bb557083a73f39511">_fc_loadLSDynaDataset</a>(filename, dataset);
<a name="l01669"></a>01669   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>: <span class="comment">// fall through</span>
<a name="l01670"></a>01670   <span class="keywordflow">default</span>:
<a name="l01671"></a>01671     <span class="comment">// Try every type until we get one that works</span>
<a name="l01672"></a>01672 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l01673"></a>01673 <span class="preprocessor"></span>    rc = <a class="code" href="group__ExodusFileIO.html#gb5ef8dd0e4369fcbc07182492a801ad9">_fc_loadExodusDataset</a>(filename, dataset);
<a name="l01674"></a>01674     <span class="keywordflow">if</span> (rc == <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l01675"></a>01675       <span class="keywordflow">return</span> rc;
<a name="l01676"></a>01676 <span class="preprocessor">#endif</span>
<a name="l01677"></a>01677 <span class="preprocessor"></span>    rc = <a class="code" href="group__LSDynaFileIO.html#gfe86dcac53085f0bb557083a73f39511">_fc_loadLSDynaDataset</a>(filename, dataset);
<a name="l01678"></a>01678     <span class="keywordflow">if</span> (rc == <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l01679"></a>01679       <span class="keywordflow">return</span> rc;
<a name="l01680"></a>01680     <span class="comment">// Couldn't find one </span>
<a name="l01681"></a>01681     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Could not open database '%s'"</span>, 
<a name="l01682"></a>01682                  filename);
<a name="l01683"></a>01683     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l01684"></a>01684   }
<a name="l01685"></a>01685 }
<a name="l01686"></a>01686 <span class="comment"></span>
<a name="l01687"></a>01687 <span class="comment">/**</span>
<a name="l01688"></a>01688 <span class="comment"> * \ingroup  FileIO</span>
<a name="l01689"></a>01689 <span class="comment"> * \brief Write a dataset</span>
<a name="l01690"></a>01690 <span class="comment"> *</span>
<a name="l01691"></a>01691 <span class="comment"> * \description  </span>
<a name="l01692"></a>01692 <span class="comment"> *</span>
<a name="l01693"></a>01693 <span class="comment"> *    Currently, only a created dataset can be written; the function cannot</span>
<a name="l01694"></a>01694 <span class="comment"> *    update changes to a dataset read from disk.  To save changes to</span>
<a name="l01695"></a>01695 <span class="comment"> *    a dataset that has been read to disk, or already written, use</span>
<a name="l01696"></a>01696 <span class="comment"> *    fc_rewriteDataset(). </span>
<a name="l01697"></a>01697 <span class="comment"> *</span>
<a name="l01698"></a>01698 <span class="comment"> *    Empty subsets do not get written.</span>
<a name="l01699"></a>01699 <span class="comment"> *</span>
<a name="l01700"></a>01700 <span class="comment"> * \modifications  </span>
<a name="l01701"></a>01701 <span class="comment"> *   - 2003-NOV-11 WSK Created.</span>
<a name="l01702"></a>01702 <span class="comment"> *   - 7/13/2005 WSD Moved to fileio.c.</span>
<a name="l01703"></a>01703 <span class="comment"> *   - 7/13/2005 WSD Made into a wrapper (old guts are now _fc_writeSAFDataset)</span>
<a name="l01704"></a>01704 <span class="comment"> *   - 10/15/2007 ACG exodus is now default file type as saf is removed</span>
<a name="l01705"></a>01705 <span class="comment"> */</span>
<a name="l01706"></a><a class="code" href="group__FileIO.html#g347a8d933894604caec7d8ee72f50899">01706</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__FileIO.html#g347a8d933894604caec7d8ee72f50899">fc_writeDataset</a>(
<a name="l01707"></a>01707   <a class="code" href="structFC__Dataset.html">FC_Dataset</a> dataset,      <span class="comment">/**&lt; the dataset to write */</span>
<a name="l01708"></a>01708   <span class="keywordtype">char</span>* filename,          <span class="comment">/**&lt; the filename to write to */</span>
<a name="l01709"></a>01709   <a class="code" href="group__FileIO.html#g4647ac3054682609036d15ddf55055d5">FC_FileIOType</a> fileType   <span class="comment">/**&lt; the file type to write */</span>
<a name="l01710"></a>01710 ) { 
<a name="l01711"></a>01711   <a class="code" href="struct__FC__DsSlot.html">_FC_DsSlot</a>* dsSlot;
<a name="l01712"></a>01712 
<a name="l01713"></a>01713   <span class="comment">// check input</span>
<a name="l01714"></a>01714   dsSlot = <a class="code" href="group__PrivateDataset.html#g42016ac71c44a0188d75d5753adc47b2">_fc_getDsSlot</a>(dataset);
<a name="l01715"></a>01715   <span class="keywordflow">if</span> (dsSlot == NULL || dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#eb6aa6b8f25a417e2372f42763119160">writable</a> == 0 || 
<a name="l01716"></a>01716       (dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#fcb1479af6b5ab547e3fa907b5e120c1">numSeq</a> == 0 &amp;&amp; dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#49972d4cac4564f23ed7e1fbf984eaf4">numMesh</a> == 0) ||
<a name="l01717"></a>01717       !<a class="code" href="group__FileIO.html#g4b010da246d95680cd57de6d5cc059e6">fc_isFileIOTypeValid</a>(fileType)) {
<a name="l01718"></a>01718     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g97ca6452d8a5b6625a2c02166dc87bb7">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>));
<a name="l01719"></a>01719     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l01720"></a>01720   }
<a name="l01721"></a>01721 
<a name="l01722"></a>01722   <span class="comment">// log message</span>
<a name="l01723"></a>01723   <a class="code" href="group__Library.html#g523b10264df36531b23de2260393db30">fc_printfLogMessage</a>(<span class="stringliteral">"Writing dataset '%s'"</span>, dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#e4b7a27c95934413a822422c50d24f25">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>);
<a name="l01724"></a>01724 
<a name="l01725"></a>01725   <span class="comment">// if no type, choose one</span>
<a name="l01726"></a>01726   <span class="keywordflow">if</span> (fileType == <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>)
<a name="l01727"></a>01727     fileType = <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>;
<a name="l01728"></a>01728 
<a name="l01729"></a>01729   <span class="comment">// Call format specific writers</span>
<a name="l01730"></a>01730   <span class="keywordflow">switch</span> (fileType) {
<a name="l01731"></a>01731   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:
<a name="l01732"></a>01732 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l01733"></a>01733 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="group__ExodusFileIO.html#gb03ff424fbbe18c077ff7f80528321dc">_fc_writeExodusDataset</a>(dataset, filename);
<a name="l01734"></a>01734 <span class="preprocessor">#else</span>
<a name="l01735"></a>01735 <span class="preprocessor"></span>    <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Exodus module not available"</span>);
<a name="l01736"></a>01736     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>;
<a name="l01737"></a>01737 <span class="preprocessor">#endif</span>
<a name="l01738"></a>01738 <span class="preprocessor"></span>  <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>: 
<a name="l01739"></a>01739     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"This installation does not support writing files "</span>
<a name="l01740"></a>01740                  <span class="stringliteral">"in LS-Dyna format\n"</span>);
<a name="l01741"></a>01741     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l01742"></a>01742   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>: <span class="comment">// fall through</span>
<a name="l01743"></a>01743     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Should never reach this point! should have "</span>
<a name="l01744"></a>01744                  <span class="stringliteral">"chosen a default format"</span>);
<a name="l01745"></a>01745     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l01746"></a>01746   }
<a name="l01747"></a>01747 
<a name="l01748"></a>01748   <span class="comment">// error if reach this point</span>
<a name="l01749"></a>01749   <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Programmer error!: Should never reach this point\n"</span>);
<a name="l01750"></a>01750   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l01751"></a>01751 }
<a name="l01752"></a>01752 <span class="comment"></span>
<a name="l01753"></a>01753 <span class="comment">/**</span>
<a name="l01754"></a>01754 <span class="comment"> * \ingroup  FileIO</span>
<a name="l01755"></a>01755 <span class="comment"> * \brief Rewrite a dataset.</span>
<a name="l01756"></a>01756 <span class="comment"> *</span>
<a name="l01757"></a>01757 <span class="comment"> * \description  </span>
<a name="l01758"></a>01758 <span class="comment"> *</span>
<a name="l01759"></a>01759 <span class="comment"> *    This will force the writing of a dataset that is already associated with</span>
<a name="l01760"></a>01760 <span class="comment"> *    a file on disk, e.g. to rewrite an Exodus dataset or write an Exodus</span>
<a name="l01761"></a>01761 <span class="comment"> *    dataset into a differnt type of file. Calling on a dataset that has</span>
<a name="l01762"></a>01762 <span class="comment"> *    never been associated with a file is o.k.</span>
<a name="l01763"></a>01763 <span class="comment"> *</span>
<a name="l01764"></a>01764 <span class="comment"> *    Empty subsets do not get written.</span>
<a name="l01765"></a>01765 <span class="comment"> *</span>
<a name="l01766"></a>01766 <span class="comment"> * \todo ?Passing NULL for the name will make it use the original</span>
<a name="l01767"></a>01767 <span class="comment"> *    dataset's filename and type -- essentially rewriting it?</span>
<a name="l01768"></a>01768 <span class="comment"> * \todo ?Replace fc_writeDataset with this version?</span>
<a name="l01769"></a>01769 <span class="comment"> * \todo Write to filename.tmp then move filename.tmp to filename --</span>
<a name="l01770"></a>01770 <span class="comment"> *    then if rewriting a file, old version less likely to get</span>
<a name="l01771"></a>01771 <span class="comment"> *    clobbered in case of an error.</span>
<a name="l01772"></a>01772 <span class="comment"> *</span>
<a name="l01773"></a>01773 <span class="comment"> * \modifications  </span>
<a name="l01774"></a>01774 <span class="comment"> *   - 3/25/2006 WSD Created.</span>
<a name="l01775"></a>01775 <span class="comment"> */</span>
<a name="l01776"></a><a class="code" href="group__FileIO.html#ge858ea01dcbf5464b07a9024475cb66a">01776</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__FileIO.html#ge858ea01dcbf5464b07a9024475cb66a">fc_rewriteDataset</a>(
<a name="l01777"></a>01777   <a class="code" href="structFC__Dataset.html">FC_Dataset</a> dataset,      <span class="comment">/**&lt; the dataset to write */</span>
<a name="l01778"></a>01778   <span class="keywordtype">char</span>* filename,          <span class="comment">/**&lt; the filename to write to */</span>
<a name="l01779"></a>01779   <a class="code" href="group__FileIO.html#g4647ac3054682609036d15ddf55055d5">FC_FileIOType</a> fileType   <span class="comment">/**&lt; the file type to write */</span>
<a name="l01780"></a>01780 ) { 
<a name="l01781"></a>01781   <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> rc;
<a name="l01782"></a>01782   <a class="code" href="struct__FC__DsSlot.html">_FC_DsSlot</a>* dsSlot;
<a name="l01783"></a>01783 
<a name="l01784"></a>01784   <span class="comment">// check input</span>
<a name="l01785"></a>01785   dsSlot = <a class="code" href="group__PrivateDataset.html#g42016ac71c44a0188d75d5753adc47b2">_fc_getDsSlot</a>(dataset);
<a name="l01786"></a>01786   <span class="keywordflow">if</span> (dsSlot == NULL || (dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#fcb1479af6b5ab547e3fa907b5e120c1">numSeq</a> == 0 &amp;&amp; dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#49972d4cac4564f23ed7e1fbf984eaf4">numMesh</a> == 0) ||
<a name="l01787"></a>01787       !<a class="code" href="group__FileIO.html#g4b010da246d95680cd57de6d5cc059e6">fc_isFileIOTypeValid</a>(fileType)) {
<a name="l01788"></a>01788     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g97ca6452d8a5b6625a2c02166dc87bb7">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>));
<a name="l01789"></a>01789     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l01790"></a>01790   }
<a name="l01791"></a>01791 
<a name="l01792"></a>01792   <span class="comment">// if not writable, make writable</span>
<a name="l01793"></a>01793   <span class="keywordflow">if</span> (dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#eb6aa6b8f25a417e2372f42763119160">writable</a> == 0) {
<a name="l01794"></a>01794     <span class="keywordtype">int</span> i, j, k;
<a name="l01795"></a>01795     <span class="keywordtype">int</span> numSeq, numGlbVar, numGlbSeqVar, numMesh;
<a name="l01796"></a>01796     <span class="keywordtype">int</span> numSub, numVar, numSeqVar, numMember, *numSteps;
<a name="l01797"></a>01797     <a class="code" href="structFC__Sequence.html">FC_Sequence</a> *sequences;
<a name="l01798"></a>01798     <a class="code" href="struct__FC__SeqSlot.html">_FC_SeqSlot</a>* seqSlot;
<a name="l01799"></a>01799     <a class="code" href="structFC__Mesh.html">FC_Mesh</a>* meshes;
<a name="l01800"></a>01800     <a class="code" href="struct__FC__MeshSlot.html">_FC_MeshSlot</a>* meshSlot;
<a name="l01801"></a>01801     <a class="code" href="structFC__Subset.html">FC_Subset</a>* subsets;
<a name="l01802"></a>01802     <a class="code" href="struct__FC__SubSlot.html">_FC_SubSlot</a>* subSlot;
<a name="l01803"></a>01803     <a class="code" href="structFC__Variable.html">FC_Variable</a> *glbVars, **glbSeqVars, *variables, **seqVars;
<a name="l01804"></a>01804     <a class="code" href="struct__FC__VarSlot.html">_FC_VarSlot</a>* varSlot;
<a name="l01805"></a>01805     <span class="keywordtype">double</span>* coords;
<a name="l01806"></a>01806     <span class="keywordtype">int</span> *conns, *ids;
<a name="l01807"></a>01807     <span class="keywordtype">void</span>* data;
<a name="l01808"></a>01808 
<a name="l01809"></a>01809     <span class="comment">// Force loading of all data &amp; set to uncommited</span>
<a name="l01810"></a>01810     <a class="code" href="group__Variable.html#ga6cb33a79c327784d62d9b57e0381fcf">fc_getGlobalVariables</a>(dataset, &amp;numGlbVar, &amp;glbVars);
<a name="l01811"></a>01811     <span class="keywordflow">for</span> (i = 0; i &lt; numGlbVar; i++) {
<a name="l01812"></a>01812       <a class="code" href="group__Variable.html#g26d6dc6119ce91abb2d2b0edf17865f6">fc_getVariableDataPtr</a>(glbVars[i], &amp;data);
<a name="l01813"></a>01813       varSlot = <a class="code" href="group__PrivateVariable.html#g2b99df3fb78e3936d0976002ca3ce18f">_fc_getVarSlot</a>(glbVars[i]);
<a name="l01814"></a>01814       varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#6b78cddabfcaf1bdc90aef8b08e9ab03">header</a>.<a class="code" href="struct__FC__SlotHeader.html#0c529177276a4cb118cedda6399e7d1e">committed</a> = 0;
<a name="l01815"></a>01815     }
<a name="l01816"></a>01816     free(glbVars);
<a name="l01817"></a>01817     <a class="code" href="group__Variable.html#g493c9016a0f06eda5a5771fc50426ec4">fc_getGlobalSeqVariables</a>(dataset, &amp;numGlbSeqVar, &amp;numSteps, &amp;glbSeqVars);
<a name="l01818"></a>01818     <span class="keywordflow">for</span> (i = 0; i &lt; numGlbSeqVar; i++) {
<a name="l01819"></a>01819       <span class="keywordflow">for</span> (j = 0; j &lt; numSteps[i]; j++) {
<a name="l01820"></a>01820         <a class="code" href="group__Variable.html#g26d6dc6119ce91abb2d2b0edf17865f6">fc_getVariableDataPtr</a>(glbSeqVars[i][j], &amp;data);
<a name="l01821"></a>01821         varSlot = <a class="code" href="group__PrivateVariable.html#g2b99df3fb78e3936d0976002ca3ce18f">_fc_getVarSlot</a>(glbSeqVars[i][j]);
<a name="l01822"></a>01822         varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#6b78cddabfcaf1bdc90aef8b08e9ab03">header</a>.<a class="code" href="struct__FC__SlotHeader.html#0c529177276a4cb118cedda6399e7d1e">committed</a> = 0;
<a name="l01823"></a>01823       }
<a name="l01824"></a>01824       free(glbSeqVars[i]);
<a name="l01825"></a>01825     }
<a name="l01826"></a>01826     free(numSteps);
<a name="l01827"></a>01827     free(glbSeqVars);
<a name="l01828"></a>01828     <a class="code" href="group__Sequence.html#g4e9e6506fc7e6ce22310105003a21789">fc_getSequences</a>(dataset, &amp;numSeq, &amp;sequences);
<a name="l01829"></a>01829     <span class="keywordflow">for</span> (i = 0; i &lt; numSeq; i++) {
<a name="l01830"></a>01830       <a class="code" href="group__Sequence.html#g38e90553b530ed6e4ebeb28df20eade8">fc_getSequenceCoordsPtr</a>(sequences[i], &amp;data);
<a name="l01831"></a>01831       seqSlot = <a class="code" href="group__PrivateSequence.html#ge669615c173acc924f9664fa05672e7f">_fc_getSeqSlot</a>(sequences[i]);
<a name="l01832"></a>01832       seqSlot-&gt;<a class="code" href="struct__FC__SeqSlot.html#b4ebe9e673fa41268979b4d19bfbcc5a">header</a>.<a class="code" href="struct__FC__SlotHeader.html#0c529177276a4cb118cedda6399e7d1e">committed</a> = 0;
<a name="l01833"></a>01833     }
<a name="l01834"></a>01834     <a class="code" href="group__Mesh.html#ge71cd0e179143c6d82d58b9cc78cc436">fc_getMeshes</a>(dataset, &amp;numMesh, &amp;meshes);
<a name="l01835"></a>01835     <span class="keywordflow">for</span> (i = 0; i &lt; numMesh; i++) {
<a name="l01836"></a>01836       <a class="code" href="group__Mesh.html#g44d09391731a139c4efc2c4fb2eda4e7">fc_getMeshCoordsPtr</a>(meshes[i], &amp;coords);
<a name="l01837"></a>01837       <a class="code" href="group__Mesh.html#g71ce3ca34963dcc548b6a7c38aa17fd9">fc_getMeshElementConnsPtr</a>(meshes[i], &amp;conns);
<a name="l01838"></a>01838       <a class="code" href="group__Subset.html#g5c0185b0cab5ac7256fec095a98c3bd0">fc_getSubsets</a>(meshes[i], &amp;numSub, &amp;subsets);
<a name="l01839"></a>01839       <span class="keywordflow">for</span> (j = 0; j &lt; numSub; j++) {
<a name="l01840"></a>01840      <a class="code" href="group__Subset.html#g7a79d4d1e13846ae12abe55ef2db3c3d">fc_getSubsetMembersAsArray</a>(subsets[j], &amp;numMember, &amp;ids);
<a name="l01841"></a>01841      free(ids);
<a name="l01842"></a>01842      subSlot = <a class="code" href="group__PrivateSubset.html#g8f78520bce8753ac1e5fda62c47862da">_fc_getSubSlot</a>(subsets[j]);
<a name="l01843"></a>01843      subSlot-&gt;<a class="code" href="struct__FC__SubSlot.html#3d4cf6721e221bdaa68d1ea3b2709aaa">header</a>.<a class="code" href="struct__FC__SlotHeader.html#0c529177276a4cb118cedda6399e7d1e">committed</a> = 0;
<a name="l01844"></a>01844       }
<a name="l01845"></a>01845       free(subsets);
<a name="l01846"></a>01846       <a class="code" href="group__Variable.html#g74cf87c790d013532d9451af1b5f1fbb">fc_getVariables</a>(meshes[i], &amp;numVar, &amp;variables);
<a name="l01847"></a>01847       <span class="keywordflow">for</span> (j = 0; j &lt; numVar; j++) {
<a name="l01848"></a>01848      <a class="code" href="group__Variable.html#g26d6dc6119ce91abb2d2b0edf17865f6">fc_getVariableDataPtr</a>(variables[j], &amp;data);
<a name="l01849"></a>01849      varSlot = <a class="code" href="group__PrivateVariable.html#g2b99df3fb78e3936d0976002ca3ce18f">_fc_getVarSlot</a>(variables[j]);
<a name="l01850"></a>01850      varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#6b78cddabfcaf1bdc90aef8b08e9ab03">header</a>.<a class="code" href="struct__FC__SlotHeader.html#0c529177276a4cb118cedda6399e7d1e">committed</a> = 0;
<a name="l01851"></a>01851       }
<a name="l01852"></a>01852       free(variables);
<a name="l01853"></a>01853       <a class="code" href="group__Variable.html#g93185e07dcdf01ffc87fc28a69ee96ae">fc_getSeqVariables</a>(meshes[i], &amp;numSeqVar, &amp;numSteps, &amp;seqVars);
<a name="l01854"></a>01854       <span class="keywordflow">for</span> (j = 0; j &lt; numSeqVar; j++) {
<a name="l01855"></a>01855      <span class="keywordflow">for</span> (k = 0; k &lt; numSteps[j]; k++) { 
<a name="l01856"></a>01856        <a class="code" href="group__Variable.html#g26d6dc6119ce91abb2d2b0edf17865f6">fc_getVariableDataPtr</a>(seqVars[j][k], &amp;data);
<a name="l01857"></a>01857        varSlot = <a class="code" href="group__PrivateVariable.html#g2b99df3fb78e3936d0976002ca3ce18f">_fc_getVarSlot</a>(seqVars[j][k]);
<a name="l01858"></a>01858        varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#6b78cddabfcaf1bdc90aef8b08e9ab03">header</a>.<a class="code" href="struct__FC__SlotHeader.html#0c529177276a4cb118cedda6399e7d1e">committed</a> = 0;
<a name="l01859"></a>01859      }
<a name="l01860"></a>01860      free(seqVars[j]);
<a name="l01861"></a>01861       }
<a name="l01862"></a>01862       free(numSteps);
<a name="l01863"></a>01863       free(seqVars);
<a name="l01864"></a>01864       meshSlot = <a class="code" href="group__PrivateMesh.html#g703c4929b726214df4d4cb3e1ab9d7d0">_fc_getMeshSlot</a>(meshes[i]);
<a name="l01865"></a>01865       meshSlot-&gt;<a class="code" href="struct__FC__MeshSlot.html#8acdc27c257edccc827cd77bf05e4f13">header</a>.<a class="code" href="struct__FC__SlotHeader.html#0c529177276a4cb118cedda6399e7d1e">committed</a> = 0;
<a name="l01866"></a>01866     }
<a name="l01867"></a>01867     free(sequences);
<a name="l01868"></a>01868     free(meshes);
<a name="l01869"></a>01869     dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#e4b7a27c95934413a822422c50d24f25">header</a>.<a class="code" href="struct__FC__SlotHeader.html#0c529177276a4cb118cedda6399e7d1e">committed</a> = 0;
<a name="l01870"></a>01870 
<a name="l01871"></a>01871     <span class="comment">// reset to look like a created dataset</span>
<a name="l01872"></a>01872     rc = <a class="code" href="group__PrivateFileIO.html#g57b9694b51249fd539752aa9be79d2af">_fc_closeDataset</a>(dataset);
<a name="l01873"></a>01873     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l01874"></a>01874       <span class="keywordflow">return</span> rc;
<a name="l01875"></a>01875     dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#eb6aa6b8f25a417e2372f42763119160">writable</a> = 1;
<a name="l01876"></a>01876   }
<a name="l01877"></a>01877  
<a name="l01878"></a>01878   <span class="keywordflow">return</span> <a class="code" href="group__FileIO.html#g347a8d933894604caec7d8ee72f50899">fc_writeDataset</a>(dataset, filename, fileType);
<a name="l01879"></a>01879 }
<a name="l01880"></a>01880 <span class="comment"></span>
<a name="l01881"></a>01881 <span class="comment">//@}</span>
<a name="l01882"></a>01882 <span class="comment"></span><span class="comment"></span>
<a name="l01883"></a>01883 <span class="comment">/**</span>
<a name="l01884"></a>01884 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l01885"></a>01885 <span class="comment"> * \brief Initial for File IO</span>
<a name="l01886"></a>01886 <span class="comment"> *</span>
<a name="l01887"></a>01887 <span class="comment"> * \description</span>
<a name="l01888"></a>01888 <span class="comment"> *  </span>
<a name="l01889"></a>01889 <span class="comment"> *    This sets up stuff for FILE IO</span>
<a name="l01890"></a>01890 <span class="comment"> *</span>
<a name="l01891"></a>01891 <span class="comment"> * \todo ? could have flags so that specific type of file IO is not initialized</span>
<a name="l01892"></a>01892 <span class="comment"> *   until use--but there could possibly be stuff that you'd want to do up </span>
<a name="l01893"></a>01893 <span class="comment"> *   front ....</span>
<a name="l01894"></a>01894 <span class="comment"> *</span>
<a name="l01895"></a>01895 <span class="comment"> * \modifications  </span>
<a name="l01896"></a>01896 <span class="comment"> *   - 7/19/2005 WSD, created to better abstract reading routines.</span>
<a name="l01897"></a>01897 <span class="comment"> */</span>
<a name="l01898"></a><a class="code" href="group__PrivateFileIO.html#g3ed8b6b23ed87cdd7ff49987ef011f2b">01898</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g3ed8b6b23ed87cdd7ff49987ef011f2b">_fc_initFileIO</a>(<span class="keywordtype">void</span>) {
<a name="l01899"></a>01899   <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> rc, rc_keep = <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l01900"></a>01900 
<a name="l01901"></a>01901 <span class="preprocessor">#ifdef HAVE_LIBXML2</span>
<a name="l01902"></a>01902 <span class="preprocessor"></span>  LIBXML_TEST_VERSION
<a name="l01903"></a>01903 <span class="preprocessor">#endif</span>
<a name="l01904"></a>01904 <span class="preprocessor"></span>
<a name="l01905"></a>01905 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l01906"></a>01906 <span class="preprocessor"></span>  rc = <a class="code" href="group__ExodusFileIO.html#gc299b4142156e72695f2f3f37bc6a16d">_fc_initExodus</a>();
<a name="l01907"></a>01907   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>) {
<a name="l01908"></a>01908     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Unable to init Exodus File IO"</span>);
<a name="l01909"></a>01909     rc_keep = rc;
<a name="l01910"></a>01910   }
<a name="l01911"></a>01911 <span class="preprocessor">#endif</span>
<a name="l01912"></a>01912 <span class="preprocessor"></span>  <span class="comment">// nothing for LSDyna</span>
<a name="l01913"></a>01913   <span class="keywordflow">return</span> rc_keep;
<a name="l01914"></a>01914 }
<a name="l01915"></a>01915 <span class="comment"></span>
<a name="l01916"></a>01916 <span class="comment">/**</span>
<a name="l01917"></a>01917 <span class="comment"> * \ingroup PrivateFileIO</span>
<a name="l01918"></a>01918 <span class="comment"> * \brief Finalize for File IO</span>
<a name="l01919"></a>01919 <span class="comment"> *</span>
<a name="l01920"></a>01920 <span class="comment"> * \description</span>
<a name="l01921"></a>01921 <span class="comment"> *  </span>
<a name="l01922"></a>01922 <span class="comment"> *    This finalizes stuff for FILE IO</span>
<a name="l01923"></a>01923 <span class="comment"> *</span>
<a name="l01924"></a>01924 <span class="comment"> * \todo? could have flags so that specific type of file IO is only finalize</span>
<a name="l01925"></a>01925 <span class="comment"> *   if it was inited ... see Fix on _fc_initFileIO().</span>
<a name="l01926"></a>01926 <span class="comment"> *</span>
<a name="l01927"></a>01927 <span class="comment"> * \modifications  </span>
<a name="l01928"></a>01928 <span class="comment"> *   - 7/19/2005 WSD, created to better abstract reading routines.</span>
<a name="l01929"></a>01929 <span class="comment"> */</span>
<a name="l01930"></a><a class="code" href="group__PrivateFileIO.html#g07a87add33e5d97cec2a0f684ec80b64">01930</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g07a87add33e5d97cec2a0f684ec80b64">_fc_finalFileIO</a>(<span class="keywordtype">void</span>) {
<a name="l01931"></a>01931   <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> rc, rc_keep = <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l01932"></a>01932   rc = <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>; <span class="comment">// so the compiler won't complaid</span>
<a name="l01933"></a>01933 
<a name="l01934"></a>01934 <span class="preprocessor">#ifdef HAVE_LIBXML2</span>
<a name="l01935"></a>01935 <span class="preprocessor"></span>  xmlCleanupParser();
<a name="l01936"></a>01936 <span class="preprocessor">#endif</span>
<a name="l01937"></a>01937 <span class="preprocessor"></span>
<a name="l01938"></a>01938   <span class="comment">// no Exodus</span>
<a name="l01939"></a>01939   <span class="comment">// no LSDyna</span>
<a name="l01940"></a>01940 
<a name="l01941"></a>01941   <span class="keywordflow">return</span> rc_keep;
<a name="l01942"></a>01942 }
<a name="l01943"></a>01943 <span class="comment"></span>
<a name="l01944"></a>01944 <span class="comment">/**</span>
<a name="l01945"></a>01945 <span class="comment"> * \ingroup  PrivateFileIO</span>
<a name="l01946"></a>01946 <span class="comment"> * \brief  Read coords from file into a sequence.</span>
<a name="l01947"></a>01947 <span class="comment"> *</span>
<a name="l01948"></a>01948 <span class="comment"> * \description</span>
<a name="l01949"></a>01949 <span class="comment"> *  </span>
<a name="l01950"></a>01950 <span class="comment"> *    Reads step coordinates from file into a sequence. This is a wrapper</span>
<a name="l01951"></a>01951 <span class="comment"> *    that chooses the proper implentation based on the file type.</span>
<a name="l01952"></a>01952 <span class="comment"> *</span>
<a name="l01953"></a>01953 <span class="comment"> * \modifications  </span>
<a name="l01954"></a>01954 <span class="comment"> *   - 7/13/2005 WSD, created to better abstract reading routines.</span>
<a name="l01955"></a>01955 <span class="comment"> */</span>
<a name="l01956"></a><a class="code" href="group__PrivateFileIO.html#g4128b5820a22c1a92825a15d8f0f2d16">01956</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g4128b5820a22c1a92825a15d8f0f2d16">_fc_readSequenceCoords</a>(
<a name="l01957"></a>01957   <a class="code" href="structFC__Sequence.html">FC_Sequence</a> sequence  <span class="comment">/**&lt; input - sequence to read into */</span>
<a name="l01958"></a>01958 ) {
<a name="l01959"></a>01959   <a class="code" href="struct__FC__SeqSlot.html">_FC_SeqSlot</a>* seqSlot = <a class="code" href="group__PrivateSequence.html#ge669615c173acc924f9664fa05672e7f">_fc_getSeqSlot</a>(sequence);
<a name="l01960"></a>01960   <a class="code" href="struct__FC__DsSlot.html">_FC_DsSlot</a>* dsSlot;
<a name="l01961"></a>01961 
<a name="l01962"></a>01962   <span class="comment">// check input</span>
<a name="l01963"></a>01963   <span class="keywordflow">if</span> (!seqSlot || !seqSlot-&gt;<a class="code" href="struct__FC__SeqSlot.html#b4ebe9e673fa41268979b4d19bfbcc5a">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>) {
<a name="l01964"></a>01964     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g97ca6452d8a5b6625a2c02166dc87bb7">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>));
<a name="l01965"></a>01965     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l01966"></a>01966   }
<a name="l01967"></a>01967 
<a name="l01968"></a>01968   <span class="comment">// log message</span>
<a name="l01969"></a>01969   <a class="code" href="group__Library.html#g523b10264df36531b23de2260393db30">fc_printfLogMessage</a>(<span class="stringliteral">"Reading coords for sequence '%s'"</span>, 
<a name="l01970"></a>01970                 seqSlot-&gt;<a class="code" href="struct__FC__SeqSlot.html#b4ebe9e673fa41268979b4d19bfbcc5a">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>);
<a name="l01971"></a>01971 
<a name="l01972"></a>01972   <span class="comment">// Call format specific routines</span>
<a name="l01973"></a>01973   dsSlot = <a class="code" href="group__PrivateDataset.html#g42016ac71c44a0188d75d5753adc47b2">_fc_getDsSlot</a>(seqSlot-&gt;<a class="code" href="struct__FC__SeqSlot.html#18a1d8c4ab7c2586678334f1d225b76c">ds</a>);
<a name="l01974"></a>01974   <span class="keywordflow">switch</span>(dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#202208502c0ef7a4dc5b7a7616f1f2ef">fileType</a>) {
<a name="l01975"></a>01975   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:
<a name="l01976"></a>01976 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l01977"></a>01977 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="group__ExodusFileIO.html#g1798afda15a913676d59087a81756a43">_fc_readExodusSequenceCoords</a>(sequence);
<a name="l01978"></a>01978 <span class="preprocessor">#else</span>
<a name="l01979"></a>01979 <span class="preprocessor"></span>    <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Exodus module not available"</span>);
<a name="l01980"></a>01980     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l01981"></a>01981 <span class="preprocessor">#endif</span>
<a name="l01982"></a>01982 <span class="preprocessor"></span>  <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>:
<a name="l01983"></a>01983     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>; <span class="comment">// do nothing, no lazy capability</span>
<a name="l01984"></a>01984   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>:
<a name="l01985"></a>01985     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Called without a file type"</span>);
<a name="l01986"></a>01986     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l01987"></a>01987   }
<a name="l01988"></a>01988 
<a name="l01989"></a>01989   <span class="comment">// shouldn't reach this point</span>
<a name="l01990"></a>01990   <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Unrecognized file type"</span>);
<a name="l01991"></a>01991   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l01992"></a>01992 }
<a name="l01993"></a>01993 <span class="comment"></span>
<a name="l01994"></a>01994 <span class="comment">/**</span>
<a name="l01995"></a>01995 <span class="comment"> * \ingroup  PrivateFileIO</span>
<a name="l01996"></a>01996 <span class="comment"> * \brief  Read coords from file into a mesh</span>
<a name="l01997"></a>01997 <span class="comment"> *</span>
<a name="l01998"></a>01998 <span class="comment"> * \description</span>
<a name="l01999"></a>01999 <span class="comment"> *  </span>
<a name="l02000"></a>02000 <span class="comment"> *    Reads vertex coordinates from file into a mesh. This is a wrapper</span>
<a name="l02001"></a>02001 <span class="comment"> *    that chooses the proper implentation based on the file type.</span>
<a name="l02002"></a>02002 <span class="comment"> *</span>
<a name="l02003"></a>02003 <span class="comment"> * \modifications  </span>
<a name="l02004"></a>02004 <span class="comment"> *   - 7/13/2005 WSD, created to better abstract reading routines.</span>
<a name="l02005"></a>02005 <span class="comment"> */</span>
<a name="l02006"></a><a class="code" href="group__PrivateFileIO.html#g6b7d22250488880068cdc93e24a9ca06">02006</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g6b7d22250488880068cdc93e24a9ca06">_fc_readMeshCoords</a>(
<a name="l02007"></a>02007   <a class="code" href="structFC__Mesh.html">FC_Mesh</a> mesh  <span class="comment">/**&lt; input - mesh to read into */</span>
<a name="l02008"></a>02008 ) {
<a name="l02009"></a>02009   <a class="code" href="struct__FC__MeshSlot.html">_FC_MeshSlot</a>* meshSlot;
<a name="l02010"></a>02010   <a class="code" href="struct__FC__DsSlot.html">_FC_DsSlot</a>* dsSlot;
<a name="l02011"></a>02011 
<a name="l02012"></a>02012   <span class="comment">// check input</span>
<a name="l02013"></a>02013   meshSlot = <a class="code" href="group__PrivateMesh.html#g703c4929b726214df4d4cb3e1ab9d7d0">_fc_getMeshSlot</a>(mesh);
<a name="l02014"></a>02014   <span class="keywordflow">if</span> (!meshSlot || !meshSlot-&gt;<a class="code" href="struct__FC__MeshSlot.html#8acdc27c257edccc827cd77bf05e4f13">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>) {
<a name="l02015"></a>02015     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g97ca6452d8a5b6625a2c02166dc87bb7">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>));
<a name="l02016"></a>02016     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l02017"></a>02017   }
<a name="l02018"></a>02018 
<a name="l02019"></a>02019   <span class="comment">// log message</span>
<a name="l02020"></a>02020   <a class="code" href="group__Library.html#g523b10264df36531b23de2260393db30">fc_printfLogMessage</a>(<span class="stringliteral">"Reading coords for mesh '%s'"</span>, 
<a name="l02021"></a>02021                 meshSlot-&gt;<a class="code" href="struct__FC__MeshSlot.html#8acdc27c257edccc827cd77bf05e4f13">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>);
<a name="l02022"></a>02022 
<a name="l02023"></a>02023   <span class="comment">// Call format specific routines</span>
<a name="l02024"></a>02024   dsSlot = <a class="code" href="group__PrivateDataset.html#g42016ac71c44a0188d75d5753adc47b2">_fc_getDsSlot</a>(meshSlot-&gt;<a class="code" href="struct__FC__MeshSlot.html#553d7d0470e312f24080c5ed49334ead">ds</a>);
<a name="l02025"></a>02025   <span class="keywordflow">switch</span> (dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#202208502c0ef7a4dc5b7a7616f1f2ef">fileType</a>) {
<a name="l02026"></a>02026   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:
<a name="l02027"></a>02027 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l02028"></a>02028 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="group__ExodusFileIO.html#gd2c121960951f2e1e84027b6d1cff0e1">_fc_readExodusMeshCoords</a>(mesh);
<a name="l02029"></a>02029 <span class="preprocessor">#else</span>
<a name="l02030"></a>02030 <span class="preprocessor"></span>    <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Exodus module not available"</span>);
<a name="l02031"></a>02031     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02032"></a>02032 <span class="preprocessor">#endif</span>
<a name="l02033"></a>02033 <span class="preprocessor"></span>  <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>: 
<a name="l02034"></a>02034     <span class="keywordflow">return</span> <a class="code" href="group__LSDynaFileIO.html#g85a880f69725b8a97145ae9b7248ec25">_fc_readLSDynaMeshCoords</a>(mesh);
<a name="l02035"></a>02035   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>:
<a name="l02036"></a>02036     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Called without a file type"</span>);
<a name="l02037"></a>02037     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02038"></a>02038   }
<a name="l02039"></a>02039 
<a name="l02040"></a>02040   <span class="comment">// shouldn't reach this point</span>
<a name="l02041"></a>02041   <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Unrecognized file type"</span>);
<a name="l02042"></a>02042   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02043"></a>02043 }
<a name="l02044"></a>02044 <span class="comment"></span>
<a name="l02045"></a>02045 <span class="comment">/**</span>
<a name="l02046"></a>02046 <span class="comment"> * \ingroup  PrivateFileIO</span>
<a name="l02047"></a>02047 <span class="comment"> * \brief  Read element conns from file into a mesh</span>
<a name="l02048"></a>02048 <span class="comment"> *</span>
<a name="l02049"></a>02049 <span class="comment"> * \description</span>
<a name="l02050"></a>02050 <span class="comment"> *  </span>
<a name="l02051"></a>02051 <span class="comment"> *    Reads element connectivities from file into a mesh. This is a wrapper</span>
<a name="l02052"></a>02052 <span class="comment"> *    that chooses the proper implentation based on the file type.</span>
<a name="l02053"></a>02053 <span class="comment"> *</span>
<a name="l02054"></a>02054 <span class="comment"> * \modifications  </span>
<a name="l02055"></a>02055 <span class="comment"> *   - 7/13/2005 WSD, created to better abstract reading routines.</span>
<a name="l02056"></a>02056 <span class="comment"> */</span>
<a name="l02057"></a><a class="code" href="group__PrivateFileIO.html#g711fdc3aebfbf372da3f2c68a90557c9">02057</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g711fdc3aebfbf372da3f2c68a90557c9">_fc_readMeshElemConns</a>(
<a name="l02058"></a>02058   <a class="code" href="structFC__Mesh.html">FC_Mesh</a> mesh  <span class="comment">/**&lt; input - mesh to read into */</span>
<a name="l02059"></a>02059 ) {
<a name="l02060"></a>02060   <a class="code" href="struct__FC__MeshSlot.html">_FC_MeshSlot</a>* meshSlot;
<a name="l02061"></a>02061   <a class="code" href="struct__FC__DsSlot.html">_FC_DsSlot</a>* dsSlot;
<a name="l02062"></a>02062 
<a name="l02063"></a>02063   <span class="comment">// check input</span>
<a name="l02064"></a>02064   meshSlot = <a class="code" href="group__PrivateMesh.html#g703c4929b726214df4d4cb3e1ab9d7d0">_fc_getMeshSlot</a>(mesh);
<a name="l02065"></a>02065   <span class="keywordflow">if</span> (!meshSlot || !meshSlot-&gt;<a class="code" href="struct__FC__MeshSlot.html#8acdc27c257edccc827cd77bf05e4f13">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>) {
<a name="l02066"></a>02066     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"INPUT ERROR: invalid mesh"</span>);
<a name="l02067"></a>02067     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l02068"></a>02068   }
<a name="l02069"></a>02069 
<a name="l02070"></a>02070   <span class="comment">// log message</span>
<a name="l02071"></a>02071   <a class="code" href="group__Library.html#g523b10264df36531b23de2260393db30">fc_printfLogMessage</a>(<span class="stringliteral">"Reading element conns for mesh '%s'"</span>, 
<a name="l02072"></a>02072                 meshSlot-&gt;<a class="code" href="struct__FC__MeshSlot.html#8acdc27c257edccc827cd77bf05e4f13">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>);
<a name="l02073"></a>02073 
<a name="l02074"></a>02074   <span class="comment">// Call format specific routines</span>
<a name="l02075"></a>02075   dsSlot = <a class="code" href="group__PrivateDataset.html#g42016ac71c44a0188d75d5753adc47b2">_fc_getDsSlot</a>(meshSlot-&gt;<a class="code" href="struct__FC__MeshSlot.html#553d7d0470e312f24080c5ed49334ead">ds</a>);
<a name="l02076"></a>02076   <span class="keywordflow">switch</span> (dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#202208502c0ef7a4dc5b7a7616f1f2ef">fileType</a>) {
<a name="l02077"></a>02077   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:
<a name="l02078"></a>02078 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l02079"></a>02079 <span class="preprocessor"></span>   <span class="keywordflow">return</span> <a class="code" href="group__ExodusFileIO.html#gb8d95904d81fd9f0e887988c51d34a70">_fc_readExodusMeshElemConns</a>(mesh);
<a name="l02080"></a>02080 <span class="preprocessor">#else</span>
<a name="l02081"></a>02081 <span class="preprocessor"></span>    <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Exodus module not available"</span>);
<a name="l02082"></a>02082     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02083"></a>02083 <span class="preprocessor">#endif</span>
<a name="l02084"></a>02084 <span class="preprocessor"></span>  <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>: 
<a name="l02085"></a>02085     <span class="keywordflow">return</span> <a class="code" href="group__LSDynaFileIO.html#gc32ed1a152397d2db2428379464e05b1">_fc_readLSDynaMeshElemConns</a>(mesh);
<a name="l02086"></a>02086   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>:
<a name="l02087"></a>02087     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Called without a file type"</span>);
<a name="l02088"></a>02088     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02089"></a>02089   }
<a name="l02090"></a>02090 
<a name="l02091"></a>02091   <span class="comment">// shouldn't reach this point</span>
<a name="l02092"></a>02092   <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Unrecognized file type"</span>);
<a name="l02093"></a>02093   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02094"></a>02094 }
<a name="l02095"></a>02095 <span class="comment"></span>
<a name="l02096"></a>02096 <span class="comment">/**</span>
<a name="l02097"></a>02097 <span class="comment"> * \ingroup  PrivateFileIO</span>
<a name="l02098"></a>02098 <span class="comment"> * \brief  Read subset members from file into a subset</span>
<a name="l02099"></a>02099 <span class="comment"> *</span>
<a name="l02100"></a>02100 <span class="comment"> * \description</span>
<a name="l02101"></a>02101 <span class="comment"> *  </span>
<a name="l02102"></a>02102 <span class="comment"> *    Reads subset members from file into a subset. This is a wrapper that</span>
<a name="l02103"></a>02103 <span class="comment"> *     chooses the proper implentation based on the file type.</span>
<a name="l02104"></a>02104 <span class="comment"> *</span>
<a name="l02105"></a>02105 <span class="comment"> * \modifications  </span>
<a name="l02106"></a>02106 <span class="comment"> *   - 7/13/2005 WSD, created to better abstract reading routines.</span>
<a name="l02107"></a>02107 <span class="comment"> */</span>
<a name="l02108"></a><a class="code" href="group__PrivateFileIO.html#g8cf27614f4ebc6794bb90aed061495e6">02108</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g8cf27614f4ebc6794bb90aed061495e6">_fc_readSubsetMembers</a>(
<a name="l02109"></a>02109   <a class="code" href="structFC__Subset.html">FC_Subset</a> subset  <span class="comment">/**&lt; input - subset to read into */</span>
<a name="l02110"></a>02110 ) {
<a name="l02111"></a>02111   <a class="code" href="struct__FC__SubSlot.html">_FC_SubSlot</a>* subSlot = <a class="code" href="group__PrivateSubset.html#g8f78520bce8753ac1e5fda62c47862da">_fc_getSubSlot</a>(subset);
<a name="l02112"></a>02112   <a class="code" href="struct__FC__DsSlot.html">_FC_DsSlot</a>* dsSlot;
<a name="l02113"></a>02113 
<a name="l02114"></a>02114   <span class="comment">// check input</span>
<a name="l02115"></a>02115   <span class="keywordflow">if</span> (!subSlot || !subSlot-&gt;<a class="code" href="struct__FC__SubSlot.html#3d4cf6721e221bdaa68d1ea3b2709aaa">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>) {
<a name="l02116"></a>02116     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"INPUT ERROR: invalid subSlot"</span>);
<a name="l02117"></a>02117     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l02118"></a>02118   }
<a name="l02119"></a>02119 
<a name="l02120"></a>02120   <span class="comment">// log message</span>
<a name="l02121"></a>02121   <a class="code" href="group__Library.html#g523b10264df36531b23de2260393db30">fc_printfLogMessage</a>(<span class="stringliteral">"Reading members for subset '%s'"</span>, 
<a name="l02122"></a>02122                 subSlot-&gt;<a class="code" href="struct__FC__SubSlot.html#3d4cf6721e221bdaa68d1ea3b2709aaa">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>);
<a name="l02123"></a>02123 
<a name="l02124"></a>02124   <span class="comment">// Call format specific routine</span>
<a name="l02125"></a>02125   dsSlot = <a class="code" href="group__PrivateDataset.html#g42016ac71c44a0188d75d5753adc47b2">_fc_getDsSlot</a>(<a class="code" href="group__PrivateMesh.html#g703c4929b726214df4d4cb3e1ab9d7d0">_fc_getMeshSlot</a>(subSlot-&gt;<a class="code" href="struct__FC__SubSlot.html#e2ea84949d74bb96696ee64123ff6f3d">mesh</a>)-&gt;<a class="code" href="struct__FC__MeshSlot.html#553d7d0470e312f24080c5ed49334ead">ds</a>);
<a name="l02126"></a>02126   <span class="keywordflow">switch</span> (dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#202208502c0ef7a4dc5b7a7616f1f2ef">fileType</a>) {
<a name="l02127"></a>02127   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:
<a name="l02128"></a>02128 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l02129"></a>02129 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="group__ExodusFileIO.html#g724dec39f2d702d53dd10f0fdd7bcc88">_fc_readExodusSubsetMembers</a>(subset);
<a name="l02130"></a>02130 <span class="preprocessor">#else</span>
<a name="l02131"></a>02131 <span class="preprocessor"></span>    <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Exodus module not available"</span>);
<a name="l02132"></a>02132     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02133"></a>02133 <span class="preprocessor">#endif</span>
<a name="l02134"></a>02134 <span class="preprocessor"></span>  <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>:
<a name="l02135"></a>02135     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>; <span class="comment">// no subsets in lsdyna</span>
<a name="l02136"></a>02136   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>:
<a name="l02137"></a>02137     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Called without a file type"</span>);
<a name="l02138"></a>02138     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02139"></a>02139   }
<a name="l02140"></a>02140 
<a name="l02141"></a>02141   <span class="comment">// shouldn't reach this point</span>
<a name="l02142"></a>02142   <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Unrecognized file type"</span>);
<a name="l02143"></a>02143   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02144"></a>02144 }
<a name="l02145"></a>02145 <span class="comment"></span>
<a name="l02146"></a>02146 <span class="comment">/**</span>
<a name="l02147"></a>02147 <span class="comment"> * \ingroup  PrivateFileIO</span>
<a name="l02148"></a>02148 <span class="comment"> * \brief  Read data from file into a variable</span>
<a name="l02149"></a>02149 <span class="comment"> *</span>
<a name="l02150"></a>02150 <span class="comment"> * \description</span>
<a name="l02151"></a>02151 <span class="comment"> *  </span>
<a name="l02152"></a>02152 <span class="comment"> *    Reads data from file into a variable. This is a wrapper that chooses the</span>
<a name="l02153"></a>02153 <span class="comment"> *    proper implentation based on the file type.</span>
<a name="l02154"></a>02154 <span class="comment"> *</span>
<a name="l02155"></a>02155 <span class="comment"> * \modifications  </span>
<a name="l02156"></a>02156 <span class="comment"> *   - 7/13/2005 WSD, created to better abstract reading routines.</span>
<a name="l02157"></a>02157 <span class="comment"> */</span>
<a name="l02158"></a><a class="code" href="group__PrivateFileIO.html#gf2f857cebf9330f22adf7ca16f571ea2">02158</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#gf2f857cebf9330f22adf7ca16f571ea2">_fc_readVariableData</a>(
<a name="l02159"></a>02159   <a class="code" href="structFC__Variable.html">FC_Variable</a> variable  <span class="comment">/**&lt; input - variable to read into */</span>
<a name="l02160"></a>02160 ) {
<a name="l02161"></a>02161   <a class="code" href="struct__FC__VarSlot.html">_FC_VarSlot</a>* varSlot = <a class="code" href="group__PrivateVariable.html#g2b99df3fb78e3936d0976002ca3ce18f">_fc_getVarSlot</a>(variable);
<a name="l02162"></a>02162   <a class="code" href="struct__FC__DsSlot.html">_FC_DsSlot</a>* dsSlot;
<a name="l02163"></a>02163   
<a name="l02164"></a>02164   <span class="comment">// check input</span>
<a name="l02165"></a>02165   <span class="keywordflow">if</span> (!varSlot || !varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#6b78cddabfcaf1bdc90aef8b08e9ab03">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>) {
<a name="l02166"></a>02166     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"INPUT ERROR: invalid variable"</span>);
<a name="l02167"></a>02167     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l02168"></a>02168   }
<a name="l02169"></a>02169 
<a name="l02170"></a>02170   <span class="comment">// log message</span>
<a name="l02171"></a>02171   <a class="code" href="group__Library.html#g523b10264df36531b23de2260393db30">fc_printfLogMessage</a>(<span class="stringliteral">"Reading data for variable '%s'"</span>, 
<a name="l02172"></a>02172                 varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#6b78cddabfcaf1bdc90aef8b08e9ab03">header</a>.<a class="code" href="struct__FC__SlotHeader.html#a3977050dc75352e26c943617ee4fcd8">name</a>);
<a name="l02173"></a>02173 
<a name="l02174"></a>02174   <span class="comment">// Call format specific routines</span>
<a name="l02175"></a>02175   dsSlot = <a class="code" href="group__PrivateDataset.html#g42016ac71c44a0188d75d5753adc47b2">_fc_getDsSlot</a>(varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#822f7af1f77f216f40f89c5a75ce549a">ds</a>);
<a name="l02176"></a>02176   <span class="keywordflow">switch</span> (dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#202208502c0ef7a4dc5b7a7616f1f2ef">fileType</a>) {
<a name="l02177"></a>02177   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:
<a name="l02178"></a>02178 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l02179"></a>02179 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="group__ExodusFileIO.html#gd8662242580b0086516334dc29067fe8">_fc_readExodusVariableData</a>(variable);
<a name="l02180"></a>02180 <span class="preprocessor">#else</span>
<a name="l02181"></a>02181 <span class="preprocessor"></span>    <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Exodus module not available"</span>);
<a name="l02182"></a>02182     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02183"></a>02183 <span class="preprocessor">#endif</span>
<a name="l02184"></a>02184 <span class="preprocessor"></span>  <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>: 
<a name="l02185"></a>02185     <span class="keywordflow">return</span> <a class="code" href="group__LSDynaFileIO.html#g751a74d05546ec17a5719c6910f93925">_fc_readLSDynaVariableData</a>(variable);
<a name="l02186"></a>02186   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>:
<a name="l02187"></a>02187     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Called without a file type"</span>);
<a name="l02188"></a>02188     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02189"></a>02189   }
<a name="l02190"></a>02190 
<a name="l02191"></a>02191   <span class="comment">// shouldn't reach this point</span>
<a name="l02192"></a>02192   <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Unrecognized file type"</span>);
<a name="l02193"></a>02193   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02194"></a>02194 }
<a name="l02195"></a>02195 <span class="comment"></span>
<a name="l02196"></a>02196 <span class="comment">/**</span>
<a name="l02197"></a>02197 <span class="comment"> * \ingroup  PrivateFileIO</span>
<a name="l02198"></a>02198 <span class="comment"> * \brief  Close a dataset.</span>
<a name="l02199"></a>02199 <span class="comment"> *</span>
<a name="l02200"></a>02200 <span class="comment"> * \description </span>
<a name="l02201"></a>02201 <span class="comment"> * </span>
<a name="l02202"></a>02202 <span class="comment"> *    Close the dataset file (if needed) and do any necessary file related</span>
<a name="l02203"></a>02203 <span class="comment"> *    cleanup for the Dataset. This is a wrapper that calls format specific</span>
<a name="l02204"></a>02204 <span class="comment"> *    implementations.</span>
<a name="l02205"></a>02205 <span class="comment"> *</span>
<a name="l02206"></a>02206 <span class="comment"> * \modifications  </span>
<a name="l02207"></a>02207 <span class="comment"> *   - 7/14/2005 WSD, created to better abstract file IO routines.</span>
<a name="l02208"></a>02208 <span class="comment"> */</span>
<a name="l02209"></a><a class="code" href="group__PrivateFileIO.html#g57b9694b51249fd539752aa9be79d2af">02209</a> <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> <a class="code" href="group__PrivateFileIO.html#g57b9694b51249fd539752aa9be79d2af">_fc_closeDataset</a>(
<a name="l02210"></a>02210   <a class="code" href="structFC__Dataset.html">FC_Dataset</a> dataset <span class="comment">/**&lt; input - the dataset */</span>
<a name="l02211"></a>02211 ) {
<a name="l02212"></a>02212   <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> rc;
<a name="l02213"></a>02213   <a class="code" href="struct__FC__DsSlot.html">_FC_DsSlot</a>* dsSlot;
<a name="l02214"></a>02214 
<a name="l02215"></a>02215   <span class="comment">// check input</span>
<a name="l02216"></a>02216   dsSlot = <a class="code" href="group__PrivateDataset.html#g42016ac71c44a0188d75d5753adc47b2">_fc_getDsSlot</a>(dataset);
<a name="l02217"></a>02217   <span class="keywordflow">if</span> (dsSlot == NULL) {
<a name="l02218"></a>02218     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g97ca6452d8a5b6625a2c02166dc87bb7">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>));
<a name="l02219"></a>02219     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>;
<a name="l02220"></a>02220   }
<a name="l02221"></a>02221   
<a name="l02222"></a>02222   <span class="comment">// Call format specific routines</span>
<a name="l02223"></a>02223   dsSlot = <a class="code" href="group__PrivateDataset.html#g42016ac71c44a0188d75d5753adc47b2">_fc_getDsSlot</a>(dataset);
<a name="l02224"></a>02224   <span class="keywordflow">switch</span> (dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#202208502c0ef7a4dc5b7a7616f1f2ef">fileType</a>) {
<a name="l02225"></a>02225   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d563b4812ed953ad6ecd01be20b81c46a3">FC_FT_EXODUS</a>:
<a name="l02226"></a>02226 <span class="preprocessor">#ifdef HAVE_EXODUS</span>
<a name="l02227"></a>02227 <span class="preprocessor"></span>    rc =<a class="code" href="group__ExodusFileIO.html#gb8fee71e47d8b6fc7b0e0eb2fd194942">_fc_closeExodusDataset</a>(dataset); <span class="keywordflow">break</span>;
<a name="l02228"></a>02228 <span class="preprocessor">#else</span>
<a name="l02229"></a>02229 <span class="preprocessor"></span>    <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Exodus module not available"</span>);
<a name="l02230"></a>02230     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02231"></a>02231 <span class="preprocessor">#endif</span>
<a name="l02232"></a>02232 <span class="preprocessor"></span>  <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d5ac975a61bcdfe4349ebbbf1e07483f37">FC_FT_LSDYNA</a>: 
<a name="l02233"></a>02233     rc = <a class="code" href="group__LSDynaFileIO.html#gf8eb45676fe0e951e02efa83223884dd">_fc_closeLSDynaDataset</a>(dataset); <span class="keywordflow">break</span>;
<a name="l02234"></a>02234   <span class="keywordflow">case</span> <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>:
<a name="l02235"></a>02235     <a class="code" href="group__Library.html#gb41a63cb101314fb41df98cef504a556">fc_printfErrorMessage</a>(<span class="stringliteral">"Called without a file type"</span>);
<a name="l02236"></a>02236     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>;
<a name="l02237"></a>02237   }
<a name="l02238"></a>02238   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l02239"></a>02239     <span class="keywordflow">return</span> rc;
<a name="l02240"></a>02240 
<a name="l02241"></a>02241   <span class="comment">// Generic stuff</span>
<a name="l02242"></a>02242   dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#202208502c0ef7a4dc5b7a7616f1f2ef">fileType</a> = <a class="code" href="group__FileIO.html#gg4647ac3054682609036d15ddf55055d516322a349292a7f09031bbc44421f35c">FC_FT_NONE</a>;
<a name="l02243"></a>02243   free(dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#e59444fefb5a972a2cebd1dcb182b19c">baseFile</a>);
<a name="l02244"></a>02244   dsSlot-&gt;<a class="code" href="struct__FC__DsSlot.html#e59444fefb5a972a2cebd1dcb182b19c">baseFile</a> = NULL;
<a name="l02245"></a>02245 
<a name="l02246"></a>02246   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>;
<a name="l02247"></a>02247 }
<a name="l02248"></a>02248 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Oct 31 11:09:58 2007 for FCLib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
