<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>FCLib: Series Routines</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Series Routines<br>
<small>
[<a class="el" href="group__API.html">FCLib API</a>]</small>
</h1>
<p>
<div class="dynheader">
Collaboration diagram for Series Routines:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__Series.gif" border="0" alt="" usemap="#group____Series_map">
<map name="group____Series_map">
<area shape="rect" href="group__PrivateSeries.html" title="(Private)" alt="" coords="324,5,404,32"><area shape="rect" href="group__API.html" title="Feature Characterization Library." alt="" coords="7,5,92,32"></map></td></tr></table></center>
</div>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Sequence-based analysis routines (e.g., time series) and helper functions. 
<p>
<b>Description:</b> <p>
Sequence-based analysis routines (e.g., time series) and helper functions. These may<ul>
<li>compare 2 sequence vars by generating a characteristic value representing the comparison (e.g., distance between them)</li><li>generate characteristic values of a single sequence var (e.g., integral)</li><li>map a sequence var into another sequence var (e.g., normal form)</li></ul>
<p>
<b>Modifications:</b> <ul>
<li>6/01/05 ACG this module was renamed from timeseries to series </li></ul>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Modules</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PrivateSeries.html">(Private)</a></td></tr>

<tr><td colspan="2"><br><h2>Functions that map a single sequence var into another single sequence var</h2></td></tr>
<tr><td colspan="2"><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Series.html#g9cb7e0a54cf1dd1e77eb224877f45183">fc_linearInterpolation</a> (int numStep, <a class="el" href="structFC__Variable.html">FC_Variable</a> *seqvar, <a class="el" href="structFC__Sequence.html">FC_Sequence</a> newseq, char *varname, <a class="el" href="structFC__Variable.html">FC_Variable</a> **newseqvar)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a handle to a seqvar that is the old seq var on a new sequence. Linear interpolation is done to get the values at the new sequence points.  <a href="#g9cb7e0a54cf1dd1e77eb224877f45183"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Series.html#g2b524f404caa2acb1fd25efac6ee1b59">fc_firstDerivative_REA</a> (int numStep, <a class="el" href="structFC__Variable.html">FC_Variable</a> *seqvar, double ueps, char *varname, <a class="el" href="structFC__Variable.html">FC_Variable</a> **newseqvar)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a handle to a seqvar that is the first derivative of an existing seqvar calulated using the Richardson Extrapolation Approximation.  <a href="#g2b524f404caa2acb1fd25efac6ee1b59"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Series.html#g1fd38482a6e61402b2cf5ccb73d648b0">fc_leadingWindowAverage</a> (int numStep, <a class="el" href="structFC__Variable.html">FC_Variable</a> *seqvar, int windowsize, char *varname, <a class="el" href="structFC__Variable.html">FC_Variable</a> **newseqvar)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a handle to a seqvar that is the window averaged version of an existing seqvar.  <a href="#g1fd38482a6e61402b2cf5ccb73d648b0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Series.html#ge579a1d090e9c3a96d42b30bd3832804">fc_leadingWindowAverage_Time</a> (int numStep, <a class="el" href="structFC__Variable.html">FC_Variable</a> *seqvar, double windowtime, char *varname, <a class="el" href="structFC__Variable.html">FC_Variable</a> **newseqvar)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a handle to a seqvar that is the time window averaged version of an existing seqvar.  <a href="#ge579a1d090e9c3a96d42b30bd3832804"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Series.html#gd1303e5ad64a3955e85f4dccb1737d32">fc_centeredWindowAverage</a> (int numStep, <a class="el" href="structFC__Variable.html">FC_Variable</a> *seqvar, int windowsize, char *varname, <a class="el" href="structFC__Variable.html">FC_Variable</a> **newseqvar)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a handle to a seqvar that is the window averaged version of an existing seqvar.  <a href="#gd1303e5ad64a3955e85f4dccb1737d32"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Series.html#g7636faac4bbb90afecb6ad101d817417">fc_centeredWindowAverage_Time</a> (int numStep, <a class="el" href="structFC__Variable.html">FC_Variable</a> *seqvar, double windowtime, char *varname, <a class="el" href="structFC__Variable.html">FC_Variable</a> **newseqvar)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a handle to a seqvar that is the time window averaged version of an existing seqvar.  <a href="#g7636faac4bbb90afecb6ad101d817417"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Series.html#g0e0fd0c6a1cdee54b6c63201906cde2c">fc_normalForm</a> (int numStep, <a class="el" href="structFC__Variable.html">FC_Variable</a> *seqvar, char *varname, <a class="el" href="structFC__Variable.html">FC_Variable</a> **newseqvar)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a handle to a seqvar that is the normal form of an existing seqvar.  <a href="#g0e0fd0c6a1cdee54b6c63201906cde2c"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions that operate on a single sequence var and return a value or values based on that var but the return val is not a sequence var</h2></td></tr>
<tr><td colspan="2"><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Series.html#gb8a16c59d79c57324b21669241b9101f">fc_integral_TR</a> (int numStep, <a class="el" href="structFC__Variable.html">FC_Variable</a> *seqvar, char *varname, <a class="el" href="structFC__Variable.html">FC_Variable</a> *newvar)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a handle to a var that is the integral of an existing seqvar over its sequence.  <a href="#gb8a16c59d79c57324b21669241b9101f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Series.html#gbf6c5e2e21752cec449de43d88ce83f8">fc_linearLeastSquares</a> (int numStep, <a class="el" href="structFC__Variable.html">FC_Variable</a> *seqvar, <a class="el" href="structFC__Variable.html">FC_Variable</a> *newvar)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Given an N Data Point, Single Component sequence variable, returns a handle to a var containing linear least squares parameters, a,b,r2,SE(a),SE(b), where y=a+bx.  <a href="#gbf6c5e2e21752cec449de43d88ce83f8"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions that operate on a pair of sequence vars and return a value or values based on those vars but the return val is not a sequence var</h2></td></tr>
<tr><td colspan="2"><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Series.html#gb7813df0d0b243c012c0fa294eb96bec">fc_euclideanDistanceBetweenCurves</a> (int numStep, <a class="el" href="structFC__Variable.html">FC_Variable</a> *seqvar1, <a class="el" href="structFC__Variable.html">FC_Variable</a> *seqvar2, char *varname, <a class="el" href="structFC__Variable.html">FC_Variable</a> *newvar)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a handle to a var that is the euclidean distance between two curves traced out by sequence variables where y = seq var data value, x = sequence value (e.g., time).  <a href="#gb7813df0d0b243c012c0fa294eb96bec"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Series.html#ga548385126e393b9d35bac26ef46315c">fc_dimensionlessAreaBetweenCurves</a> (int numStep, <a class="el" href="structFC__Variable.html">FC_Variable</a> *refseqvar, <a class="el" href="structFC__Variable.html">FC_Variable</a> *compseqvar, char *varname, <a class="el" href="structFC__Variable.html">FC_Variable</a> *newvar)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a handle to a var that is a dimensionless area between two curves traced out by sequence variables where y = seq var data value, x = sequence value (e.g., time).  <a href="#ga548385126e393b9d35bac26ef46315c"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="gd1303e5ad64a3955e85f4dccb1737d32"></a><!-- doxytag: member="series.c::fc_centeredWindowAverage" ref="gd1303e5ad64a3955e85f4dccb1737d32" args="(int numStep, FC_Variable *seqvar, int windowsize, char *varname, FC_Variable **newseqvar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_centeredWindowAverage           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>seqvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>windowsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> **&nbsp;</td>
          <td class="paramname"> <em>newseqvar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return a handle to a seqvar that is the window averaged version of an existing seqvar. 
<p>
<b>Description:</b> <p>
Return a handle to a seqvar that is the window averaged version of an existing seqvar. Return value is an average of the the window number values of f centered about the current time. Therefore choosing window = 1 returns the orig sequence. For early/late times if there are not enough values to satisfy the window, it uses what it can and preserves the symettry of the window. Time averaged version of this is <a class="el" href="group__Series.html#g7636faac4bbb90afecb6ad101d817417">fc_centeredWindowAverage_Time</a>.<p>
Averaging is over each dimension of the variable separately<p>
Floats and Doubles will return vars with same type; Ints will return Doubles. Someone can floor/ceil it later if they want integer values. This will return with an error if the seqvar is not numerical. Windowsize must be odd.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000066">Todo:</a></b></dt><dd></dd></dl>
<ul>
<li>see notes in <a class="el" href="group__Series.html#g1fd38482a6e61402b2cf5ccb73d648b0">fc_leadingWindowAverage</a></li></ul>
<p>
<b>Modifications:</b> <ul>
<li>01/24/06 ACG, Created </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - number of steps in the seq var </td></tr>
<tr><td valign="top"><em>seqvar</em>&nbsp;</td><td>
input - seq var averaging over </td></tr>
<tr><td valign="top"><em>windowsize</em>&nbsp;</td><td>
input - window size for average </td></tr>
<tr><td valign="top"><em>varname</em>&nbsp;</td><td>
input - name for averaged output seq var </td></tr>
<tr><td valign="top"><em>newseqvar</em>&nbsp;</td><td>
output - handles for output seq var </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="series_8c-source.html#l01506">1506</a> of file <a class="el" href="series_8c-source.html">series.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l06536">_fc_getVarSlot()</a>, <a class="el" href="series_8c-source.html#l00122">_fc_makeNewSeqVar()</a>, <a class="el" href="variable_8c-source.html#l02328">fc_copySeqVariable()</a>, <a class="el" href="variable_8c-source.html#l05062">fc_deleteSeqVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="variable_8c-source.html#l05392">fc_getMeshFromVariable()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="variable_8c-source.html#l05317">fc_getSequenceFromSeqVariable()</a>, <a class="el" href="variable_8c-source.html#l05715">fc_getVariableDataPtr()</a>, <a class="el" href="variable_8c-source.html#l05498">fc_getVariableDataType()</a>, <a class="el" href="variable_8c-source.html#l05433">fc_getVariableInfo()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="variable_8c-source.html#l05178">fc_isSeqVariableValid()</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="variable_8c-source.html#l00469">fc_setVariableData()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="variableP_8h-source.html#l00075">_FC_VarSlot::header</a>, <a class="el" href="tableP_8h-source.html#l00100">_FC_SlotHeader::name</a>, and <a class="el" href="seriesAnalyzer_8c-source.html#l00102">numComponent</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01512"></a>01512  {
<a name="l01513"></a>01513 
<a name="l01514"></a>01514 
<a name="l01515"></a>01515   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l01516"></a>01516   <a class="code" href="struct__FC__VarSlot.html" title="Variable Slot Structure for the Variable Table.">_FC_VarSlot</a>* varSlot;
<a name="l01517"></a>01517   <span class="keywordtype">int</span> numDataPoint;
<a name="l01518"></a>01518   <span class="keywordtype">int</span> <a class="code" href="seriesAnalyzer_8c.html#9ba814c62f21460639802c7771e86fa6">numComponent</a>;
<a name="l01519"></a>01519   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc;
<a name="l01520"></a>01520   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype;
<a name="l01521"></a>01521   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype, newdatatype;
<a name="l01522"></a>01522   <span class="keywordtype">void</span>* vwritedata;
<a name="l01523"></a>01523   <span class="keywordtype">int</span> i,j,numArrayVals;
<a name="l01524"></a>01524 
<a name="l01525"></a>01525   <span class="keywordflow">if</span> (newseqvar)
<a name="l01526"></a>01526     *newseqvar = NULL;
<a name="l01527"></a>01527 
<a name="l01528"></a>01528   <span class="comment">//will check below to see that its appropriate numerical type</span>
<a name="l01529"></a>01529   <span class="keywordflow">if</span> ((!<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,seqvar)) || (newseqvar == NULL)
<a name="l01530"></a>01530       || varname == NULL || windowsize &lt; 1 || (windowsize-1)%2 != 0){
<a name="l01531"></a>01531     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l01532"></a>01532     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l01533"></a>01533   };
<a name="l01534"></a>01534 
<a name="l01535"></a>01535   rc = <a class="code" href="group__Variable.html#gd3b7cecfd0c6d488e82b426b4c114aba" title="Return the data type of a variable.">fc_getVariableDataType</a>(seqvar[0],&amp;datatype);
<a name="l01536"></a>01536   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01537"></a>01537     <span class="keywordflow">return</span> rc;
<a name="l01538"></a>01538 
<a name="l01539"></a>01539   <span class="keywordflow">if</span> (!(datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l01540"></a>01540         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l01541"></a>01541         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l01542"></a>01542       ){
<a name="l01543"></a>01543     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l01544"></a>01544   } 
<a name="l01545"></a>01545 
<a name="l01546"></a>01546 
<a name="l01547"></a>01547   varSlot = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(seqvar[0]);
<a name="l01548"></a>01548   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Getting windowave for seq variable '%s'"</span>,
<a name="l01549"></a>01549                       varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>);
<a name="l01550"></a>01550 
<a name="l01551"></a>01551   <span class="comment">//special case</span>
<a name="l01552"></a>01552   <span class="keywordflow">if</span> (windowsize == 1){
<a name="l01553"></a>01553     <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> mesh;
<a name="l01554"></a>01554     <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> seq;
<a name="l01555"></a>01555 
<a name="l01556"></a>01556     rc = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(seqvar[0],&amp;mesh);
<a name="l01557"></a>01557     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01558"></a>01558       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(rc));
<a name="l01559"></a>01559       <span class="keywordflow">return</span> rc;
<a name="l01560"></a>01560     }
<a name="l01561"></a>01561 
<a name="l01562"></a>01562     rc = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,seqvar,&amp;seq);
<a name="l01563"></a>01563     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01564"></a>01564       <span class="keywordflow">return</span> rc;
<a name="l01565"></a>01565 
<a name="l01566"></a>01566     rc = <a class="code" href="group__Variable.html#gaf25870a6c8032440b6d5565ccc083cb" title="Copy a sequence variable.">fc_copySeqVariable</a>(numStep,seqvar,mesh,seq,varname,newseqvar); 
<a name="l01567"></a>01567     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01568"></a>01568       <span class="keywordflow">return</span> rc;
<a name="l01569"></a>01569 
<a name="l01570"></a>01570     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l01571"></a>01571   }
<a name="l01572"></a>01572 
<a name="l01573"></a>01573 
<a name="l01574"></a>01574   rc = <a class="code" href="group__PrivateSeries.html#g85558d3a96772fc12d86f399f7eece30" title="Makes a new seq var on the mesh that is on the same sequence as a given variable...">_fc_makeNewSeqVar</a>(numStep, seqvar, varname,newseqvar); 
<a name="l01575"></a>01575   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01576"></a>01576     <span class="keywordflow">return</span> rc;
<a name="l01577"></a>01577 
<a name="l01578"></a>01578   rc = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(seqvar[0], &amp;numDataPoint, &amp;numComponent, &amp;assoc,
<a name="l01579"></a>01579                            &amp;mathtype, &amp;datatype);
<a name="l01580"></a>01580   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01581"></a>01581     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01582"></a>01582     free(*newseqvar);
<a name="l01583"></a>01583     *newseqvar=NULL;
<a name="l01584"></a>01584     <span class="keywordflow">return</span> rc;
<a name="l01585"></a>01585   }
<a name="l01586"></a>01586 
<a name="l01587"></a>01587   <span class="comment">//make writeout array</span>
<a name="l01588"></a>01588   numArrayVals = numDataPoint*numComponent;
<a name="l01589"></a>01589   <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l01590"></a>01590     newdatatype = <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>;
<a name="l01591"></a>01591     vwritedata = (<span class="keywordtype">float</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));    
<a name="l01592"></a>01592   } <span class="keywordflow">else</span> { <span class="comment">//knows its an int or a double cause that was checked above)</span>
<a name="l01593"></a>01593     newdatatype = <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>;
<a name="l01594"></a>01594     vwritedata = (<span class="keywordtype">double</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01595"></a>01595   }
<a name="l01596"></a>01596   <span class="keywordflow">if</span> (vwritedata == NULL){
<a name="l01597"></a>01597     <span class="comment">//no clean up in case of memory error</span>
<a name="l01598"></a>01598     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l01599"></a>01599     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l01600"></a>01600   }
<a name="l01601"></a>01601 
<a name="l01602"></a>01602 
<a name="l01603"></a>01603   <span class="comment">//this is not the most efficient, but it is the easiest</span>
<a name="l01604"></a>01604   <span class="keywordflow">for</span> (i = 0; i &lt; numStep; i++) { <span class="comment">//like each time</span>
<a name="l01605"></a>01605     <span class="keywordtype">int</span> count = 0;
<a name="l01606"></a>01606     <span class="keywordtype">int</span> range = (windowsize-1)/2;
<a name="l01607"></a>01607     <span class="keywordflow">if</span> (i-range &lt; 0) range = i;
<a name="l01608"></a>01608     <span class="keywordflow">if</span> (i+range &gt; (numStep-1)) range = numStep-1-i;
<a name="l01609"></a>01609 
<a name="l01610"></a>01610     <span class="keywordflow">for</span> (j = 0; j &lt; numArrayVals; j++){
<a name="l01611"></a>01611       <span class="keywordflow">if</span> (newdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l01612"></a>01612      ((<span class="keywordtype">float</span>*)vwritedata)[j] = 0.0;
<a name="l01613"></a>01613       }<span class="keywordflow">else</span> {
<a name="l01614"></a>01614      ((<span class="keywordtype">double</span>*)vwritedata)[j] = 0.0;
<a name="l01615"></a>01615       }
<a name="l01616"></a>01616     }
<a name="l01617"></a>01617 
<a name="l01618"></a>01618     <span class="keywordflow">for</span> (j = (i-range); j &lt;= (i+range); j++){
<a name="l01619"></a>01619       <span class="keywordtype">void</span> *data;
<a name="l01620"></a>01620       <span class="keywordtype">int</span> k;
<a name="l01621"></a>01621 
<a name="l01622"></a>01622       rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(seqvar[j], &amp;data);
<a name="l01623"></a>01623       <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01624"></a>01624      data = NULL;
<a name="l01625"></a>01625      <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01626"></a>01626      free(*newseqvar);
<a name="l01627"></a>01627      *newseqvar=NULL;
<a name="l01628"></a>01628      free(vwritedata);
<a name="l01629"></a>01629      <span class="keywordflow">return</span> rc;
<a name="l01630"></a>01630       }
<a name="l01631"></a>01631 
<a name="l01632"></a>01632       <span class="keywordflow">for</span> (k = 0; k &lt; numArrayVals; k++){
<a name="l01633"></a>01633      <span class="keywordflow">switch</span>(datatype){
<a name="l01634"></a>01634      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l01635"></a>01635        ((<span class="keywordtype">double</span>*)vwritedata)[k] += ((<span class="keywordtype">int</span>*)data)[k];
<a name="l01636"></a>01636        <span class="keywordflow">break</span>;
<a name="l01637"></a>01637      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l01638"></a>01638        ((<span class="keywordtype">float</span>*)vwritedata)[k] += ((<span class="keywordtype">float</span>*)data)[k];
<a name="l01639"></a>01639        <span class="keywordflow">break</span>;
<a name="l01640"></a>01640      <span class="keywordflow">default</span>: <span class="comment">//knows its a double cause that was checked above</span>
<a name="l01641"></a>01641        ((<span class="keywordtype">double</span>*)vwritedata)[k] += ((<span class="keywordtype">double</span>*)data)[k];
<a name="l01642"></a>01642        <span class="keywordflow">break</span>;
<a name="l01643"></a>01643      }
<a name="l01644"></a>01644       }
<a name="l01645"></a>01645       count++;
<a name="l01646"></a>01646     } <span class="comment">//end for - over all those in range</span>
<a name="l01647"></a>01647 
<a name="l01648"></a>01648     <span class="keywordflow">for</span> (j = 0 ; j &lt; numArrayVals; j++){
<a name="l01649"></a>01649       <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l01650"></a>01650         ((<span class="keywordtype">float</span>*)vwritedata)[j] /= (float)count;
<a name="l01651"></a>01651       }<span class="keywordflow">else</span> {
<a name="l01652"></a>01652         ((<span class="keywordtype">double</span>*)vwritedata)[j] /= (double)count;
<a name="l01653"></a>01653       }
<a name="l01654"></a>01654     }
<a name="l01655"></a>01655 
<a name="l01656"></a>01656     rc = <a class="code" href="group__Variable.html#g3f958d3b630c9df78a4e7fbca287b039" title="Set the variable data by copy.">fc_setVariableData</a>((*newseqvar)[i], numDataPoint,
<a name="l01657"></a>01657                             numComponent, assoc, mathtype,
<a name="l01658"></a>01658                             newdatatype,vwritedata);
<a name="l01659"></a>01659     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01660"></a>01660       <span class="comment">//additional clean up</span>
<a name="l01661"></a>01661       <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01662"></a>01662 
<a name="l01663"></a>01663       free(*newseqvar);
<a name="l01664"></a>01664       free(vwritedata);
<a name="l01665"></a>01665       *newseqvar=NULL;
<a name="l01666"></a>01666       <span class="keywordflow">return</span> rc;
<a name="l01667"></a>01667     }
<a name="l01668"></a>01668   } <span class="comment">// end for - timestep</span>
<a name="l01669"></a>01669 
<a name="l01670"></a>01670   free(vwritedata);
<a name="l01671"></a>01671 
<a name="l01672"></a>01672   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l01673"></a>01673 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="g7636faac4bbb90afecb6ad101d817417"></a><!-- doxytag: member="series.c::fc_centeredWindowAverage_Time" ref="g7636faac4bbb90afecb6ad101d817417" args="(int numStep, FC_Variable *seqvar, double windowtime, char *varname, FC_Variable **newseqvar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_centeredWindowAverage_Time           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>seqvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>windowtime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> **&nbsp;</td>
          <td class="paramname"> <em>newseqvar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return a handle to a seqvar that is the time window averaged version of an existing seqvar. 
<p>
<b>Description:</b> <p>
Return a handle to a seqvar that is the time window averaged version of an existing seqvar.<p>
Return value f(t) = ave(x(t-window/2)....x(t+window/2)), i.e. it is an average of the vals of f in the time window centered about the current time. For early/late times, if there are not enough values to satisfy the window, it uses as many as it can and preserves the symmetry of the window. This is the window duration version of <a class="el" href="group__Series.html#gd1303e5ad64a3955e85f4dccb1737d32">fc_centeredWindowAverage</a>. There is nothing that checks that the x variable is time of course, but it most likely is so I'm using that name. If the time window is zero, it returns a copy of the orig sequence.<p>
This does not check that the sequence is regular, nor does it weight the vals in the average by their duration in the window etc. It is a blind average.<p>
Averaging is over each dimension of the variable separately<p>
Floats and Doubles will return vars with same type; Ints will return Doubles. Someone can floor/ceil it later if they want integer values. This will return with an error if the seqvar or seq is not numerical.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000067">Todo:</a></b></dt><dd><ul>
<li>any interested in a weighted version ?</li></ul>
</dd></dl>
<b>Modifications:</b> <ul>
<li>01/24/06 ACG, Created </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - number of steps in the seq var </td></tr>
<tr><td valign="top"><em>seqvar</em>&nbsp;</td><td>
input - seq var averaging over </td></tr>
<tr><td valign="top"><em>windowtime</em>&nbsp;</td><td>
input - time window size for average </td></tr>
<tr><td valign="top"><em>varname</em>&nbsp;</td><td>
input - name for averaged output seq var </td></tr>
<tr><td valign="top"><em>newseqvar</em>&nbsp;</td><td>
output - handles for output seq var </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="series_8c-source.html#l01715">1715</a> of file <a class="el" href="series_8c-source.html">series.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l06536">_fc_getVarSlot()</a>, <a class="el" href="series_8c-source.html#l00122">_fc_makeNewSeqVar()</a>, <a class="el" href="variable_8c-source.html#l02328">fc_copySeqVariable()</a>, <a class="el" href="util_8h-source.html#l00136">FC_DBL_EQUIV</a>, <a class="el" href="variable_8c-source.html#l05062">fc_deleteSeqVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="variable_8c-source.html#l05392">fc_getMeshFromVariable()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="sequence_8c-source.html#l01737">fc_getSequenceCoordsPtr()</a>, <a class="el" href="sequence_8c-source.html#l01687">fc_getSequenceDataType()</a>, <a class="el" href="variable_8c-source.html#l05317">fc_getSequenceFromSeqVariable()</a>, <a class="el" href="variable_8c-source.html#l05715">fc_getVariableDataPtr()</a>, <a class="el" href="variable_8c-source.html#l05498">fc_getVariableDataType()</a>, <a class="el" href="variable_8c-source.html#l05433">fc_getVariableInfo()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="variable_8c-source.html#l05178">fc_isSeqVariableValid()</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="variable_8c-source.html#l00469">fc_setVariableData()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="variableP_8h-source.html#l00075">_FC_VarSlot::header</a>, <a class="el" href="tableP_8h-source.html#l00100">_FC_SlotHeader::name</a>, and <a class="el" href="seriesAnalyzer_8c-source.html#l00102">numComponent</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01721"></a>01721  {
<a name="l01722"></a>01722   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l01723"></a>01723   <a class="code" href="struct__FC__VarSlot.html" title="Variable Slot Structure for the Variable Table.">_FC_VarSlot</a>* varSlot;
<a name="l01724"></a>01724   <span class="keywordtype">int</span> numDataPoint;
<a name="l01725"></a>01725   <span class="keywordtype">int</span> <a class="code" href="seriesAnalyzer_8c.html#9ba814c62f21460639802c7771e86fa6">numComponent</a>;
<a name="l01726"></a>01726   <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> seq;
<a name="l01727"></a>01727   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc;
<a name="l01728"></a>01728   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype;
<a name="l01729"></a>01729   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype, seqdatatype,newdatatype;
<a name="l01730"></a>01730   <span class="keywordtype">void</span> *vwritedata, *seqcoords;
<a name="l01731"></a>01731   <span class="keywordtype">int</span> i,j,numArrayVals;
<a name="l01732"></a>01732 
<a name="l01733"></a>01733   <span class="keywordflow">if</span> (newseqvar)
<a name="l01734"></a>01734     *newseqvar = NULL;
<a name="l01735"></a>01735 
<a name="l01736"></a>01736   <span class="comment">//will check below to see that its appropriate numerical type</span>
<a name="l01737"></a>01737   <span class="keywordflow">if</span> ((!<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,seqvar)) || (newseqvar == NULL)
<a name="l01738"></a>01738       || varname == NULL || windowtime &lt; 0){
<a name="l01739"></a>01739     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l01740"></a>01740     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l01741"></a>01741   };
<a name="l01742"></a>01742 
<a name="l01743"></a>01743   rc = <a class="code" href="group__Variable.html#gd3b7cecfd0c6d488e82b426b4c114aba" title="Return the data type of a variable.">fc_getVariableDataType</a>(seqvar[0],&amp;datatype);
<a name="l01744"></a>01744   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01745"></a>01745     <span class="keywordflow">return</span> rc;
<a name="l01746"></a>01746 
<a name="l01747"></a>01747   <span class="keywordflow">if</span> (!(datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l01748"></a>01748         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l01749"></a>01749         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l01750"></a>01750       ){
<a name="l01751"></a>01751     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"var data must be numerical"</span>);
<a name="l01752"></a>01752     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l01753"></a>01753   } 
<a name="l01754"></a>01754 
<a name="l01755"></a>01755   rc = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,seqvar,&amp;seq);
<a name="l01756"></a>01756   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01757"></a>01757     <span class="keywordflow">return</span> rc;
<a name="l01758"></a>01758 
<a name="l01759"></a>01759   rc = <a class="code" href="group__Sequence.html#g6d5a8a30edd00c973804c7ce31a3a2e6" title="Get the data type of a sequence&amp;#39;s coordinates.">fc_getSequenceDataType</a>(seq,&amp;seqdatatype);
<a name="l01760"></a>01760   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01761"></a>01761     <span class="keywordflow">return</span> rc;
<a name="l01762"></a>01762 
<a name="l01763"></a>01763   <span class="keywordflow">if</span> (!(seqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l01764"></a>01764         seqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l01765"></a>01765         seqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l01766"></a>01766       ){
<a name="l01767"></a>01767     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"seq data must be numerical"</span>);
<a name="l01768"></a>01768     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l01769"></a>01769   } 
<a name="l01770"></a>01770 
<a name="l01771"></a>01771 
<a name="l01772"></a>01772   varSlot = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(seqvar[0]);
<a name="l01773"></a>01773   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Getting windowave for seq variable '%s'"</span>,
<a name="l01774"></a>01774                       varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>);
<a name="l01775"></a>01775 
<a name="l01776"></a>01776 
<a name="l01777"></a>01777   <span class="comment">//special case</span>
<a name="l01778"></a>01778   <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(windowtime,0.0)){
<a name="l01779"></a>01779     <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> mesh;
<a name="l01780"></a>01780     rc = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(seqvar[0],&amp;mesh);
<a name="l01781"></a>01781     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01782"></a>01782       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(rc));
<a name="l01783"></a>01783       <span class="keywordflow">return</span> rc;
<a name="l01784"></a>01784     }
<a name="l01785"></a>01785 
<a name="l01786"></a>01786     rc = <a class="code" href="group__Variable.html#gaf25870a6c8032440b6d5565ccc083cb" title="Copy a sequence variable.">fc_copySeqVariable</a>(numStep,seqvar,mesh,seq,varname,newseqvar); 
<a name="l01787"></a>01787     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01788"></a>01788       <span class="keywordflow">return</span> rc;
<a name="l01789"></a>01789 
<a name="l01790"></a>01790     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l01791"></a>01791   }
<a name="l01792"></a>01792 
<a name="l01793"></a>01793   rc = <a class="code" href="group__Sequence.html#ga88160e25be202c8de18ac89edf876c6" title="Get sequence coordinates.">fc_getSequenceCoordsPtr</a>(seq,&amp;seqcoords);
<a name="l01794"></a>01794   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01795"></a>01795     <span class="keywordflow">return</span> rc;
<a name="l01796"></a>01796 
<a name="l01797"></a>01797   rc = <a class="code" href="group__PrivateSeries.html#g85558d3a96772fc12d86f399f7eece30" title="Makes a new seq var on the mesh that is on the same sequence as a given variable...">_fc_makeNewSeqVar</a>(numStep, seqvar, varname,newseqvar); 
<a name="l01798"></a>01798   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01799"></a>01799     <span class="keywordflow">return</span> rc;
<a name="l01800"></a>01800 
<a name="l01801"></a>01801   rc = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(seqvar[0], &amp;numDataPoint, &amp;numComponent, &amp;assoc,
<a name="l01802"></a>01802                            &amp;mathtype, &amp;datatype);
<a name="l01803"></a>01803   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01804"></a>01804     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01805"></a>01805     free(*newseqvar);
<a name="l01806"></a>01806     *newseqvar=NULL;
<a name="l01807"></a>01807     <span class="keywordflow">return</span> rc;
<a name="l01808"></a>01808   }
<a name="l01809"></a>01809 
<a name="l01810"></a>01810   <span class="comment">//make writeout array</span>
<a name="l01811"></a>01811   numArrayVals = numDataPoint*numComponent;
<a name="l01812"></a>01812   <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l01813"></a>01813     newdatatype = <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>;
<a name="l01814"></a>01814     vwritedata = (<span class="keywordtype">float</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));    
<a name="l01815"></a>01815   } <span class="keywordflow">else</span> { <span class="comment">//knows its an int or a double cause that was checked above)</span>
<a name="l01816"></a>01816     newdatatype = <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>;
<a name="l01817"></a>01817     vwritedata = (<span class="keywordtype">double</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01818"></a>01818   }
<a name="l01819"></a>01819   <span class="keywordflow">if</span> (vwritedata == NULL){
<a name="l01820"></a>01820     <span class="comment">//no clean up in case of memory error</span>
<a name="l01821"></a>01821     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l01822"></a>01822     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l01823"></a>01823   }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825   <span class="keywordflow">for</span> (i = 0; i &lt; numStep; i++) { <span class="comment">//like each time</span>
<a name="l01826"></a>01826     <span class="keywordtype">double</span> currtime, lowtime, hightime, prevtime;
<a name="l01827"></a>01827     <span class="keywordtype">double</span> timebounds,newtimebounds;
<a name="l01828"></a>01828     <span class="keywordtype">int</span> highindex, lowindex, previndex;
<a name="l01829"></a>01829     <span class="keywordtype">int</span> count;
<a name="l01830"></a>01830 
<a name="l01831"></a>01831     timebounds = windowtime/2.0;
<a name="l01832"></a>01832     <span class="comment">//get new time - currtime is alwasy a double cause its easier</span>
<a name="l01833"></a>01833     <span class="keywordflow">switch</span>(seqdatatype){
<a name="l01834"></a>01834     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l01835"></a>01835       currtime = ((<span class="keywordtype">int</span>*)(seqcoords))[i];
<a name="l01836"></a>01836       <span class="keywordflow">break</span>;
<a name="l01837"></a>01837     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l01838"></a>01838       currtime = ((<span class="keywordtype">float</span>*)(seqcoords))[i];
<a name="l01839"></a>01839       <span class="keywordflow">break</span>;
<a name="l01840"></a>01840     <span class="keywordflow">default</span>: <span class="comment">//know its a double</span>
<a name="l01841"></a>01841       currtime = ((<span class="keywordtype">double</span>*)(seqcoords))[i];
<a name="l01842"></a>01842       <span class="keywordflow">break</span>;
<a name="l01843"></a>01843     }
<a name="l01844"></a>01844 
<a name="l01845"></a>01845     <span class="comment">//find time range indicies</span>
<a name="l01846"></a>01846     lowtime = currtime;
<a name="l01847"></a>01847     lowindex = i;
<a name="l01848"></a>01848     prevtime = currtime;
<a name="l01849"></a>01849     previndex = i;
<a name="l01850"></a>01850     <span class="keywordflow">while</span>((currtime-lowtime) &lt;= timebounds){
<a name="l01851"></a>01851       previndex = lowindex;
<a name="l01852"></a>01852       prevtime = lowtime;
<a name="l01853"></a>01853 
<a name="l01854"></a>01854       <span class="keywordflow">if</span> (lowindex == 0) <span class="keywordflow">break</span>;
<a name="l01855"></a>01855       lowindex--;
<a name="l01856"></a>01856       <span class="keywordflow">switch</span>(seqdatatype){
<a name="l01857"></a>01857       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l01858"></a>01858      lowtime = ((<span class="keywordtype">int</span>*)(seqcoords))[lowindex];
<a name="l01859"></a>01859      <span class="keywordflow">break</span>;
<a name="l01860"></a>01860       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l01861"></a>01861      lowtime = ((<span class="keywordtype">float</span>*)(seqcoords))[lowindex];
<a name="l01862"></a>01862      <span class="keywordflow">break</span>;
<a name="l01863"></a>01863       <span class="keywordflow">default</span>: <span class="comment">//know its a double</span>
<a name="l01864"></a>01864      lowtime = ((<span class="keywordtype">double</span>*)(seqcoords))[lowindex];
<a name="l01865"></a>01865      <span class="keywordflow">break</span>;
<a name="l01866"></a>01866       }
<a name="l01867"></a>01867     }
<a name="l01868"></a>01868     lowindex = previndex;
<a name="l01869"></a>01869     lowtime = prevtime;
<a name="l01870"></a>01870 
<a name="l01871"></a>01871     hightime = currtime;
<a name="l01872"></a>01872     highindex = i;
<a name="l01873"></a>01873     prevtime = currtime;
<a name="l01874"></a>01874     previndex = i;
<a name="l01875"></a>01875     <span class="keywordflow">while</span>((hightime-currtime) &lt;= timebounds){
<a name="l01876"></a>01876       previndex = highindex;
<a name="l01877"></a>01877       prevtime = hightime;
<a name="l01878"></a>01878 
<a name="l01879"></a>01879       <span class="keywordflow">if</span> (highindex == numStep -1) <span class="keywordflow">break</span>;
<a name="l01880"></a>01880       highindex++;
<a name="l01881"></a>01881       <span class="keywordflow">switch</span>(seqdatatype){
<a name="l01882"></a>01882       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l01883"></a>01883      hightime = ((<span class="keywordtype">int</span>*)(seqcoords))[highindex];
<a name="l01884"></a>01884      <span class="keywordflow">break</span>;
<a name="l01885"></a>01885       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l01886"></a>01886      hightime = ((<span class="keywordtype">float</span>*)(seqcoords))[highindex];
<a name="l01887"></a>01887      <span class="keywordflow">break</span>;
<a name="l01888"></a>01888       <span class="keywordflow">default</span>: <span class="comment">//know its a double</span>
<a name="l01889"></a>01889      hightime = ((<span class="keywordtype">double</span>*)(seqcoords))[highindex];
<a name="l01890"></a>01890      <span class="keywordflow">break</span>;
<a name="l01891"></a>01891       }
<a name="l01892"></a>01892     }
<a name="l01893"></a>01893 
<a name="l01894"></a>01894     highindex = previndex;
<a name="l01895"></a>01895     hightime = prevtime;
<a name="l01896"></a>01896 
<a name="l01897"></a>01897     <span class="comment">//now we have valid high and low times and indicies, but</span>
<a name="l01898"></a>01898     <span class="comment">//did we stop because we hit the bounds ?</span>
<a name="l01899"></a>01899     newtimebounds = timebounds;
<a name="l01900"></a>01900     <span class="keywordflow">if</span> (lowindex == 0){
<a name="l01901"></a>01901       newtimebounds = currtime-lowtime;
<a name="l01902"></a>01902     }
<a name="l01903"></a>01903     <span class="keywordflow">if</span> (highindex == (numStep-1)){
<a name="l01904"></a>01904       newtimebounds = (newtimebounds &lt; (hightime-currtime) ? 
<a name="l01905"></a>01905                  newtimebounds : (hightime-currtime));
<a name="l01906"></a>01906       
<a name="l01907"></a>01907     }
<a name="l01908"></a>01908     <span class="keywordflow">if</span> (!<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(newtimebounds,timebounds) &amp;&amp;
<a name="l01909"></a>01909      newtimebounds &lt; timebounds){ <span class="comment">//redo it</span>
<a name="l01910"></a>01910       <span class="comment">//latter check just incase there is some weird round off thing</span>
<a name="l01911"></a>01911       timebounds = newtimebounds;
<a name="l01912"></a>01912 
<a name="l01913"></a>01913       <span class="comment">//find time range indicies</span>
<a name="l01914"></a>01914       lowtime = currtime;
<a name="l01915"></a>01915       lowindex = i;
<a name="l01916"></a>01916       prevtime = currtime;
<a name="l01917"></a>01917       previndex = i;
<a name="l01918"></a>01918       <span class="keywordflow">while</span>((currtime-lowtime) &lt;= timebounds){
<a name="l01919"></a>01919      previndex = lowindex;
<a name="l01920"></a>01920      prevtime = lowtime;
<a name="l01921"></a>01921      
<a name="l01922"></a>01922      <span class="keywordflow">if</span> (lowindex == 0) <span class="keywordflow">break</span>;
<a name="l01923"></a>01923      lowindex--;
<a name="l01924"></a>01924      <span class="keywordflow">switch</span>(seqdatatype){
<a name="l01925"></a>01925      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l01926"></a>01926        lowtime = ((<span class="keywordtype">int</span>*)(seqcoords))[lowindex];
<a name="l01927"></a>01927        <span class="keywordflow">break</span>;
<a name="l01928"></a>01928      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l01929"></a>01929        lowtime = ((<span class="keywordtype">float</span>*)(seqcoords))[lowindex];
<a name="l01930"></a>01930        <span class="keywordflow">break</span>;
<a name="l01931"></a>01931      <span class="keywordflow">default</span>: <span class="comment">//know its a double</span>
<a name="l01932"></a>01932        lowtime = ((<span class="keywordtype">double</span>*)(seqcoords))[lowindex];
<a name="l01933"></a>01933        <span class="keywordflow">break</span>;
<a name="l01934"></a>01934      }
<a name="l01935"></a>01935       }
<a name="l01936"></a>01936       lowindex = previndex;
<a name="l01937"></a>01937       lowtime = prevtime;
<a name="l01938"></a>01938 
<a name="l01939"></a>01939       hightime = currtime;
<a name="l01940"></a>01940       highindex = i;
<a name="l01941"></a>01941       prevtime = currtime;
<a name="l01942"></a>01942       previndex = i;
<a name="l01943"></a>01943       <span class="keywordflow">while</span>((hightime-currtime) &lt;= timebounds){
<a name="l01944"></a>01944      previndex = highindex;
<a name="l01945"></a>01945      prevtime = hightime;
<a name="l01946"></a>01946      
<a name="l01947"></a>01947      <span class="keywordflow">if</span> (highindex == numStep -1) <span class="keywordflow">break</span>;
<a name="l01948"></a>01948      highindex++;
<a name="l01949"></a>01949      <span class="keywordflow">switch</span>(seqdatatype){
<a name="l01950"></a>01950      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l01951"></a>01951        hightime = ((<span class="keywordtype">int</span>*)(seqcoords))[highindex];
<a name="l01952"></a>01952        <span class="keywordflow">break</span>;
<a name="l01953"></a>01953      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l01954"></a>01954        hightime = ((<span class="keywordtype">float</span>*)(seqcoords))[highindex];
<a name="l01955"></a>01955        <span class="keywordflow">break</span>;
<a name="l01956"></a>01956      <span class="keywordflow">default</span>: <span class="comment">//know its a double</span>
<a name="l01957"></a>01957        hightime = ((<span class="keywordtype">double</span>*)(seqcoords))[highindex];
<a name="l01958"></a>01958        <span class="keywordflow">break</span>;
<a name="l01959"></a>01959      }
<a name="l01960"></a>01960       }
<a name="l01961"></a>01961 
<a name="l01962"></a>01962       highindex = previndex;
<a name="l01963"></a>01963       hightime = prevtime;
<a name="l01964"></a>01964     }
<a name="l01965"></a>01965 
<a name="l01966"></a>01966     <span class="comment">//now weve got valid indicie bounds for this step</span>
<a name="l01967"></a>01967     <span class="keywordflow">for</span> (j = 0; j &lt; numArrayVals; j++){
<a name="l01968"></a>01968       <span class="keywordflow">if</span> (newdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l01969"></a>01969      ((<span class="keywordtype">float</span>*)vwritedata)[j] = 0.0;
<a name="l01970"></a>01970       }<span class="keywordflow">else</span> {
<a name="l01971"></a>01971      ((<span class="keywordtype">double</span>*)vwritedata)[j] = 0.0;
<a name="l01972"></a>01972       }
<a name="l01973"></a>01973     }
<a name="l01974"></a>01974 
<a name="l01975"></a>01975     count = 0;
<a name="l01976"></a>01976     <span class="keywordflow">for</span> (j = lowindex; j &lt;= highindex ; j++){
<a name="l01977"></a>01977       <span class="keywordtype">void</span> *data;
<a name="l01978"></a>01978       <span class="keywordtype">int</span> k;
<a name="l01979"></a>01979 
<a name="l01980"></a>01980       rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(seqvar[j], &amp;data);
<a name="l01981"></a>01981       <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01982"></a>01982      data = NULL;
<a name="l01983"></a>01983      <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01984"></a>01984      free(*newseqvar);
<a name="l01985"></a>01985      *newseqvar=NULL;
<a name="l01986"></a>01986      free(vwritedata);
<a name="l01987"></a>01987      <span class="keywordflow">return</span> rc;
<a name="l01988"></a>01988       }
<a name="l01989"></a>01989 
<a name="l01990"></a>01990       <span class="keywordflow">for</span> (k = 0; k &lt; numArrayVals; k++){
<a name="l01991"></a>01991      <span class="keywordflow">switch</span>(datatype){
<a name="l01992"></a>01992      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l01993"></a>01993        ((<span class="keywordtype">double</span>*)vwritedata)[k] += ((<span class="keywordtype">int</span>*)data)[k];
<a name="l01994"></a>01994        <span class="keywordflow">break</span>;
<a name="l01995"></a>01995      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l01996"></a>01996        ((<span class="keywordtype">float</span>*)vwritedata)[k] += ((<span class="keywordtype">float</span>*)data)[k];
<a name="l01997"></a>01997        <span class="keywordflow">break</span>;
<a name="l01998"></a>01998      <span class="keywordflow">default</span>: <span class="comment">//knows its a double cause that was checked above</span>
<a name="l01999"></a>01999        ((<span class="keywordtype">double</span>*)vwritedata)[k] += ((<span class="keywordtype">double</span>*)data)[k];
<a name="l02000"></a>02000        <span class="keywordflow">break</span>;
<a name="l02001"></a>02001      }
<a name="l02002"></a>02002       }
<a name="l02003"></a>02003       count++;
<a name="l02004"></a>02004     } <span class="comment">//end for - over all those in range</span>
<a name="l02005"></a>02005 
<a name="l02006"></a>02006     <span class="keywordflow">for</span> (j = 0 ; j &lt; numArrayVals; j++){
<a name="l02007"></a>02007       <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l02008"></a>02008         ((<span class="keywordtype">float</span>*)vwritedata)[j] /= (float)count;
<a name="l02009"></a>02009       }<span class="keywordflow">else</span> {
<a name="l02010"></a>02010         ((<span class="keywordtype">double</span>*)vwritedata)[j] /= (double)count;
<a name="l02011"></a>02011       }
<a name="l02012"></a>02012     }
<a name="l02013"></a>02013 
<a name="l02014"></a>02014     rc = <a class="code" href="group__Variable.html#g3f958d3b630c9df78a4e7fbca287b039" title="Set the variable data by copy.">fc_setVariableData</a>((*newseqvar)[i], numDataPoint,
<a name="l02015"></a>02015                             numComponent, assoc, mathtype,
<a name="l02016"></a>02016                             newdatatype,vwritedata);
<a name="l02017"></a>02017     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02018"></a>02018       <span class="comment">//additional clean up</span>
<a name="l02019"></a>02019       <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l02020"></a>02020 
<a name="l02021"></a>02021       free(*newseqvar);
<a name="l02022"></a>02022       free(vwritedata);
<a name="l02023"></a>02023       *newseqvar=NULL;
<a name="l02024"></a>02024       <span class="keywordflow">return</span> rc;
<a name="l02025"></a>02025     }
<a name="l02026"></a>02026   } <span class="comment">// end for - timestep</span>
<a name="l02027"></a>02027 
<a name="l02028"></a>02028   free(vwritedata);
<a name="l02029"></a>02029 
<a name="l02030"></a>02030   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l02031"></a>02031 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ga548385126e393b9d35bac26ef46315c"></a><!-- doxytag: member="series.c::fc_dimensionlessAreaBetweenCurves" ref="ga548385126e393b9d35bac26ef46315c" args="(int numStep, FC_Variable *refseqvar, FC_Variable *compseqvar, char *varname, FC_Variable *newvar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_dimensionlessAreaBetweenCurves           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>refseqvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>compseqvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>newvar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return a handle to a var that is a dimensionless area between two curves traced out by sequence variables where y = seq var data value, x = sequence value (e.g., time). 
<p>
<b>Description:</b> <p>
Return a handle to a var that is a dimensionless area between two curves traced out by sequence variables where y = seq var data value, x = sequence value (e.g., time). This is defined: (1/(xrange*ref_fct_max))* (integral sqr(reference variable - comparison variable)<p>
This function is the formula used by Patrick Klein Note that that is the absolute max on the ref fct, not max absolute value, so its subject to the placement of the functions on the y axis. Note that the variables are not symmetric.<p>
Does a calc for each data point and each component separately. i.e. original seqvar has (numseriessteps*numdatapoint*numcomponent) dimensions; the result has numdatapoint*numcomponent) dimensions.<p>
This will return with an error if the seq is not monotonically increasing, if the seqvars are not numerical, or if the sequence has less than 2 points. The seq vars must be of the same mathtype, datatype, and association. For now seq vars must be on same mesh and same sequence.<p>
This will always return datatype FC_DT_DOUBLE<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000072">Todo:</a></b></dt><dd><ul>
<li>despite PK definition, should we go with max abs val on the ref fct, as opposed to just max val ? or some distance val that means things are not subject to where the functions are placed on the axis?</li></ul>
</dd></dl>
<b>Modifications:</b> <ul>
<li>4/26/05 ACG, Created</li><li>6/07/05 ACG revised to use new seqvar varmath functions</li><li>7/06/05 ACG name change</li><li>1/20/06 ACG error checking revisions </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - number of steps in the seq var </td></tr>
<tr><td valign="top"><em>refseqvar</em>&nbsp;</td><td>
input - reference seq var </td></tr>
<tr><td valign="top"><em>compseqvar</em>&nbsp;</td><td>
input - comparison seq var </td></tr>
<tr><td valign="top"><em>varname</em>&nbsp;</td><td>
input - name for averaged output var </td></tr>
<tr><td valign="top"><em>newvar</em>&nbsp;</td><td>
output - handle for output var </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="series_8c-source.html#l03021">3021</a> of file <a class="el" href="series_8c-source.html">series.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l06536">_fc_getVarSlot()</a>, <a class="el" href="variable_8c-source.html#l00286">fc_createVariable()</a>, <a class="el" href="util_8h-source.html#l00136">FC_DBL_EQUIV</a>, <a class="el" href="variable_8c-source.html#l05062">fc_deleteSeqVariable()</a>, <a class="el" href="variable_8c-source.html#l04980">fc_deleteVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="base_8h-source.html#l00105">FC_ERROR</a>, <a class="el" href="variable_8c-source.html#l05392">fc_getMeshFromVariable()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="variable_8c-source.html#l05317">fc_getSequenceFromSeqVariable()</a>, <a class="el" href="statistics_8c-source.html#l01753">fc_getSequenceMinMaxMono()</a>, <a class="el" href="statistics_8c-source.html#l01028">fc_getSeqVariableSeriesMinMax()</a>, <a class="el" href="variable_8c-source.html#l05715">fc_getVariableDataPtr()</a>, <a class="el" href="variable_8c-source.html#l05433">fc_getVariableInfo()</a>, <a class="el" href="base_8h-source.html#l00319">FC_HANDLE_EQUIV</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="series_8c-source.html#l02270">fc_integral_TR()</a>, <a class="el" href="variable_8c-source.html#l05178">fc_isSeqVariableValid()</a>, <a class="el" href="base_8c-source.html#l00779">FC_NULL_VARIABLE</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="varmath_8c-source.html#l00747">fc_seqVarOperatorSeqVar()</a>, <a class="el" href="variable_8c-source.html#l00604">fc_setVariableDataPtr()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="variableP_8h-source.html#l00075">_FC_VarSlot::header</a>, <a class="el" href="tableP_8h-source.html#l00100">_FC_SlotHeader::name</a>, and <a class="el" href="seriesAnalyzer_8c-source.html#l00102">numComponent</a>.</p>

<p>Referenced by <a class="el" href="seriesAnalyzer_8c-source.html#l00497">doDoubles()</a>, and <a class="el" href="seriesDemo_8c-source.html#l00075">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l03027"></a>03027  {
<a name="l03028"></a>03028   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc,rc1,rc2;
<a name="l03029"></a>03029   <a class="code" href="struct__FC__VarSlot.html" title="Variable Slot Structure for the Variable Table.">_FC_VarSlot</a> *varSlot1, *varSlot2;
<a name="l03030"></a>03030   <span class="keywordtype">int</span> numDataPoint1, numDataPoint2, numComponent1, numComponent2;
<a name="l03031"></a>03031   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc1, assoc2;
<a name="l03032"></a>03032   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype1, mathtype2;
<a name="l03033"></a>03033   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype1, datatype2;
<a name="l03034"></a>03034   <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> seq1, seq2;
<a name="l03035"></a>03035   <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> mesh1, mesh2;
<a name="l03036"></a>03036 
<a name="l03037"></a>03037   <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> mesh;
<a name="l03038"></a>03038   <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a> *diffvar, *prodvar, intvar;
<a name="l03039"></a>03039   <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a> minvar,maxvar,minindexvar,maxindexvar;
<a name="l03040"></a>03040   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype;
<a name="l03041"></a>03041   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc;
<a name="l03042"></a>03042   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype;
<a name="l03043"></a>03043   <span class="keywordtype">int</span> numDataPoint, <a class="code" href="seriesAnalyzer_8c.html#9ba814c62f21460639802c7771e86fa6">numComponent</a>;
<a name="l03044"></a>03044   <span class="keywordtype">double</span> *maxdata, *intdata, *writedata;
<a name="l03045"></a>03045   <span class="keywordtype">double</span> min,max;
<a name="l03046"></a>03046   <span class="keywordtype">int</span> minindex, maxindex,mono;
<a name="l03047"></a>03047   <span class="keywordtype">double</span> range;
<a name="l03048"></a>03048   <span class="keywordtype">int</span> i,j;
<a name="l03049"></a>03049 
<a name="l03050"></a>03050   <span class="keywordflow">if</span> (newvar)
<a name="l03051"></a>03051     *newvar = <a class="code" href="group__Handles.html#g82162b8ad3f5476855507c3c6450db09" title="Null (default) variable handle.">FC_NULL_VARIABLE</a>;
<a name="l03052"></a>03052 
<a name="l03053"></a>03053   <span class="keywordflow">if</span> (newvar == NULL || varname == NULL){
<a name="l03054"></a>03054     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l03055"></a>03055     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l03056"></a>03056   }
<a name="l03057"></a>03057 
<a name="l03058"></a>03058   <span class="keywordflow">if</span> ((!<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,refseqvar)) || 
<a name="l03059"></a>03059       (!<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,compseqvar))){
<a name="l03060"></a>03060     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l03061"></a>03061     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l03062"></a>03062   }
<a name="l03063"></a>03063 
<a name="l03064"></a>03064   <span class="comment">//check seqvars are compatible</span>
<a name="l03065"></a>03065   rc1 = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(refseqvar[0], &amp;numDataPoint1, &amp;numComponent1, &amp;assoc1,
<a name="l03066"></a>03066                           &amp;mathtype1, &amp;datatype1);
<a name="l03067"></a>03067   rc2 = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(compseqvar[0], &amp;numDataPoint2, &amp;numComponent2, &amp;assoc2,
<a name="l03068"></a>03068                            &amp;mathtype2, &amp;datatype2);
<a name="l03069"></a>03069   <span class="keywordflow">if</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> || rc2 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) 
<a name="l03070"></a>03070     <span class="keywordflow">return</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> ? rc1: rc2);
<a name="l03071"></a>03071 
<a name="l03072"></a>03072 
<a name="l03073"></a>03073   <span class="keywordflow">if</span> ((numDataPoint1 != numDataPoint2) ||
<a name="l03074"></a>03074       (numComponent1 != numComponent2) ||
<a name="l03075"></a>03075       (assoc1 != assoc2) ||
<a name="l03076"></a>03076       (mathtype1 != mathtype2) ||
<a name="l03077"></a>03077       (datatype1 != datatype2)){
<a name="l03078"></a>03078     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"seqvars not compatible"</span>);
<a name="l03079"></a>03079     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l03080"></a>03080   }
<a name="l03081"></a>03081 
<a name="l03082"></a>03082   <span class="comment">//check datatypes are right</span>
<a name="l03083"></a>03083   <span class="keywordflow">if</span> (!(datatype1 == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> || datatype1 == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l03084"></a>03084      datatype1 == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l03085"></a>03085       ){
<a name="l03086"></a>03086     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"seqvar data type not numerical"</span>);
<a name="l03087"></a>03087     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l03088"></a>03088   } 
<a name="l03089"></a>03089 
<a name="l03090"></a>03090   <span class="comment">//more checking seq vars compatible</span>
<a name="l03091"></a>03091   rc1 = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,refseqvar,&amp;seq1);
<a name="l03092"></a>03092   rc2 = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,compseqvar,&amp;seq2);
<a name="l03093"></a>03093   <span class="keywordflow">if</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> || rc2 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) 
<a name="l03094"></a>03094     <span class="keywordflow">return</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> ? rc1: rc2);
<a name="l03095"></a>03095 
<a name="l03096"></a>03096 
<a name="l03097"></a>03097   <span class="keywordflow">if</span> (!(<a class="code" href="group__Handles.html#g390004fca0870147d490f32c55afab8d" title="Check two handles for equality.">FC_HANDLE_EQUIV</a>(seq1,seq2))){
<a name="l03098"></a>03098     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"seqvars must be on same sequence"</span>);
<a name="l03099"></a>03099     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l03100"></a>03100   }
<a name="l03101"></a>03101 
<a name="l03102"></a>03102   <span class="keywordflow">if</span> (numStep &lt; 2){
<a name="l03103"></a>03103     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"seqvars must have at least 2 datapoints"</span>);
<a name="l03104"></a>03104     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l03105"></a>03105   }
<a name="l03106"></a>03106 
<a name="l03107"></a>03107   rc=<a class="code" href="group__Statistics.html#g31eedcdb364aa8ab2bdf2dde14c8bfbe" title="Returns min and max of a sequence and the indicies where they occur and returns monotonicity...">fc_getSequenceMinMaxMono</a>(seq1,&amp;min,&amp;minindex,&amp;max,&amp;maxindex,&amp;mono);
<a name="l03108"></a>03108   <span class="keywordflow">if</span> (rc !=<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l03109"></a>03109     <span class="keywordflow">return</span> rc;
<a name="l03110"></a>03110   }
<a name="l03111"></a>03111 
<a name="l03112"></a>03112   <span class="keywordflow">if</span> (mono != 1){
<a name="l03113"></a>03113     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"sequence must be monotonically increasing"</span>);
<a name="l03114"></a>03114     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>;
<a name="l03115"></a>03115   }
<a name="l03116"></a>03116 
<a name="l03117"></a>03117   range = max-min;
<a name="l03118"></a>03118   <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(range,0.0)){ <span class="comment">//check range here, check max &amp; max*range below</span>
<a name="l03119"></a>03119     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cant get area between zero range sequences"</span>);
<a name="l03120"></a>03120     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l03121"></a>03121   }
<a name="l03122"></a>03122 
<a name="l03123"></a>03123 
<a name="l03124"></a>03124   rc1 = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(refseqvar[0],&amp;mesh1);
<a name="l03125"></a>03125   rc2 = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(compseqvar[0],&amp;mesh2);
<a name="l03126"></a>03126   <span class="keywordflow">if</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> || rc2 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) 
<a name="l03127"></a>03127     <span class="keywordflow">return</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> ? rc1: rc2);
<a name="l03128"></a>03128 
<a name="l03129"></a>03129   <span class="keywordflow">if</span> (!(<a class="code" href="group__Handles.html#g390004fca0870147d490f32c55afab8d" title="Check two handles for equality.">FC_HANDLE_EQUIV</a>(mesh1,mesh2))){
<a name="l03130"></a>03130     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l03131"></a>03131   }
<a name="l03132"></a>03132 
<a name="l03133"></a>03133 
<a name="l03134"></a>03134   varSlot1 = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(refseqvar[0]);
<a name="l03135"></a>03135   varSlot2 = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(compseqvar[0]);
<a name="l03136"></a>03136   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Getting area between curves of seq variables '%s' '%s'"</span>,
<a name="l03137"></a>03137                       varSlot1-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>,varSlot2-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>);
<a name="l03138"></a>03138 
<a name="l03139"></a>03139   varSlot1 = NULL;
<a name="l03140"></a>03140   varSlot2 = NULL;
<a name="l03141"></a>03141 
<a name="l03142"></a>03142   rc = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(refseqvar[0],&amp;numDataPoint, &amp;numComponent,
<a name="l03143"></a>03143                           &amp;assoc,&amp;mathtype, &amp;datatype);
<a name="l03144"></a>03144   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l03145"></a>03145     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cant get info on ref variable"</span>);
<a name="l03146"></a>03146     <span class="keywordflow">return</span> rc;
<a name="l03147"></a>03147   }
<a name="l03148"></a>03148 
<a name="l03149"></a>03149   
<a name="l03150"></a>03150   <span class="comment">// now get max of ref fcnt and make sure it is non zero....</span>
<a name="l03151"></a>03151   rc =  <a class="code" href="group__Statistics.html#g8f565e977a0909545d87bb33bc7bd6f6" title="Find min &amp;amp; max data values of a sequence variable across its sequence (series)...">fc_getSeqVariableSeriesMinMax</a>(numStep, refseqvar,&amp;minvar,
<a name="l03152"></a>03152                           &amp;maxvar, &amp;minindexvar,&amp;maxindexvar);
<a name="l03153"></a>03153   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l03154"></a>03154     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cant get min max of ref variable"</span>);
<a name="l03155"></a>03155     <span class="keywordflow">return</span> rc;
<a name="l03156"></a>03156   }
<a name="l03157"></a>03157   
<a name="l03158"></a>03158   rc=<a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(minvar);
<a name="l03159"></a>03159   rc=<a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(minindexvar);
<a name="l03160"></a>03160   rc=<a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(maxindexvar);
<a name="l03161"></a>03161 
<a name="l03162"></a>03162   rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(maxvar,(<span class="keywordtype">void</span>**)&amp;maxdata);
<a name="l03163"></a>03163   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l03164"></a>03164     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cant get max data"</span>);
<a name="l03165"></a>03165     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(maxvar);
<a name="l03166"></a>03166     <span class="keywordflow">return</span> rc;
<a name="l03167"></a>03167   }
<a name="l03168"></a>03168 
<a name="l03169"></a>03169 
<a name="l03170"></a>03170   <span class="comment">//its a shame to loop thru these twice but it will save</span>
<a name="l03171"></a>03171   <span class="comment">//work below if there is a problem discoverable now.</span>
<a name="l03172"></a>03172   <span class="keywordflow">for</span> (i = 0; i &lt; numDataPoint; i++){
<a name="l03173"></a>03173     <span class="keywordflow">for</span> (j = 0; j &lt; numComponent; j++){
<a name="l03174"></a>03174       <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(maxdata[numComponent*i+j],0.0) || 
<a name="l03175"></a>03175        <a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(maxdata[numComponent*i+j]*range,0.0)){
<a name="l03176"></a>03176         <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cant normalize by zero max function or max*range"</span>);
<a name="l03177"></a>03177         <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(maxvar);
<a name="l03178"></a>03178         <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>;
<a name="l03179"></a>03179       }
<a name="l03180"></a>03180     }
<a name="l03181"></a>03181   }
<a name="l03182"></a>03182 
<a name="l03183"></a>03183   <span class="comment">//now get the difference between the seq vars</span>
<a name="l03184"></a>03184   rc = <a class="code" href="group__VariableMath.html#gcd6c90529e251e21ec0eb9fc7fb3b788" title="Performs built-in binary operation on two seq variables.">fc_seqVarOperatorSeqVar</a>(numStep,refseqvar,<span class="stringliteral">"-"</span>,compseqvar,
<a name="l03185"></a>03185                                    <span class="stringliteral">"fc_junk_diff_var"</span>, &amp;diffvar);
<a name="l03186"></a>03186   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l03187"></a>03187     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cannot get diff between two sequnces"</span>);
<a name="l03188"></a>03188     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(maxvar);
<a name="l03189"></a>03189     <span class="keywordflow">return</span> rc;
<a name="l03190"></a>03190   }
<a name="l03191"></a>03191 
<a name="l03192"></a>03192   <span class="comment">//now square it</span>
<a name="l03193"></a>03193   rc = <a class="code" href="group__VariableMath.html#gcd6c90529e251e21ec0eb9fc7fb3b788" title="Performs built-in binary operation on two seq variables.">fc_seqVarOperatorSeqVar</a>(numStep,diffvar,<span class="stringliteral">"*"</span>,diffvar,
<a name="l03194"></a>03194                                    <span class="stringliteral">"fc_junk_prod_var"</span>, &amp;prodvar);
<a name="l03195"></a>03195   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l03196"></a>03196     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cannot get square"</span>);
<a name="l03197"></a>03197     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(maxvar);
<a name="l03198"></a>03198     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,diffvar);
<a name="l03199"></a>03199     free(diffvar);
<a name="l03200"></a>03200     <span class="keywordflow">return</span> rc;
<a name="l03201"></a>03201   }
<a name="l03202"></a>03202   rc =  <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,diffvar);
<a name="l03203"></a>03203   free(diffvar);
<a name="l03204"></a>03204 
<a name="l03205"></a>03205   <span class="comment">//now integrate it - returns doubles. no longer a seq var</span>
<a name="l03206"></a>03206   rc = <a class="code" href="group__Series.html#gb8a16c59d79c57324b21669241b9101f" title="Return a handle to a var that is the integral of an existing seqvar over its sequence...">fc_integral_TR</a>(numStep,prodvar,<span class="stringliteral">"fc_junk_int_var"</span>,
<a name="l03207"></a>03207                                 &amp;intvar);
<a name="l03208"></a>03208   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l03209"></a>03209     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cannot get integral"</span>);
<a name="l03210"></a>03210     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(maxvar);
<a name="l03211"></a>03211     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,prodvar);
<a name="l03212"></a>03212     free(prodvar);
<a name="l03213"></a>03213     <span class="keywordflow">return</span> rc;
<a name="l03214"></a>03214   }
<a name="l03215"></a>03215   rc =  <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,prodvar);
<a name="l03216"></a>03216   free(prodvar);
<a name="l03217"></a>03217 
<a name="l03218"></a>03218 
<a name="l03219"></a>03219   <span class="comment">//now do calc</span>
<a name="l03220"></a>03220   <span class="comment">//still have maxdataptr</span>
<a name="l03221"></a>03221 
<a name="l03222"></a>03222   rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(intvar,(<span class="keywordtype">void</span>**)&amp;intdata);
<a name="l03223"></a>03223   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l03224"></a>03224     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cant get integral data"</span>);
<a name="l03225"></a>03225     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(maxvar);
<a name="l03226"></a>03226     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(intvar);
<a name="l03227"></a>03227     <span class="keywordflow">return</span> rc;
<a name="l03228"></a>03228   }
<a name="l03229"></a>03229 
<a name="l03230"></a>03230   writedata = (<span class="keywordtype">double</span>*) malloc(numDataPoint*numComponent*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l03231"></a>03231 
<a name="l03232"></a>03232   <span class="keywordflow">for</span> (i = 0; i &lt; numDataPoint; i++){
<a name="l03233"></a>03233     <span class="keywordflow">for</span> (j = 0; j &lt; numComponent; j++){
<a name="l03234"></a>03234       <span class="comment">//have already checked for divide by zero</span>
<a name="l03235"></a>03235       <span class="comment">//      printf("int %10g max %10g range %10g\n",intdata[numComponent*i+j],</span>
<a name="l03236"></a>03236       <span class="comment">//       maxdata[numComponent*i+j],range);</span>
<a name="l03237"></a>03237       writedata[numComponent*i+j] = intdata[numComponent*i+j]/
<a name="l03238"></a>03238                           (maxdata[numComponent*i+j]*range);
<a name="l03239"></a>03239     }
<a name="l03240"></a>03240   }
<a name="l03241"></a>03241 
<a name="l03242"></a>03242   <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(maxvar);
<a name="l03243"></a>03243   <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(intvar);
<a name="l03244"></a>03244 
<a name="l03245"></a>03245   <span class="comment">//assign data to variable</span>
<a name="l03246"></a>03246   rc = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(refseqvar[0],&amp;mesh);
<a name="l03247"></a>03247   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l03248"></a>03248     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(rc));
<a name="l03249"></a>03249     free (writedata);
<a name="l03250"></a>03250     <span class="keywordflow">return</span> rc;
<a name="l03251"></a>03251   }
<a name="l03252"></a>03252 
<a name="l03253"></a>03253   rc = <a class="code" href="group__Variable.html#ga2ffd025a786dbe93fc7f8defb969631" title="Create a new variable.">fc_createVariable</a>(mesh,varname,newvar);
<a name="l03254"></a>03254   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l03255"></a>03255     free(writedata);
<a name="l03256"></a>03256     <span class="keywordflow">return</span> rc;
<a name="l03257"></a>03257   }
<a name="l03258"></a>03258 
<a name="l03259"></a>03259   rc = <a class="code" href="group__Variable.html#g87015cda75e038cc73c1d584537d81fc" title="Set the pointer to the variable data.">fc_setVariableDataPtr</a>(*newvar,numDataPoint, numComponent,
<a name="l03260"></a>03260                              assoc,mathtype,<a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>,writedata);
<a name="l03261"></a>03261   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l03262"></a>03262     <span class="keywordflow">if</span> (writedata) free (writedata);
<a name="l03263"></a>03263     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(*newvar);
<a name="l03264"></a>03264     <span class="keywordflow">return</span> rc;
<a name="l03265"></a>03265   }
<a name="l03266"></a>03266 
<a name="l03267"></a>03267   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l03268"></a>03268 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="gb7813df0d0b243c012c0fa294eb96bec"></a><!-- doxytag: member="series.c::fc_euclideanDistanceBetweenCurves" ref="gb7813df0d0b243c012c0fa294eb96bec" args="(int numStep, FC_Variable *seqvar1, FC_Variable *seqvar2, char *varname, FC_Variable *newvar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_euclideanDistanceBetweenCurves           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>seqvar1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>seqvar2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>newvar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return a handle to a var that is the euclidean distance between two curves traced out by sequence variables where y = seq var data value, x = sequence value (e.g., time). 
<p>
<b>Description:</b> <p>
Return a handle to a var that is the euclidean distance between two curves traced out by sequence variables where y = seq var data value, x = sequence value (e.g., time). NOTE: this is not normalized in any way (ie, it is dependent upon the number of data points and the spacing) Does a distance calc for each data point and each component separately. i.e. original seqvar has (numseriessteps*numdatapoint*numcomponent) dimensions; the result has numdatapoint*numcomponent) dimensions.<p>
Always returns datatype FC_DT_DOUBLE.<p>
This will return with an error if the seqvars are not numerical. The seq vars must be of the same mathtype, datatype, and association. For now seq vars must be on same mesh and same sequence.<p>
This does *not* check that the sequence is a function. This does *not* check that the sequence is monotonically increasing.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000071">Todo:</a></b></dt><dd></dd></dl>
<ul>
<li>In future may want to see about issues if the time pts arent regular.</li><li>Also may want to relax constraint of same mesh and same sequence - there are issues here however (comparing things disjoint in time etc).</li><li>Had changed this to each component separately - see if there is a reason to want to combine them.</li><li>should it check if the sequence is a fucntion ?</li><li>should it check if the sequence is monotonically increasing ?</li></ul>
<p>
<b>Modifications:</b> <ul>
<li>1/14/05 ACG, Created</li><li>4/25/05 ACG changed to use new functions fc_calcSeqVarUnaryFunction and fc_calcSeqVarBinaryFunction</li><li>4/26/05 ACG because using fc_getSeqVariableTimeSum return type must always be double.</li><li>6/07/05 ACG replaced calls to fc_calcSeqVarUnaryFunction and fc_calcSeqVarBinaryFunction with calls to appropriate seqvar functions in varmath</li><li>7/06/05 ACG name change </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - number of steps in the seq var </td></tr>
<tr><td valign="top"><em>seqvar1</em>&nbsp;</td><td>
input - 1st seq var </td></tr>
<tr><td valign="top"><em>seqvar2</em>&nbsp;</td><td>
input - 2nd seq var </td></tr>
<tr><td valign="top"><em>varname</em>&nbsp;</td><td>
input - name for averaged output var </td></tr>
<tr><td valign="top"><em>newvar</em>&nbsp;</td><td>
output - handle for output var </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="series_8c-source.html#l02844">2844</a> of file <a class="el" href="series_8c-source.html">series.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l06536">_fc_getVarSlot()</a>, <a class="el" href="variable_8c-source.html#l05062">fc_deleteSeqVariable()</a>, <a class="el" href="variable_8c-source.html#l04980">fc_deleteVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="variable_8c-source.html#l05392">fc_getMeshFromVariable()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="variable_8c-source.html#l05317">fc_getSequenceFromSeqVariable()</a>, <a class="el" href="statistics_8c-source.html#l01584">fc_getSeqVariableSeriesSum()</a>, <a class="el" href="variable_8c-source.html#l05433">fc_getVariableInfo()</a>, <a class="el" href="base_8h-source.html#l00319">FC_HANDLE_EQUIV</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="variable_8c-source.html#l05178">fc_isSeqVariableValid()</a>, <a class="el" href="base_8c-source.html#l00779">FC_NULL_VARIABLE</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="varmath_8c-source.html#l00747">fc_seqVarOperatorSeqVar()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="varmath_8c-source.html#l01485">fc_varUnaryFunction()</a>, <a class="el" href="variableP_8h-source.html#l00075">_FC_VarSlot::header</a>, and <a class="el" href="tableP_8h-source.html#l00100">_FC_SlotHeader::name</a>.</p>

<p>Referenced by <a class="el" href="seriesAnalyzer_8c-source.html#l00497">doDoubles()</a>, and <a class="el" href="seriesDemo_8c-source.html#l00075">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02850"></a>02850  {
<a name="l02851"></a>02851   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc,rc1,rc2;
<a name="l02852"></a>02852   <a class="code" href="struct__FC__VarSlot.html" title="Variable Slot Structure for the Variable Table.">_FC_VarSlot</a> *varSlot1, *varSlot2;
<a name="l02853"></a>02853   <span class="keywordtype">int</span> numDataPoint1, numDataPoint2, numComponent1, numComponent2;
<a name="l02854"></a>02854   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc1, assoc2;
<a name="l02855"></a>02855   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype1, mathtype2;
<a name="l02856"></a>02856   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype1, datatype2;
<a name="l02857"></a>02857   <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> seq1, seq2;
<a name="l02858"></a>02858   <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> mesh1, mesh2;
<a name="l02859"></a>02859 
<a name="l02860"></a>02860   <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a> *diffvar, *prodvar;
<a name="l02861"></a>02861   <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a> sumvar;
<a name="l02862"></a>02862 
<a name="l02863"></a>02863 
<a name="l02864"></a>02864   <span class="keywordflow">if</span> (newvar)
<a name="l02865"></a>02865     *newvar = <a class="code" href="group__Handles.html#g82162b8ad3f5476855507c3c6450db09" title="Null (default) variable handle.">FC_NULL_VARIABLE</a>;
<a name="l02866"></a>02866 
<a name="l02867"></a>02867   <span class="keywordflow">if</span> (newvar == NULL || varname == NULL ||
<a name="l02868"></a>02868       !<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,seqvar1) ||
<a name="l02869"></a>02869       !<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,seqvar2)){
<a name="l02870"></a>02870     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l02871"></a>02871     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02872"></a>02872   }
<a name="l02873"></a>02873 
<a name="l02874"></a>02874   <span class="comment">//check seqvars are compatible</span>
<a name="l02875"></a>02875   rc1 = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(seqvar1[0], &amp;numDataPoint1, &amp;numComponent1, &amp;assoc1,
<a name="l02876"></a>02876                           &amp;mathtype1, &amp;datatype1);
<a name="l02877"></a>02877   rc2 = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(seqvar2[0], &amp;numDataPoint2, &amp;numComponent2, &amp;assoc2,
<a name="l02878"></a>02878                            &amp;mathtype2, &amp;datatype2);
<a name="l02879"></a>02879   <span class="keywordflow">if</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> || rc2 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l02880"></a>02880     <span class="keywordflow">return</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> ? rc1: rc2);
<a name="l02881"></a>02881 
<a name="l02882"></a>02882   <span class="keywordflow">if</span> ((numDataPoint1 != numDataPoint2) ||
<a name="l02883"></a>02883       (numComponent1 != numComponent2) ||
<a name="l02884"></a>02884       (assoc1 != assoc2) ||
<a name="l02885"></a>02885       (mathtype1 != mathtype2) ||
<a name="l02886"></a>02886       (datatype1 != datatype2)){
<a name="l02887"></a>02887     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"Mismatch in seqvar info"</span>);
<a name="l02888"></a>02888     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02889"></a>02889   }
<a name="l02890"></a>02890 
<a name="l02891"></a>02891   <span class="comment">//check datatypes are right</span>
<a name="l02892"></a>02892   <span class="keywordflow">if</span> (!(datatype1 == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l02893"></a>02893         datatype1 == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l02894"></a>02894         datatype1 == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l02895"></a>02895       ){
<a name="l02896"></a>02896     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"seqvars are not numerical"</span>);
<a name="l02897"></a>02897     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02898"></a>02898   } 
<a name="l02899"></a>02899 
<a name="l02900"></a>02900   <span class="comment">//more checking seq vars compatible</span>
<a name="l02901"></a>02901   rc1 = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,seqvar1,&amp;seq1);
<a name="l02902"></a>02902   rc2 = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,seqvar2,&amp;seq2);  
<a name="l02903"></a>02903   <span class="keywordflow">if</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> || rc2 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l02904"></a>02904     <span class="keywordflow">return</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> ? rc1: rc2);
<a name="l02905"></a>02905 
<a name="l02906"></a>02906   <span class="keywordflow">if</span> (!(<a class="code" href="group__Handles.html#g390004fca0870147d490f32c55afab8d" title="Check two handles for equality.">FC_HANDLE_EQUIV</a>(seq1,seq2))){
<a name="l02907"></a>02907     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"seq vars must be on same seq"</span>);
<a name="l02908"></a>02908     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02909"></a>02909   }
<a name="l02910"></a>02910 
<a name="l02911"></a>02911 
<a name="l02912"></a>02912   rc1 = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(seqvar1[0],&amp;mesh1);
<a name="l02913"></a>02913   rc2 = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(seqvar2[0],&amp;mesh2);
<a name="l02914"></a>02914   <span class="keywordflow">if</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> || rc2 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l02915"></a>02915     <span class="keywordflow">return</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> ? rc1: rc2);
<a name="l02916"></a>02916 
<a name="l02917"></a>02917   <span class="keywordflow">if</span> (!(<a class="code" href="group__Handles.html#g390004fca0870147d490f32c55afab8d" title="Check two handles for equality.">FC_HANDLE_EQUIV</a>(mesh1,mesh2))){
<a name="l02918"></a>02918     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"seq vars must be on same mesh"</span>);
<a name="l02919"></a>02919     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02920"></a>02920   }
<a name="l02921"></a>02921 
<a name="l02922"></a>02922   varSlot1 = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(seqvar1[0]);
<a name="l02923"></a>02923   varSlot2 = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(seqvar2[0]);
<a name="l02924"></a>02924   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Getting euclidean distance for seq variables '%s' '%s'"</span>,
<a name="l02925"></a>02925                       varSlot1-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>,varSlot2-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>);
<a name="l02926"></a>02926 
<a name="l02927"></a>02927   varSlot1 = NULL;
<a name="l02928"></a>02928   varSlot2 = NULL;
<a name="l02929"></a>02929 
<a name="l02930"></a>02930 
<a name="l02931"></a>02931   <span class="comment">//first get the difference between the seq vars</span>
<a name="l02932"></a>02932   rc = <a class="code" href="group__VariableMath.html#gcd6c90529e251e21ec0eb9fc7fb3b788" title="Performs built-in binary operation on two seq variables.">fc_seqVarOperatorSeqVar</a>(numStep,seqvar1,<span class="stringliteral">"-"</span>,seqvar2,
<a name="l02933"></a>02933                                    <span class="stringliteral">"fc_junk_diff_var"</span>, &amp;diffvar);
<a name="l02934"></a>02934   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02935"></a>02935     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cannot get diff between two sequnces"</span>);
<a name="l02936"></a>02936     <span class="keywordflow">return</span> rc;
<a name="l02937"></a>02937   }
<a name="l02938"></a>02938 
<a name="l02939"></a>02939   <span class="comment">//now square it </span>
<a name="l02940"></a>02940   rc = <a class="code" href="group__VariableMath.html#gcd6c90529e251e21ec0eb9fc7fb3b788" title="Performs built-in binary operation on two seq variables.">fc_seqVarOperatorSeqVar</a>(numStep,diffvar,<span class="stringliteral">"*"</span>,diffvar,
<a name="l02941"></a>02941                                    <span class="stringliteral">"fc_junk_diff_var"</span>, &amp;prodvar);
<a name="l02942"></a>02942   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02943"></a>02943     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cannot get diff between two sequnces"</span>);
<a name="l02944"></a>02944     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,diffvar);
<a name="l02945"></a>02945     free(diffvar);
<a name="l02946"></a>02946     <span class="keywordflow">return</span> rc;
<a name="l02947"></a>02947   }
<a name="l02948"></a>02948   rc =  <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,diffvar);
<a name="l02949"></a>02949   free(diffvar);
<a name="l02950"></a>02950     
<a name="l02951"></a>02951   <span class="comment">//now sum each data point and each component over time</span>
<a name="l02952"></a>02952   <span class="comment">// returns doubles</span>
<a name="l02953"></a>02953   rc = <a class="code" href="group__Statistics.html#gaa272ae4e4388ae2291cf0aaf3e378ea" title="Compute sum of all data values of a sequence variable across its sequence (series)...">fc_getSeqVariableSeriesSum</a> (numStep, prodvar, &amp;sumvar);
<a name="l02954"></a>02954   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02955"></a>02955     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cannot get series sum"</span>);
<a name="l02956"></a>02956     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,prodvar);
<a name="l02957"></a>02957     free(prodvar);
<a name="l02958"></a>02958     <span class="keywordflow">return</span> rc;
<a name="l02959"></a>02959   }
<a name="l02960"></a>02960   rc = <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,prodvar);
<a name="l02961"></a>02961   free(prodvar);
<a name="l02962"></a>02962 
<a name="l02963"></a>02963   <span class="comment">//now need sqrt of the series sum</span>
<a name="l02964"></a>02964   rc = <a class="code" href="group__VariableMath.html#gc65fff664346c952a3271574679f9665" title="Performs unary function on a variable.">fc_varUnaryFunction</a>(sumvar, sqrt, varname, newvar);
<a name="l02965"></a>02965   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02966"></a>02966     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"cannot get sqrt of var"</span>);
<a name="l02967"></a>02967     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(sumvar);
<a name="l02968"></a>02968     <span class="keywordflow">return</span> rc;
<a name="l02969"></a>02969   }
<a name="l02970"></a>02970 
<a name="l02971"></a>02971   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l02972"></a>02972 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="g2b524f404caa2acb1fd25efac6ee1b59"></a><!-- doxytag: member="series.c::fc_firstDerivative_REA" ref="g2b524f404caa2acb1fd25efac6ee1b59" args="(int numStep, FC_Variable *seqvar, double ueps, char *varname, FC_Variable **newseqvar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_firstDerivative_REA           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>seqvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>ueps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> **&nbsp;</td>
          <td class="paramname"> <em>newseqvar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return a handle to a seqvar that is the first derivative of an existing seqvar calulated using the Richardson Extrapolation Approximation. 
<p>
<b>Description:</b> <p>
Return a handle to a seqvar that is the first derivative of an existing seqvar calulated using the Richardson Extrapolation Approximation.The sequence must be regularly spaced.<p>
f'(x) = (f(x-2h)-8f(x-h)+8f(x+h)-f(x+2h))/12h. where h is the regular spacing.<p>
There must be at least 5 steps in the sequence. Return vals for the first 2 and last 2 pts in the series will be zero.<p>
Does calc for each data point and each component separately. i.e. original seqvar has (numseriessteps*numdatapoint*numcomponent) dimensions; the result has numdatapoint*numcomponent) dimensions.<p>
This will return with an error if the seqvar is not numerical. This will return with an error if the seq is not regularly increasingly spaced. User can pass tolerance in. If user passes in zero it defaults to (type)_EPS<p>
If either the sequence datatype or the value datatype is FC_DT_FLOAT, then the return value is datatype FC_DT_FLOAT; otherwise it is FC_DT_DOUBLE;<p>
NOTE: This method is really not recommended for floats becuase of roundoff error.<p>
NOTE: becuase this allocates memory for seq var, user must call deleteSeqVar *and* free, unless delete gets changed.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000063">Todo:</a></b></dt><dd><ul>
<li>THIS IS NOT CHEKCED FOR MULTIPLE DP, MULTIPLE COMPONENT</li><li>pass tolerance parameter IS NOT CHECKED</li><li>see if reg spacing criteria works ok for most real life cases.</li><li>can this be made more robust for floats (esp determining irregualr sequence ?)</li><li>is this the methodolgy we want ? (REA)</li><li>check out higher order derivative methods</li></ul>
</dd></dl>
<b>Modifications:</b> <ul>
<li>07/05/05 ACG, Created</li><li>07/27/05 ACG added user passes in tolerance</li><li>01/09/06 ACG changing/removing handling/cleanup in case of datatype error at WSK recommendation since it skews the coverage testing. Either there is already an explict type check or if those lines are reached you've got serious errors and the cleanup doesnt matter.</li><li>01/12/06 ACG cleaned up, esp wrt writeout arrays </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - number of steps in the seq var </td></tr>
<tr><td valign="top"><em>seqvar</em>&nbsp;</td><td>
input - seq var differnetiating </td></tr>
<tr><td valign="top"><em>ueps</em>&nbsp;</td><td>
input - user pass in tolerance </td></tr>
<tr><td valign="top"><em>varname</em>&nbsp;</td><td>
input - name for averaged output var </td></tr>
<tr><td valign="top"><em>newseqvar</em>&nbsp;</td><td>
output - handle for output var </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="series_8c-source.html#l00676">676</a> of file <a class="el" href="series_8c-source.html">series.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l06536">_fc_getVarSlot()</a>, <a class="el" href="series_8c-source.html#l00122">_fc_makeNewSeqVar()</a>, <a class="el" href="util_8h-source.html#l00136">FC_DBL_EQUIV</a>, <a class="el" href="variable_8c-source.html#l05062">fc_deleteSeqVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="util_8h-source.html#l00111">FC_FLT_EQUIV</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="sequence_8c-source.html#l01687">fc_getSequenceDataType()</a>, <a class="el" href="variable_8c-source.html#l05317">fc_getSequenceFromSeqVariable()</a>, <a class="el" href="statistics_8c-source.html#l01951">fc_getSequenceSpacingMinMaxMeanSdev()</a>, <a class="el" href="variable_8c-source.html#l05715">fc_getVariableDataPtr()</a>, <a class="el" href="variable_8c-source.html#l05498">fc_getVariableDataType()</a>, <a class="el" href="variable_8c-source.html#l05433">fc_getVariableInfo()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="variable_8c-source.html#l05178">fc_isSeqVariableValid()</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="variable_8c-source.html#l00469">fc_setVariableData()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="util_8h-source.html#l00085">FC_VALUE_EQUIV</a>, <a class="el" href="variableP_8h-source.html#l00075">_FC_VarSlot::header</a>, <a class="el" href="tableP_8h-source.html#l00100">_FC_SlotHeader::name</a>, and <a class="el" href="seriesAnalyzer_8c-source.html#l00102">numComponent</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00682"></a>00682       {
<a name="l00683"></a>00683   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l00684"></a>00684   <a class="code" href="struct__FC__VarSlot.html" title="Variable Slot Structure for the Variable Table.">_FC_VarSlot</a>* varSlot;
<a name="l00685"></a>00685   <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> seq;
<a name="l00686"></a>00686   <span class="keywordtype">int</span> numDataPoint, <a class="code" href="seriesAnalyzer_8c.html#9ba814c62f21460639802c7771e86fa6">numComponent</a>, numArrayVals;
<a name="l00687"></a>00687   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc;
<a name="l00688"></a>00688   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype;
<a name="l00689"></a>00689   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype, seqdatatype, newdatatype;
<a name="l00690"></a>00690   <span class="keywordtype">double</span> dh;
<a name="l00691"></a>00691   <span class="keywordtype">float</span> fh;
<a name="l00692"></a>00692   <span class="keywordtype">void</span> *calcdata, *writedata;
<a name="l00693"></a>00693   <span class="keywordtype">double</span>  ssmax, ssmin, ssmean, sssdev,tol;
<a name="l00694"></a>00694   <span class="keywordtype">int</span> i,j, count;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696   <span class="keywordflow">if</span> (newseqvar)
<a name="l00697"></a>00697     *newseqvar = NULL;
<a name="l00698"></a>00698 
<a name="l00699"></a>00699   <span class="comment">//will check below to see that its appropriate numerical type</span>
<a name="l00700"></a>00700   <span class="keywordflow">if</span> ((!<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,seqvar)) ||  !varname || !newseqvar){
<a name="l00701"></a>00701     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l00702"></a>00702     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00703"></a>00703   };
<a name="l00704"></a>00704 
<a name="l00705"></a>00705 
<a name="l00706"></a>00706   varSlot = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(seqvar[0]);
<a name="l00707"></a>00707   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Getting first derivative for seq variable '%s'"</span>,
<a name="l00708"></a>00708                       varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>);
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 
<a name="l00711"></a>00711   rc = <a class="code" href="group__Variable.html#gd3b7cecfd0c6d488e82b426b4c114aba" title="Return the data type of a variable.">fc_getVariableDataType</a>(seqvar[0],&amp;datatype);
<a name="l00712"></a>00712   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) 
<a name="l00713"></a>00713     <span class="keywordflow">return</span> rc;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715   <span class="keywordflow">if</span> (!(datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l00716"></a>00716         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l00717"></a>00717         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l00718"></a>00718       ){
<a name="l00719"></a>00719     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"seqvar is not numerical"</span>);
<a name="l00720"></a>00720     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00721"></a>00721   } 
<a name="l00722"></a>00722 
<a name="l00723"></a>00723   <span class="keywordflow">if</span> (numStep &lt; 5){
<a name="l00724"></a>00724     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"seqvar is too short"</span>);
<a name="l00725"></a>00725     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00726"></a>00726   }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728 
<a name="l00729"></a>00729   rc = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,seqvar,&amp;seq);
<a name="l00730"></a>00730   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) 
<a name="l00731"></a>00731     <span class="keywordflow">return</span> rc;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733   rc = <a class="code" href="group__Sequence.html#g6d5a8a30edd00c973804c7ce31a3a2e6" title="Get the data type of a sequence&amp;#39;s coordinates.">fc_getSequenceDataType</a>(seq,&amp;seqdatatype);
<a name="l00734"></a>00734   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) 
<a name="l00735"></a>00735     <span class="keywordflow">return</span> rc;
<a name="l00736"></a>00736 
<a name="l00737"></a>00737   <span class="keywordflow">if</span> (seqdatatype != <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> &amp;&amp; seqdatatype != <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> &amp;&amp;
<a name="l00738"></a>00738       seqdatatype != <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>){
<a name="l00739"></a>00739     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"seq data type non numerical"</span>);
<a name="l00740"></a>00740     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00741"></a>00741   }
<a name="l00742"></a>00742 
<a name="l00743"></a>00743   newdatatype = (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> || seqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>) ?
<a name="l00744"></a>00744     <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>: <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>;
<a name="l00745"></a>00745 
<a name="l00746"></a>00746 
<a name="l00747"></a>00747   rc = <a class="code" href="group__Statistics.html#g8f24c59a1f5d8641fb877b6d9631c0f5" title="Returns min, max, mean, and std of spacing of a sequence. Returns indicies of the...">fc_getSequenceSpacingMinMaxMeanSdev</a>(seq,&amp;ssmin,&amp;i,
<a name="l00748"></a>00748                                            &amp;ssmax,&amp;j,&amp;ssmean,&amp;sssdev);
<a name="l00749"></a>00749   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00750"></a>00750     <span class="keywordflow">return</span> rc;
<a name="l00751"></a>00751 
<a name="l00752"></a>00752   <span class="comment">//also need sequence to be monotonically increasing. rather than do mono check</span>
<a name="l00753"></a>00753   <span class="comment">//since will use mean as spacing, just check that the mean is positive.</span>
<a name="l00754"></a>00754   <span class="comment">// checks below will make sure that it is regular. these two</span>
<a name="l00755"></a>00755   <span class="comment">//together will guarentee that the spacing is good enuf</span>
<a name="l00756"></a>00756   <span class="keywordflow">if</span> (ssmean  &lt; 0){
<a name="l00757"></a>00757     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"sequence is not monotonically increasing"</span>);
<a name="l00758"></a>00758     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00759"></a>00759   }
<a name="l00760"></a>00760   
<a name="l00761"></a>00761   <span class="comment">//  printf("\nmin %10.8g max %10.8g  mean %10.8g sdev %10.8g max-min %10.8g max-mean %10.8g</span>
<a name="l00762"></a>00762   <span class="comment">// min-mean %10.8g sc(max-min) %10.8g sc(max-mean) %10.8g sc(min-mean) %10.8g\n",</span>
<a name="l00763"></a>00763   <span class="comment">//     ssmin,ssmax,ssmean,sssdev, ssmax-ssmin, ssmax-ssmean, ssmin-ssmean, (ssmax-ssmin)/ssmax,</span>
<a name="l00764"></a>00764   <span class="comment">//     (ssmax-ssmean)/ssmax, (ssmin-ssmean)/ssmean);</span>
<a name="l00765"></a>00765 
<a name="l00766"></a>00766 
<a name="l00767"></a>00767 
<a name="l00768"></a>00768   <span class="comment">//check for regular spacing - may have to adjust these constraints later</span>
<a name="l00769"></a>00769   <span class="keywordflow">if</span> (seqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l00770"></a>00770     tol = FLT_EPSILON;
<a name="l00771"></a>00771     <span class="keywordflow">if</span> (ueps &gt; tol) tol = ueps;
<a name="l00772"></a>00772     <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g66e4000738f924f4e7a1c1837d877cf2" title="Test equality of floating point numbers.">FC_VALUE_EQUIV</a>(ssmin,ssmax,tol,FLT_MIN)  || <a class="code" href="group__PublicFloatingPoint.html#g564c35a50d7fa88019003ccfb2bbff97" title="Test equality of two values with float precision.">FC_FLT_EQUIV</a>(sssdev,0.0) ||
<a name="l00773"></a>00773         (<a class="code" href="group__PublicFloatingPoint.html#g66e4000738f924f4e7a1c1837d877cf2" title="Test equality of floating point numbers.">FC_VALUE_EQUIV</a>(ssmin,ssmean,tol,FLT_MIN) &amp;&amp; <a class="code" href="group__PublicFloatingPoint.html#g66e4000738f924f4e7a1c1837d877cf2" title="Test equality of floating point numbers.">FC_VALUE_EQUIV</a>(ssmax,ssmean,tol,FLT_MIN))){
<a name="l00774"></a>00774       <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g564c35a50d7fa88019003ccfb2bbff97" title="Test equality of two values with float precision.">FC_FLT_EQUIV</a>(ssmean,0.0)){
<a name="l00775"></a>00775         <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"cant calc with 0 mean spacing"</span>);
<a name="l00776"></a>00776         <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00777"></a>00777       }<span class="keywordflow">else</span> {
<a name="l00778"></a>00778         fh = ssmean;
<a name="l00779"></a>00779       }
<a name="l00780"></a>00780     } <span class="keywordflow">else</span>{
<a name="l00781"></a>00781       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"seqvar is not on regular sequence"</span>);
<a name="l00782"></a>00782       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00783"></a>00783     }
<a name="l00784"></a>00784   }<span class="keywordflow">else</span>{ <span class="comment">//its a double or a int, use dbl conditions in either case</span>
<a name="l00785"></a>00785     tol = DBL_EPSILON;
<a name="l00786"></a>00786     <span class="keywordflow">if</span> (ueps &gt; tol) tol = ueps;
<a name="l00787"></a>00787     <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g66e4000738f924f4e7a1c1837d877cf2" title="Test equality of floating point numbers.">FC_VALUE_EQUIV</a>(ssmin,ssmax,tol,DBL_MIN) || <a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(sssdev,0.0) ||
<a name="l00788"></a>00788         (<a class="code" href="group__PublicFloatingPoint.html#g66e4000738f924f4e7a1c1837d877cf2" title="Test equality of floating point numbers.">FC_VALUE_EQUIV</a>(ssmin,ssmean,tol,DBL_MIN) &amp;&amp; <a class="code" href="group__PublicFloatingPoint.html#g66e4000738f924f4e7a1c1837d877cf2" title="Test equality of floating point numbers.">FC_VALUE_EQUIV</a>(ssmax,ssmean,tol,DBL_MIN))){
<a name="l00789"></a>00789       <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(ssmean,0.0)){
<a name="l00790"></a>00790         <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"cant calc with 0 mean spacing"</span>);
<a name="l00791"></a>00791         <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00792"></a>00792       }<span class="keywordflow">else</span> {
<a name="l00793"></a>00793         dh = ssmean;
<a name="l00794"></a>00794       }
<a name="l00795"></a>00795     } <span class="keywordflow">else</span>{
<a name="l00796"></a>00796       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"seqvar is not on regular sequence"</span>);
<a name="l00797"></a>00797       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00798"></a>00798     }
<a name="l00799"></a>00799   }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801 
<a name="l00802"></a>00802   rc = <a class="code" href="group__PrivateSeries.html#g85558d3a96772fc12d86f399f7eece30" title="Makes a new seq var on the mesh that is on the same sequence as a given variable...">_fc_makeNewSeqVar</a>(numStep, seqvar, varname,newseqvar); 
<a name="l00803"></a>00803   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00804"></a>00804     <span class="keywordflow">return</span> rc;
<a name="l00805"></a>00805 
<a name="l00806"></a>00806   rc = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(seqvar[0], &amp;numDataPoint, &amp;numComponent, &amp;assoc,
<a name="l00807"></a>00807                            &amp;mathtype, &amp;datatype);
<a name="l00808"></a>00808   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l00809"></a>00809     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l00810"></a>00810     free(*newseqvar);
<a name="l00811"></a>00811     *newseqvar=NULL;
<a name="l00812"></a>00812     <span class="keywordflow">return</span> rc;
<a name="l00813"></a>00813   }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 
<a name="l00816"></a>00816   <span class="comment">//first make calc arrays</span>
<a name="l00817"></a>00817   numArrayVals = numDataPoint*numComponent;
<a name="l00818"></a>00818   <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l00819"></a>00819     calcdata = (<span class="keywordtype">float</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00820"></a>00820   }<span class="keywordflow">else</span>{
<a name="l00821"></a>00821     calcdata = (<span class="keywordtype">double</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00822"></a>00822   }
<a name="l00823"></a>00823   <span class="keywordflow">if</span> (newdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l00824"></a>00824     writedata = (<span class="keywordtype">float</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00825"></a>00825   }<span class="keywordflow">else</span>{
<a name="l00826"></a>00826     writedata = (<span class="keywordtype">double</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00827"></a>00827   }
<a name="l00828"></a>00828   <span class="keywordflow">if</span>(calcdata == NULL || writedata == NULL){
<a name="l00829"></a>00829     <span class="comment">//dont clean up in case of memory error</span>
<a name="l00830"></a>00830     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l00831"></a>00831     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l00832"></a>00832   }
<a name="l00833"></a>00833 
<a name="l00834"></a>00834   <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> &amp;&amp; newdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l00835"></a>00835     <span class="keywordflow">for</span> (i = 0; i &lt; numArrayVals; i++){
<a name="l00836"></a>00836       ((<span class="keywordtype">float</span>*)calcdata)[i] = 0.0;
<a name="l00837"></a>00837       ((<span class="keywordtype">float</span>*)writedata)[i] = 0.0;
<a name="l00838"></a>00838     }
<a name="l00839"></a>00839   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>){ <span class="comment">//they both have to be dbls then</span>
<a name="l00840"></a>00840     <span class="keywordflow">for</span> (i = 0; i &lt; numArrayVals; i++){
<a name="l00841"></a>00841       ((<span class="keywordtype">double</span>*)calcdata)[i] = 0.0;
<a name="l00842"></a>00842       ((<span class="keywordtype">double</span>*)writedata)[i] = 0.0;
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844   } <span class="keywordflow">else</span>{ <span class="comment">//data must be a dbl and new must be a float</span>
<a name="l00845"></a>00845     <span class="keywordflow">for</span> (i = 0; i &lt; numArrayVals; i++){
<a name="l00846"></a>00846       ((<span class="keywordtype">double</span>*)calcdata)[i] = 0.0;
<a name="l00847"></a>00847       ((<span class="keywordtype">float</span>*)writedata)[i] = 0.0;
<a name="l00848"></a>00848     }
<a name="l00849"></a>00849   }
<a name="l00850"></a>00850       
<a name="l00851"></a>00851 
<a name="l00852"></a>00852   <span class="comment">//assign zeros to first two and last two steps</span>
<a name="l00853"></a>00853   j = 0;
<a name="l00854"></a>00854   <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++){
<a name="l00855"></a>00855     <span class="keywordflow">if</span> (i == 2){
<a name="l00856"></a>00856       j = numStep - 2;
<a name="l00857"></a>00857     }
<a name="l00858"></a>00858 
<a name="l00859"></a>00859     rc = <a class="code" href="group__Variable.html#g3f958d3b630c9df78a4e7fbca287b039" title="Set the variable data by copy.">fc_setVariableData</a>((*newseqvar)[j], numDataPoint,
<a name="l00860"></a>00860                    numComponent, assoc, mathtype,
<a name="l00861"></a>00861                    newdatatype,writedata);
<a name="l00862"></a>00862     j++;
<a name="l00863"></a>00863     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l00864"></a>00864       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"cant set var data"</span>);
<a name="l00865"></a>00865       <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l00866"></a>00866       free(*newseqvar);
<a name="l00867"></a>00867       *newseqvar=NULL;
<a name="l00868"></a>00868       free(writedata);
<a name="l00869"></a>00869       free(calcdata);
<a name="l00870"></a>00870       <span class="keywordflow">return</span> rc;
<a name="l00871"></a>00871     }
<a name="l00872"></a>00872   }
<a name="l00873"></a>00873 
<a name="l00874"></a>00874   <span class="comment">//now do all the others</span>
<a name="l00875"></a>00875   <span class="keywordflow">for</span> (count = 2; count &lt; numStep-2; count++){
<a name="l00876"></a>00876 
<a name="l00877"></a>00877     <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> &amp;&amp; newdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l00878"></a>00878       <span class="keywordflow">for</span> (i = 0; i &lt; numArrayVals; i++){
<a name="l00879"></a>00879      ((<span class="keywordtype">float</span>*)calcdata)[i] = 0.0;
<a name="l00880"></a>00880      ((<span class="keywordtype">float</span>*)writedata)[i] = 0.0;
<a name="l00881"></a>00881       }
<a name="l00882"></a>00882     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>){ <span class="comment">//they both have to be dbls then</span>
<a name="l00883"></a>00883       <span class="keywordflow">for</span> (i = 0; i &lt; numArrayVals; i++){
<a name="l00884"></a>00884      ((<span class="keywordtype">double</span>*)calcdata)[i] = 0.0;
<a name="l00885"></a>00885      ((<span class="keywordtype">double</span>*)writedata)[i] = 0.0;
<a name="l00886"></a>00886       }
<a name="l00887"></a>00887     } <span class="keywordflow">else</span>{ <span class="comment">//data must be a dbl and new must be a float</span>
<a name="l00888"></a>00888       <span class="keywordflow">for</span> (i = 0; i &lt; numArrayVals; i++){
<a name="l00889"></a>00889      ((<span class="keywordtype">double</span>*)calcdata)[i] = 0.0;
<a name="l00890"></a>00890      ((<span class="keywordtype">float</span>*)writedata)[i] = 0.0;
<a name="l00891"></a>00891       }
<a name="l00892"></a>00892     }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894     <span class="comment">//now calc vals</span>
<a name="l00895"></a>00895     <span class="keywordflow">for</span> (j = 0; j &lt; 5; j++){ <span class="comment">//for each of the 4 time vals that contrib to this quantity</span>
<a name="l00896"></a>00896       <span class="keywordtype">void</span> *data;
<a name="l00897"></a>00897       <span class="keywordtype">int</span> coeff;
<a name="l00898"></a>00898 
<a name="l00899"></a>00899       <span class="keywordflow">switch</span>(j){ <span class="comment">//weighted add to the sum </span>
<a name="l00900"></a>00900       <span class="keywordflow">case</span> 0:
<a name="l00901"></a>00901      coeff = 1;
<a name="l00902"></a>00902      <span class="keywordflow">break</span>;
<a name="l00903"></a>00903       <span class="keywordflow">case</span> 1:
<a name="l00904"></a>00904      coeff = -8;
<a name="l00905"></a>00905      <span class="keywordflow">break</span>;
<a name="l00906"></a>00906       <span class="keywordflow">case</span> 3: 
<a name="l00907"></a>00907      coeff = 8;
<a name="l00908"></a>00908      <span class="keywordflow">break</span>;
<a name="l00909"></a>00909       <span class="keywordflow">case</span> 4:
<a name="l00910"></a>00910      coeff = -1;
<a name="l00911"></a>00911      <span class="keywordflow">break</span>;
<a name="l00912"></a>00912       <span class="keywordflow">default</span>:
<a name="l00913"></a>00913      <span class="comment">//continue. this actually happens for j = 2</span>
<a name="l00914"></a>00914      <span class="keywordflow">continue</span>;
<a name="l00915"></a>00915       }
<a name="l00916"></a>00916       rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(seqvar[count-2+j], &amp;data); <span class="comment">//get a time slice</span>
<a name="l00917"></a>00917       <span class="keywordflow">for</span> (i = 0; i &lt; numArrayVals; i++){ <span class="comment">//for each datapoint</span>
<a name="l00918"></a>00918      <span class="keywordflow">switch</span>(datatype){
<a name="l00919"></a>00919      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l00920"></a>00920        ((<span class="keywordtype">float</span>*)calcdata)[i]+=coeff*((<span class="keywordtype">float</span>*)data)[i];
<a name="l00921"></a>00921        <span class="keywordflow">break</span>;
<a name="l00922"></a>00922      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l00923"></a>00923        ((<span class="keywordtype">double</span>*)calcdata)[i]+=coeff*((<span class="keywordtype">int</span>*)data)[i];
<a name="l00924"></a>00924        <span class="keywordflow">break</span>;
<a name="l00925"></a>00925      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>:
<a name="l00926"></a>00926        ((<span class="keywordtype">double</span>*)calcdata)[i]+=coeff*((<span class="keywordtype">double</span>*)data)[i];
<a name="l00927"></a>00927        <span class="keywordflow">break</span>;
<a name="l00928"></a>00928      <span class="keywordflow">default</span>: <span class="comment">//this wont happen. do nothing</span>
<a name="l00929"></a>00929        <span class="keywordflow">break</span>;
<a name="l00930"></a>00930      }
<a name="l00931"></a>00931       }
<a name="l00932"></a>00932     } <span class="comment">//now have finished the 4 vals that contrib to the sum</span>
<a name="l00933"></a>00933 
<a name="l00934"></a>00934 
<a name="l00935"></a>00935     <span class="comment">//divide by 12h</span>
<a name="l00936"></a>00936     <span class="keywordflow">if</span> (seqdatatype != <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> &amp;&amp; datatype != <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l00937"></a>00937       <span class="keywordflow">for</span> (i = 0; i &lt; numArrayVals; i++){
<a name="l00938"></a>00938         <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(((<span class="keywordtype">double</span>*)calcdata)[i],0.0)){
<a name="l00939"></a>00939        ((<span class="keywordtype">double</span>*)writedata)[i] = 0.0;
<a name="l00940"></a>00940         } <span class="keywordflow">else</span> {
<a name="l00941"></a>00941        ((<span class="keywordtype">double</span>*)writedata)[i] = ((<span class="keywordtype">double</span>*)calcdata)[i]/(12.0*dh);
<a name="l00942"></a>00942         }
<a name="l00943"></a>00943       }
<a name="l00944"></a>00944     } <span class="keywordflow">else</span> {
<a name="l00945"></a>00945       <span class="comment">//one or the other or both are a float </span>
<a name="l00946"></a>00946       <span class="keywordflow">if</span> (seqdatatype != <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l00947"></a>00947      fh = (float)dh;
<a name="l00948"></a>00948       }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950       <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l00951"></a>00951      <span class="keywordflow">for</span> (i = 0; i &lt; numArrayVals; i++){
<a name="l00952"></a>00952        <span class="keywordtype">float</span> temp = ((<span class="keywordtype">float</span>*)calcdata)[i];
<a name="l00953"></a>00953        <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g564c35a50d7fa88019003ccfb2bbff97" title="Test equality of two values with float precision.">FC_FLT_EQUIV</a>(temp,0.0)){
<a name="l00954"></a>00954          ((<span class="keywordtype">float</span>*)writedata)[i] = 0.0;
<a name="l00955"></a>00955        }<span class="keywordflow">else</span>{
<a name="l00956"></a>00956          ((<span class="keywordtype">float</span>*)writedata)[i]=temp/(12.0*fh);
<a name="l00957"></a>00957        }
<a name="l00958"></a>00958      }
<a name="l00959"></a>00959       } <span class="keywordflow">else</span>{
<a name="l00960"></a>00960      <span class="keywordflow">for</span> (i = 0; i &lt; numArrayVals; i++){
<a name="l00961"></a>00961        <span class="keywordtype">float</span> temp = (float)(((<span class="keywordtype">double</span>*)calcdata)[i]);
<a name="l00962"></a>00962        <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g564c35a50d7fa88019003ccfb2bbff97" title="Test equality of two values with float precision.">FC_FLT_EQUIV</a>(temp,0.0)){
<a name="l00963"></a>00963          ((<span class="keywordtype">float</span>*)writedata)[i] = 0.0;
<a name="l00964"></a>00964        }<span class="keywordflow">else</span>{
<a name="l00965"></a>00965          ((<span class="keywordtype">float</span>*)writedata)[i]=temp/(12.0*fh);
<a name="l00966"></a>00966        }
<a name="l00967"></a>00967      }
<a name="l00968"></a>00968       }
<a name="l00969"></a>00969     }
<a name="l00970"></a>00970     
<a name="l00971"></a>00971     <span class="comment">//assign to this time pt</span>
<a name="l00972"></a>00972     rc = <a class="code" href="group__Variable.html#g3f958d3b630c9df78a4e7fbca287b039" title="Set the variable data by copy.">fc_setVariableData</a>((*newseqvar)[count], numDataPoint,
<a name="l00973"></a>00973                    numComponent, assoc, mathtype,
<a name="l00974"></a>00974                             newdatatype,writedata);
<a name="l00975"></a>00975     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l00976"></a>00976       <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l00977"></a>00977       free(*newseqvar);
<a name="l00978"></a>00978       *newseqvar=NULL;
<a name="l00979"></a>00979       free(calcdata);
<a name="l00980"></a>00980       free(writedata);
<a name="l00981"></a>00981       <span class="keywordflow">return</span> rc;
<a name="l00982"></a>00982     }
<a name="l00983"></a>00983   } <span class="comment">//now have finished deriv for this time step</span>
<a name="l00984"></a>00984 
<a name="l00985"></a>00985   free(calcdata);
<a name="l00986"></a>00986   free(writedata);
<a name="l00987"></a>00987   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l00988"></a>00988 
<a name="l00989"></a>00989 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="gb8a16c59d79c57324b21669241b9101f"></a><!-- doxytag: member="series.c::fc_integral_TR" ref="gb8a16c59d79c57324b21669241b9101f" args="(int numStep, FC_Variable *seqvar, char *varname, FC_Variable *newvar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_integral_TR           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>seqvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>newvar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return a handle to a var that is the integral of an existing seqvar over its sequence. 
<p>
<b>Description:</b> <p>
Does calc for each data point and each component separately. i.e. original seqvar has (numseriessteps*numdatapoint*numcomponent) dimensions; the result has numdatapoint*numcomponent) dimensions. Uses the trapezoidal rule for the calculation. The sequence does not have to be equally spaced.<p>
This will return with an error if the seqvar is not numerical. This will return with an error if the seq is not increasing. Must be at least 2 steps in the sequence.<p>
Value is returned as datatype FC_DT_DOUBLE.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000069">Todo:</a></b></dt><dd><ul>
<li>should floats return floats ?</li><li>is it worth making a version that takes advantage of equally spaced sequences ?</li></ul>
</dd></dl>
<b>Modifications:</b> <ul>
<li>2/22/05 ACG, Created</li><li>3/14/05 ACG, tested</li><li>7/06/05 ACG renamed for consistency with derviative</li><li>01/09/06 ACG changing/removing handling/cleanup in case of datatype error at WSK recommendation since it skews the coverage testing. Either there is already an explict type check or if those lines are reached you've got serious erros and the cleanup doesnt matter. </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - number of steps in the seq var </td></tr>
<tr><td valign="top"><em>seqvar</em>&nbsp;</td><td>
input - seq var integrating </td></tr>
<tr><td valign="top"><em>varname</em>&nbsp;</td><td>
input - name for averaged output var </td></tr>
<tr><td valign="top"><em>newvar</em>&nbsp;</td><td>
output - handle for output var </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="series_8c-source.html#l02270">2270</a> of file <a class="el" href="series_8c-source.html">series.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l06536">_fc_getVarSlot()</a>, <a class="el" href="variable_8c-source.html#l00286">fc_createVariable()</a>, <a class="el" href="util_8h-source.html#l00136">FC_DBL_EQUIV</a>, <a class="el" href="variable_8c-source.html#l04980">fc_deleteVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="base_8h-source.html#l00105">FC_ERROR</a>, <a class="el" href="variable_8c-source.html#l05392">fc_getMeshFromVariable()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="sequence_8c-source.html#l01737">fc_getSequenceCoordsPtr()</a>, <a class="el" href="sequence_8c-source.html#l01687">fc_getSequenceDataType()</a>, <a class="el" href="variable_8c-source.html#l05317">fc_getSequenceFromSeqVariable()</a>, <a class="el" href="variable_8c-source.html#l05715">fc_getVariableDataPtr()</a>, <a class="el" href="variable_8c-source.html#l05433">fc_getVariableInfo()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="variable_8c-source.html#l05178">fc_isSeqVariableValid()</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="base_8c-source.html#l00779">FC_NULL_VARIABLE</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="variable_8c-source.html#l00604">fc_setVariableDataPtr()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="variableP_8h-source.html#l00075">_FC_VarSlot::header</a>, <a class="el" href="tableP_8h-source.html#l00100">_FC_SlotHeader::name</a>, and <a class="el" href="seriesAnalyzer_8c-source.html#l00102">numComponent</a>.</p>

<p>Referenced by <a class="el" href="seriesAnalyzer_8c-source.html#l00439">doSingles()</a>, and <a class="el" href="series_8c-source.html#l03021">fc_dimensionlessAreaBetweenCurves()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02275"></a>02275       {
<a name="l02276"></a>02276   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l02277"></a>02277   <a class="code" href="struct__FC__VarSlot.html" title="Variable Slot Structure for the Variable Table.">_FC_VarSlot</a>* varSlot;
<a name="l02278"></a>02278   <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> mesh;
<a name="l02279"></a>02279   <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> seq;
<a name="l02280"></a>02280   <span class="keywordtype">int</span> numDataPoint;
<a name="l02281"></a>02281   <span class="keywordtype">int</span> <a class="code" href="seriesAnalyzer_8c.html#9ba814c62f21460639802c7771e86fa6">numComponent</a>;
<a name="l02282"></a>02282   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc;
<a name="l02283"></a>02283   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype;
<a name="l02284"></a>02284   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype,dt;
<a name="l02285"></a>02285   <span class="keywordtype">int</span> varsize;
<a name="l02286"></a>02286   <span class="keywordtype">int</span> i,j;
<a name="l02287"></a>02287   <span class="keywordtype">void</span> *data;
<a name="l02288"></a>02288   <span class="keywordtype">double</span> *currtot, *prevval, *nextval, deltat;
<a name="l02289"></a>02289   <span class="keywordtype">void</span>* seqcoords;
<a name="l02290"></a>02290 
<a name="l02291"></a>02291   <span class="keywordflow">if</span> (newvar)
<a name="l02292"></a>02292     *newvar = <a class="code" href="group__Handles.html#g82162b8ad3f5476855507c3c6450db09" title="Null (default) variable handle.">FC_NULL_VARIABLE</a>;
<a name="l02293"></a>02293 
<a name="l02294"></a>02294   <span class="comment">//check input</span>
<a name="l02295"></a>02295   <span class="keywordflow">if</span> (newvar == NULL || varname == NULL ||
<a name="l02296"></a>02296       (!<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,seqvar))){
<a name="l02297"></a>02297     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l02298"></a>02298     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02299"></a>02299   }
<a name="l02300"></a>02300 
<a name="l02301"></a>02301 
<a name="l02302"></a>02302   varSlot = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(seqvar[0]);
<a name="l02303"></a>02303   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Getting integral for seq variable '%s'"</span>,
<a name="l02304"></a>02304                       varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>);
<a name="l02305"></a>02305 
<a name="l02306"></a>02306 
<a name="l02307"></a>02307   rc = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(seqvar[0], &amp;numDataPoint, &amp;numComponent, &amp;assoc,
<a name="l02308"></a>02308                            &amp;mathtype, &amp;datatype);
<a name="l02309"></a>02309   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) <span class="keywordflow">return</span> rc;
<a name="l02310"></a>02310 
<a name="l02311"></a>02311   <span class="keywordflow">if</span> (!(datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l02312"></a>02312         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l02313"></a>02313         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l02314"></a>02314       ){
<a name="l02315"></a>02315     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02316"></a>02316   } 
<a name="l02317"></a>02317 
<a name="l02318"></a>02318 
<a name="l02319"></a>02319   <span class="keywordflow">if</span> (numStep &lt; 2){
<a name="l02320"></a>02320     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"sequence doesnt have enough steps to integrate"</span>);
<a name="l02321"></a>02321     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02322"></a>02322   }
<a name="l02323"></a>02323 
<a name="l02324"></a>02324   rc = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,seqvar,&amp;seq);
<a name="l02325"></a>02325   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l02326"></a>02326     <span class="keywordflow">return</span> rc;
<a name="l02327"></a>02327 
<a name="l02328"></a>02328   rc = <a class="code" href="group__Sequence.html#ga88160e25be202c8de18ac89edf876c6" title="Get sequence coordinates.">fc_getSequenceCoordsPtr</a>(seq,&amp;seqcoords);
<a name="l02329"></a>02329   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l02330"></a>02330     <span class="keywordflow">return</span> rc;
<a name="l02331"></a>02331 
<a name="l02332"></a>02332   rc = <a class="code" href="group__Sequence.html#g6d5a8a30edd00c973804c7ce31a3a2e6" title="Get the data type of a sequence&amp;#39;s coordinates.">fc_getSequenceDataType</a>(seq,&amp;dt);
<a name="l02333"></a>02333   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) 
<a name="l02334"></a>02334     <span class="keywordflow">return</span> rc;
<a name="l02335"></a>02335 
<a name="l02336"></a>02336   <span class="keywordflow">if</span> (!(dt == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l02337"></a>02337         dt == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l02338"></a>02338         dt == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l02339"></a>02339       ){
<a name="l02340"></a>02340     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02341"></a>02341   } 
<a name="l02342"></a>02342 
<a name="l02343"></a>02343 
<a name="l02344"></a>02344   <span class="comment">// set up data arrays</span>
<a name="l02345"></a>02345   varsize = numDataPoint*numComponent;
<a name="l02346"></a>02346   currtot = (<span class="keywordtype">double</span>*)malloc(varsize*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l02347"></a>02347   nextval = (<span class="keywordtype">double</span>*)malloc(varsize*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l02348"></a>02348   prevval = (<span class="keywordtype">double</span>*)malloc(varsize*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l02349"></a>02349   <span class="keywordflow">if</span> (currtot == NULL || nextval == NULL || prevval == NULL){
<a name="l02350"></a>02350     <span class="comment">//no clean up in case of memory error</span>
<a name="l02351"></a>02351     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l02352"></a>02352     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l02353"></a>02353   }
<a name="l02354"></a>02354 
<a name="l02355"></a>02355   <span class="comment">//get first point </span>
<a name="l02356"></a>02356   rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(seqvar[0], &amp;data);
<a name="l02357"></a>02357   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02358"></a>02358     data = NULL;
<a name="l02359"></a>02359     free(currtot);
<a name="l02360"></a>02360     free(nextval);
<a name="l02361"></a>02361     free(prevval);
<a name="l02362"></a>02362     <span class="keywordflow">return</span> rc;
<a name="l02363"></a>02363   }
<a name="l02364"></a>02364   <span class="keywordflow">for</span> (j = 0; j &lt; varsize; j++){
<a name="l02365"></a>02365     currtot[j] = 0;
<a name="l02366"></a>02366     <span class="keywordflow">switch</span>(datatype){
<a name="l02367"></a>02367     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>:
<a name="l02368"></a>02368       prevval[j]= ((<span class="keywordtype">double</span>*)data)[j];
<a name="l02369"></a>02369       <span class="keywordflow">break</span>;
<a name="l02370"></a>02370     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l02371"></a>02371       prevval[j]= (double)(((<span class="keywordtype">int</span>*)data)[j]);
<a name="l02372"></a>02372       <span class="keywordflow">break</span>;
<a name="l02373"></a>02373     <span class="keywordflow">default</span>: <span class="comment">//its a float cuase i checked it above</span>
<a name="l02374"></a>02374       prevval[j]= (double)(((<span class="keywordtype">float</span>*)data)[j]);
<a name="l02375"></a>02375       <span class="keywordflow">break</span>;
<a name="l02376"></a>02376     }
<a name="l02377"></a>02377   }
<a name="l02378"></a>02378 
<a name="l02379"></a>02379   <span class="comment">//do rest of them....</span>
<a name="l02380"></a>02380   <span class="keywordflow">for</span> (i = 1; i &lt; numStep; i++){
<a name="l02381"></a>02381     <span class="keywordflow">switch</span> (dt){
<a name="l02382"></a>02382     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>:
<a name="l02383"></a>02383       deltat= ((<span class="keywordtype">double</span>*)seqcoords)[i]-((<span class="keywordtype">double</span>*)seqcoords)[i-1];
<a name="l02384"></a>02384       <span class="keywordflow">break</span>;
<a name="l02385"></a>02385     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l02386"></a>02386       deltat= (double)((<span class="keywordtype">int</span>*)seqcoords)[i]-(<span class="keywordtype">double</span>)((<span class="keywordtype">int</span>*)seqcoords)[i-1];
<a name="l02387"></a>02387       <span class="keywordflow">break</span>;
<a name="l02388"></a>02388     <span class="keywordflow">default</span>: <span class="comment">//its a float cuase i checked it above</span>
<a name="l02389"></a>02389       deltat= (double)((<span class="keywordtype">float</span>*)seqcoords)[i]-
<a name="l02390"></a>02390         (<span class="keywordtype">double</span>)((<span class="keywordtype">float</span>*)seqcoords)[i-1];
<a name="l02391"></a>02391       <span class="keywordflow">break</span>;
<a name="l02392"></a>02392     }
<a name="l02393"></a>02393     
<a name="l02394"></a>02394     <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(deltat,0.0)){
<a name="l02395"></a>02395       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"divide by zero"</span>);
<a name="l02396"></a>02396       free(currtot);
<a name="l02397"></a>02397       free(nextval);
<a name="l02398"></a>02398       free(prevval);
<a name="l02399"></a>02399       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>;
<a name="l02400"></a>02400     }
<a name="l02401"></a>02401     <span class="keywordflow">if</span> (deltat &lt; 0.0){
<a name="l02402"></a>02402       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"sequence not increasing"</span>);
<a name="l02403"></a>02403       free(currtot);
<a name="l02404"></a>02404       free(nextval);
<a name="l02405"></a>02405       free(prevval);
<a name="l02406"></a>02406       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>; 
<a name="l02407"></a>02407     }
<a name="l02408"></a>02408 
<a name="l02409"></a>02409 
<a name="l02410"></a>02410     rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(seqvar[i], &amp;data);
<a name="l02411"></a>02411     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02412"></a>02412       data = NULL;
<a name="l02413"></a>02413       free(currtot);
<a name="l02414"></a>02414       free(nextval);
<a name="l02415"></a>02415       free(prevval);
<a name="l02416"></a>02416       <span class="keywordflow">return</span> rc;
<a name="l02417"></a>02417     }
<a name="l02418"></a>02418     <span class="keywordflow">for</span> (j = 0; j &lt; varsize; j++){
<a name="l02419"></a>02419       <span class="keywordflow">switch</span>(datatype){
<a name="l02420"></a>02420       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>:
<a name="l02421"></a>02421         nextval[j] = ((<span class="keywordtype">double</span>*)data)[j];
<a name="l02422"></a>02422         <span class="keywordflow">break</span>;
<a name="l02423"></a>02423       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l02424"></a>02424         nextval[j] = (double)(((<span class="keywordtype">int</span>*)data)[j]);
<a name="l02425"></a>02425         <span class="keywordflow">break</span>;
<a name="l02426"></a>02426       <span class="keywordflow">default</span>: <span class="comment">//its a float cuase i checked this above</span>
<a name="l02427"></a>02427         nextval[j] = (double)(((<span class="keywordtype">float</span>*)data)[j]);
<a name="l02428"></a>02428         <span class="keywordflow">break</span>;
<a name="l02429"></a>02429       }
<a name="l02430"></a>02430       currtot[j] += deltat*(nextval[j]+prevval[j])/2.0;
<a name="l02431"></a>02431       prevval[j] = nextval[j];
<a name="l02432"></a>02432     }
<a name="l02433"></a>02433   }
<a name="l02434"></a>02434 
<a name="l02435"></a>02435   free(nextval);
<a name="l02436"></a>02436   free(prevval);
<a name="l02437"></a>02437 
<a name="l02438"></a>02438   rc = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(seqvar[0],&amp;mesh);
<a name="l02439"></a>02439   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02440"></a>02440     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(rc));
<a name="l02441"></a>02441     <span class="keywordflow">return</span> rc;
<a name="l02442"></a>02442   }
<a name="l02443"></a>02443 
<a name="l02444"></a>02444   rc = <a class="code" href="group__Variable.html#ga2ffd025a786dbe93fc7f8defb969631" title="Create a new variable.">fc_createVariable</a>(mesh,varname,newvar);
<a name="l02445"></a>02445   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02446"></a>02446     free(currtot);
<a name="l02447"></a>02447     <span class="keywordflow">return</span> rc;
<a name="l02448"></a>02448   }
<a name="l02449"></a>02449 
<a name="l02450"></a>02450   rc = <a class="code" href="group__Variable.html#g87015cda75e038cc73c1d584537d81fc" title="Set the pointer to the variable data.">fc_setVariableDataPtr</a>(*newvar,numDataPoint, numComponent,
<a name="l02451"></a>02451                              assoc,mathtype,<a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>,currtot);
<a name="l02452"></a>02452   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02453"></a>02453     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(*newvar);
<a name="l02454"></a>02454     <span class="keywordflow">return</span> rc;
<a name="l02455"></a>02455   }
<a name="l02456"></a>02456 
<a name="l02457"></a>02457   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l02458"></a>02458 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="g1fd38482a6e61402b2cf5ccb73d648b0"></a><!-- doxytag: member="series.c::fc_leadingWindowAverage" ref="g1fd38482a6e61402b2cf5ccb73d648b0" args="(int numStep, FC_Variable *seqvar, int windowsize, char *varname, FC_Variable **newseqvar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_leadingWindowAverage           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>seqvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>windowsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> **&nbsp;</td>
          <td class="paramname"> <em>newseqvar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return a handle to a seqvar that is the window averaged version of an existing seqvar. 
<p>
<b>Description:</b> <p>
Return a handle to a seqvar that is the window averaged version of an existing seqvar. Return value is an average of the current f(t) and the previous (window-1) values of f. Therefore choosing window = 1, returns the orig sequence. For early times if there are not enough values to satisfy the window, it uses what it can. Time averaged version of this is <a class="el" href="group__Series.html#ge579a1d090e9c3a96d42b30bd3832804">fc_leadingWindowAverage_Time</a>.<p>
Averaging is over each dimension of the variable separately<p>
Floats and Doubles will return vars with same type; Ints will return Doubles. Someone can floor/ceil it later if they want integer values. This will return with an error if the seqvar is not numerical.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000064">Todo:</a></b></dt><dd></dd></dl>
<ul>
<li>Weighted version ?</li><li>Think about making a wrapper and passing in ptrs to function for the particular calculation parts</li></ul>
<p>
<b>Modifications:</b> <ul>
<li>12/21/04 ACG, Created</li><li>01/09/06 ACG changing/removing handling/cleanup in case of datatype error at WSK recommendation since it skews the coverage testing. Either there is already an explict type check or if those lines are reached</li><li>01/12/06 ACG cleaned up the way the writeout arrays were handled. </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - number of steps in the seq var </td></tr>
<tr><td valign="top"><em>seqvar</em>&nbsp;</td><td>
input - seq var averaging over </td></tr>
<tr><td valign="top"><em>windowsize</em>&nbsp;</td><td>
input - window size for average </td></tr>
<tr><td valign="top"><em>varname</em>&nbsp;</td><td>
input - name for averaged output seq var </td></tr>
<tr><td valign="top"><em>newseqvar</em>&nbsp;</td><td>
output - handles for output seq var </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="series_8c-source.html#l01027">1027</a> of file <a class="el" href="series_8c-source.html">series.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l06536">_fc_getVarSlot()</a>, <a class="el" href="series_8c-source.html#l00122">_fc_makeNewSeqVar()</a>, <a class="el" href="variable_8c-source.html#l02328">fc_copySeqVariable()</a>, <a class="el" href="variable_8c-source.html#l05062">fc_deleteSeqVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="variable_8c-source.html#l05392">fc_getMeshFromVariable()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="variable_8c-source.html#l05317">fc_getSequenceFromSeqVariable()</a>, <a class="el" href="variable_8c-source.html#l05715">fc_getVariableDataPtr()</a>, <a class="el" href="variable_8c-source.html#l05498">fc_getVariableDataType()</a>, <a class="el" href="variable_8c-source.html#l05433">fc_getVariableInfo()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="variable_8c-source.html#l05178">fc_isSeqVariableValid()</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="variable_8c-source.html#l00469">fc_setVariableData()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="variableP_8h-source.html#l00075">_FC_VarSlot::header</a>, <a class="el" href="tableP_8h-source.html#l00100">_FC_SlotHeader::name</a>, and <a class="el" href="seriesAnalyzer_8c-source.html#l00102">numComponent</a>.</p>

<p>Referenced by <a class="el" href="windowVars_8c-source.html#l00065">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01033"></a>01033  {
<a name="l01034"></a>01034 
<a name="l01035"></a>01035 
<a name="l01036"></a>01036   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l01037"></a>01037   <a class="code" href="struct__FC__VarSlot.html" title="Variable Slot Structure for the Variable Table.">_FC_VarSlot</a>* varSlot;
<a name="l01038"></a>01038   <span class="keywordtype">int</span> numDataPoint;
<a name="l01039"></a>01039   <span class="keywordtype">int</span> <a class="code" href="seriesAnalyzer_8c.html#9ba814c62f21460639802c7771e86fa6">numComponent</a>;
<a name="l01040"></a>01040   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc;
<a name="l01041"></a>01041   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype;
<a name="l01042"></a>01042   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype, newdatatype;
<a name="l01043"></a>01043   <span class="keywordtype">double</span>* curr;
<a name="l01044"></a>01044   <span class="keywordtype">void</span>* vwritedata;
<a name="l01045"></a>01045   <span class="keywordtype">int</span> i,j,count,numArrayVals;
<a name="l01046"></a>01046 
<a name="l01047"></a>01047   <span class="keywordflow">if</span> (newseqvar)
<a name="l01048"></a>01048     *newseqvar = NULL;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050   <span class="comment">//will check below to see that its appropriate numerical type</span>
<a name="l01051"></a>01051   <span class="keywordflow">if</span> ((!<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,seqvar)) || (newseqvar == NULL)
<a name="l01052"></a>01052       || varname == NULL || windowsize &lt; 1){
<a name="l01053"></a>01053     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l01054"></a>01054     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l01055"></a>01055   };
<a name="l01056"></a>01056 
<a name="l01057"></a>01057   rc = <a class="code" href="group__Variable.html#gd3b7cecfd0c6d488e82b426b4c114aba" title="Return the data type of a variable.">fc_getVariableDataType</a>(seqvar[0],&amp;datatype);
<a name="l01058"></a>01058   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01059"></a>01059     <span class="keywordflow">return</span> rc;
<a name="l01060"></a>01060 
<a name="l01061"></a>01061   <span class="keywordflow">if</span> (!(datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l01062"></a>01062         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l01063"></a>01063         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l01064"></a>01064       ){
<a name="l01065"></a>01065     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l01066"></a>01066   } 
<a name="l01067"></a>01067 
<a name="l01068"></a>01068   varSlot = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(seqvar[0]);
<a name="l01069"></a>01069   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Getting windowave for seq variable '%s'"</span>,
<a name="l01070"></a>01070                       varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>);
<a name="l01071"></a>01071 
<a name="l01072"></a>01072   <span class="comment">//special case</span>
<a name="l01073"></a>01073   <span class="keywordflow">if</span> (windowsize == 1){
<a name="l01074"></a>01074     <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> mesh;
<a name="l01075"></a>01075     <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> seq;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     rc = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(seqvar[0],&amp;mesh);
<a name="l01078"></a>01078     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01079"></a>01079       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(rc));
<a name="l01080"></a>01080       <span class="keywordflow">return</span> rc;
<a name="l01081"></a>01081     }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083     rc = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,seqvar,&amp;seq);
<a name="l01084"></a>01084     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01085"></a>01085       <span class="keywordflow">return</span> rc;
<a name="l01086"></a>01086 
<a name="l01087"></a>01087     rc = <a class="code" href="group__Variable.html#gaf25870a6c8032440b6d5565ccc083cb" title="Copy a sequence variable.">fc_copySeqVariable</a>(numStep,seqvar,mesh,seq,varname,newseqvar); 
<a name="l01088"></a>01088     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01089"></a>01089       <span class="keywordflow">return</span> rc;
<a name="l01090"></a>01090 
<a name="l01091"></a>01091     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l01092"></a>01092   }
<a name="l01093"></a>01093 
<a name="l01094"></a>01094 
<a name="l01095"></a>01095   rc = <a class="code" href="group__PrivateSeries.html#g85558d3a96772fc12d86f399f7eece30" title="Makes a new seq var on the mesh that is on the same sequence as a given variable...">_fc_makeNewSeqVar</a>(numStep, seqvar, varname,newseqvar); 
<a name="l01096"></a>01096   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01097"></a>01097     <span class="keywordflow">return</span> rc;
<a name="l01098"></a>01098 
<a name="l01099"></a>01099   rc = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(seqvar[0], &amp;numDataPoint, &amp;numComponent, &amp;assoc,
<a name="l01100"></a>01100                            &amp;mathtype, &amp;datatype);
<a name="l01101"></a>01101   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01102"></a>01102     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01103"></a>01103     free(*newseqvar);
<a name="l01104"></a>01104     *newseqvar=NULL;
<a name="l01105"></a>01105     <span class="keywordflow">return</span> rc;
<a name="l01106"></a>01106   }
<a name="l01107"></a>01107 
<a name="l01108"></a>01108 
<a name="l01109"></a>01109   <span class="comment">//make writeout array and calc array</span>
<a name="l01110"></a>01110   numArrayVals = numDataPoint*numComponent;
<a name="l01111"></a>01111   curr = (<span class="keywordtype">double</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01112"></a>01112   <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l01113"></a>01113     newdatatype = <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>;
<a name="l01114"></a>01114     vwritedata = (<span class="keywordtype">float</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));    
<a name="l01115"></a>01115   } <span class="keywordflow">else</span> { <span class="comment">//knows its an it or a double cuase that was checked above)</span>
<a name="l01116"></a>01116     newdatatype = <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>;
<a name="l01117"></a>01117     vwritedata = (<span class="keywordtype">double</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01118"></a>01118   }
<a name="l01119"></a>01119   <span class="keywordflow">if</span> (curr == NULL || vwritedata == NULL){
<a name="l01120"></a>01120     <span class="comment">//no clean up in case of memory error</span>
<a name="l01121"></a>01121     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l01122"></a>01122     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l01123"></a>01123   }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125   <span class="keywordflow">for</span> (i = 0; i &lt; numArrayVals; i++){
<a name="l01126"></a>01126     curr[i] = 0.0;
<a name="l01127"></a>01127   }
<a name="l01128"></a>01128 
<a name="l01129"></a>01129   count = 0;
<a name="l01130"></a>01130 
<a name="l01131"></a>01131 
<a name="l01132"></a>01132   <span class="keywordflow">for</span> (i = 0; i &lt; numStep; i++) { <span class="comment">//like each time</span>
<a name="l01133"></a>01133     <span class="keywordtype">int</span> dropping = 0;
<a name="l01134"></a>01134     <span class="keywordtype">void</span> *data, *dropdata;
<a name="l01135"></a>01135 
<a name="l01136"></a>01136     <span class="keywordflow">if</span> (count == windowsize){
<a name="l01137"></a>01137       <span class="comment">//if a value is ageing out, get it</span>
<a name="l01138"></a>01138       <span class="keywordtype">int</span> idx = i - windowsize;
<a name="l01139"></a>01139       dropping = 1;
<a name="l01140"></a>01140       rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(seqvar[idx], &amp;dropdata);
<a name="l01141"></a>01141       <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01142"></a>01142         data = NULL;
<a name="l01143"></a>01143         dropdata = NULL;
<a name="l01144"></a>01144         free(curr);
<a name="l01145"></a>01145         <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01146"></a>01146         free(*newseqvar);
<a name="l01147"></a>01147         *newseqvar=NULL;
<a name="l01148"></a>01148      free(vwritedata);
<a name="l01149"></a>01149         <span class="keywordflow">return</span> rc;
<a name="l01150"></a>01150       }
<a name="l01151"></a>01151       count--;
<a name="l01152"></a>01152     }
<a name="l01153"></a>01153 
<a name="l01154"></a>01154 
<a name="l01155"></a>01155     <span class="comment">//get new val</span>
<a name="l01156"></a>01156     rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(seqvar[i], &amp;data);
<a name="l01157"></a>01157     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01158"></a>01158       data = NULL;
<a name="l01159"></a>01159       dropdata = NULL;
<a name="l01160"></a>01160       free(curr);
<a name="l01161"></a>01161       <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01162"></a>01162       free(*newseqvar);
<a name="l01163"></a>01163       *newseqvar=NULL;
<a name="l01164"></a>01164       free(vwritedata);
<a name="l01165"></a>01165       <span class="keywordflow">return</span> rc;
<a name="l01166"></a>01166     }
<a name="l01167"></a>01167     count++;
<a name="l01168"></a>01168 
<a name="l01169"></a>01169     <span class="keywordflow">for</span> (j = 0; j &lt; numArrayVals; j++){
<a name="l01170"></a>01170       <span class="comment">//if dropping subtract aged value off the curr total.</span>
<a name="l01171"></a>01171       <span class="comment">//always add new value in.</span>
<a name="l01172"></a>01172       <span class="keywordtype">double</span> temp;
<a name="l01173"></a>01173       <span class="keywordflow">switch</span>(datatype){
<a name="l01174"></a>01174       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l01175"></a>01175         temp = (double)((<span class="keywordtype">int</span>*)data)[j];
<a name="l01176"></a>01176         <span class="keywordflow">if</span> (dropping)   temp -= (double)((<span class="keywordtype">int</span>*)dropdata)[j];
<a name="l01177"></a>01177         <span class="keywordflow">break</span>;
<a name="l01178"></a>01178       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l01179"></a>01179         temp = (double)((<span class="keywordtype">float</span>*)data)[j];
<a name="l01180"></a>01180         <span class="keywordflow">if</span> (dropping) temp -= (double)((<span class="keywordtype">float</span>*)dropdata)[j];
<a name="l01181"></a>01181         <span class="keywordflow">break</span>;
<a name="l01182"></a>01182       <span class="keywordflow">default</span>: <span class="comment">//knows its a double cause that was checked above</span>
<a name="l01183"></a>01183         temp = ((<span class="keywordtype">double</span>*)data)[j];
<a name="l01184"></a>01184         <span class="keywordflow">if</span> (dropping) temp -= ((<span class="keywordtype">double</span>*)dropdata)[j];
<a name="l01185"></a>01185         <span class="keywordflow">break</span>;
<a name="l01186"></a>01186       }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188       curr[j] += temp;
<a name="l01189"></a>01189 
<a name="l01190"></a>01190       <span class="comment">//divide at end so less roundoff; count not always fixed</span>
<a name="l01191"></a>01191       <span class="comment">//(e.g., at early times)</span>
<a name="l01192"></a>01192       <span class="keywordflow">if</span> (newdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l01193"></a>01193         ((<span class="keywordtype">float</span>*)vwritedata)[j] = (float)(curr[j]/(<span class="keywordtype">double</span>)count);
<a name="l01194"></a>01194       }<span class="keywordflow">else</span> {
<a name="l01195"></a>01195         ((<span class="keywordtype">double</span>*)vwritedata)[j] = curr[j]/(double)count;
<a name="l01196"></a>01196       }
<a name="l01197"></a>01197     }
<a name="l01198"></a>01198 
<a name="l01199"></a>01199     rc = <a class="code" href="group__Variable.html#g3f958d3b630c9df78a4e7fbca287b039" title="Set the variable data by copy.">fc_setVariableData</a>((*newseqvar)[i], numDataPoint,
<a name="l01200"></a>01200                             numComponent, assoc, mathtype,
<a name="l01201"></a>01201                             newdatatype,vwritedata);
<a name="l01202"></a>01202     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01203"></a>01203       <span class="comment">//additional clean up</span>
<a name="l01204"></a>01204       <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01205"></a>01205 
<a name="l01206"></a>01206       free(*newseqvar);
<a name="l01207"></a>01207       free(vwritedata);
<a name="l01208"></a>01208       *newseqvar=NULL;
<a name="l01209"></a>01209       free(curr);
<a name="l01210"></a>01210       <span class="keywordflow">return</span> rc;
<a name="l01211"></a>01211     }
<a name="l01212"></a>01212   }
<a name="l01213"></a>01213 
<a name="l01214"></a>01214 
<a name="l01215"></a>01215 
<a name="l01216"></a>01216   free(curr);
<a name="l01217"></a>01217   free(vwritedata);
<a name="l01218"></a>01218 
<a name="l01219"></a>01219   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l01220"></a>01220 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ge579a1d090e9c3a96d42b30bd3832804"></a><!-- doxytag: member="series.c::fc_leadingWindowAverage_Time" ref="ge579a1d090e9c3a96d42b30bd3832804" args="(int numStep, FC_Variable *seqvar, double windowtime, char *varname, FC_Variable **newseqvar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_leadingWindowAverage_Time           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>seqvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>windowtime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> **&nbsp;</td>
          <td class="paramname"> <em>newseqvar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return a handle to a seqvar that is the time window averaged version of an existing seqvar. 
<p>
<b>Description:</b> <p>
Return a handle to a seqvar that is the time window averaged version of an existing seqvar.<p>
Return value f(t) = ave(x(t-window)....x(t)), i.e. it is an average of the current and past values for which the sequence time is &lt;= (currenttime-timewindow). For early times, if there are not enough values to satisfy the window, it uses as many as it can. This is the window duration version of <a class="el" href="group__Series.html#g1fd38482a6e61402b2cf5ccb73d648b0">fc_leadingWindowAverage</a>. There is nothing that checks that the x variable is time of course, but it most likely is so I'm using that name. If the time window is zero, it returns a copy of the orig sequence.<p>
This does not check that the sequence is regular, nor does it weight the vals in the average by their duration in the window etc. It is a blind average.<p>
Averaging is over each dimension of the variable separately<p>
Floats and Doubles will return vars with same type; Ints will return Doubles. Someone can floor/ceil it later if they want integer values. This will return with an error if the seqvar or seq is not numerical.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000065">Todo:</a></b></dt><dd><ul>
<li>any interested in a weighted version ?</li></ul>
</dd></dl>
<b>Modifications:</b> <ul>
<li>01/23/06 ACG, Created </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - number of steps in the seq var </td></tr>
<tr><td valign="top"><em>seqvar</em>&nbsp;</td><td>
input - seq var averaging over </td></tr>
<tr><td valign="top"><em>windowtime</em>&nbsp;</td><td>
input - time window size for average </td></tr>
<tr><td valign="top"><em>varname</em>&nbsp;</td><td>
input - name for averaged output seq var </td></tr>
<tr><td valign="top"><em>newseqvar</em>&nbsp;</td><td>
output - handles for output seq var </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="series_8c-source.html#l01261">1261</a> of file <a class="el" href="series_8c-source.html">series.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l06536">_fc_getVarSlot()</a>, <a class="el" href="series_8c-source.html#l00122">_fc_makeNewSeqVar()</a>, <a class="el" href="variable_8c-source.html#l02328">fc_copySeqVariable()</a>, <a class="el" href="util_8h-source.html#l00136">FC_DBL_EQUIV</a>, <a class="el" href="variable_8c-source.html#l05062">fc_deleteSeqVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="variable_8c-source.html#l05392">fc_getMeshFromVariable()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="sequence_8c-source.html#l01737">fc_getSequenceCoordsPtr()</a>, <a class="el" href="sequence_8c-source.html#l01687">fc_getSequenceDataType()</a>, <a class="el" href="variable_8c-source.html#l05317">fc_getSequenceFromSeqVariable()</a>, <a class="el" href="variable_8c-source.html#l05715">fc_getVariableDataPtr()</a>, <a class="el" href="variable_8c-source.html#l05498">fc_getVariableDataType()</a>, <a class="el" href="variable_8c-source.html#l05433">fc_getVariableInfo()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="variable_8c-source.html#l05178">fc_isSeqVariableValid()</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="variable_8c-source.html#l00469">fc_setVariableData()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="variableP_8h-source.html#l00075">_FC_VarSlot::header</a>, <a class="el" href="tableP_8h-source.html#l00100">_FC_SlotHeader::name</a>, and <a class="el" href="seriesAnalyzer_8c-source.html#l00102">numComponent</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01267"></a>01267  {
<a name="l01268"></a>01268   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l01269"></a>01269   <a class="code" href="struct__FC__VarSlot.html" title="Variable Slot Structure for the Variable Table.">_FC_VarSlot</a>* varSlot;
<a name="l01270"></a>01270   <span class="keywordtype">int</span> numDataPoint;
<a name="l01271"></a>01271   <span class="keywordtype">int</span> <a class="code" href="seriesAnalyzer_8c.html#9ba814c62f21460639802c7771e86fa6">numComponent</a>;
<a name="l01272"></a>01272   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc;
<a name="l01273"></a>01273   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype;
<a name="l01274"></a>01274   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype, seqdatatype, newdatatype;
<a name="l01275"></a>01275   <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> seq;
<a name="l01276"></a>01276 
<a name="l01277"></a>01277   <span class="keywordtype">void</span> *seqcoords, *vwritedata;
<a name="l01278"></a>01278   <span class="keywordtype">int</span> i,j,rangeindex, numArrayVals;
<a name="l01279"></a>01279 
<a name="l01280"></a>01280   <span class="keywordflow">if</span> (newseqvar)
<a name="l01281"></a>01281     *newseqvar = NULL;
<a name="l01282"></a>01282 
<a name="l01283"></a>01283   <span class="comment">//will check below to see that its appropriate numerical type</span>
<a name="l01284"></a>01284   <span class="keywordflow">if</span> ((!<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,seqvar)) || (newseqvar == NULL)
<a name="l01285"></a>01285       || varname == NULL || windowtime &lt; 0){
<a name="l01286"></a>01286     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l01287"></a>01287     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l01288"></a>01288   };
<a name="l01289"></a>01289 
<a name="l01290"></a>01290   rc = <a class="code" href="group__Variable.html#gd3b7cecfd0c6d488e82b426b4c114aba" title="Return the data type of a variable.">fc_getVariableDataType</a>(seqvar[0],&amp;datatype);
<a name="l01291"></a>01291   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01292"></a>01292     <span class="keywordflow">return</span> rc;
<a name="l01293"></a>01293 
<a name="l01294"></a>01294   <span class="keywordflow">if</span> (!(datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l01295"></a>01295         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l01296"></a>01296         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l01297"></a>01297       ){
<a name="l01298"></a>01298     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"var data must be numerical"</span>);
<a name="l01299"></a>01299     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l01300"></a>01300   } 
<a name="l01301"></a>01301 
<a name="l01302"></a>01302   rc = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,seqvar,&amp;seq);
<a name="l01303"></a>01303   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01304"></a>01304     <span class="keywordflow">return</span> rc;
<a name="l01305"></a>01305 
<a name="l01306"></a>01306   rc = <a class="code" href="group__Sequence.html#g6d5a8a30edd00c973804c7ce31a3a2e6" title="Get the data type of a sequence&amp;#39;s coordinates.">fc_getSequenceDataType</a>(seq,&amp;seqdatatype);
<a name="l01307"></a>01307   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01308"></a>01308     <span class="keywordflow">return</span> rc;
<a name="l01309"></a>01309 
<a name="l01310"></a>01310   <span class="keywordflow">if</span> (!(seqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l01311"></a>01311         seqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l01312"></a>01312         seqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l01313"></a>01313       ){
<a name="l01314"></a>01314     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"seq data must be numerical"</span>);
<a name="l01315"></a>01315     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l01316"></a>01316   } 
<a name="l01317"></a>01317 
<a name="l01318"></a>01318   varSlot = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(seqvar[0]);
<a name="l01319"></a>01319   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Getting windowave for seq variable '%s'"</span>,
<a name="l01320"></a>01320                       varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>);
<a name="l01321"></a>01321 
<a name="l01322"></a>01322 
<a name="l01323"></a>01323   <span class="comment">//special case</span>
<a name="l01324"></a>01324   <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(windowtime,0.0)){
<a name="l01325"></a>01325     <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> mesh;
<a name="l01326"></a>01326     rc = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(seqvar[0],&amp;mesh);
<a name="l01327"></a>01327     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01328"></a>01328       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(rc));
<a name="l01329"></a>01329       <span class="keywordflow">return</span> rc;
<a name="l01330"></a>01330     }
<a name="l01331"></a>01331 
<a name="l01332"></a>01332     rc = <a class="code" href="group__Variable.html#gaf25870a6c8032440b6d5565ccc083cb" title="Copy a sequence variable.">fc_copySeqVariable</a>(numStep,seqvar,mesh,seq,varname,newseqvar); 
<a name="l01333"></a>01333     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01334"></a>01334       <span class="keywordflow">return</span> rc;
<a name="l01335"></a>01335 
<a name="l01336"></a>01336     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l01337"></a>01337   }
<a name="l01338"></a>01338 
<a name="l01339"></a>01339   rc = <a class="code" href="group__Sequence.html#ga88160e25be202c8de18ac89edf876c6" title="Get sequence coordinates.">fc_getSequenceCoordsPtr</a>(seq,&amp;seqcoords);
<a name="l01340"></a>01340   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01341"></a>01341     <span class="keywordflow">return</span> rc;
<a name="l01342"></a>01342 
<a name="l01343"></a>01343   rc = <a class="code" href="group__PrivateSeries.html#g85558d3a96772fc12d86f399f7eece30" title="Makes a new seq var on the mesh that is on the same sequence as a given variable...">_fc_makeNewSeqVar</a>(numStep, seqvar, varname,newseqvar); 
<a name="l01344"></a>01344   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l01345"></a>01345     <span class="keywordflow">return</span> rc;
<a name="l01346"></a>01346 
<a name="l01347"></a>01347   rc = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(seqvar[0], &amp;numDataPoint, &amp;numComponent, &amp;assoc,
<a name="l01348"></a>01348                            &amp;mathtype, &amp;datatype);
<a name="l01349"></a>01349   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01350"></a>01350     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01351"></a>01351     free(*newseqvar);
<a name="l01352"></a>01352     *newseqvar=NULL;
<a name="l01353"></a>01353     <span class="keywordflow">return</span> rc;
<a name="l01354"></a>01354   }
<a name="l01355"></a>01355 
<a name="l01356"></a>01356   <span class="comment">//make writeout array</span>
<a name="l01357"></a>01357   numArrayVals = numDataPoint*numComponent;
<a name="l01358"></a>01358   <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l01359"></a>01359     newdatatype = <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>;
<a name="l01360"></a>01360     vwritedata = (<span class="keywordtype">float</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));    
<a name="l01361"></a>01361   } <span class="keywordflow">else</span> { <span class="comment">//knows its an int or a double cause that was checked above)</span>
<a name="l01362"></a>01362     newdatatype = <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>;
<a name="l01363"></a>01363     vwritedata = (<span class="keywordtype">double</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01364"></a>01364   }
<a name="l01365"></a>01365   <span class="keywordflow">if</span> (vwritedata == NULL){
<a name="l01366"></a>01366     <span class="comment">//no clean up in case of memory error</span>
<a name="l01367"></a>01367     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l01368"></a>01368     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l01369"></a>01369   }
<a name="l01370"></a>01370 
<a name="l01371"></a>01371   rangeindex = 0;
<a name="l01372"></a>01372   <span class="keywordflow">for</span> (i = 0; i &lt; numStep; i++) { <span class="comment">//like each time</span>
<a name="l01373"></a>01373     <span class="keywordtype">int</span> count = 0;
<a name="l01374"></a>01374     <span class="keywordtype">double</span> currtime, itertime;
<a name="l01375"></a>01375 
<a name="l01376"></a>01376     <span class="comment">//get new time</span>
<a name="l01377"></a>01377     <span class="keywordflow">switch</span>(seqdatatype){
<a name="l01378"></a>01378     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l01379"></a>01379       currtime = ((<span class="keywordtype">int</span>*)(seqcoords))[i];
<a name="l01380"></a>01380       itertime = ((<span class="keywordtype">int</span>*)(seqcoords))[rangeindex];
<a name="l01381"></a>01381       <span class="keywordflow">break</span>;
<a name="l01382"></a>01382     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>: 
<a name="l01383"></a>01383       <span class="comment">//we are going to use double for the time no matter</span>
<a name="l01384"></a>01384       <span class="comment">//what cause its easier</span>
<a name="l01385"></a>01385       currtime = ((<span class="keywordtype">float</span>*)seqcoords)[i];
<a name="l01386"></a>01386       itertime = ((<span class="keywordtype">float</span>*)seqcoords)[rangeindex];
<a name="l01387"></a>01387       <span class="keywordflow">break</span>;
<a name="l01388"></a>01388     <span class="keywordflow">default</span>: <span class="comment">//know its a double</span>
<a name="l01389"></a>01389       currtime = ((<span class="keywordtype">double</span>*)seqcoords)[i];
<a name="l01390"></a>01390       itertime = ((<span class="keywordtype">double</span>*)seqcoords)[rangeindex];
<a name="l01391"></a>01391     }
<a name="l01392"></a>01392 
<a name="l01393"></a>01393     <span class="comment">//move rangeindex if necessary</span>
<a name="l01394"></a>01394     <span class="keywordflow">while</span> ((currtime - itertime) &gt; windowtime){
<a name="l01395"></a>01395       rangeindex++;
<a name="l01396"></a>01396       <span class="keywordflow">switch</span>(seqdatatype){
<a name="l01397"></a>01397       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l01398"></a>01398      itertime = ((<span class="keywordtype">int</span>*)seqcoords)[rangeindex];
<a name="l01399"></a>01399      <span class="keywordflow">break</span>;
<a name="l01400"></a>01400       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l01401"></a>01401      itertime = ((<span class="keywordtype">float</span>*)seqcoords)[rangeindex];
<a name="l01402"></a>01402      <span class="keywordflow">break</span>;
<a name="l01403"></a>01403       <span class="keywordflow">default</span>: <span class="comment">//know its a double</span>
<a name="l01404"></a>01404      itertime = ((<span class="keywordtype">double</span>*)seqcoords)[rangeindex];
<a name="l01405"></a>01405       }
<a name="l01406"></a>01406     }
<a name="l01407"></a>01407 
<a name="l01408"></a>01408     <span class="keywordflow">for</span> (j = 0; j &lt; numArrayVals; j++){
<a name="l01409"></a>01409       <span class="keywordflow">if</span> (newdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l01410"></a>01410      ((<span class="keywordtype">float</span>*)vwritedata)[j] = 0.0;
<a name="l01411"></a>01411       }<span class="keywordflow">else</span> {
<a name="l01412"></a>01412      ((<span class="keywordtype">double</span>*)vwritedata)[j] = 0.0;
<a name="l01413"></a>01413       }
<a name="l01414"></a>01414     }
<a name="l01415"></a>01415 
<a name="l01416"></a>01416     <span class="keywordflow">for</span> (j = rangeindex; j &lt;= i ; j++){
<a name="l01417"></a>01417       <span class="keywordtype">void</span> *data;
<a name="l01418"></a>01418       <span class="keywordtype">int</span> k;
<a name="l01419"></a>01419 
<a name="l01420"></a>01420       rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(seqvar[j], &amp;data);
<a name="l01421"></a>01421       <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01422"></a>01422      data = NULL;
<a name="l01423"></a>01423      <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01424"></a>01424      free(*newseqvar);
<a name="l01425"></a>01425      *newseqvar=NULL;
<a name="l01426"></a>01426      free(vwritedata);
<a name="l01427"></a>01427      <span class="keywordflow">return</span> rc;
<a name="l01428"></a>01428       }
<a name="l01429"></a>01429 
<a name="l01430"></a>01430       <span class="keywordflow">for</span> (k = 0; k &lt; numArrayVals; k++){
<a name="l01431"></a>01431      <span class="keywordflow">switch</span>(datatype){
<a name="l01432"></a>01432      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l01433"></a>01433        ((<span class="keywordtype">double</span>*)vwritedata)[k] += ((<span class="keywordtype">int</span>*)data)[k];
<a name="l01434"></a>01434        <span class="keywordflow">break</span>;
<a name="l01435"></a>01435      <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l01436"></a>01436        ((<span class="keywordtype">float</span>*)vwritedata)[k] += ((<span class="keywordtype">float</span>*)data)[k];
<a name="l01437"></a>01437        <span class="keywordflow">break</span>;
<a name="l01438"></a>01438      <span class="keywordflow">default</span>: <span class="comment">//knows its a double cause that was checked above</span>
<a name="l01439"></a>01439        ((<span class="keywordtype">double</span>*)vwritedata)[k] += ((<span class="keywordtype">double</span>*)data)[k];
<a name="l01440"></a>01440        <span class="keywordflow">break</span>;
<a name="l01441"></a>01441      }
<a name="l01442"></a>01442       }
<a name="l01443"></a>01443       count++;
<a name="l01444"></a>01444     } <span class="comment">//end for - over all those in range</span>
<a name="l01445"></a>01445 
<a name="l01446"></a>01446     <span class="keywordflow">for</span> (j = 0 ; j &lt; numArrayVals; j++){
<a name="l01447"></a>01447       <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l01448"></a>01448         ((<span class="keywordtype">float</span>*)vwritedata)[j] /= (float)count;
<a name="l01449"></a>01449       }<span class="keywordflow">else</span> {
<a name="l01450"></a>01450         ((<span class="keywordtype">double</span>*)vwritedata)[j] /= (double)count;
<a name="l01451"></a>01451       }
<a name="l01452"></a>01452     }
<a name="l01453"></a>01453 
<a name="l01454"></a>01454     rc = <a class="code" href="group__Variable.html#g3f958d3b630c9df78a4e7fbca287b039" title="Set the variable data by copy.">fc_setVariableData</a>((*newseqvar)[i], numDataPoint,
<a name="l01455"></a>01455                             numComponent, assoc, mathtype,
<a name="l01456"></a>01456                             newdatatype,vwritedata);
<a name="l01457"></a>01457     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l01458"></a>01458       <span class="comment">//additional clean up</span>
<a name="l01459"></a>01459       <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l01460"></a>01460 
<a name="l01461"></a>01461       free(*newseqvar);
<a name="l01462"></a>01462       free(vwritedata);
<a name="l01463"></a>01463       *newseqvar=NULL;
<a name="l01464"></a>01464       <span class="keywordflow">return</span> rc;
<a name="l01465"></a>01465     }
<a name="l01466"></a>01466   } <span class="comment">// end for - timestep</span>
<a name="l01467"></a>01467 
<a name="l01468"></a>01468   free(vwritedata);
<a name="l01469"></a>01469 
<a name="l01470"></a>01470   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l01471"></a>01471 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="g9cb7e0a54cf1dd1e77eb224877f45183"></a><!-- doxytag: member="series.c::fc_linearInterpolation" ref="g9cb7e0a54cf1dd1e77eb224877f45183" args="(int numStep, FC_Variable *seqvar, FC_Sequence newseq, char *varname, FC_Variable **newseqvar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_linearInterpolation           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>seqvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Sequence.html">FC_Sequence</a>&nbsp;</td>
          <td class="paramname"> <em>newseq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> **&nbsp;</td>
          <td class="paramname"> <em>newseqvar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return a handle to a seqvar that is the old seq var on a new sequence. Linear interpolation is done to get the values at the new sequence points. 
<p>
<b>Description:</b> <p>
Returns a handle to a seqvar that is the old seq var on a new sequence. Linear interpolation is done to get the values at the new sequence points. Each Data Point and Component are calculated separately. The return values of the variable will be Double.<p>
The new and old sequences must be monotonically increasing.<p>
This will return with an error if the sequences and the variable are not numerical. This will return with an error if the new sequence range is greater than that of the original sequence.<p>
Like fc_createSeqVariable, it actaully allocates the memory for the array here - the user must call deleteSeqVariable *and* free unless delete gets changed.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000061">Todo:</a></b></dt><dd>see if this algorithm (or a trivially modified one) will work for monotonically decreasing sequences. </dd></dl>
<dl compact><dt><b><a class="el" href="todo.html#_todo000061">Todo:</a></b></dt><dd>see about rewriting taking advantage of fc_getSequenceClosestValue.</dd></dl>
<b>Modifications:</b> <ul>
<li>4/12/05 ACG, Created</li><li>01/09/06 ACG changing/removing handling/cleanup in case of datatype error at WSK recommendation since it skews the coverage testing. Either there is already an explict type check or if those lines are reached you've got serious errors and the cleanup doesnt matter.</li><li>01/19/06 ACG clean up </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - number of steps in the seq var </td></tr>
<tr><td valign="top"><em>seqvar</em>&nbsp;</td><td>
input - seq var averaging over </td></tr>
<tr><td valign="top"><em>newseq</em>&nbsp;</td><td>
input - sequence new variable will be over </td></tr>
<tr><td valign="top"><em>varname</em>&nbsp;</td><td>
input - name for output seq var </td></tr>
<tr><td valign="top"><em>newseqvar</em>&nbsp;</td><td>
output - handles for output seq var </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="series_8c-source.html#l00347">347</a> of file <a class="el" href="series_8c-source.html">series.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l06536">_fc_getVarSlot()</a>, <a class="el" href="variable_8c-source.html#l00350">fc_createSeqVariable()</a>, <a class="el" href="util_8h-source.html#l00136">FC_DBL_EQUIV</a>, <a class="el" href="variable_8c-source.html#l05062">fc_deleteSeqVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="base_8h-source.html#l00105">FC_ERROR</a>, <a class="el" href="variable_8c-source.html#l05392">fc_getMeshFromVariable()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="sequence_8c-source.html#l01737">fc_getSequenceCoordsPtr()</a>, <a class="el" href="variable_8c-source.html#l05317">fc_getSequenceFromSeqVariable()</a>, <a class="el" href="sequence_8c-source.html#l01612">fc_getSequenceInfo()</a>, <a class="el" href="statistics_8c-source.html#l01753">fc_getSequenceMinMaxMono()</a>, <a class="el" href="variable_8c-source.html#l05773">fc_getVariableDataAsDataType()</a>, <a class="el" href="variable_8c-source.html#l05498">fc_getVariableDataType()</a>, <a class="el" href="variable_8c-source.html#l05433">fc_getVariableInfo()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="sequence_8c-source.html#l01505">fc_isSequenceValid()</a>, <a class="el" href="variable_8c-source.html#l05178">fc_isSeqVariableValid()</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="variable_8c-source.html#l00469">fc_setVariableData()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="variableP_8h-source.html#l00075">_FC_VarSlot::header</a>, <a class="el" href="tableP_8h-source.html#l00100">_FC_SlotHeader::name</a>, and <a class="el" href="seriesAnalyzer_8c-source.html#l00102">numComponent</a>.</p>

<p>Referenced by <a class="el" href="seriesDemo_8c-source.html#l00075">main()</a>, and <a class="el" href="seriesAnalyzer_8c-source.html#l00324">makeIntersecting()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00353"></a>00353  {
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc, rc1, rc2;
<a name="l00356"></a>00356   <a class="code" href="struct__FC__VarSlot.html" title="Variable Slot Structure for the Variable Table.">_FC_VarSlot</a>* varSlot;
<a name="l00357"></a>00357   <span class="keywordtype">int</span> numDataPoint;
<a name="l00358"></a>00358   <span class="keywordtype">int</span> <a class="code" href="seriesAnalyzer_8c.html#9ba814c62f21460639802c7771e86fa6">numComponent</a>;
<a name="l00359"></a>00359   <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> mesh;
<a name="l00360"></a>00360   <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> seq;
<a name="l00361"></a>00361   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc;
<a name="l00362"></a>00362   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype;
<a name="l00363"></a>00363   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype, newdatatype;
<a name="l00364"></a>00364   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> seqdatatype, newseqdatatype;
<a name="l00365"></a>00365   <span class="keywordtype">int</span> seqnumstep, newseqnumstep;
<a name="l00366"></a>00366   <span class="keywordtype">void</span> *seqcoords, *newseqcoords;
<a name="l00367"></a>00367   <span class="keywordtype">double</span>* writedata;
<a name="l00368"></a>00368   <span class="keywordtype">double</span> seqprev, seqnext, newseqprev, newseqnext;
<a name="l00369"></a>00369   <span class="keywordtype">int</span> iseq, inewseq;
<a name="l00370"></a>00370   <span class="keywordtype">int</span> numArrayVals;
<a name="l00371"></a>00371   <span class="keywordtype">int</span> j,k;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <span class="keywordflow">if</span> (newseqvar)
<a name="l00375"></a>00375     *newseqvar = NULL;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377   <span class="comment">//will check below to see that its appropriate numerical type</span>
<a name="l00378"></a>00378   <span class="keywordflow">if</span> ((!<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,seqvar)) || !newseqvar
<a name="l00379"></a>00379       || !varname  || !<a class="code" href="group__Sequence.html#g55e1bf7be4e19be93103378503b123b9" title="Check that the handle refers to a valid sequence.">fc_isSequenceValid</a>(newseq)){
<a name="l00380"></a>00380     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l00381"></a>00381     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00382"></a>00382   };
<a name="l00383"></a>00383 
<a name="l00384"></a>00384   rc = <a class="code" href="group__Variable.html#gd3b7cecfd0c6d488e82b426b4c114aba" title="Return the data type of a variable.">fc_getVariableDataType</a>(seqvar[0],&amp;datatype);
<a name="l00385"></a>00385   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00386"></a>00386     <span class="keywordflow">return</span> rc;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388   <span class="keywordflow">if</span> (!(datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l00389"></a>00389         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l00390"></a>00390         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l00391"></a>00391       ){
<a name="l00392"></a>00392     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00393"></a>00393   } 
<a name="l00394"></a>00394 
<a name="l00395"></a>00395   rc = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,seqvar,&amp;seq);
<a name="l00396"></a>00396   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00397"></a>00397     <span class="keywordflow">return</span> rc;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399   rc1 = <a class="code" href="group__Sequence.html#g39b5198d7c58288101f909fac5569f71" title="Get information about a sequence.">fc_getSequenceInfo</a>(seq, &amp;seqnumstep, &amp;seqdatatype);
<a name="l00400"></a>00400   rc2 = <a class="code" href="group__Sequence.html#g39b5198d7c58288101f909fac5569f71" title="Get information about a sequence.">fc_getSequenceInfo</a>(newseq, &amp;newseqnumstep, &amp;newseqdatatype);
<a name="l00401"></a>00401   <span class="keywordflow">if</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> || rc2 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) 
<a name="l00402"></a>00402     <span class="keywordflow">return</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> ? rc1: rc2);     <span class="comment">//if both are bad, will get first back. </span>
<a name="l00403"></a>00403 
<a name="l00404"></a>00404   <span class="keywordflow">if</span> (seqnumstep &lt; 1 || newseqnumstep &lt; 1){
<a name="l00405"></a>00405     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00406"></a>00406   }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408   <span class="comment">//check datatypes are right</span>
<a name="l00409"></a>00409   <span class="comment">//already checked that the variable was numerical</span>
<a name="l00410"></a>00410   <span class="keywordflow">if</span> (!((seqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l00411"></a>00411          seqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l00412"></a>00412          seqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>) &amp;&amp;
<a name="l00413"></a>00413         (newseqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l00414"></a>00414          newseqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l00415"></a>00415          newseqdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> ))){
<a name="l00416"></a>00416     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"Invalid datatype"</span>);
<a name="l00417"></a>00417     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00418"></a>00418   }
<a name="l00419"></a>00419   newdatatype = <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>; <span class="comment">// return var type will be double</span>
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   <span class="comment">//lets check monotonicty upfront</span>
<a name="l00422"></a>00422   rc1 = <a class="code" href="group__Statistics.html#g31eedcdb364aa8ab2bdf2dde14c8bfbe" title="Returns min and max of a sequence and the indicies where they occur and returns monotonicity...">fc_getSequenceMinMaxMono</a>(seq,&amp;seqprev,NULL,&amp;seqnext,NULL,&amp;j);
<a name="l00423"></a>00423   rc2 = <a class="code" href="group__Statistics.html#g31eedcdb364aa8ab2bdf2dde14c8bfbe" title="Returns min and max of a sequence and the indicies where they occur and returns monotonicity...">fc_getSequenceMinMaxMono</a>(newseq,&amp;newseqprev,NULL,&amp;newseqnext,NULL,&amp;k);
<a name="l00424"></a>00424   <span class="keywordflow">if</span> (rc1 !=  <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> || rc2 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00425"></a>00425     <span class="keywordflow">return</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> ? rc1: rc2);     <span class="comment">//if both are bad, will get first back. </span>
<a name="l00426"></a>00426     
<a name="l00427"></a>00427   <span class="keywordflow">if</span> (j != 1 &amp;&amp; j != 2){
<a name="l00428"></a>00428     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"Orig sequence not monotonically increasing"</span>);
<a name="l00429"></a>00429     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00430"></a>00430   }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432   <span class="keywordflow">if</span> (k != 1 &amp;&amp; k !=2){
<a name="l00433"></a>00433     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"New sequence not monotonically increasing"</span>);
<a name="l00434"></a>00434     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00435"></a>00435   }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437   <span class="comment">//now check BC - if the boundaries are off by DBL_epsilon its still ok</span>
<a name="l00438"></a>00438   <span class="keywordflow">if</span> (newseqnext &gt; seqnext &amp;&amp; !<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(newseqnext,seqnext)){
<a name="l00439"></a>00439     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"New sequence range end too high"</span>);
<a name="l00440"></a>00440     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00441"></a>00441   }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443   <span class="keywordflow">if</span> (newseqprev &lt; seqprev &amp;&amp; !<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(newseqprev,seqprev)){
<a name="l00444"></a>00444     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"New sequence range begin too low"</span>);
<a name="l00445"></a>00445     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00446"></a>00446   }
<a name="l00447"></a>00447 
<a name="l00448"></a>00448   <span class="comment">//finally ok! </span>
<a name="l00449"></a>00449   varSlot = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(seqvar[0]);
<a name="l00450"></a>00450   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Linear interpolations for seq variable '%s'"</span>,
<a name="l00451"></a>00451                       varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>);
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   rc = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(seqvar[0],&amp;mesh);
<a name="l00454"></a>00454   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l00455"></a>00455     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(rc));
<a name="l00456"></a>00456     <span class="keywordflow">return</span> rc;
<a name="l00457"></a>00457   }
<a name="l00458"></a>00458 
<a name="l00459"></a>00459   rc = <a class="code" href="group__Variable.html#g05d5098e68c1761ac851b2509dfbea70" title="Create a new sequence variable.">fc_createSeqVariable</a>(mesh, newseq, varname, &amp;newseqnumstep, newseqvar);
<a name="l00460"></a>00460   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l00461"></a>00461     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(newseqnumstep,*newseqvar); 
<a name="l00462"></a>00462     free(*newseqvar);
<a name="l00463"></a>00463     *newseqvar=NULL;
<a name="l00464"></a>00464     <span class="keywordflow">return</span> rc;
<a name="l00465"></a>00465   }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467   rc = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(seqvar[0], &amp;numDataPoint, &amp;numComponent, &amp;assoc,
<a name="l00468"></a>00468                            &amp;mathtype, &amp;datatype);
<a name="l00469"></a>00469   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l00470"></a>00470     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(newseqnumstep,*newseqvar); 
<a name="l00471"></a>00471     free(*newseqvar);
<a name="l00472"></a>00472     *newseqvar=NULL;
<a name="l00473"></a>00473     <span class="keywordflow">return</span> rc;
<a name="l00474"></a>00474   }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476   <span class="comment">//make writeout arrays</span>
<a name="l00477"></a>00477   numArrayVals = numDataPoint*numComponent; 
<a name="l00478"></a>00478   writedata = (<span class="keywordtype">double</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00479"></a>00479 
<a name="l00480"></a>00480   <span class="comment">//get data arrays</span>
<a name="l00481"></a>00481   rc1 = <a class="code" href="group__Sequence.html#ga88160e25be202c8de18ac89edf876c6" title="Get sequence coordinates.">fc_getSequenceCoordsPtr</a>(seq, &amp;seqcoords);
<a name="l00482"></a>00482   rc2 = <a class="code" href="group__Sequence.html#ga88160e25be202c8de18ac89edf876c6" title="Get sequence coordinates.">fc_getSequenceCoordsPtr</a>(newseq, &amp;newseqcoords);
<a name="l00483"></a>00483   <span class="keywordflow">if</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> || rc2 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l00484"></a>00484     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(newseqnumstep,*newseqvar); 
<a name="l00485"></a>00485     free(*newseqvar);
<a name="l00486"></a>00486     *newseqvar=NULL;
<a name="l00487"></a>00487     <span class="keywordflow">return</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> ? rc1: rc2);     <span class="comment">//if both are bad, will get first back. </span>
<a name="l00488"></a>00488   }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490   iseq = 0;
<a name="l00491"></a>00491   seqnext= seqprev; <span class="comment">// get it back to beginning</span>
<a name="l00492"></a>00492   <span class="keywordflow">for</span> (inewseq = 0; inewseq &lt; newseqnumstep; inewseq++) { <span class="comment">//like each time</span>
<a name="l00493"></a>00493     <span class="comment">//get current value</span>
<a name="l00494"></a>00494     newseqprev = newseqnext;
<a name="l00495"></a>00495     <span class="keywordflow">switch</span>(newseqdatatype){
<a name="l00496"></a>00496     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l00497"></a>00497       newseqnext = (double)((<span class="keywordtype">int</span>*)newseqcoords)[inewseq];
<a name="l00498"></a>00498       <span class="keywordflow">break</span>;
<a name="l00499"></a>00499     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l00500"></a>00500       newseqnext = (double)((<span class="keywordtype">float</span>*)newseqcoords)[inewseq];
<a name="l00501"></a>00501       <span class="keywordflow">break</span>;
<a name="l00502"></a>00502     <span class="keywordflow">default</span>: <span class="comment">// its a double cuase i checked this above</span>
<a name="l00503"></a>00503       newseqnext = ((<span class="keywordtype">double</span>*)newseqcoords)[inewseq];
<a name="l00504"></a>00504       <span class="keywordflow">break</span>;
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     <span class="comment">//find the range for this seq val in the old seq</span>
<a name="l00509"></a>00509     <span class="keywordflow">while</span>( seqnext &lt; newseqnext  &amp;&amp; !<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(newseqnext,seqnext)){
<a name="l00510"></a>00510       iseq++; 
<a name="l00511"></a>00511       <span class="comment">//know shouldnt overrun seqnumstep, but checking it anyway</span>
<a name="l00512"></a>00512       <span class="keywordflow">if</span> (iseq &gt; seqnumstep-1){
<a name="l00513"></a>00513      <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"Overran sequence bounds. Developer Error!"</span>);
<a name="l00514"></a>00514      <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>;
<a name="l00515"></a>00515       }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517       seqprev = seqnext;
<a name="l00518"></a>00518       <span class="keywordflow">switch</span>(seqdatatype){
<a name="l00519"></a>00519       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l00520"></a>00520         seqnext = (double)((<span class="keywordtype">int</span>*)seqcoords)[iseq];
<a name="l00521"></a>00521         <span class="keywordflow">break</span>;
<a name="l00522"></a>00522       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:
<a name="l00523"></a>00523         seqnext = (double)((<span class="keywordtype">float</span>*)seqcoords)[iseq];
<a name="l00524"></a>00524         <span class="keywordflow">break</span>;
<a name="l00525"></a>00525       <span class="keywordflow">default</span>: <span class="comment">//its a double cause i checked this above</span>
<a name="l00526"></a>00526         seqnext = ((<span class="keywordtype">double</span>*)seqcoords)[iseq];
<a name="l00527"></a>00527         <span class="keywordflow">break</span>;
<a name="l00528"></a>00528       }
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530 
<a name="l00531"></a>00531     <span class="comment">//now we have the boundaries for the val we are looking for</span>
<a name="l00532"></a>00532     <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(newseqnext,seqnext)){ <span class="comment">//then just copy over val</span>
<a name="l00533"></a>00533       <span class="keywordtype">double</span>* datanext = NULL;
<a name="l00534"></a>00534       rc = <a class="code" href="group__Variable.html#gd2bb293943346a413ef5fa244a072b8f" title="Get a copy of a variable&amp;#39;s data as the requested data type.">fc_getVariableDataAsDataType</a>(seqvar[iseq], <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>,
<a name="l00535"></a>00535                                         (<span class="keywordtype">void</span>**)(&amp;datanext));
<a name="l00536"></a>00536       <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l00537"></a>00537         <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(newseqnumstep,*newseqvar);
<a name="l00538"></a>00538         free(*newseqvar);
<a name="l00539"></a>00539         *newseqvar=NULL;
<a name="l00540"></a>00540         <span class="keywordflow">if</span> (datanext) free(datanext);
<a name="l00541"></a>00541         <span class="keywordflow">if</span> (writedata) free(writedata);
<a name="l00542"></a>00542         <span class="keywordflow">return</span> rc;
<a name="l00543"></a>00543       }
<a name="l00544"></a>00544 
<a name="l00545"></a>00545       <span class="comment">//copy it over</span>
<a name="l00546"></a>00546       rc = <a class="code" href="group__Variable.html#g3f958d3b630c9df78a4e7fbca287b039" title="Set the variable data by copy.">fc_setVariableData</a>((*newseqvar)[inewseq], numDataPoint,
<a name="l00547"></a>00547                                 numComponent, assoc, mathtype,
<a name="l00548"></a>00548                                 newdatatype,datanext);
<a name="l00549"></a>00549       free(datanext);
<a name="l00550"></a>00550       <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l00551"></a>00551         <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(newseqnumstep,*newseqvar);
<a name="l00552"></a>00552         free(*newseqvar);
<a name="l00553"></a>00553         *newseqvar=NULL;
<a name="l00554"></a>00554         <span class="keywordflow">if</span> (writedata) free(writedata);
<a name="l00555"></a>00555         <span class="keywordflow">return</span> rc;
<a name="l00556"></a>00556       }
<a name="l00557"></a>00557     } <span class="keywordflow">else</span> {       <span class="comment">//interpolate</span>
<a name="l00558"></a>00558       <span class="keywordtype">double</span>* dataprev = NULL;
<a name="l00559"></a>00559       <span class="keywordtype">double</span>* datanext = NULL;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561       rc1 = <a class="code" href="group__Variable.html#gd2bb293943346a413ef5fa244a072b8f" title="Get a copy of a variable&amp;#39;s data as the requested data type.">fc_getVariableDataAsDataType</a>(seqvar[iseq], <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>,
<a name="l00562"></a>00562                          (<span class="keywordtype">void</span>**)(&amp;datanext));
<a name="l00563"></a>00563       rc2 = <a class="code" href="group__Variable.html#gd2bb293943346a413ef5fa244a072b8f" title="Get a copy of a variable&amp;#39;s data as the requested data type.">fc_getVariableDataAsDataType</a>(seqvar[iseq-1], <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>,
<a name="l00564"></a>00564                          (<span class="keywordtype">void</span>**)(&amp;dataprev));
<a name="l00565"></a>00565       <span class="keywordflow">if</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> || rc2 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l00566"></a>00566      <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(newseqnumstep,*newseqvar);
<a name="l00567"></a>00567      free(*newseqvar);
<a name="l00568"></a>00568      *newseqvar=NULL;
<a name="l00569"></a>00569      <span class="keywordflow">if</span> (datanext) free(datanext);
<a name="l00570"></a>00570      <span class="keywordflow">if</span> (dataprev) free(dataprev);
<a name="l00571"></a>00571      <span class="keywordflow">if</span> (writedata) free(writedata);
<a name="l00572"></a>00572      <span class="keywordflow">return</span> (rc1 != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a> ? rc1: rc2);     <span class="comment">//if both are bad, will get first back. </span>
<a name="l00573"></a>00573       }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575       <span class="comment">//filling in variable</span>
<a name="l00576"></a>00576       <span class="keywordflow">for</span> (j = 0; j &lt; numArrayVals; j++){
<a name="l00577"></a>00577      <span class="keywordtype">double</span> dt, dvar, diff;
<a name="l00578"></a>00578      
<a name="l00579"></a>00579      dt = seqnext-seqprev; 
<a name="l00580"></a>00580      <span class="comment">//dt shouldnt be zero since we checked it with the monotonicity</span>
<a name="l00581"></a>00581      <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(dt,0.0)){
<a name="l00582"></a>00582        printf(<span class="stringliteral">"** Developer Alert! Should never reach this point!**\n"</span>);
<a name="l00583"></a>00583        fflush(NULL);
<a name="l00584"></a>00584        <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <span class="stringliteral">"Zero time step "</span>);
<a name="l00585"></a>00585        <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>;
<a name="l00586"></a>00586      }
<a name="l00587"></a>00587      dvar = datanext[j]- dataprev[j];
<a name="l00588"></a>00588      diff = newseqnext-seqprev;
<a name="l00589"></a>00589      
<a name="l00590"></a>00590      <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(diff,0.0) || <a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(dvar,0.0)){
<a name="l00591"></a>00591        writedata[j] = dataprev[j];
<a name="l00592"></a>00592      } <span class="keywordflow">else</span> {
<a name="l00593"></a>00593        writedata[j] = dvar*(diff/dt)+dataprev[j];
<a name="l00594"></a>00594      }
<a name="l00595"></a>00595       }
<a name="l00596"></a>00596       
<a name="l00597"></a>00597       <span class="keywordflow">if</span> (dataprev) free(dataprev);
<a name="l00598"></a>00598       <span class="keywordflow">if</span> (datanext) free(datanext);
<a name="l00599"></a>00599         
<a name="l00600"></a>00600       rc = <a class="code" href="group__Variable.html#g3f958d3b630c9df78a4e7fbca287b039" title="Set the variable data by copy.">fc_setVariableData</a>((*newseqvar)[inewseq], numDataPoint,
<a name="l00601"></a>00601                      numComponent, assoc, mathtype,
<a name="l00602"></a>00602                      newdatatype,writedata);
<a name="l00603"></a>00603       <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l00604"></a>00604      <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(newseqnumstep,*newseqvar);
<a name="l00605"></a>00605      free(*newseqvar);
<a name="l00606"></a>00606      *newseqvar=NULL;
<a name="l00607"></a>00607      <span class="keywordflow">if</span> (writedata) free(writedata);
<a name="l00608"></a>00608      <span class="keywordflow">return</span> rc;
<a name="l00609"></a>00609       }
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611   }
<a name="l00612"></a>00612                               
<a name="l00613"></a>00613   <span class="keywordflow">if</span> (writedata) free(writedata);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="gbf6c5e2e21752cec449de43d88ce83f8"></a><!-- doxytag: member="series.c::fc_linearLeastSquares" ref="gbf6c5e2e21752cec449de43d88ce83f8" args="(int numStep, FC_Variable *seqvar, FC_Variable *newvar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_linearLeastSquares           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>seqvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>newvar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Given an N Data Point, Single Component sequence variable, returns a handle to a var containing linear least squares parameters, a,b,r2,SE(a),SE(b), where y=a+bx. 
<p>
<b>Description:</b> <p>
Given an N Data Point, Single Component sequence variable, return a handle to an N DataPoint, 5 component non-sequence variable containing least squares parameters a,b,r2,SE(a),SE(b), where y=a+bx. Therefore, the least-squares fit is doen for each data point's series independently The variable must be single component and it is understood that x=seq values and y = variable values.<p>
The output variable name is the name of the original variable, postpended with "_LSQ" with values in the order given above. It will be a Double.<p>
This will return with an error if the seqvars are not numerical. if ssxx == 0, all values will be -1. if ssyy == 0, all values are calc, except r2 ==-1 if numStep &lt; 3, all values are calc, except SE(a) and SE(b) == -1<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000070">Todo:</a></b></dt><dd>see about relaxing the single component constraint.</dd></dl>
<b>Modifications:</b> <ul>
<li>3/21/05 ACG, Created</li><li>4/06/05 ACG, changed from calculating the sumofsquares to the actual linear least squares fit. will worry about what to do for non-linear fits later</li><li>01/09/06 ACG changing/removing handling/cleanup in case of datatype error at WSK recommendation since it skews the coverage testing. Either there is already an explict type check or if those lines are reached you've got serious erros and the cleanup doesnt matter. </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - number of steps in the seq var </td></tr>
<tr><td valign="top"><em>seqvar</em>&nbsp;</td><td>
input - seq var </td></tr>
<tr><td valign="top"><em>newvar</em>&nbsp;</td><td>
output - handle for output var </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="series_8c-source.html#l02499">2499</a> of file <a class="el" href="series_8c-source.html">series.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l06536">_fc_getVarSlot()</a>, <a class="el" href="variable_8c-source.html#l00286">fc_createVariable()</a>, <a class="el" href="util_8h-source.html#l00136">FC_DBL_EQUIV</a>, <a class="el" href="variable_8c-source.html#l04980">fc_deleteVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="base_8h-source.html#l00105">FC_ERROR</a>, <a class="el" href="variable_8c-source.html#l05392">fc_getMeshFromVariable()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="sequence_8c-source.html#l01737">fc_getSequenceCoordsPtr()</a>, <a class="el" href="sequence_8c-source.html#l01687">fc_getSequenceDataType()</a>, <a class="el" href="variable_8c-source.html#l05317">fc_getSequenceFromSeqVariable()</a>, <a class="el" href="variable_8c-source.html#l05715">fc_getVariableDataPtr()</a>, <a class="el" href="variable_8c-source.html#l05433">fc_getVariableInfo()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="variable_8c-source.html#l05178">fc_isSeqVariableValid()</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="base_8h-source.html#l00171">FC_MT_VECTOR</a>, <a class="el" href="base_8c-source.html#l00779">FC_NULL_VARIABLE</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="variable_8c-source.html#l00604">fc_setVariableDataPtr()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="util_8h-source.html#l00085">FC_VALUE_EQUIV</a>, <a class="el" href="variableP_8h-source.html#l00075">_FC_VarSlot::header</a>, <a class="el" href="tableP_8h-source.html#l00100">_FC_SlotHeader::name</a>, and <a class="el" href="seriesAnalyzer_8c-source.html#l00102">numComponent</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02503"></a>02503       {
<a name="l02504"></a>02504   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l02505"></a>02505   <a class="code" href="struct__FC__VarSlot.html" title="Variable Slot Structure for the Variable Table.">_FC_VarSlot</a>* varSlot;
<a name="l02506"></a>02506   <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> mesh;
<a name="l02507"></a>02507   <span class="keywordtype">int</span> numDataPoint;
<a name="l02508"></a>02508   <span class="keywordtype">int</span> <a class="code" href="seriesAnalyzer_8c.html#9ba814c62f21460639802c7771e86fa6">numComponent</a>;
<a name="l02509"></a>02509   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc;
<a name="l02510"></a>02510   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype;
<a name="l02511"></a>02511   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype, dt;
<a name="l02512"></a>02512   <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> seq;
<a name="l02513"></a>02513   <span class="keywordtype">int</span> sum_dim;
<a name="l02514"></a>02514   <span class="keywordtype">int</span> i,j;
<a name="l02515"></a>02515   <span class="keywordtype">void</span>* data;
<a name="l02516"></a>02516   <span class="keywordtype">double</span> *sumx, *sumy, *sumzz, *retdata;
<a name="l02517"></a>02517   <span class="keywordtype">char</span> *varname, *returnname;
<a name="l02518"></a>02518   <span class="keywordtype">void</span>* seqcoords;
<a name="l02519"></a>02519 
<a name="l02520"></a>02520 
<a name="l02521"></a>02521   <span class="keywordflow">if</span> (newvar)
<a name="l02522"></a>02522     *newvar = <a class="code" href="group__Handles.html#g82162b8ad3f5476855507c3c6450db09" title="Null (default) variable handle.">FC_NULL_VARIABLE</a>;
<a name="l02523"></a>02523 
<a name="l02524"></a>02524   <span class="comment">//check input</span>
<a name="l02525"></a>02525   <span class="keywordflow">if</span> (newvar == NULL ||
<a name="l02526"></a>02526       (!<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,seqvar))){
<a name="l02527"></a>02527     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l02528"></a>02528     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02529"></a>02529   }
<a name="l02530"></a>02530 
<a name="l02531"></a>02531 
<a name="l02532"></a>02532   varSlot = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(seqvar[0]);
<a name="l02533"></a>02533   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Getting sumofSquares for seq variable '%s'"</span>,
<a name="l02534"></a>02534                       varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>);
<a name="l02535"></a>02535 
<a name="l02536"></a>02536 
<a name="l02537"></a>02537   rc = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(seqvar[0], &amp;numDataPoint, &amp;numComponent, &amp;assoc,
<a name="l02538"></a>02538                            &amp;mathtype, &amp;datatype);
<a name="l02539"></a>02539   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) <span class="keywordflow">return</span> rc;
<a name="l02540"></a>02540 
<a name="l02541"></a>02541   <span class="keywordflow">if</span> (!(datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l02542"></a>02542         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l02543"></a>02543         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l02544"></a>02544       ){
<a name="l02545"></a>02545     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02546"></a>02546   } 
<a name="l02547"></a>02547 
<a name="l02548"></a>02548   <span class="keywordflow">if</span> (numComponent != 1){
<a name="l02549"></a>02549     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02550"></a>02550   }
<a name="l02551"></a>02551 
<a name="l02552"></a>02552   rc = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep,seqvar,&amp;seq);
<a name="l02553"></a>02553   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l02554"></a>02554     <span class="keywordflow">return</span> rc;
<a name="l02555"></a>02555 
<a name="l02556"></a>02556   rc = <a class="code" href="group__Sequence.html#ga88160e25be202c8de18ac89edf876c6" title="Get sequence coordinates.">fc_getSequenceCoordsPtr</a>(seq,&amp;seqcoords);
<a name="l02557"></a>02557   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l02558"></a>02558     <span class="keywordflow">return</span> rc;
<a name="l02559"></a>02559 
<a name="l02560"></a>02560   rc = <a class="code" href="group__Sequence.html#g6d5a8a30edd00c973804c7ce31a3a2e6" title="Get the data type of a sequence&amp;#39;s coordinates.">fc_getSequenceDataType</a>(seq,&amp;dt);
<a name="l02561"></a>02561   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) 
<a name="l02562"></a>02562     <span class="keywordflow">return</span> rc;
<a name="l02563"></a>02563 
<a name="l02564"></a>02564   <span class="keywordflow">if</span> (!(dt == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l02565"></a>02565         dt == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l02566"></a>02566         dt == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l02567"></a>02567       ){
<a name="l02568"></a>02568     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02569"></a>02569   } 
<a name="l02570"></a>02570 
<a name="l02571"></a>02571   sum_dim = numDataPoint*numComponent; <span class="comment">//numcomponent==1</span>
<a name="l02572"></a>02572   sumx = (<span class="keywordtype">double</span>*)malloc(sum_dim*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l02573"></a>02573   sumy = (<span class="keywordtype">double</span>*)malloc(sum_dim*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l02574"></a>02574   sumzz = (<span class="keywordtype">double</span>*)malloc(3*sum_dim*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l02575"></a>02575   retdata= (<span class="keywordtype">double</span>*)malloc(5*sum_dim*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l02576"></a>02576   <span class="keywordflow">if</span> (sumx == NULL || sumy == NULL || sumzz == NULL || retdata == NULL){
<a name="l02577"></a>02577     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l02578"></a>02578     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l02579"></a>02579   }
<a name="l02580"></a>02580 
<a name="l02581"></a>02581   <span class="keywordflow">for</span> (i =0; i &lt; sum_dim; i++){
<a name="l02582"></a>02582     sumx[i] = 0;
<a name="l02583"></a>02583     sumy[i] = 0;
<a name="l02584"></a>02584     <span class="keywordflow">for</span> (j = 0; j &lt; 3; j++){
<a name="l02585"></a>02585       sumzz[3*i+j] = 0.0;
<a name="l02586"></a>02586     }
<a name="l02587"></a>02587     <span class="keywordflow">for</span> (j = 0; j &lt; 5; j++){
<a name="l02588"></a>02588       retdata[5*i+j] = 0.0;
<a name="l02589"></a>02589     }
<a name="l02590"></a>02590   }
<a name="l02591"></a>02591 
<a name="l02592"></a>02592 
<a name="l02593"></a>02593   <span class="keywordflow">for</span> (i = 0; i &lt; numStep; i++){
<a name="l02594"></a>02594     <span class="keywordtype">double</span> currx, curry;
<a name="l02595"></a>02595     <span class="keywordflow">switch</span>(dt){
<a name="l02596"></a>02596     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>:
<a name="l02597"></a>02597       currx = ((<span class="keywordtype">double</span>*)seqcoords)[i];
<a name="l02598"></a>02598       <span class="keywordflow">break</span>;
<a name="l02599"></a>02599     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l02600"></a>02600       currx = (double)(((<span class="keywordtype">int</span>*)seqcoords)[i]);
<a name="l02601"></a>02601       <span class="keywordflow">break</span>;
<a name="l02602"></a>02602     <span class="keywordflow">default</span>: <span class="comment">// know its a float cause i checked it above</span>
<a name="l02603"></a>02603       currx = (double)(((<span class="keywordtype">float</span>*)seqcoords)[i]);
<a name="l02604"></a>02604       <span class="keywordflow">break</span>;
<a name="l02605"></a>02605     }
<a name="l02606"></a>02606 
<a name="l02607"></a>02607     rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(seqvar[i], &amp;data);
<a name="l02608"></a>02608     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02609"></a>02609       data = NULL;
<a name="l02610"></a>02610       free(sumx);
<a name="l02611"></a>02611       free(sumy);
<a name="l02612"></a>02612       free(sumzz);
<a name="l02613"></a>02613       free(retdata);
<a name="l02614"></a>02614       <span class="keywordflow">return</span> rc;
<a name="l02615"></a>02615     }
<a name="l02616"></a>02616    
<a name="l02617"></a>02617     <span class="keywordflow">for</span> (j = 0; j &lt; sum_dim; j++){
<a name="l02618"></a>02618       <span class="keywordflow">switch</span>(datatype){
<a name="l02619"></a>02619       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>:
<a name="l02620"></a>02620          curry = ((<span class="keywordtype">double</span>*)data)[j];
<a name="l02621"></a>02621         <span class="keywordflow">break</span>;
<a name="l02622"></a>02622       <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:
<a name="l02623"></a>02623          curry = (double)(((<span class="keywordtype">int</span>*)data)[j]);
<a name="l02624"></a>02624         <span class="keywordflow">break</span>;
<a name="l02625"></a>02625       <span class="keywordflow">default</span>: <span class="comment">// know its a float cause i checked it above</span>
<a name="l02626"></a>02626      curry = (double)(((<span class="keywordtype">float</span>*)data)[j]);
<a name="l02627"></a>02627       }
<a name="l02628"></a>02628     
<a name="l02629"></a>02629       sumx[j]+=currx;
<a name="l02630"></a>02630       sumy[j]+=curry;
<a name="l02631"></a>02631       sumzz[3*j+0]+=(currx*currx);
<a name="l02632"></a>02632       sumzz[3*j+1]+=(currx*curry);
<a name="l02633"></a>02633       sumzz[3*j+2]+=(curry*curry);
<a name="l02634"></a>02634     }
<a name="l02635"></a>02635   }
<a name="l02636"></a>02636 
<a name="l02637"></a>02637   <span class="comment">//  printf("\n");</span>
<a name="l02638"></a>02638 
<a name="l02639"></a>02639   <span class="comment">//now calc least squares val</span>
<a name="l02640"></a>02640   <span class="keywordflow">for</span> (j = 0; j &lt; sum_dim; j++){
<a name="l02641"></a>02641     <span class="keywordtype">double</span> a,b,r2,sea,seb,s;
<a name="l02642"></a>02642     <span class="keywordtype">int</span> id, xx,xy,yy;
<a name="l02643"></a>02643 
<a name="l02644"></a>02644     <span class="comment">//formulas from mathworld on least squares fitting</span>
<a name="l02645"></a>02645     sumx[j]/=(double)numStep;
<a name="l02646"></a>02646     sumy[j]/=(double)numStep;
<a name="l02647"></a>02647     sumzz[3*j+0]-=(sumx[j]*sumx[j]*(double)numStep);
<a name="l02648"></a>02648     sumzz[3*j+1]-=(sumx[j]*sumy[j]*(double)numStep);
<a name="l02649"></a>02649     sumzz[3*j+2]-=(sumy[j]*sumy[j]*(double)numStep);
<a name="l02650"></a>02650 
<a name="l02651"></a>02651     <span class="comment">//    printf("sxx %10g sxy %10g syy %10g",sumzz[3*j],sumzz[3*j+1],sumzz[3*j+2]);</span>
<a name="l02652"></a>02652 
<a name="l02653"></a>02653     xx = (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(sumzz[3*j],0.0) ? 1:0);
<a name="l02654"></a>02654     xy = (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(sumzz[3*j+1],0.0) ? 1:0);
<a name="l02655"></a>02655     yy = (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(sumzz[3*j+2],0.0) ? 1:0);
<a name="l02656"></a>02656 
<a name="l02657"></a>02657     <span class="comment">// if xx means xx == 0</span>
<a name="l02658"></a>02658     <span class="keywordflow">if</span> (xx) <span class="keywordtype">id</span> = 1;
<a name="l02659"></a>02659     <span class="keywordflow">if</span> (!xx &amp;&amp; xy &amp;&amp; yy) <span class="keywordtype">id</span> = 2;
<a name="l02660"></a>02660     <span class="keywordflow">if</span> (!xx &amp;&amp; xy &amp;&amp; !yy) <span class="keywordtype">id</span> = 3;
<a name="l02661"></a>02661     <span class="keywordflow">if</span> (!xx &amp;&amp; !xy &amp;&amp; yy) <span class="keywordtype">id</span> = 4;
<a name="l02662"></a>02662     <span class="keywordflow">if</span> (!xx &amp;&amp; !xy &amp;&amp; !yy) <span class="keywordtype">id</span> = 5;
<a name="l02663"></a>02663 
<a name="l02664"></a>02664     <span class="keywordflow">switch</span>(<span class="keywordtype">id</span>){
<a name="l02665"></a>02665     <span class="keywordflow">case</span> 1:
<a name="l02666"></a>02666       <span class="comment">//just returning junk</span>
<a name="l02667"></a>02667       a = -1;
<a name="l02668"></a>02668       b = -1;
<a name="l02669"></a>02669       r2 = -1;
<a name="l02670"></a>02670       sea = -1; 
<a name="l02671"></a>02671       seb = -1; 
<a name="l02672"></a>02672       <span class="keywordflow">break</span>;
<a name="l02673"></a>02673     <span class="keywordflow">case</span> 2: 
<a name="l02674"></a>02674       a = sumy[j];
<a name="l02675"></a>02675       b = 0;
<a name="l02676"></a>02676       r2 = -1;
<a name="l02677"></a>02677       sea = 0;
<a name="l02678"></a>02678       seb = 0;
<a name="l02679"></a>02679       <span class="keywordflow">break</span>;
<a name="l02680"></a>02680     <span class="keywordflow">case</span> 3:  <span class="comment">//sea and seb calc below</span>
<a name="l02681"></a>02681       a = sumy[j];
<a name="l02682"></a>02682       b = 0;
<a name="l02683"></a>02683       r2 = 0;
<a name="l02684"></a>02684       <span class="keywordflow">if</span> (numStep &gt; 2){ <span class="comment">//s cant be zero</span>
<a name="l02685"></a>02685         s = sqrt(sumzz[3*j+2]/(<span class="keywordtype">double</span>)(numStep-2)); 
<a name="l02686"></a>02686         <span class="comment">//      printf(" s %10g",s); </span>
<a name="l02687"></a>02687       }
<a name="l02688"></a>02688       <span class="keywordflow">break</span>;
<a name="l02689"></a>02689     <span class="keywordflow">case</span> 4: <span class="comment">//sea and seb calc below</span>
<a name="l02690"></a>02690       b = sumzz[3*j+1]/sumzz[3*j+0]; 
<a name="l02691"></a>02691       a = sumy[j]- b*sumx[j];
<a name="l02692"></a>02692       r2 = -1;
<a name="l02693"></a>02693       <span class="keywordflow">if</span> (numStep &gt;2){  <span class="comment">//s cant be zero</span>
<a name="l02694"></a>02694         s = sqrt((sumzz[3*j+1]*sumzz[3*j+1]/sumzz[3*j])/(<span class="keywordtype">double</span>)(numStep-2));
<a name="l02695"></a>02695       }
<a name="l02696"></a>02696       <span class="keywordflow">break</span>;
<a name="l02697"></a>02697     <span class="keywordflow">case</span> 5: <span class="comment">//sea and seb calc below</span>
<a name="l02698"></a>02698       b =  sumzz[3*j+1]/sumzz[3*j+0]; 
<a name="l02699"></a>02699       a = sumy[j]- b*sumx[j];
<a name="l02700"></a>02700       r2 = sumzz[3*j+1]*sumzz[3*j+1]/(sumzz[3*j+0]*sumzz[3*j+2]); 
<a name="l02701"></a>02701       <span class="keywordflow">if</span> (numStep &gt; 2){
<a name="l02702"></a>02702         <span class="comment">//check if s == 0</span>
<a name="l02703"></a>02703         <span class="keywordtype">double</span> p1, p2;
<a name="l02704"></a>02704         p1 = sumzz[3*j+2]/(double)(numStep-2);
<a name="l02705"></a>02705         p2 = (sumzz[3*j+1]/(double)(numStep-2))*(sumzz[3*j+1]/sumzz[3*j]);
<a name="l02706"></a>02706         <span class="comment">//      printf(" inside %10g eps %10g",p1-p2, DBL_EPSILON);</span>
<a name="l02707"></a>02707         <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g66e4000738f924f4e7a1c1837d877cf2" title="Test equality of floating point numbers.">FC_VALUE_EQUIV</a>(p1,p2,50*DBL_EPSILON,DBL_MIN)){
<a name="l02708"></a>02708           s = 0;
<a name="l02709"></a>02709         }<span class="keywordflow">else</span> {
<a name="l02710"></a>02710           s = sqrt(p1-p2);
<a name="l02711"></a>02711         }
<a name="l02712"></a>02712       }
<a name="l02713"></a>02713       <span class="keywordflow">break</span>;
<a name="l02714"></a>02714     <span class="keywordflow">default</span>:
<a name="l02715"></a>02715       printf(<span class="stringliteral">"** Developer Alert! Should never reach this point!**\n"</span>);
<a name="l02716"></a>02716       fflush(NULL);
<a name="l02717"></a>02717       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"Invalid SS values"</span>);
<a name="l02718"></a>02718       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>;
<a name="l02719"></a>02719       <span class="keywordflow">break</span>;
<a name="l02720"></a>02720     }
<a name="l02721"></a>02721       
<a name="l02722"></a>02722     <span class="keywordflow">if</span> (<span class="keywordtype">id</span> ==3 || <span class="keywordtype">id</span> == 4 || <span class="keywordtype">id</span> == 5){
<a name="l02723"></a>02723       <span class="keywordflow">if</span> (numStep &lt; 3){
<a name="l02724"></a>02724         sea = -1;
<a name="l02725"></a>02725         seb = -1;
<a name="l02726"></a>02726       } <span class="keywordflow">else</span> {
<a name="l02727"></a>02727         <span class="comment">//      printf(" s %10g",s); </span>
<a name="l02728"></a>02728         <span class="keywordflow">if</span> (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(s,0.0)){ 
<a name="l02729"></a>02729           sea = 0;
<a name="l02730"></a>02730           seb = 0;
<a name="l02731"></a>02731         }<span class="keywordflow">else</span> {
<a name="l02732"></a>02732           <span class="keywordtype">double</span> acoeff, bcoeff;        
<a name="l02733"></a>02733           acoeff = sqrt(1.0/(<span class="keywordtype">double</span>)numStep + sumx[j]*sumx[j]/sumzz[3*j]);
<a name="l02734"></a>02734           bcoeff = sqrt(sumzz[3*j]);
<a name="l02735"></a>02735           <span class="comment">//      printf(" coeffa %10g coeffb %10g",acoeff,bcoeff); </span>
<a name="l02736"></a>02736           sea = s*acoeff;
<a name="l02737"></a>02737           seb = s/bcoeff;
<a name="l02738"></a>02738         }
<a name="l02739"></a>02739       }
<a name="l02740"></a>02740     }
<a name="l02741"></a>02741 
<a name="l02742"></a>02742     <span class="comment">//    printf ("\n");</span>
<a name="l02743"></a>02743     retdata[5*j] = a;
<a name="l02744"></a>02744     retdata[5*j+1] = b;
<a name="l02745"></a>02745     retdata[5*j+2] = r2;
<a name="l02746"></a>02746     retdata[5*j+3] = sea;
<a name="l02747"></a>02747     retdata[5*j+4] = seb;
<a name="l02748"></a>02748   }
<a name="l02749"></a>02749 
<a name="l02750"></a>02750   free(sumx);
<a name="l02751"></a>02751   free(sumy);
<a name="l02752"></a>02752   free(sumzz);
<a name="l02753"></a>02753 
<a name="l02754"></a>02754   rc = <a class="code" href="group__Variable.html#g6808d2015766d9b530b93375f42296a3" title="Get the parent mesh of the variable.">fc_getMeshFromVariable</a>(seqvar[0],&amp;mesh);
<a name="l02755"></a>02755   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02756"></a>02756     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(rc));
<a name="l02757"></a>02757     free(retdata);
<a name="l02758"></a>02758     <span class="keywordflow">return</span> rc;
<a name="l02759"></a>02759   }
<a name="l02760"></a>02760 
<a name="l02761"></a>02761 
<a name="l02762"></a>02762   varname = varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>;
<a name="l02763"></a>02763   returnname = malloc((strlen(varname)+20)*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l02764"></a>02764   <span class="keywordflow">if</span> (returnname == NULL) {
<a name="l02765"></a>02765     <span class="comment">//no clean up in case of memory error</span>
<a name="l02766"></a>02766     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l02767"></a>02767     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l02768"></a>02768   }
<a name="l02769"></a>02769   sprintf(returnname, <span class="stringliteral">"%s_LSQ"</span>, varname);
<a name="l02770"></a>02770   
<a name="l02771"></a>02771   rc = <a class="code" href="group__Variable.html#ga2ffd025a786dbe93fc7f8defb969631" title="Create a new variable.">fc_createVariable</a>(mesh,returnname,newvar);
<a name="l02772"></a>02772   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02773"></a>02773     free(retdata);
<a name="l02774"></a>02774     free(returnname);
<a name="l02775"></a>02775     <span class="keywordflow">return</span> rc;
<a name="l02776"></a>02776   }
<a name="l02777"></a>02777 
<a name="l02778"></a>02778   free(returnname);
<a name="l02779"></a>02779 
<a name="l02780"></a>02780   rc = <a class="code" href="group__Variable.html#g87015cda75e038cc73c1d584537d81fc" title="Set the pointer to the variable data.">fc_setVariableDataPtr</a>(*newvar,numDataPoint,5,
<a name="l02781"></a>02781                              assoc,<a class="code" href="group__DataTypes.html#gg60d16c50c365cd12f1f61ce8f4cebb207f48fe9fd9efb7bc772bbb41106e217f">FC_MT_VECTOR</a>,<a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>,retdata);
<a name="l02782"></a>02782   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02783"></a>02783     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(*newvar);
<a name="l02784"></a>02784     <span class="keywordflow">return</span> rc;
<a name="l02785"></a>02785   }
<a name="l02786"></a>02786 
<a name="l02787"></a>02787   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l02788"></a>02788 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="g0e0fd0c6a1cdee54b6c63201906cde2c"></a><!-- doxytag: member="series.c::fc_normalForm" ref="g0e0fd0c6a1cdee54b6c63201906cde2c" args="(int numStep, FC_Variable *seqvar, char *varname, FC_Variable **newseqvar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_normalForm           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> *&nbsp;</td>
          <td class="paramname"> <em>seqvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Variable.html">FC_Variable</a> **&nbsp;</td>
          <td class="paramname"> <em>newseqvar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return a handle to a seqvar that is the normal form of an existing seqvar. 
<p>
<b>Description:</b> <p>
Normal forms are done over each dimension and component separately. Normal form X(t)= (x(t)-xmean(t))/sdev(x);<p>
This will return with an error if the seqvar is not numerical. This will return the vals unchanged if the sdev for a sequence is zero.<p>
Floats and Doubles will return vars with same type; Ints will return Doubles. Someone can floor/ceil it later if they want integer values.<p>
NOTE: becuase this allocates memory for seq var, user must call deleteSeqVar *and* free, unless delete gets changed.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000068">Todo:</a></b></dt><dd><ul>
<li>ask new seqvar functions are written for varmath see if can replace any of the innards of this</li><li>Decide if want to change return if stdev is zero to error. Hesitating on that since want to get the legitimate ones back.</li></ul>
</dd></dl>
<b>Modifications:</b> <ul>
<li>1/21/04 ACG, Created</li><li>01/09/06 ACG changing/removing handling/cleanup in case of datatype error at WSK recommendation since it skews the coverage testing. Either there is already an explict type check or if those lines are reached you've got serious errors and the cleanup doesnt matter.</li><li>01/12/06 ACG cleaned up the way the writeout arrays were handled. </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - number of steps in the seq var </td></tr>
<tr><td valign="top"><em>seqvar</em>&nbsp;</td><td>
input - seq var changing to normal form </td></tr>
<tr><td valign="top"><em>varname</em>&nbsp;</td><td>
input - name for averaged output seq var </td></tr>
<tr><td valign="top"><em>newseqvar</em>&nbsp;</td><td>
output - handles for output seq var </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="series_8c-source.html#l02072">2072</a> of file <a class="el" href="series_8c-source.html">series.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l06536">_fc_getVarSlot()</a>, <a class="el" href="series_8c-source.html#l00122">_fc_makeNewSeqVar()</a>, <a class="el" href="util_8h-source.html#l00136">FC_DBL_EQUIV</a>, <a class="el" href="variable_8c-source.html#l05062">fc_deleteSeqVariable()</a>, <a class="el" href="variable_8c-source.html#l04980">fc_deleteVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="statistics_8c-source.html#l01324">fc_getSeqVariableSeriesMeanSdev()</a>, <a class="el" href="variable_8c-source.html#l05773">fc_getVariableDataAsDataType()</a>, <a class="el" href="variable_8c-source.html#l05715">fc_getVariableDataPtr()</a>, <a class="el" href="variable_8c-source.html#l05498">fc_getVariableDataType()</a>, <a class="el" href="variable_8c-source.html#l05433">fc_getVariableInfo()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="variable_8c-source.html#l05178">fc_isSeqVariableValid()</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="variable_8c-source.html#l00469">fc_setVariableData()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="variableP_8h-source.html#l00075">_FC_VarSlot::header</a>, <a class="el" href="tableP_8h-source.html#l00100">_FC_SlotHeader::name</a>, and <a class="el" href="seriesAnalyzer_8c-source.html#l00102">numComponent</a>.</p>

<p>Referenced by <a class="el" href="seriesAnalyzer_8c-source.html#l00402">makeNormal()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02077"></a>02077  {
<a name="l02078"></a>02078 
<a name="l02079"></a>02079 
<a name="l02080"></a>02080   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l02081"></a>02081   <a class="code" href="struct__FC__VarSlot.html" title="Variable Slot Structure for the Variable Table.">_FC_VarSlot</a>* varSlot;
<a name="l02082"></a>02082   <span class="keywordtype">int</span> numDataPoint;
<a name="l02083"></a>02083   <span class="keywordtype">int</span> <a class="code" href="seriesAnalyzer_8c.html#9ba814c62f21460639802c7771e86fa6">numComponent</a>;
<a name="l02084"></a>02084   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> assoc;
<a name="l02085"></a>02085   <a class="code" href="group__DataTypes.html#g60d16c50c365cd12f1f61ce8f4cebb20" title="Possible ways of organizing data values.">FC_MathType</a> mathtype;
<a name="l02086"></a>02086   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype, newdatatype;
<a name="l02087"></a>02087   <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a> meanvar, sdevvar;
<a name="l02088"></a>02088   <span class="keywordtype">void</span>* vwritedata;
<a name="l02089"></a>02089   <span class="keywordtype">int</span> i,j,numArrayVals;
<a name="l02090"></a>02090   <span class="keywordtype">double</span> *meandata, *sdevdata;
<a name="l02091"></a>02091 
<a name="l02092"></a>02092 
<a name="l02093"></a>02093   <span class="keywordflow">if</span> (newseqvar)
<a name="l02094"></a>02094     *newseqvar = NULL;
<a name="l02095"></a>02095 
<a name="l02096"></a>02096   <span class="comment">//will check below to see that its appropriate numerical type</span>
<a name="l02097"></a>02097   <span class="keywordflow">if</span> ((!<a class="code" href="group__Variable.html#gac07e226e274bee4de4b21db8e03ae0e" title="Check that the handle refers to a valid variable.">fc_isSeqVariableValid</a>(numStep,seqvar)) || (newseqvar == NULL)
<a name="l02098"></a>02098       || varname == NULL){
<a name="l02099"></a>02099     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l02100"></a>02100     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02101"></a>02101   };
<a name="l02102"></a>02102 
<a name="l02103"></a>02103   rc = <a class="code" href="group__Variable.html#gd3b7cecfd0c6d488e82b426b4c114aba" title="Return the data type of a variable.">fc_getVariableDataType</a>(seqvar[0],&amp;datatype);
<a name="l02104"></a>02104   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l02105"></a>02105     <span class="keywordflow">return</span> rc;
<a name="l02106"></a>02106 
<a name="l02107"></a>02107   <span class="keywordflow">if</span> (!(datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a> ||
<a name="l02108"></a>02108         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a> ||
<a name="l02109"></a>02109         datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a> )
<a name="l02110"></a>02110       ){
<a name="l02111"></a>02111     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02112"></a>02112   } 
<a name="l02113"></a>02113 
<a name="l02114"></a>02114 
<a name="l02115"></a>02115   varSlot = <a class="code" href="group__PrivateVariable.html#gf497c9a7299e6455d322dd98805ea8f0" title="Get a variable slot from a variable handle.">_fc_getVarSlot</a>(seqvar[0]);
<a name="l02116"></a>02116   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Getting normal form seq variable '%s'"</span>,
<a name="l02117"></a>02117                       varSlot-&gt;<a class="code" href="struct__FC__VarSlot.html#50d222efb8783e524916e62071f595c7">header</a>.<a class="code" href="struct__FC__SlotHeader.html#b14afe27fdf25b95ceacb0ca867696a5">name</a>);
<a name="l02118"></a>02118 
<a name="l02119"></a>02119 
<a name="l02120"></a>02120   rc = <a class="code" href="group__Statistics.html#g6bb6087f9da82dc295d312ab9614d0da" title="Compute mean and standard deviation of a seq variable across its sequence (series)...">fc_getSeqVariableSeriesMeanSdev</a>(numStep,seqvar,&amp;meanvar,&amp;sdevvar);
<a name="l02121"></a>02121   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02122"></a>02122     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>,<span class="stringliteral">"can't get mean and stdev for this variable"</span>);
<a name="l02123"></a>02123     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l02124"></a>02124   }
<a name="l02125"></a>02125 
<a name="l02126"></a>02126   <span class="comment">//going to do the cast on these so dont have to allocate arrays for them</span>
<a name="l02127"></a>02127   rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(meanvar,(<span class="keywordtype">void</span>**)&amp;meandata);
<a name="l02128"></a>02128   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02129"></a>02129     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(meanvar);
<a name="l02130"></a>02130     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(sdevvar);
<a name="l02131"></a>02131     <span class="keywordflow">return</span> rc;
<a name="l02132"></a>02132   }
<a name="l02133"></a>02133 
<a name="l02134"></a>02134   rc = <a class="code" href="group__Variable.html#g40a4d68cafd7134b908b78d053d3c47d" title="Get the data in a variable.">fc_getVariableDataPtr</a>(sdevvar,(<span class="keywordtype">void</span>**)&amp;sdevdata);
<a name="l02135"></a>02135   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02136"></a>02136     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(meanvar);
<a name="l02137"></a>02137     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(sdevvar);
<a name="l02138"></a>02138     <span class="keywordflow">return</span> rc;
<a name="l02139"></a>02139   }
<a name="l02140"></a>02140 
<a name="l02141"></a>02141 
<a name="l02142"></a>02142   rc = <a class="code" href="group__PrivateSeries.html#g85558d3a96772fc12d86f399f7eece30" title="Makes a new seq var on the mesh that is on the same sequence as a given variable...">_fc_makeNewSeqVar</a>(numStep, seqvar, varname,newseqvar); 
<a name="l02143"></a>02143   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02144"></a>02144     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(meanvar);
<a name="l02145"></a>02145     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(sdevvar);
<a name="l02146"></a>02146     <span class="keywordflow">return</span> rc;
<a name="l02147"></a>02147   }
<a name="l02148"></a>02148 
<a name="l02149"></a>02149   rc = <a class="code" href="group__Variable.html#gcd52b4ee0552c63ff2819e5f30549cbc" title="Get information about a variable.">fc_getVariableInfo</a>(seqvar[0], &amp;numDataPoint, &amp;numComponent, &amp;assoc,
<a name="l02150"></a>02150                            &amp;mathtype, &amp;datatype);
<a name="l02151"></a>02151   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02152"></a>02152     <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l02153"></a>02153     free(*newseqvar);
<a name="l02154"></a>02154     *newseqvar=NULL;
<a name="l02155"></a>02155     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(meanvar);
<a name="l02156"></a>02156     <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(sdevvar);
<a name="l02157"></a>02157     <span class="keywordflow">return</span> rc;
<a name="l02158"></a>02158   }
<a name="l02159"></a>02159 
<a name="l02160"></a>02160 
<a name="l02161"></a>02161   <span class="comment">//make writeout array</span>
<a name="l02162"></a>02162   numArrayVals = numDataPoint*numComponent;
<a name="l02163"></a>02163   <span class="keywordflow">if</span> (datatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l02164"></a>02164     newdatatype = <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>;
<a name="l02165"></a>02165     vwritedata = (<span class="keywordtype">float</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));    
<a name="l02166"></a>02166   }<span class="keywordflow">else</span> {     <span class="comment">//its an int or a double cuase i checked it above</span>
<a name="l02167"></a>02167     newdatatype = <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>;
<a name="l02168"></a>02168     vwritedata = (<span class="keywordtype">double</span>*)malloc(numArrayVals*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l02169"></a>02169   }
<a name="l02170"></a>02170   <span class="keywordflow">if</span> (vwritedata == NULL ){
<a name="l02171"></a>02171     <span class="comment">//no clean up in case of memory error</span>
<a name="l02172"></a>02172     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l02173"></a>02173     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l02174"></a>02174   }
<a name="l02175"></a>02175 
<a name="l02176"></a>02176   <span class="keywordflow">for</span> (i = 0; i &lt; numStep; i++) { <span class="comment">//like each time</span>
<a name="l02177"></a>02177     <span class="keywordtype">double</span>* data;
<a name="l02178"></a>02178     rc = <a class="code" href="group__Variable.html#gd2bb293943346a413ef5fa244a072b8f" title="Get a copy of a variable&amp;#39;s data as the requested data type.">fc_getVariableDataAsDataType</a>(seqvar[i], <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>,
<a name="l02179"></a>02179                                       (<span class="keywordtype">void</span>**)(&amp;data));
<a name="l02180"></a>02180     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02181"></a>02181       <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l02182"></a>02182       free(*newseqvar);
<a name="l02183"></a>02183       *newseqvar=NULL;
<a name="l02184"></a>02184       <span class="keywordflow">if</span> (data) free(data);
<a name="l02185"></a>02185       free(vwritedata);
<a name="l02186"></a>02186       <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(meanvar);
<a name="l02187"></a>02187       <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(sdevvar);
<a name="l02188"></a>02188       <span class="keywordflow">return</span> rc;
<a name="l02189"></a>02189     }
<a name="l02190"></a>02190 
<a name="l02191"></a>02191     <span class="keywordflow">for</span> (j = 0; j &lt; numArrayVals; j++){
<a name="l02192"></a>02192       <span class="keywordflow">if</span> (newdatatype == <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>){
<a name="l02193"></a>02193         ((<span class="keywordtype">float</span>*)vwritedata)[j] = (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(sdevdata[j],0.0) ?
<a name="l02194"></a>02194                          (float)(data[j]):
<a name="l02195"></a>02195                          (float)(data[j] - meandata[j])/sdevdata[j]);
<a name="l02196"></a>02196       }<span class="keywordflow">else</span> {
<a name="l02197"></a>02197         ((<span class="keywordtype">double</span>*)vwritedata)[j] = (<a class="code" href="group__PublicFloatingPoint.html#g9eab7a99d9f08eee22764c6916f46f51" title="Test equality of two values with double precision.">FC_DBL_EQUIV</a>(sdevdata[j],0.0) ?
<a name="l02198"></a>02198                          data[j]:(data[j] - meandata[j])/sdevdata[j]);
<a name="l02199"></a>02199       }
<a name="l02200"></a>02200     }
<a name="l02201"></a>02201 
<a name="l02202"></a>02202 
<a name="l02203"></a>02203     free(data);
<a name="l02204"></a>02204     rc = <a class="code" href="group__Variable.html#g3f958d3b630c9df78a4e7fbca287b039" title="Set the variable data by copy.">fc_setVariableData</a>((*newseqvar)[i], numDataPoint,
<a name="l02205"></a>02205                             numComponent, assoc, mathtype,
<a name="l02206"></a>02206                             newdatatype,vwritedata);
<a name="l02207"></a>02207 
<a name="l02208"></a>02208 
<a name="l02209"></a>02209     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>){
<a name="l02210"></a>02210       <span class="comment">//addtional cleanup</span>
<a name="l02211"></a>02211       free(vwritedata);
<a name="l02212"></a>02212       <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(meanvar);
<a name="l02213"></a>02213       <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(sdevvar);
<a name="l02214"></a>02214       <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(numStep,*newseqvar);
<a name="l02215"></a>02215       free(*newseqvar);
<a name="l02216"></a>02216       *newseqvar=NULL;
<a name="l02217"></a>02217       <span class="keywordflow">return</span> rc;
<a name="l02218"></a>02218     }
<a name="l02219"></a>02219   }
<a name="l02220"></a>02220 
<a name="l02221"></a>02221   free(vwritedata);
<a name="l02222"></a>02222   <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(meanvar);
<a name="l02223"></a>02223   <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(sdevvar);
<a name="l02224"></a>02224 
<a name="l02225"></a>02225   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l02226"></a>02226 }
</pre></div>
<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Oct 27 13:26:18 2008 for FCLib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
