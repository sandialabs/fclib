<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>FCLib: tools/loadHistory.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>tools/loadHistory.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Calculate the load history on a subset of a mesh. 
<p>
<dl class="rcs" compact><dt><b>Source</b></dt><dd>/usr/local/Repositories/fcdmf/fclib/tools/loadHistory.c,v </dd></dl>
<dl class="rcs" compact><dt><b>Revision</b></dt><dd>1.10 </dd></dl>
<dl class="rcs" compact><dt><b>Date</b></dt><dd>2006/09/28 06:34:39 </dd></dl>
<p>
<b>Description:</b> Usage: loadHistory [options] filename meshname subsetname varname<p>
Computes a curve where each point is the sum of the variable over the subset at that time. If the variable has multiple components, this is done for each component. Also, if the variable is a vector, this is done for the magnitude.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000127">Todo:</a></b></dt><dd>What if variable is tensor? Currently program stops with error. Could still do the components...</dd></dl>
<b>Modifications:</b> <ul>
<li>01/19/05 WSK, created. </li></ul>

<p>Definition in file <a class="el" href="loadHistory_8c-source.html">loadHistory.c</a>.</p>

<p>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;time.h&gt;</code><br>
<code>#include &quot;<a class="el" href="fc_8h-source.html">fc.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for loadHistory.c:</div>
<div class="dynsection">
<p><center><img src="loadHistory_8c__incl.gif" border="0" usemap="#tools/loadHistory.c_map" alt=""></center>
<map name="tools/loadHistory.c_map">
<area shape="rect" href="fc_8h.html" title="Master header file for FCLib." alt="" coords="1285,84,1333,111"><area shape="rect" href="base_8h.html" title="Public declarations for Data Types, Data Interface, and Handles Modules." alt="" coords="195,161,264,188"><area shape="rect" href="storage_8h.html" title="Public declarations for Simple Data Objects Module." alt="" coords="288,161,376,188"><area shape="rect" href="library_8h.html" title="Public declarations for the Library Module." alt="" coords="400,161,477,188"><area shape="rect" href="dataset_8h.html" title="Public declarations for the Dataset Module." alt="" coords="501,161,589,188"><area shape="rect" href="sequence_8h.html" title="Public declarations for the Sequence Module." alt="" coords="613,161,717,188"><area shape="rect" href="mesh_8h.html" title="Public declarations for the Mesh Module." alt="" coords="741,161,816,188"><area shape="rect" href="subset_8h.html" title="Public declarations for Subset module." alt="" coords="840,161,920,188"><area shape="rect" href="variable_8h.html" title="Public declarations for Variable Module." alt="" coords="944,161,1037,188"><area shape="rect" href="feature_8h.html" title="Public declarations for Features module." alt="" coords="1061,161,1149,188"><area shape="rect" href="shape_8h.html" title="Declarations for Shape module." alt="" coords="1173,161,1251,188"><area shape="rect" href="fileio_8h.html" title="Public declarations for File IO module." alt="" coords="1275,161,1344,188"><area shape="rect" href="error_8h.html" title="Declarations for Error Handling Module." alt="" coords="1368,161,1435,188"><area shape="rect" href="geom_8h.html" title="Public declarations for Geometric Relations module." alt="" coords="1459,161,1536,188"><area shape="rect" href="statistics_8h.html" title="Public declarations for Statistics Routines module." alt="" coords="1487,239,1583,265"><area shape="rect" href="sierra_8h.html" title="Public declarations for the Sierra module." alt="" coords="1611,161,1685,188"><area shape="rect" href="threshold_8h.html" title="Public declarations for Threshold module." alt="" coords="1709,161,1811,188"><area shape="rect" href="elemdeath_8h.html" title="Declarations for Element Death module." alt="" coords="1835,161,1949,188"><area shape="rect" href="series_8h.html" title="Public declarations for Series Routines module." alt="" coords="1973,161,2048,188"><area shape="rect" href="topo_8h.html" title="Public declarations for Topological Relations module." alt="" coords="2072,161,2139,188"><area shape="rect" href="util_8h.html" title="Public declarations for Utilities module." alt="" coords="2163,161,2219,188"><area shape="rect" href="track_8h.html" title="Declaration of tracking routines." alt="" coords="2243,161,2312,188"><area shape="rect" href="varmath_8h.html" title="Public declarations for Variable Math module." alt="" coords="2336,161,2432,188"><area shape="rect" href="custom_8h.html" title="Declarations for Custom module." alt="" coords="2456,161,2544,188"></map>
</div>

<p>
<a href="loadHistory_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="loadHistory_8c.html#3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="3c04138a5bfe5d72780bb7e82a18e627"></a><!-- doxytag: member="loadHistory.c::main" ref="3c04138a5bfe5d72780bb7e82a18e627" args="(int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="loadHistory_8c-source.html#l00064">64</a> of file <a class="el" href="loadHistory_8c-source.html">loadHistory.c</a>.</p>

<p>References <a class="el" href="variable_8c-source.html#l03056">fc_createComponentSeqVariables()</a>, <a class="el" href="varmath_8c-source.html#l03533">fc_createMagnitudeVariable()</a>, <a class="el" href="base_8h-source.html#l00150">FC_DT_DOUBLE</a>, <a class="el" href="base_8h-source.html#l00149">FC_DT_FLOAT</a>, <a class="el" href="base_8h-source.html#l00143">FC_DT_INT</a>, <a class="el" href="base_8h-source.html#l00105">FC_ERROR</a>, <a class="el" href="error_8h-source.html#l00080">fc_exitIfError</a>, <a class="el" href="error_8h-source.html#l00116">fc_exitIfErrorPrintf</a>, <a class="el" href="base_8h-source.html#l00108">FC_FILE_IO_ERROR</a>, <a class="el" href="library_8c-source.html#l00256">fc_finalLibrary()</a>, <a class="el" href="base_8c-source.html#l00477">fc_getAssociationTypeText()</a>, <a class="el" href="mesh_8c-source.html#l02285">fc_getMeshByName()</a>, <a class="el" href="variable_8c-source.html#l04695">fc_getOrGenerateUniqueSeqVariableByName()</a>, <a class="el" href="sequence_8c-source.html#l01737">fc_getSequenceCoordsPtr()</a>, <a class="el" href="sequence_8c-source.html#l01687">fc_getSequenceDataType()</a>, <a class="el" href="variable_8c-source.html#l05317">fc_getSequenceFromSeqVariable()</a>, <a class="el" href="subset_8c-source.html#l02902">fc_getSubsetAssociationType()</a>, <a class="el" href="subset_8c-source.html#l01461">fc_getSubsetByName()</a>, <a class="el" href="variable_8c-source.html#l05539">fc_getVariableAssociationType()</a>, <a class="el" href="variable_8c-source.html#l05276">fc_getVariableName()</a>, <a class="el" href="variable_8c-source.html#l05582">fc_getVariableNumComponent()</a>, <a class="el" href="statistics_8c-source.html#l00664">fc_getVariableSubsetSum()</a>, <a class="el" href="library_8c-source.html#l00208">fc_initLibrary()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="fileio_8c-source.html#l01565">fc_loadDataset()</a>, <a class="el" href="base_8h-source.html#l00084">FC_LOG_MESSAGES</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="base_8h-source.html#l00081">FC_QUIET</a>, <a class="el" href="library_8c-source.html#l00146">fc_setLibraryVerbosity()</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="base_8h-source.html#l00083">FC_WARNING_MESSAGES</a>, <a class="el" href="subsetter_8c-source.html#l00114">file_name</a>, <a class="el" href="subsetter_8c-source.html#l00115">var_name</a>, and <a class="el" href="regionreassembler_8c-source.html#l00069">verbose_level</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00064"></a>00064                                 {
<a name="l00065"></a>00065   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l00066"></a>00066   time_t start_time = time(NULL); <span class="comment">// the time analysis starts</span>
<a name="l00067"></a>00067   <span class="keywordtype">int</span> i, j;
<a name="l00068"></a>00068   <span class="keywordtype">int</span> numStep, numComp;
<a name="l00069"></a>00069   <a class="code" href="structFC__Dataset.html" title="Dataset Handle.">FC_Dataset</a> dataset;
<a name="l00070"></a>00070   <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> sequence;
<a name="l00071"></a>00071   <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> mesh, *returnMeshes;
<a name="l00072"></a>00072   <a class="code" href="structFC__Subset.html" title="Subset Handle.">FC_Subset</a> subset, *returnSubsets;
<a name="l00073"></a>00073   <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a> *seqVar, **compSeqVars;
<a name="l00074"></a>00074   <span class="keywordtype">int</span> numReturnMeshes, numReturnSubsets;
<a name="l00075"></a>00075   <span class="keywordtype">char</span>* <a class="code" href="subsetter_8c.html#8505c513bc640d1f69e5f76fb32b24a8">file_name</a> = NULL;
<a name="l00076"></a>00076   <span class="keywordtype">char</span>* mesh_name = NULL;
<a name="l00077"></a>00077   <span class="keywordtype">char</span>* subset_name = NULL;
<a name="l00078"></a>00078   <span class="keywordtype">char</span>* <a class="code" href="subsetter_8c.html#4b703ba1f7a1288de40089aa611b9abf">var_name</a> = NULL;
<a name="l00079"></a>00079   <span class="keywordtype">char</span>* output_root_name = <span class="stringliteral">"loadHistory"</span>; <span class="comment">// this is default, can change</span>
<a name="l00080"></a>00080   <span class="keywordtype">int</span> str_len;
<a name="l00081"></a>00081   <span class="keywordtype">char</span>* datfile_name;
<a name="l00082"></a>00082   <span class="keywordtype">char</span>* gnufile_name;
<a name="l00083"></a>00083   <span class="keywordtype">char</span>* plotfile_name;
<a name="l00084"></a>00084   <span class="keywordtype">char</span>** comp_names;
<a name="l00085"></a>00085   <a class="code" href="group__DataTypes.html#g1ceb59a5b485f8bcbcb8acad4cfb9323" title="Possible verbosity levels.">FC_VerbosityLevel</a> <a class="code" href="regionreassembler_8c.html#46e260e16f29333b3f475e879e4d8e70">verbose_level</a> = <a class="code" href="group__DataTypes.html#gg1ceb59a5b485f8bcbcb8acad4cfb9323b4443923870aca5048c4cfc22ce803c5">FC_QUIET</a>;
<a name="l00086"></a>00086   <a class="code" href="group__DataTypes.html#g28b7cdba59395ddc988888d01dd19af6" title="Possible association of the data to the mesh.">FC_AssociationType</a> subset_assoc, var_assoc;
<a name="l00087"></a>00087   <span class="keywordtype">double</span> **sums;
<a name="l00088"></a>00088   FILE *file;
<a name="l00089"></a>00089   <span class="keywordtype">void</span>* times;
<a name="l00090"></a>00090   <a class="code" href="group__DataTypes.html#gcca24e957488bb76e40a84ea651975d9" title="Possible data types.">FC_DataType</a> datatype;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092   <span class="comment">// handle arguments</span>
<a name="l00093"></a>00093   <span class="keywordflow">if</span> (argc &lt; 5) {
<a name="l00094"></a>00094   usage:
<a name="l00095"></a>00095     printf(<span class="stringliteral">"\n"</span>);
<a name="l00096"></a>00096     printf(<span class="stringliteral">"usage: %s [options] filename meshname subsetname varname\n"</span>, 
<a name="l00097"></a>00097            argv[0]);
<a name="l00098"></a>00098     printf(<span class="stringliteral">"options: \n"</span>);
<a name="l00099"></a>00099     printf(<span class="stringliteral">"   -o         : root name for output files (default is "</span>
<a name="l00100"></a>00100            <span class="stringliteral">"loadHistory)\n"</span>);
<a name="l00101"></a>00101     printf(<span class="stringliteral">"   -h         : print this help message\n"</span>);
<a name="l00102"></a>00102     printf(<span class="stringliteral">"   -v         : print warning and error messages\n"</span>);   
<a name="l00103"></a>00103     printf(<span class="stringliteral">"   -v         : print log and error messages\n"</span>);   
<a name="l00104"></a>00104     printf(<span class="stringliteral">"\n"</span>);
<a name="l00105"></a>00105     printf(<span class="stringliteral">"Creates a file, '*.dat', that contains the sum of the variable "</span>
<a name="l00106"></a>00106            <span class="stringliteral">"over the subset\n"</span> );
<a name="l00107"></a>00107     printf(<span class="stringliteral">"(decomposed into components if the variable is a vector) for "</span>
<a name="l00108"></a>00108            <span class="stringliteral">"each time\n"</span>);
<a name="l00109"></a>00109     printf(<span class="stringliteral">"step. It also creates a file, '*.gnu', which produces a plot of "</span>
<a name="l00110"></a>00110            <span class="stringliteral">"the results. \n"</span>);
<a name="l00111"></a>00111     printf(<span class="stringliteral">"\n"</span>);
<a name="l00112"></a>00112     fflush(NULL);
<a name="l00113"></a>00113     exit(-1);
<a name="l00114"></a>00114   }
<a name="l00115"></a>00115   <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {
<a name="l00116"></a>00116     <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">"-o"</span>)) {
<a name="l00117"></a>00117       output_root_name = argv[i+1];
<a name="l00118"></a>00118       i++;
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">"-v"</span>)) {
<a name="l00121"></a>00121       verbose_level = <a class="code" href="group__DataTypes.html#gg1ceb59a5b485f8bcbcb8acad4cfb9323d5f8d0b704dba62980776bac1283a741">FC_WARNING_MESSAGES</a>;
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">"-V"</span>)) {
<a name="l00124"></a>00124       verbose_level = <a class="code" href="group__DataTypes.html#gg1ceb59a5b485f8bcbcb8acad4cfb932395535fc1e83f1faa426c80811de6c55e">FC_LOG_MESSAGES</a>;
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(argv[i], <span class="stringliteral">"-h"</span>, 2) || !strncmp(argv[i], <span class="stringliteral">"-"</span>, 1))
<a name="l00127"></a>00127       <span class="keywordflow">goto</span> usage;
<a name="l00128"></a>00128     <span class="keywordflow">else</span> {
<a name="l00129"></a>00129       <span class="keywordflow">if</span> (i + 3 &gt;= argc)
<a name="l00130"></a>00130         <span class="keywordflow">goto</span> usage;
<a name="l00131"></a>00131       file_name = argv[i];
<a name="l00132"></a>00132       mesh_name = argv[i+1];
<a name="l00133"></a>00133       subset_name = argv[i+2];
<a name="l00134"></a>00134       var_name = argv[i+3];
<a name="l00135"></a>00135       i+=4;
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137   }
<a name="l00138"></a>00138   <span class="keywordflow">if</span> (!file_name)
<a name="l00139"></a>00139     <span class="keywordflow">goto</span> usage;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141   <span class="comment">// init library and load dataset</span>
<a name="l00142"></a>00142   rc = <a class="code" href="group__Library.html#gc54575c50a63dd29c694c78315d8fcf2" title="Set the library verbosity level.">fc_setLibraryVerbosity</a>(verbose_level);
<a name="l00143"></a>00143   <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(rc);
<a name="l00144"></a>00144   rc = <a class="code" href="group__Library.html#g18b26962103ffc9596657386d55a93af" title="Setup Feature Characterization Library for use.">fc_initLibrary</a>();
<a name="l00145"></a>00145   <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(rc);
<a name="l00146"></a>00146   rc = <a class="code" href="group__FileIO.html#g77b8250a472752e14bda28962116a66b" title="Load a dataset and it&amp;#39;s members from a file.">fc_loadDataset</a>(file_name, &amp;dataset);
<a name="l00147"></a>00147   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to load dataset '%s'"</span>, file_name);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149   <span class="comment">// get mesh, subset and sequence variable</span>
<a name="l00150"></a>00150   rc = <a class="code" href="group__Mesh.html#gb72987c2bf83a19f208df925bc8af86b" title="Get all meshes with a given name from the dataset.">fc_getMeshByName</a>(dataset, mesh_name, &amp;numReturnMeshes,
<a name="l00151"></a>00151                &amp;returnMeshes);
<a name="l00152"></a>00152   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get mesh '%s' by name"</span>, mesh_name);
<a name="l00153"></a>00153   <span class="keywordflow">if</span> (numReturnMeshes != 1){
<a name="l00154"></a>00154     <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>, 
<a name="l00155"></a>00155                 <span class="stringliteral">"Failed to find (unique) mesh '%s' - found %d matches"</span>,
<a name="l00156"></a>00156                 mesh_name,numReturnMeshes);
<a name="l00157"></a>00157   } 
<a name="l00158"></a>00158   mesh = returnMeshes[0];
<a name="l00159"></a>00159   free(returnMeshes);
<a name="l00160"></a>00160   rc = <a class="code" href="group__Subset.html#g4a86210a00bac9a23256e57f6c161a36" title="Get subsets of a given name from a mesh.">fc_getSubsetByName</a>(mesh, subset_name, &amp;numReturnSubsets, &amp;returnSubsets);
<a name="l00161"></a>00161   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get subset '%s' by name"</span>, subset_name);
<a name="l00162"></a>00162   <span class="keywordflow">if</span> (numReturnSubsets != 1){
<a name="l00163"></a>00163     <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>,
<a name="l00164"></a>00164                 <span class="stringliteral">"Failed to find (unique) subset '%s' - found %d matches"</span>,
<a name="l00165"></a>00165                 subset_name, numReturnSubsets);
<a name="l00166"></a>00166   }
<a name="l00167"></a>00167   subset = returnSubsets[0];
<a name="l00168"></a>00168   free(returnSubsets);
<a name="l00169"></a>00169   rc = <a class="code" href="group__Variable.html#g9022a4933230e252076467a05f101a68" title="Gets a unique seq var if it exists, otherwise generate it from components if possible...">fc_getOrGenerateUniqueSeqVariableByName</a>(mesh, var_name,
<a name="l00170"></a>00170                                 &amp;numStep, &amp;seqVar);
<a name="l00171"></a>00171   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to find or create sequence variable '%s'\n"</span>,
<a name="l00172"></a>00172                  var_name);
<a name="l00173"></a>00173   <span class="keywordflow">if</span> (!seqVar){
<a name="l00174"></a>00174     <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>,
<a name="l00175"></a>00175                 <span class="stringliteral">"Failed to find or create sequence variable '%s'\n"</span>,
<a name="l00176"></a>00176                 var_name);
<a name="l00177"></a>00177   }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179   rc = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep, seqVar, &amp;sequence);
<a name="l00180"></a>00180   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get sequence from seqVariable"</span>);
<a name="l00181"></a>00181   rc = <a class="code" href="group__Sequence.html#g6d5a8a30edd00c973804c7ce31a3a2e6" title="Get the data type of a sequence&amp;#39;s coordinates.">fc_getSequenceDataType</a>(sequence, &amp;datatype);
<a name="l00182"></a>00182   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get data from sequence"</span>);
<a name="l00183"></a>00183   rc = <a class="code" href="group__Sequence.html#ga88160e25be202c8de18ac89edf876c6" title="Get sequence coordinates.">fc_getSequenceCoordsPtr</a>(sequence, &amp;times);
<a name="l00184"></a>00184   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get data from sequence"</span>);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   <span class="comment">// Make sure that subset and seqVar are on same association</span>
<a name="l00187"></a>00187   rc = <a class="code" href="group__Subset.html#g7e34b0e8a2f9d42c44f0ee4ea00f5e8a" title="Get subset&amp;#39;s association type.">fc_getSubsetAssociationType</a>(subset, &amp;subset_assoc);
<a name="l00188"></a>00188   rc = rc + <a class="code" href="group__Variable.html#ge4935bc28dae482ddabcfd421400ab13" title="Return data association of a variable.">fc_getVariableAssociationType</a>(seqVar[0], &amp;var_assoc);
<a name="l00189"></a>00189   <span class="keywordflow">if</span> (subset_assoc != var_assoc || rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) 
<a name="l00190"></a>00190     <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>, <span class="stringliteral">"Subset and seqVar must have the same "</span>
<a name="l00191"></a>00191                          <span class="stringliteral">"assoc (subset = '%s', var = '%s')"</span>,
<a name="l00192"></a>00192                          <a class="code" href="group__DataTypes.html#g615e96c3b13331857b5ba45d597c49de" title="Return the name of the FC_AssociationType&amp;#39;s value.">fc_getAssociationTypeText</a>(subset_assoc),
<a name="l00193"></a>00193                          <a class="code" href="group__DataTypes.html#g615e96c3b13331857b5ba45d597c49de" title="Return the name of the FC_AssociationType&amp;#39;s value.">fc_getAssociationTypeText</a>(var_assoc));
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <span class="comment">// If a vector seqVar, decompose seqVar into components &amp; get magnitude</span>
<a name="l00196"></a>00196   rc = <a class="code" href="group__Variable.html#gb3e6e14f099d7870ee2c38ccccf87544" title="Return number of components of a variable.">fc_getVariableNumComponent</a>(seqVar[0], &amp;numComp);
<a name="l00197"></a>00197   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Could not get number of components of variable"</span>);
<a name="l00198"></a>00198   <span class="keywordflow">if</span> (numComp == 1) {
<a name="l00199"></a>00199     compSeqVars = (<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>**)malloc(<span class="keyword">sizeof</span>(<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>*));
<a name="l00200"></a>00200     compSeqVars[0] = (<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>*)malloc(numStep*<span class="keyword">sizeof</span>(<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>));
<a name="l00201"></a>00201     <span class="keywordflow">for</span> (i = 0; i &lt; numStep; i++)
<a name="l00202"></a>00202       compSeqVars[0][i] = seqVar[i];
<a name="l00203"></a>00203   }
<a name="l00204"></a>00204   <span class="keywordflow">else</span> {                        
<a name="l00205"></a>00205     <span class="keywordtype">void</span>* temp;
<a name="l00206"></a>00206     rc = <a class="code" href="group__Variable.html#g192ec837fdd98caa5360f30188207b89" title="Creates new sequence variables which are the components of a given sequence variable...">fc_createComponentSeqVariables</a>(numStep, seqVar, &amp;numComp,
<a name="l00207"></a>00207                                         &amp;compSeqVars);
<a name="l00208"></a>00208     <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Could not split var into components"</span>);
<a name="l00209"></a>00209     temp = realloc(compSeqVars, (numComp+1)*<span class="keyword">sizeof</span>(<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>*));
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (!temp) 
<a name="l00211"></a>00211       <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00212"></a>00212     compSeqVars = temp;
<a name="l00213"></a>00213     compSeqVars[numComp] = (<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>*)malloc(numStep*<span class="keyword">sizeof</span>(<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>));
<a name="l00214"></a>00214     <span class="keywordflow">if</span> (!compSeqVars[numComp]) 
<a name="l00215"></a>00215       <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00216"></a>00216     <span class="keywordflow">for</span> (i = 0; i &lt; numStep; i++) {
<a name="l00217"></a>00217       <span class="keywordtype">char</span>* tempName = (<span class="keywordtype">char</span>*)malloc((strlen(var_name)+20)*<span class="keyword">sizeof</span>(char));
<a name="l00218"></a>00218       sprintf(tempName, <span class="stringliteral">"%s_magnitude"</span>, var_name);
<a name="l00219"></a>00219       rc = <a class="code" href="group__VariableMath.html#g8b3157495faccd3052b54aa54cb96c1b" title="Creates a new variable which is the magnitude of the current variable.">fc_createMagnitudeVariable</a>(seqVar[i], tempName, 
<a name="l00220"></a>00220                                       &amp;compSeqVars[numComp][i]);
<a name="l00221"></a>00221       free(tempName);
<a name="l00222"></a>00222       <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"could not create magnitude variable"</span>);
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224     numComp++;
<a name="l00225"></a>00225   }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227   <span class="comment">// Collect Sum over subset for all components and steps</span>
<a name="l00228"></a>00228   sums = (<span class="keywordtype">double</span>**)malloc(numComp*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>*));
<a name="l00229"></a>00229   <span class="keywordflow">for</span> (i = 0; i &lt; numComp; i++)
<a name="l00230"></a>00230     sums[i] = (<span class="keywordtype">double</span>*)malloc(numStep*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00231"></a>00231   <span class="keywordflow">for</span> (i = 0; i &lt; numComp; i++) {
<a name="l00232"></a>00232     <span class="keywordflow">for</span> (j = 0; j &lt; numStep; j++) {
<a name="l00233"></a>00233       rc = <a class="code" href="group__Statistics.html#ge7be077012a83bcf2ed8133cc8590576" title="Compute sum of all data values of a subset of a variable.">fc_getVariableSubsetSum</a>(compSeqVars[i][j], subset, &amp;sums[i][j]);
<a name="l00234"></a>00234       <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Get sum failed for step %d of component %d"</span>,
<a name="l00235"></a>00235                            j, i);
<a name="l00236"></a>00236     }
<a name="l00237"></a>00237   }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   <span class="comment">// Get names of things</span>
<a name="l00240"></a>00240   <span class="comment">// get component names</span>
<a name="l00241"></a>00241   comp_names = (<span class="keywordtype">char</span>**)malloc(numComp*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
<a name="l00242"></a>00242   <span class="keywordflow">for</span> (i = 0; i &lt; numComp; i++) {
<a name="l00243"></a>00243     rc = <a class="code" href="group__Variable.html#g233584b319c5dd90a13582fc9ac3484e" title="Return name of a variable.">fc_getVariableName</a>(compSeqVars[i][0], &amp;comp_names[i]);
<a name="l00244"></a>00244     <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"failed to get name of component %d"</span>, i);
<a name="l00245"></a>00245   }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247   <span class="comment">// setup output names</span>
<a name="l00248"></a>00248   str_len = strlen(output_root_name)+1;
<a name="l00249"></a>00249   datfile_name = (<span class="keywordtype">char</span>*)malloc((str_len + 4)*<span class="keyword">sizeof</span>(char));
<a name="l00250"></a>00250   sprintf(datfile_name, <span class="stringliteral">"%s.dat"</span>, output_root_name);
<a name="l00251"></a>00251   gnufile_name = (<span class="keywordtype">char</span>*)malloc((str_len + 4)*<span class="keyword">sizeof</span>(char));
<a name="l00252"></a>00252   sprintf(gnufile_name, <span class="stringliteral">"%s.gnu"</span>, output_root_name);
<a name="l00253"></a>00253   plotfile_name = (<span class="keywordtype">char</span>*)malloc((str_len + 4)*<span class="keyword">sizeof</span>(char));
<a name="l00254"></a>00254   sprintf(plotfile_name, <span class="stringliteral">"%s.eps"</span>, output_root_name);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256   <span class="comment">// create dat file</span>
<a name="l00257"></a>00257   file = fopen(datfile_name, <span class="stringliteral">"w"</span>);
<a name="l00258"></a>00258   fprintf(file, <span class="stringliteral">"# Data file generated by FCLib's %s\n"</span>, argv[0]);
<a name="l00259"></a>00259   fprintf(file, <span class="stringliteral">"# %s"</span>, ctime(&amp;start_time));
<a name="l00260"></a>00260   fprintf(file, <span class="stringliteral">"#\n"</span>);
<a name="l00261"></a>00261   fprintf(file, <span class="stringliteral">"# Database file: %s\n"</span>, file_name);
<a name="l00262"></a>00262   fprintf(file, <span class="stringliteral">"# Mesh = '%s'\n"</span>, mesh_name);
<a name="l00263"></a>00263   fprintf(file, <span class="stringliteral">"# Subset = '%s'\n"</span>, subset_name);
<a name="l00264"></a>00264   fprintf(file, <span class="stringliteral">"# SeqVariable = '%s'\n"</span>, var_name);
<a name="l00265"></a>00265   fprintf(file, <span class="stringliteral">"#\n"</span>);
<a name="l00266"></a>00266   fprintf(file, <span class="stringliteral">"# numComp = %d, numStep = %d\n"</span>, numComp, numStep);
<a name="l00267"></a>00267   fprintf(file, <span class="stringliteral">"# time"</span>);
<a name="l00268"></a>00268   fflush(NULL);
<a name="l00269"></a>00269   <span class="keywordflow">for</span> (i = 0; i &lt; numComp; i++) 
<a name="l00270"></a>00270     fprintf(file, <span class="stringliteral">" %s"</span>, comp_names[i]);
<a name="l00271"></a>00271   fprintf(file, <span class="stringliteral">"\n"</span>);
<a name="l00272"></a>00272   <span class="keywordflow">for</span> (i = 0; i &lt; numStep; i++) {
<a name="l00273"></a>00273     <span class="keywordflow">switch</span> (datatype) {
<a name="l00274"></a>00274     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d963896eb450c264fe236185788362b270">FC_DT_INT</a>:     fprintf(file, <span class="stringliteral">"%11d"</span>, ((<span class="keywordtype">int</span>*)times)[i]);       <span class="keywordflow">break</span>;
<a name="l00275"></a>00275     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9b32c04c999cf2998e57c184acc553eb7">FC_DT_FLOAT</a>:   fprintf(file, <span class="stringliteral">"%11.6g"</span>, ((<span class="keywordtype">float</span>*)times)[i]);   <span class="keywordflow">break</span>;
<a name="l00276"></a>00276     <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>:  fprintf(file, <span class="stringliteral">"%11.6g"</span>, ((<span class="keywordtype">double</span>*)times)[i]);  <span class="keywordflow">break</span>;
<a name="l00277"></a>00277     <span class="keywordflow">default</span>:
<a name="l00278"></a>00278       printf(<span class="stringliteral">"Warning: could not decode time coords, writing time IDs instead\n"</span>);
<a name="l00279"></a>00279       fprintf(file, <span class="stringliteral">"%11d"</span>, i);
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281     <span class="keywordflow">for</span> (j = 0; j &lt; numComp; j++) 
<a name="l00282"></a>00282       fprintf(file, <span class="stringliteral">" %11.6g"</span>, sums[j][i]);
<a name="l00283"></a>00283     fprintf(file, <span class="stringliteral">"\n"</span>);
<a name="l00284"></a>00284   }
<a name="l00285"></a>00285   fflush(NULL);
<a name="l00286"></a>00286   fclose(file);
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   <span class="comment">// create gnuplot file</span>
<a name="l00289"></a>00289   file = fopen(gnufile_name, <span class="stringliteral">"w"</span>);
<a name="l00290"></a>00290   <span class="keywordflow">if</span> (file == NULL)
<a name="l00291"></a>00291     <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce406cfb6be2c486a7655cecdd3f5c02e44">FC_FILE_IO_ERROR</a>, <span class="stringliteral">"Couldn't open file"</span>);
<a name="l00292"></a>00292   fprintf(file, <span class="stringliteral">"# Gnuplot script generated by FCLib's %s\n"</span>, argv[0]);
<a name="l00293"></a>00293   fprintf(file, <span class="stringliteral">"# %s"</span>, ctime(&amp;start_time));
<a name="l00294"></a>00294   fprintf(file, <span class="stringliteral">"#\n"</span>);
<a name="l00295"></a>00295   fprintf(file, <span class="stringliteral">"# References data file '%s'\n"</span>, datfile_name);
<a name="l00296"></a>00296   fprintf(file, <span class="stringliteral">"# To run: 'gnuplot %s' \n"</span>, gnufile_name); 
<a name="l00297"></a>00297   fprintf(file, <span class="stringliteral">"#\n"</span>);
<a name="l00298"></a>00298 
<a name="l00299"></a>00299   fprintf(file, <span class="stringliteral">"# set up\n"</span>);
<a name="l00300"></a>00300   fprintf(file, <span class="stringliteral">"set terminal postscript eps color\n"</span>);
<a name="l00301"></a>00301   fprintf(file, <span class="stringliteral">"set output '%s'\n"</span>, plotfile_name);
<a name="l00302"></a>00302   fprintf(file, <span class="stringliteral">"set multiplot\n"</span>);
<a name="l00303"></a>00303   fprintf(file, <span class="stringliteral">"set size 1, %g\n"</span>, 1./numComp); <span class="comment">// all plots same size</span>
<a name="l00304"></a>00304   fprintf(file, <span class="stringliteral">"set xlabel 'Time'\n"</span>);
<a name="l00305"></a>00305   fprintf(file, <span class="stringliteral">"\n"</span>);
<a name="l00306"></a>00306   fflush(NULL);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   <span class="comment">//fprintf(file, "set title \"Title\"\n");</span>
<a name="l00309"></a>00309   <span class="keywordflow">for</span> (i = 0; i &lt; numComp; i++) {
<a name="l00310"></a>00310     fprintf(file, <span class="stringliteral">"set origin 0, %g\n"</span>, 1.- (i+1.)/numComp);
<a name="l00311"></a>00311     fprintf(file, <span class="stringliteral">"set ylabel '%s'\n"</span>, comp_names[i]);
<a name="l00312"></a>00312     fprintf(file, <span class="stringliteral">"plot '%s' using 1:%d notitle with linespoints\n"</span>, 
<a name="l00313"></a>00313             datfile_name, 2+i);
<a name="l00314"></a>00314   }
<a name="l00315"></a>00315   fflush(NULL);
<a name="l00316"></a>00316   fclose(file);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318   <span class="comment">// all done</span>
<a name="l00319"></a>00319   free(seqVar);
<a name="l00320"></a>00320   <span class="keywordflow">for</span> (i = 0; i &lt; numComp; i++) 
<a name="l00321"></a>00321     free(compSeqVars[i]);
<a name="l00322"></a>00322   free(compSeqVars);
<a name="l00323"></a>00323   <span class="keywordflow">for</span> (i = 0; i &lt; numComp; i++)
<a name="l00324"></a>00324     free(sums[i]);
<a name="l00325"></a>00325   free(sums);
<a name="l00326"></a>00326   free(datfile_name);
<a name="l00327"></a>00327   free(gnufile_name);
<a name="l00328"></a>00328   free(plotfile_name);
<a name="l00329"></a>00329   <a class="code" href="group__Library.html#g29ff0e41fb4f58b55489bc875ac32b2f" title="Cleanup when done using Feature Characterization Library.">fc_finalLibrary</a>();
<a name="l00330"></a>00330 
<a name="l00331"></a>00331   exit(0);
<a name="l00332"></a>00332 }
</pre></div>
<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Oct 27 13:26:11 2008 for FCLib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
