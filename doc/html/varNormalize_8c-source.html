<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>FCLib: tools/varNormalize.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>tools/varNormalize.c</h1><a href="varNormalize_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (2000) Sandia Corporation. Under the terms of Contract</span>
<a name="l00003"></a>00003 <span class="comment"> * DE-AC04-94AL85000 with Sandia Corporation, the U.S. Government retains</span>
<a name="l00004"></a>00004 <span class="comment"> * certain rights in this software.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00007"></a>00007 <span class="comment"> * modification, are permitted provided that the following conditions are met:</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *   * Redistributions of source code must retain the above copyright</span>
<a name="l00010"></a>00010 <span class="comment"> *     notice, this list of conditions and the following disclaimer.</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> *   * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00013"></a>00013 <span class="comment"> *     notice, this list of conditions and the following disclaimer in the</span>
<a name="l00014"></a>00014 <span class="comment"> *     documentation and/or other materials provided with the</span>
<a name="l00015"></a>00015 <span class="comment"> *     distribution.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> *   * Neither the name of Sandia nor the names of any contributors may</span>
<a name="l00018"></a>00018 <span class="comment"> *     be used to endorse or promote products derived from this software</span>
<a name="l00019"></a>00019 <span class="comment"> *     without specific prior written permission.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> *   * Modified source versions must be plainly marked as such, and must</span>
<a name="l00022"></a>00022 <span class="comment"> *     not be misrepresented as being the original software.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</span>
<a name="l00025"></a>00025 <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00026"></a>00026 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00027"></a>00027 <span class="comment"> * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR</span>
<a name="l00028"></a>00028 <span class="comment"> * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<a name="l00029"></a>00029 <span class="comment"> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<a name="l00030"></a>00030 <span class="comment"> * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="l00031"></a>00031 <span class="comment"> * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00032"></a>00032 <span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
<a name="l00033"></a>00033 <span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
<a name="l00034"></a>00034 <span class="comment"> * DAMAGE.</span>
<a name="l00035"></a>00035 <span class="comment"> */</span>
<a name="l00036"></a>00036 <span class="comment"></span>
<a name="l00037"></a>00037 <span class="comment">/**</span>
<a name="l00038"></a>00038 <span class="comment"> * \file varNormalize.c</span>
<a name="l00039"></a>00039 <span class="comment"> * \brief Create a new dataset in which the desired variable has</span>
<a name="l00040"></a>00040 <span class="comment"> *        been normalized.</span>
<a name="l00041"></a>00041 <span class="comment"> *</span>
<a name="l00042"></a>00042 <span class="comment"> * $Source: /usr/local/Repositories/fcdmf/fclib/tools/varNormalize.c,v $</span>
<a name="l00043"></a>00043 <span class="comment"> * $Revision: 1.5 $ </span>
<a name="l00044"></a>00044 <span class="comment"> * $Date: 2007/03/14 01:47:22 $</span>
<a name="l00045"></a>00045 <span class="comment"> *</span>
<a name="l00046"></a>00046 <span class="comment"> * \description</span>
<a name="l00047"></a>00047 <span class="comment"> *</span>
<a name="l00048"></a>00048 <span class="comment"> *    Usage: varNormalize [options] dataset "variable name" new_file</span>
<a name="l00049"></a>00049 <span class="comment"> *</span>
<a name="l00050"></a>00050 <span class="comment"> *    Create a new dataset in which the desired variable has been</span>
<a name="l00051"></a>00051 <span class="comment"> *    normalized to be the ratio of the original values to a maximum value.</span>
<a name="l00052"></a>00052 <span class="comment"> *</span>
<a name="l00053"></a>00053 <span class="comment"> *    If you specify "von mises stress" or "pressure" as the var and</span>
<a name="l00054"></a>00054 <span class="comment"> *    it does not exist in the file, it will be calculated.</span>
<a name="l00055"></a>00055 <span class="comment"> *</span>
<a name="l00056"></a>00056 <span class="comment"> *    The maximum value(s) can be provided or "discovered"--the discovered</span>
<a name="l00057"></a>00057 <span class="comment"> *    values are calculated from variable itself. The default execution is</span>
<a name="l00058"></a>00058 <span class="comment"> *    that a single value is applied to all meshes and all steps. If a value</span>
<a name="l00059"></a>00059 <span class="comment"> *    is not provided on the command line, the maximum value of the variable</span>
<a name="l00060"></a>00060 <span class="comment"> *    over all meshes and time steps is used.</span>
<a name="l00061"></a>00061 <span class="comment"> *</span>
<a name="l00062"></a>00062 <span class="comment"> *    Command line arguments can switch the behavior to applying per mesh</span>
<a name="l00063"></a>00063 <span class="comment"> *    values, per time step values, or both. For example, if per mesh behavior</span>
<a name="l00064"></a>00064 <span class="comment"> *    is requested, the maximum value over all timesteps is found for each mesh</span>
<a name="l00065"></a>00065 <span class="comment"> *    and applied to only that mesh.</span>
<a name="l00066"></a>00066 <span class="comment"> *</span>
<a name="l00067"></a>00067 <span class="comment"> *    To apply a provided value to all meshes and steps, you can provide</span>
<a name="l00068"></a>00068 <span class="comment"> *    the value on the command line (-max #). If you want to provide per</span>
<a name="l00069"></a>00069 <span class="comment"> *    mesh values, you give the name of a file containing the mesh names and</span>
<a name="l00070"></a>00070 <span class="comment"> *    their values. The format of the file is pair of lines: the first line</span>
<a name="l00071"></a>00071 <span class="comment"> *    has the name of the mesh exactly (NO trailing spaces), the second line</span>
<a name="l00072"></a>00072 <span class="comment"> *    is the value you would like applied to that mesh.</span>
<a name="l00073"></a>00073 <span class="comment"> *</span>
<a name="l00074"></a>00074 <span class="comment"> *    Currently, this tool does not allow providing per time max values.</span>
<a name="l00075"></a>00075 <span class="comment"> *</span>
<a name="l00076"></a>00076 <span class="comment"> *    The new dataset will be of the same file type as the original dataset.</span>
<a name="l00077"></a>00077 <span class="comment"> *</span>
<a name="l00078"></a>00078 <span class="comment"> * \todo </span>
<a name="l00079"></a>00079 <span class="comment"> *    - Be able to specify per step "provided" max values (both per mesh </span>
<a name="l00080"></a>00080 <span class="comment"> *      and overall). For the per mesh, could extend the current file</span>
<a name="l00081"></a>00081 <span class="comment"> *      format to have multiple vals on the val line.</span>
<a name="l00082"></a>00082 <span class="comment"> *    - The max stress tool calculates the tension and compression</span>
<a name="l00083"></a>00083 <span class="comment"> *      separately and reports min and max for those separately.</span>
<a name="l00084"></a>00084 <span class="comment"> *      Will we want that here?</span>
<a name="l00085"></a>00085 <span class="comment"> *    - I believe this does not check for the normalized var already</span>
<a name="l00086"></a>00086 <span class="comment"> *      exisitng by name - fix this.</span>
<a name="l00087"></a>00087 <span class="comment"> *    - What happens for divide by zero? check this</span>
<a name="l00088"></a>00088 <span class="comment"> *    - The von mises stress is fairly well tested via reliance on values</span>
<a name="l00089"></a>00089 <span class="comment"> *      obtained by maxStress, but that is not true of pressure. Decide how</span>
<a name="l00090"></a>00090 <span class="comment"> *      necessary it is to rigorously test this givent hat the var is built the</span>
<a name="l00091"></a>00091 <span class="comment"> *      same in either case and that the vals come from the unittested function</span>
<a name="l00092"></a>00092 <span class="comment"> *      fc_createStressAndPressureVariables.</span>
<a name="l00093"></a>00093 <span class="comment"> *    - for sparse keep track of remaining vars per sequence and delete sequences</span>
<a name="l00094"></a>00094 <span class="comment"> *      with no seqvars</span>
<a name="l00095"></a>00095 <span class="comment"> *</span>
<a name="l00096"></a>00096 <span class="comment"> * \modifications</span>
<a name="l00097"></a>00097 <span class="comment"> *   - 11/17/06 WSD, created</span>
<a name="l00098"></a>00098 <span class="comment"> *   - 03/12/07 ACG option to calculate von mises stress and pressure vars. Much</span>
<a name="l00099"></a>00099 <span class="comment"> *                  of this was lifted from the maxstress tool. If you make a</span>
<a name="l00100"></a>00100 <span class="comment"> *                  change in either file, please cross reference.</span>
<a name="l00101"></a>00101 <span class="comment"> *   - 10/11/07 ACG changed append of "normalized" to "nmz" because of</span>
<a name="l00102"></a>00102 <span class="comment"> *                  var name length limitation in exodus</span>
<a name="l00103"></a>00103 <span class="comment"> */</span>
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00106"></a>00106 <span class="preprocessor">#include "<a class="code" href="fc_8h.html" title="Master header file for FCLib.">fc.h</a>"</span>
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 <span class="keyword">static</span> <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> <a class="code" href="varNormalize_8c.html#73d7511bd9bb6b7517da3b0f91975f4e">createStressOrPressureVar</a>(<span class="keywordtype">int</span>, <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a>*, <span class="keywordtype">char</span>**, <span class="keywordtype">char</span>*);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="comment">// the endings of the sigma matrix in the order we plan to process them</span>
<a name="l00111"></a><a class="code" href="varNormalize_8c.html#b98e818ad01171b451d8e4d0ee641063">00111</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="maxStress_8c.html#b98e818ad01171b451d8e4d0ee641063">sigmaPostfix</a>[6][3] = { <span class="stringliteral">"xx"</span>, <span class="stringliteral">"yy"</span>, <span class="stringliteral">"zz"</span>, <span class="stringliteral">"xy"</span>, <span class="stringliteral">"yz"</span>, <span class="stringliteral">"zx"</span> };
<a name="l00112"></a><a class="code" href="varNormalize_8c.html#0965079320a17226b599cd560ee48931">00112</a> <span class="keyword">static</span> <span class="keywordtype">char</span>* <a class="code" href="varNormalize_8c.html#0965079320a17226b599cd560ee48931">von_mises_stress_name</a> = <span class="stringliteral">"von mises stress"</span>;
<a name="l00113"></a><a class="code" href="varNormalize_8c.html#06b7b2a0646c86c3b6649e65b344a643">00113</a> <span class="keyword">static</span> <span class="keywordtype">char</span>* <a class="code" href="varNormalize_8c.html#06b7b2a0646c86c3b6649e65b344a643">pressure_name</a> = <span class="stringliteral">"pressure"</span>;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 
<a name="l00116"></a><a class="code" href="varNormalize_8c.html#73d7511bd9bb6b7517da3b0f91975f4e">00116</a> <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> <a class="code" href="varNormalize_8c.html#73d7511bd9bb6b7517da3b0f91975f4e">createStressOrPressureVar</a>(<span class="keywordtype">int</span> numMesh, <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a> *meshes, 
<a name="l00117"></a>00117                            <span class="keywordtype">char</span> **mesh_names, <span class="keywordtype">char</span> *<a class="code" href="subsetter_8c.html#4b703ba1f7a1288de40089aa611b9abf">var_name</a>){
<a name="l00118"></a>00118   <span class="comment">//lifting this from maxstress</span>
<a name="l00119"></a>00119   <span class="keywordtype">int</span> numStep;
<a name="l00120"></a>00120   <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a> **sigmas[6]; <span class="comment">//index as sigmas[compID][meshID][stepID]</span>
<a name="l00121"></a>00121   <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> sequence;
<a name="l00122"></a>00122   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l00123"></a>00123   <span class="keywordtype">int</span> i,j,k;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++) {
<a name="l00126"></a>00126     <span class="keywordtype">char</span> charBuf[1028];
<a name="l00127"></a>00127     sprintf(charBuf, <span class="stringliteral">"sigma-%s"</span>, <a class="code" href="maxStress_8c.html#b98e818ad01171b451d8e4d0ee641063">sigmaPostfix</a>[i]);
<a name="l00128"></a>00128     sigmas[i] = (<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>**)malloc(numMesh*<span class="keyword">sizeof</span>(<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>*));
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (!sigmas[i])
<a name="l00130"></a>00130       <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00131"></a>00131     <span class="keywordflow">for</span> (j = 0; j &lt; numMesh; j++) {
<a name="l00132"></a>00132       rc = <a class="code" href="group__Variable.html#g9022a4933230e252076467a05f101a68" title="Gets a unique seq var if it exists, otherwise generate it from components if possible...">fc_getOrGenerateUniqueSeqVariableByName</a>(meshes[j], charBuf,
<a name="l00133"></a>00133                                  &amp;numStep,
<a name="l00134"></a>00134                                  &amp;sigmas[i][j]);
<a name="l00135"></a>00135       <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Could not find variable '%s' on mesh '%s'"</span>,
<a name="l00136"></a>00136                   charBuf, mesh_names[j]);
<a name="l00137"></a>00137       <span class="keywordflow">if</span> (sigmas[i][j] == 0){
<a name="l00138"></a>00138      <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>,
<a name="l00139"></a>00139                     <span class="stringliteral">"Problems finding (unique) variable '%s' on mesh '%s'"</span>,
<a name="l00140"></a>00140                     charBuf, mesh_names[j]);
<a name="l00141"></a>00141       }
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143   }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145   rc = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep, sigmas[0][0], &amp;sequence);
<a name="l00146"></a>00146   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get sequence from first seq variable"</span>);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 
<a name="l00149"></a>00149   <span class="keywordflow">for</span> (i = 0; i &lt; numMesh; i++){
<a name="l00150"></a>00150     <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a> stress[numStep], pressure[numStep];
<a name="l00151"></a>00151     <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a> *newseq_var;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="keywordflow">for</span> (j = 0; j &lt; numStep; j++) {
<a name="l00154"></a>00154       <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a> sigs[6];
<a name="l00155"></a>00155       <span class="keywordflow">for</span> (k = 0; k &lt; 6; k++)
<a name="l00156"></a>00156      sigs[k] = sigmas[k][i][j];
<a name="l00157"></a>00157       
<a name="l00158"></a>00158       <span class="comment">// get stress &amp; pressure</span>
<a name="l00159"></a>00159       rc = <a class="code" href="group__VariableMath.html#g7fa0743dcd208fc958512a0ecbacfde0" title="Compute Von Mises stress and pressure from the stress matrix.">fc_createStressPressureVariables</a>(sigs, &amp;stress[j], &amp;pressure[j]);
<a name="l00160"></a>00160       <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"failed to compute stress &amp; pressure"</span>);
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="comment">//make one into a seq var and kill the other one</span>
<a name="l00164"></a>00164     <span class="keywordflow">if</span> (!strcmp(var_name,<a class="code" href="varNormalize_8c.html#0965079320a17226b599cd560ee48931">von_mises_stress_name</a>)){
<a name="l00165"></a>00165       rc = <a class="code" href="group__Variable.html#g962a68f110466d7e77d7bae3df089f20" title="Convert an array of basic vars into a sequence var.">fc_convertVariablesToSeqVariable</a> (numStep, stress, sequence,
<a name="l00166"></a>00166                               <a class="code" href="varNormalize_8c.html#0965079320a17226b599cd560ee48931">von_mises_stress_name</a>,
<a name="l00167"></a>00167                               &amp;newseq_var);
<a name="l00168"></a>00168       <span class="keywordflow">for</span> (k = 0; k &lt; numStep; k++){
<a name="l00169"></a>00169      <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(pressure[k]);
<a name="l00170"></a>00170       }
<a name="l00171"></a>00171     } <span class="keywordflow">else</span>{
<a name="l00172"></a>00172       rc = <a class="code" href="group__Variable.html#g962a68f110466d7e77d7bae3df089f20" title="Convert an array of basic vars into a sequence var.">fc_convertVariablesToSeqVariable</a> (numStep, pressure, sequence,
<a name="l00173"></a>00173                              <a class="code" href="varNormalize_8c.html#06b7b2a0646c86c3b6649e65b344a643">pressure_name</a>, &amp;newseq_var);
<a name="l00174"></a>00174       <span class="keywordflow">for</span> (k = 0; k &lt; numStep; k++){
<a name="l00175"></a>00175      <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(stress[k]);
<a name="l00176"></a>00176       }
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="comment">//we dont need to keep our array of handles (the var itself stays)</span>
<a name="l00180"></a>00180     free(newseq_var);
<a name="l00181"></a>00181   }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183   <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++){
<a name="l00184"></a>00184     <span class="keywordflow">for</span> (j = 0; j &lt; numMesh; j++){
<a name="l00185"></a>00185       free(sigmas[i][j]);
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187     free(sigmas[i]);
<a name="l00188"></a>00188   }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 
<a name="l00195"></a>00195  
<a name="l00196"></a><a class="code" href="varNormalize_8c.html#3c04138a5bfe5d72780bb7e82a18e627">00196</a> <span class="keywordtype">int</span> <a class="code" href="analyzeSpotWelds_8c.html#3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {
<a name="l00197"></a>00197   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l00198"></a>00198   <span class="keywordtype">int</span> i, j;
<a name="l00199"></a>00199   <span class="keywordtype">int</span> numMesh, numBasicVar, numSeqVar, numStep = 0;
<a name="l00200"></a>00200   <a class="code" href="structFC__Dataset.html" title="Dataset Handle.">FC_Dataset</a> ds_orig;
<a name="l00201"></a>00201   <a class="code" href="structFC__Mesh.html" title="Mesh Handle.">FC_Mesh</a>* meshes;
<a name="l00202"></a>00202   <span class="keywordtype">char</span>** meshNames;
<a name="l00203"></a>00203   <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>* basic_vars = NULL, *new_basic_vars = NULL;
<a name="l00204"></a>00204   <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>** seq_vars = NULL, **new_seq_vars = NULL;
<a name="l00205"></a>00205   <a class="code" href="structFC__Sequence.html" title="Sequence Handle.">FC_Sequence</a> sequence;
<a name="l00206"></a>00206   <span class="keywordtype">char</span>* <a class="code" href="subsetter_8c.html#8505c513bc640d1f69e5f76fb32b24a8">file_name</a> = NULL, *new_file_name;
<a name="l00207"></a>00207   <span class="keywordtype">char</span>* <a class="code" href="subsetter_8c.html#4b703ba1f7a1288de40089aa611b9abf">var_name</a>, *new_var_name;
<a name="l00208"></a>00208   <a class="code" href="group__DataTypes.html#g1ceb59a5b485f8bcbcb8acad4cfb9323" title="Possible verbosity levels.">FC_VerbosityLevel</a> <a class="code" href="regionreassembler_8c.html#46e260e16f29333b3f475e879e4d8e70">verbose_level</a> = <a class="code" href="group__DataTypes.html#gg1ceb59a5b485f8bcbcb8acad4cfb9323b4443923870aca5048c4cfc22ce803c5">FC_QUIET</a>; 
<a name="l00209"></a>00209   <a class="code" href="group__FileIO.html#ge2c4eb60578842e0dfb050ffe07be10f" title="Types of file formats for dataset file IO.">FC_FileIOType</a> fileType;
<a name="l00210"></a>00210   <span class="keywordtype">int</span> doPerMesh = 0; <span class="comment">// 0 = same value for all meshes</span>
<a name="l00211"></a>00211   <span class="keywordtype">int</span> doPerStep = 0; <span class="comment">// 0 = same value for all steps</span>
<a name="l00212"></a>00212   <span class="keywordtype">int</span> *basic_meshIDs, *seq_meshIDs;
<a name="l00213"></a>00213   <span class="keywordtype">int</span> maxWasProvided = 0; <span class="comment">// 1 = a max value was provided</span>
<a name="l00214"></a>00214   <span class="keywordtype">double</span> providedMaxVal;
<a name="l00215"></a>00215   <span class="keywordtype">int</span> maxFileWasProvided = 0; <span class="comment">// 1 = a file of max values was provided</span>
<a name="l00216"></a>00216   <span class="keywordtype">char</span>* maxFileName = NULL;
<a name="l00217"></a>00217   <span class="keywordtype">int</span>* haveMaxValPerMesh;
<a name="l00218"></a>00218   <span class="keywordtype">double</span>* providedMaxValsPerMesh;
<a name="l00219"></a>00219   <span class="keywordtype">int</span> doSparse = 0;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221   <span class="comment">// handle arguments</span>
<a name="l00222"></a>00222   <span class="keywordflow">if</span> (argc &lt; 4) {
<a name="l00223"></a>00223   usage:
<a name="l00224"></a>00224     printf(<span class="stringliteral">"usage: %s [options] dataset \"var name\" new_file_name\n"</span>, 
<a name="l00225"></a>00225            argv[0]);
<a name="l00226"></a>00226     printf(<span class="stringliteral">"options: \n"</span>);
<a name="l00227"></a>00227     printf(<span class="stringliteral">"  --permesh  : Use a different max value for each mesh\n"</span>); 
<a name="l00228"></a>00228     printf(<span class="stringliteral">"  --perstep  : Use a different max value for each step\n"</span>);
<a name="l00229"></a>00229     printf(<span class="stringliteral">"  --max #    : Provide a single max value to use for all meshes and steps.\n"</span>); 
<a name="l00230"></a>00230     printf(<span class="stringliteral">"  -f file    : A file to read multiple provided max values from.\n"</span>);
<a name="l00231"></a>00231     printf(<span class="stringliteral">"  --sparse   : Create sparse output--contains only the new variable\n"</span>);
<a name="l00232"></a>00232     printf(<span class="stringliteral">"  -h         : Print this help message\n"</span>);
<a name="l00233"></a>00233     printf(<span class="stringliteral">"  -v         : Verbose: print warning and error messages\n"</span>);
<a name="l00234"></a>00234     printf(<span class="stringliteral">"  -V         : Very verbose: print log and error messages\n"</span>);
<a name="l00235"></a>00235     printf(<span class="stringliteral">"\n"</span>);
<a name="l00236"></a>00236     printf(<span class="stringliteral">"Create a new dataset which will be a copy of the original dataset\n"</span>);
<a name="l00237"></a>00237     printf(<span class="stringliteral">"plus an additional variable which is a normalized version of the\n"</span>);
<a name="l00238"></a>00238     printf(<span class="stringliteral">"specified variable. The user can provide the max value(s) to normalize\n"</span>);
<a name="l00239"></a>00239     printf(<span class="stringliteral">"with using the --max or -f arguments. Otherwise, a max value is calucated\n"</span>);
<a name="l00240"></a>00240     printf(<span class="stringliteral">"from the variable field itself. The -f flag requires the --permesh flag.\n"</span>);
<a name="l00241"></a>00241     printf(<span class="stringliteral">"Both the --permesh and --perstep flags can be used at the same time.\n"</span>);
<a name="l00242"></a>00242     printf(<span class="stringliteral">"Currently, the user cannot provide data for --perstep execution.\n"</span>);
<a name="l00243"></a>00243     printf(<span class="stringliteral">"\n"</span>);
<a name="l00244"></a>00244     printf(<span class="stringliteral">"The format for the file of max values is to have the name of a mesh on\n"</span>);
<a name="l00245"></a>00245     printf(<span class="stringliteral">"a single line (no extra spaces), and then the max value for that mesh\n"</span>);
<a name="l00246"></a>00246     printf(<span class="stringliteral">"on the next line. Then the next mesh name on the next line, and its\n"</span>);
<a name="l00247"></a>00247     printf(<span class="stringliteral">"value on the line after that.\n"</span>);
<a name="l00248"></a>00248     printf(<span class="stringliteral">"\n"</span>);   
<a name="l00249"></a>00249     printf(<span class="stringliteral">"If the variable name is either von mises stress or pressure, it will\n"</span>);
<a name="l00250"></a>00250     printf(<span class="stringliteral">"be calculated if it does not exist.\n"</span>);
<a name="l00251"></a>00251     fflush(NULL);
<a name="l00252"></a>00252     exit(-1);
<a name="l00253"></a>00253   }
<a name="l00254"></a>00254   <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {
<a name="l00255"></a>00255     <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">"--permesh"</span>)) {
<a name="l00256"></a>00256       doPerMesh = 1;
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">"--perstep"</span>)) {
<a name="l00259"></a>00259       doPerStep = 1;
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">"--max"</span>)) {
<a name="l00262"></a>00262       <span class="keywordflow">if</span> (i+1 &gt;= argc)
<a name="l00263"></a>00263         <span class="keywordflow">goto</span> usage;
<a name="l00264"></a>00264       maxWasProvided = 1;
<a name="l00265"></a>00265       providedMaxVal = atof(argv[i+1]);
<a name="l00266"></a>00266       i++;
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">"-f"</span>)) {
<a name="l00269"></a>00269       <span class="keywordflow">if</span> (i+1 &gt;= argc)
<a name="l00270"></a>00270         <span class="keywordflow">goto</span> usage;
<a name="l00271"></a>00271       maxFileWasProvided = 1;
<a name="l00272"></a>00272       maxFileName = argv[i+1];
<a name="l00273"></a>00273       i++;
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">"--sparse"</span>)) {
<a name="l00276"></a>00276       doSparse = 1;
<a name="l00277"></a>00277     }
<a name="l00278"></a>00278     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">"-v"</span>)) {
<a name="l00279"></a>00279       verbose_level = <a class="code" href="group__DataTypes.html#gg1ceb59a5b485f8bcbcb8acad4cfb9323d5f8d0b704dba62980776bac1283a741">FC_WARNING_MESSAGES</a>;
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">"-V"</span>)) {
<a name="l00282"></a>00282       verbose_level = <a class="code" href="group__DataTypes.html#gg1ceb59a5b485f8bcbcb8acad4cfb932395535fc1e83f1faa426c80811de6c55e">FC_LOG_MESSAGES</a>;
<a name="l00283"></a>00283     }
<a name="l00284"></a>00284     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(argv[i], <span class="stringliteral">"-h"</span>, 2) || !strncmp(argv[i], <span class="stringliteral">"-"</span>, 1))
<a name="l00285"></a>00285       <span class="keywordflow">goto</span> usage;
<a name="l00286"></a>00286     <span class="keywordflow">else</span> {
<a name="l00287"></a>00287       <span class="keywordflow">if</span> (i+2 &gt;= argc)
<a name="l00288"></a>00288         <span class="keywordflow">goto</span> usage;
<a name="l00289"></a>00289       file_name = argv[i];
<a name="l00290"></a>00290       var_name = argv[i+1];
<a name="l00291"></a>00291       new_file_name = argv[i+2];
<a name="l00292"></a>00292       i+=2;
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294   }
<a name="l00295"></a>00295   <span class="keywordflow">if</span> (!file_name || !var_name || !new_file_name || 
<a name="l00296"></a>00296       (maxFileWasProvided &amp;&amp; !maxFileName))
<a name="l00297"></a>00297     <span class="keywordflow">goto</span> usage;
<a name="l00298"></a>00298   <span class="keywordflow">if</span> (maxWasProvided &amp;&amp; maxFileWasProvided) 
<a name="l00299"></a>00299   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>, <span class="stringliteral">"You cannot provide a single max value and "</span>
<a name="l00300"></a>00300                        <span class="stringliteral">"a file of per mesh max values at the same time"</span>);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302   <span class="comment">// init library and load dataset &amp; meshes</span>
<a name="l00303"></a>00303   rc = <a class="code" href="group__Library.html#gc54575c50a63dd29c694c78315d8fcf2" title="Set the library verbosity level.">fc_setLibraryVerbosity</a>(verbose_level);
<a name="l00304"></a>00304   <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(rc);
<a name="l00305"></a>00305   rc = <a class="code" href="group__Library.html#g18b26962103ffc9596657386d55a93af" title="Setup Feature Characterization Library for use.">fc_initLibrary</a>();
<a name="l00306"></a>00306   <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(rc);
<a name="l00307"></a>00307   rc = <a class="code" href="group__FileIO.html#g77b8250a472752e14bda28962116a66b" title="Load a dataset and it&amp;#39;s members from a file.">fc_loadDataset</a>(file_name, &amp;ds_orig);
<a name="l00308"></a>00308   <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(rc);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   <span class="comment">// Read the meshes &amp; store their names</span>
<a name="l00311"></a>00311   rc = <a class="code" href="group__Mesh.html#gcb092c2c909dd536c0120830890a9f36" title="Get the meshes in a dataset.">fc_getMeshes</a>(ds_orig, &amp;numMesh, &amp;meshes);
<a name="l00312"></a>00312   <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(rc);
<a name="l00313"></a>00313   meshNames = (<span class="keywordtype">char</span>**)malloc(numMesh*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>**));
<a name="l00314"></a>00314   <span class="keywordflow">for</span> (i = 0; i &lt; numMesh; i++) {
<a name="l00315"></a>00315     rc = <a class="code" href="group__Mesh.html#g3d701a44941883311e4940d7d3b4146a" title="Return name of a mesh.">fc_getMeshName</a>(meshes[i], &amp;meshNames[i]);
<a name="l00316"></a>00316     <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get mesh name"</span>);
<a name="l00317"></a>00317   }
<a name="l00318"></a>00318  
<a name="l00319"></a>00319   <span class="comment">// read the values from provided file &amp; associate with a mesh</span>
<a name="l00320"></a>00320   <span class="comment">// Requires uniquely named meshes</span>
<a name="l00321"></a>00321   <span class="keywordflow">if</span> (maxFileWasProvided) {
<a name="l00322"></a>00322     <span class="keywordtype">char</span> temp_name[1028], temp_valstr[1028];
<a name="l00323"></a>00323     FILE* file;
<a name="l00324"></a>00324     providedMaxValsPerMesh = (<span class="keywordtype">double</span>*)malloc(numMesh*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00325"></a>00325     haveMaxValPerMesh = (<span class="keywordtype">int</span>*)calloc(numMesh, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00326"></a>00326     <span class="keywordflow">if</span> (!providedMaxValsPerMesh)
<a name="l00327"></a>00327       <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00328"></a>00328     file = fopen(maxFileName, <span class="stringliteral">"r"</span>);
<a name="l00329"></a>00329     <span class="keywordflow">if</span> (!file)
<a name="l00330"></a>00330       <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce406cfb6be2c486a7655cecdd3f5c02e44">FC_FILE_IO_ERROR</a>, <span class="stringliteral">"Could not open file '%s'"</span>,
<a name="l00331"></a>00331                            maxFileName);
<a name="l00332"></a>00332     <span class="keywordflow">while</span>(fscanf(file, <span class="stringliteral">"%[^\n]\n"</span>, temp_name) &gt; 0) {
<a name="l00333"></a>00333       <span class="keywordflow">if</span> (fscanf(file, <span class="stringliteral">"%[^\n]\n"</span>, temp_valstr) &lt; 1) {
<a name="l00334"></a>00334         <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce406cfb6be2c486a7655cecdd3f5c02e44">FC_FILE_IO_ERROR</a>, <span class="stringliteral">"Could not find the value "</span>
<a name="l00335"></a>00335                              <span class="stringliteral">"for mesh '%s'"</span>, temp_name);
<a name="l00336"></a>00336       }
<a name="l00337"></a>00337       <span class="keywordflow">for</span> (i = 0; i &lt; numMesh; i++) {
<a name="l00338"></a>00338         <span class="keywordflow">if</span> (!strcmp(temp_name, meshNames[i])) {
<a name="l00339"></a>00339           haveMaxValPerMesh[i] = 1;
<a name="l00340"></a>00340           providedMaxValsPerMesh[i] = atof(temp_valstr);
<a name="l00341"></a>00341           <span class="keywordflow">break</span>;
<a name="l00342"></a>00342         }
<a name="l00343"></a>00343       }
<a name="l00344"></a>00344     }
<a name="l00345"></a>00345     fclose(file);
<a name="l00346"></a>00346     <span class="comment">// require that we have something for every mesh</span>
<a name="l00347"></a>00347     <span class="keywordflow">for</span> (i = 0; i &lt; numMesh; i++) {
<a name="l00348"></a>00348       <span class="keywordflow">if</span> (haveMaxValPerMesh[i] != 1) {
<a name="l00349"></a>00349         <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>, <span class="stringliteral">"In file '%s', a max val was not "</span>
<a name="l00350"></a>00350                              <span class="stringliteral">"provided for mesh '%s'"</span>, maxFileName, 
<a name="l00351"></a>00351                              meshNames[i]);
<a name="l00352"></a>00352       }
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354   }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 
<a name="l00357"></a>00357   <span class="keywordflow">if</span> ((!strcmp(var_name, <a class="code" href="varNormalize_8c.html#0965079320a17226b599cd560ee48931">von_mises_stress_name</a>)) || 
<a name="l00358"></a>00358       (!strcmp(var_name,<a class="code" href="varNormalize_8c.html#06b7b2a0646c86c3b6649e65b344a643">pressure_name</a>))){
<a name="l00359"></a>00359     rc = <a class="code" href="varNormalize_8c.html#73d7511bd9bb6b7517da3b0f91975f4e">createStressOrPressureVar</a>(numMesh, meshes, meshNames,var_name);
<a name="l00360"></a>00360     <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"failed to create von mises stress or pressure vars"</span>);
<a name="l00361"></a>00361   }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363  
<a name="l00364"></a>00364   <span class="comment">// --- loop over meshes, looking for var and or seq var to be normalized</span>
<a name="l00365"></a>00365   basic_vars = (<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>*)malloc(numMesh*<span class="keyword">sizeof</span>(<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>));
<a name="l00366"></a>00366   seq_vars = (<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>**)malloc(numMesh*<span class="keyword">sizeof</span>(<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>*));
<a name="l00367"></a>00367   basic_meshIDs = (<span class="keywordtype">int</span>*)malloc(numMesh*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00368"></a>00368   seq_meshIDs = (<span class="keywordtype">int</span>*)malloc(numMesh*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00369"></a>00369   <span class="keywordflow">if</span> ( !basic_vars || !seq_vars || !basic_meshIDs || !seq_meshIDs)
<a name="l00370"></a>00370     <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00371"></a>00371   numBasicVar = 0;
<a name="l00372"></a>00372   numSeqVar = 0;
<a name="l00373"></a>00373   <span class="keywordflow">for</span> (i = 0; i &lt; numMesh; i++) {
<a name="l00374"></a>00374     <span class="keywordtype">int</span> tempNumStep;
<a name="l00375"></a>00375     <span class="comment">// try to access as basic var</span>
<a name="l00376"></a>00376     rc = <a class="code" href="group__Variable.html#g0fa74bad632cca78316af6f11ef7cf48" title="Gets a unique var if it exists, otherwise generate it from components if possible...">fc_getOrGenerateUniqueVariableByName</a>(meshes[i], var_name,
<a name="l00377"></a>00377                                &amp;basic_vars[numBasicVar]);
<a name="l00378"></a>00378     <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(rc);
<a name="l00379"></a>00379     <span class="keywordflow">if</span> (!<a class="code" href="group__Handles.html#g390004fca0870147d490f32c55afab8d" title="Check two handles for equality.">FC_HANDLE_EQUIV</a>(basic_vars[numBasicVar], <a class="code" href="group__Handles.html#g82162b8ad3f5476855507c3c6450db09" title="Null (default) variable handle.">FC_NULL_VARIABLE</a>)){
<a name="l00380"></a>00380       basic_meshIDs[numBasicVar] = i;
<a name="l00381"></a>00381       numBasicVar++;
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383     
<a name="l00384"></a>00384     <span class="comment">// try to access as seq vars</span>
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     rc = <a class="code" href="group__Variable.html#g9022a4933230e252076467a05f101a68" title="Gets a unique seq var if it exists, otherwise generate it from components if possible...">fc_getOrGenerateUniqueSeqVariableByName</a>(meshes[i], var_name,
<a name="l00387"></a>00387                                &amp;tempNumStep,
<a name="l00388"></a>00388                                &amp;seq_vars[numSeqVar]);
<a name="l00389"></a>00389     <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(rc);
<a name="l00390"></a>00390     <span class="keywordflow">if</span> (seq_vars[numSeqVar] != NULL){
<a name="l00391"></a>00391       <span class="keywordflow">if</span> (numSeqVar == 0) {
<a name="l00392"></a>00392      <span class="comment">//this is the first one</span>
<a name="l00393"></a>00393         numStep = tempNumStep;
<a name="l00394"></a>00394      rc = <a class="code" href="group__Variable.html#g314a992ec5ba07d7075f1172b13ef166" title="Get the parent sequence of a sequence variable.">fc_getSequenceFromSeqVariable</a>(numStep, seq_vars[numSeqVar],
<a name="l00395"></a>00395                             &amp;sequence);
<a name="l00396"></a>00396      <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Could not get squence from seq variable"</span>);
<a name="l00397"></a>00397       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tempNumStep != numStep) {
<a name="l00398"></a>00398         <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>, <span class="stringliteral">"Expected the sequence variable to "</span>
<a name="l00399"></a>00399                              <span class="stringliteral">"have the same number of steps on all meshes"</span>);
<a name="l00400"></a>00400       }
<a name="l00401"></a>00401       seq_meshIDs[numSeqVar] = i;
<a name="l00402"></a>00402       numSeqVar++;
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404   }
<a name="l00405"></a>00405   <span class="keywordflow">if</span> (numBasicVar &lt; 1 &amp;&amp; numSeqVar &lt; 1) {
<a name="l00406"></a>00406     <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>, <span class="stringliteral">"Failed to find variable '%s' in dataset "</span>
<a name="l00407"></a>00407                          <span class="stringliteral">"'%s'"</span>, var_name, file_name);
<a name="l00408"></a>00408   }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <span class="comment">// --- Make new var name - append "_nmz"</span>
<a name="l00411"></a>00411   new_var_name = (<span class="keywordtype">char</span>*)malloc((strlen(var_name)+12)*<span class="keyword">sizeof</span>(char));
<a name="l00412"></a>00412   <span class="keywordflow">if</span> (!new_var_name)
<a name="l00413"></a>00413     <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00414"></a>00414   sprintf(new_var_name, <span class="stringliteral">"%s_nmz"</span>, var_name);
<a name="l00415"></a>00415   
<a name="l00416"></a>00416   <span class="comment">// --- Do basic var</span>
<a name="l00417"></a>00417   <span class="keywordflow">if</span> (numBasicVar &gt; 0) {
<a name="l00418"></a>00418     <span class="keywordtype">double</span> maxVal;
<a name="l00419"></a>00419     <span class="keywordtype">double</span>* maxVals;
<a name="l00420"></a>00420     new_basic_vars = (<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>*)malloc(numBasicVar*<span class="keyword">sizeof</span>(<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>));
<a name="l00421"></a>00421     <span class="keywordflow">if</span> (maxWasProvided) {
<a name="l00422"></a>00422       maxVal = providedMaxVal;
<a name="l00423"></a>00423     }
<a name="l00424"></a>00424     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (maxFileWasProvided) {
<a name="l00425"></a>00425       maxVals = (<span class="keywordtype">double</span>*)malloc(numBasicVar*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00426"></a>00426       <span class="keywordflow">if</span> (!maxVals)
<a name="l00427"></a>00427         <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00428"></a>00428       <span class="keywordflow">for</span> (i = 0; i &lt; numBasicVar; i++) {
<a name="l00429"></a>00429         maxVals[i] = providedMaxValsPerMesh[basic_meshIDs[i]];
<a name="l00430"></a>00430       }
<a name="l00431"></a>00431     }
<a name="l00432"></a>00432     <span class="keywordflow">else</span> {
<a name="l00433"></a>00433       maxVals = (<span class="keywordtype">double</span>*)malloc(numBasicVar*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00434"></a>00434       <span class="keywordflow">if</span> (!maxVals)
<a name="l00435"></a>00435         <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00436"></a>00436       <span class="keywordflow">for</span> (i = 0; i &lt; numBasicVar; i++) {
<a name="l00437"></a>00437         rc = <a class="code" href="group__Statistics.html#g8e828048c88585a6de200e4f05d61ee4" title="Find min &amp;amp; max data values of a variable.">fc_getVariableMinMax</a>(basic_vars[i], NULL, NULL, &amp;maxVals[i], NULL);
<a name="l00438"></a>00438         <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get variable min max"</span>);
<a name="l00439"></a>00439       }
<a name="l00440"></a>00440       <span class="keywordflow">if</span> (!doPerMesh) {
<a name="l00441"></a>00441         <span class="keywordflow">for</span> (i = 0; i &lt; numBasicVar; i++) {
<a name="l00442"></a>00442           <span class="keywordflow">if</span> (i == 0)
<a name="l00443"></a>00443             maxVal = maxVals[i];
<a name="l00444"></a>00444           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (maxVals[i] &gt; maxVal)
<a name="l00445"></a>00445             maxVal = maxVals[i];
<a name="l00446"></a>00446         }
<a name="l00447"></a>00447       } 
<a name="l00448"></a>00448     }
<a name="l00449"></a>00449     <span class="keywordflow">for</span> (i = 0; i &lt; numBasicVar; i++) {
<a name="l00450"></a>00450       <span class="keywordtype">double</span> temp_max;
<a name="l00451"></a>00451       <span class="keywordflow">if</span> (doPerMesh)
<a name="l00452"></a>00452         temp_max = maxVals[i];
<a name="l00453"></a>00453       <span class="keywordflow">else</span>
<a name="l00454"></a>00454         temp_max = maxVal;
<a name="l00455"></a>00455       printf(<span class="stringliteral">"Max value for basic var on mesh '%s' = %g\n"</span>,
<a name="l00456"></a>00456              meshNames[basic_meshIDs[i]], temp_max);
<a name="l00457"></a>00457       fflush(NULL);
<a name="l00458"></a>00458       rc = <a class="code" href="group__VariableMath.html#g1ef65703f3a8fb753d540f212c541213" title="Performs built-in binary operation on a variable and a constant.">fc_varOperatorConst</a>(basic_vars[i], <span class="stringliteral">"/"</span>, 1, &amp;temp_max, <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>,
<a name="l00459"></a>00459                                new_var_name, &amp;new_basic_vars[i]);
<a name="l00460"></a>00460       <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to divide var by const value"</span>);
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462     <span class="keywordflow">if</span> (!maxWasProvided)
<a name="l00463"></a>00463       free(maxVals);
<a name="l00464"></a>00464   }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466   <span class="comment">// --- Do seq var</span>
<a name="l00467"></a>00467   <span class="keywordflow">if</span> (numSeqVar &gt; 0) {
<a name="l00468"></a>00468     new_seq_vars = (<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>**)malloc(numSeqVar*<span class="keyword">sizeof</span>(<a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a>*));
<a name="l00469"></a>00469     <span class="keywordflow">if</span> (doPerStep) {
<a name="l00470"></a>00470       <span class="keywordtype">double</span>* seqMaxVal = (<span class="keywordtype">double</span>*)malloc(numStep*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00471"></a>00471       <span class="keywordtype">double</span>** seqMaxVals = (<span class="keywordtype">double</span>**)malloc(numSeqVar*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>*));
<a name="l00472"></a>00472       <span class="keywordflow">if</span> (!seqMaxVals || !seqMaxVals)
<a name="l00473"></a>00473         <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00474"></a>00474       <span class="keywordflow">for</span> (i = 0; i &lt; numSeqVar; i++) {
<a name="l00475"></a>00475         seqMaxVals[i] = (<span class="keywordtype">double</span>*)malloc(numStep*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00476"></a>00476         <span class="keywordflow">if</span> (!seqMaxVals[i])
<a name="l00477"></a>00477           <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00478"></a>00478       }
<a name="l00479"></a>00479       <span class="keywordflow">for</span> (i = 0; i &lt; numSeqVar; i++) {
<a name="l00480"></a>00480         <span class="keywordflow">for</span> (j = 0; j &lt; numStep; j++) {
<a name="l00481"></a>00481           rc = <a class="code" href="group__Statistics.html#g8e828048c88585a6de200e4f05d61ee4" title="Find min &amp;amp; max data values of a variable.">fc_getVariableMinMax</a>(seq_vars[i][j], NULL, NULL,
<a name="l00482"></a>00482                                     &amp;seqMaxVals[i][j], NULL);
<a name="l00483"></a>00483           <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get seq var step's min max"</span>);
<a name="l00484"></a>00484         }
<a name="l00485"></a>00485       }
<a name="l00486"></a>00486       <span class="keywordflow">if</span> (!doPerMesh) {
<a name="l00487"></a>00487         <span class="keywordflow">for</span> (j = 0; j &lt; numStep; j++) {
<a name="l00488"></a>00488           <span class="keywordflow">for</span> (i = 0; i &lt; numSeqVar; i++) {
<a name="l00489"></a>00489             <span class="keywordflow">if</span> (i == 0) 
<a name="l00490"></a>00490               seqMaxVal[j] = seqMaxVals[i][j];
<a name="l00491"></a>00491             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (seqMaxVals[i][j] &gt; seqMaxVal[j])
<a name="l00492"></a>00492               seqMaxVal[j] = seqMaxVals[i][j];
<a name="l00493"></a>00493           }
<a name="l00494"></a>00494         }
<a name="l00495"></a>00495       }
<a name="l00496"></a>00496       <span class="keywordflow">for</span> (i = 0; i &lt; numSeqVar; i++) {
<a name="l00497"></a>00497         <span class="keywordtype">double</span>* temp_seqMax;
<a name="l00498"></a>00498         <span class="keywordflow">if</span> (doPerMesh)
<a name="l00499"></a>00499           temp_seqMax = seqMaxVals[i];
<a name="l00500"></a>00500         <span class="keywordflow">else</span>
<a name="l00501"></a>00501           temp_seqMax = seqMaxVal;
<a name="l00502"></a>00502         printf(<span class="stringliteral">"Max values for seq var on mesh '%s' = \n"</span>,
<a name="l00503"></a>00503                meshNames[seq_meshIDs[i]]);
<a name="l00504"></a>00504         <span class="keywordflow">for</span> (j = 0; j &lt; numStep; j++)
<a name="l00505"></a>00505           printf(<span class="stringliteral">"  %d: %g\n"</span>, j, temp_seqMax[j]);
<a name="l00506"></a>00506         rc = <a class="code" href="group__VariableMath.html#gf462045cd029f5a9a7a41362ca46d338" title="Performs built-in binary operation on a seq variable a seq of constants.">fc_seqVarOperatorSeqConst</a>(numStep, seq_vars[i], <span class="stringliteral">"/"</span>, 
<a name="l00507"></a>00507                                        1, temp_seqMax, <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>, 
<a name="l00508"></a>00508                                        new_var_name, &amp;new_seq_vars[i]);
<a name="l00509"></a>00509         <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to divide seq var by const values"</span>);
<a name="l00510"></a>00510       }
<a name="l00511"></a>00511       <span class="keywordflow">for</span> (i = 0; i &lt; numSeqVar; i++)
<a name="l00512"></a>00512         free(seqMaxVals[i]);
<a name="l00513"></a>00513       free(seqMaxVals);
<a name="l00514"></a>00514       free(seqMaxVal);
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516     <span class="keywordflow">else</span> {
<a name="l00517"></a>00517       <span class="keywordtype">double</span> maxVal;
<a name="l00518"></a>00518       <span class="keywordtype">double</span>* maxVals;
<a name="l00519"></a>00519       <span class="keywordflow">if</span> (maxWasProvided) {
<a name="l00520"></a>00520         maxVal = providedMaxVal;
<a name="l00521"></a>00521       }
<a name="l00522"></a>00522       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (maxFileWasProvided) {
<a name="l00523"></a>00523         maxVals = (<span class="keywordtype">double</span>*)malloc(numSeqVar*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00524"></a>00524         <span class="keywordflow">if</span> (!maxVals)
<a name="l00525"></a>00525           <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00526"></a>00526         <span class="keywordflow">for</span> (i = 0; i &lt; numSeqVar; i++) {
<a name="l00527"></a>00527           maxVals[i] = providedMaxValsPerMesh[seq_meshIDs[i]];
<a name="l00528"></a>00528         }
<a name="l00529"></a>00529       }
<a name="l00530"></a>00530       <span class="keywordflow">else</span> {
<a name="l00531"></a>00531         maxVals = (<span class="keywordtype">double</span>*)malloc(numSeqVar*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00532"></a>00532         <span class="keywordflow">if</span> (!maxVals)
<a name="l00533"></a>00533           <a class="code" href="group__ErrorHandling.html#gcc9949110ba62c7ec8fabf7b455f1c0b" title="If the return code is an error, print diagnostic and exit.">fc_exitIfError</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>);
<a name="l00534"></a>00534         <span class="keywordflow">for</span> (i = 0; i &lt; numSeqVar; i++) {
<a name="l00535"></a>00535           rc = <a class="code" href="group__Statistics.html#gfa32a24cb703b1c9c1f08224e86a504f" title="Find min &amp;amp; max data values of a sequence variable.">fc_getSeqVariableMinMax</a>(numStep, seq_vars[i], NULL, NULL, NULL,
<a name="l00536"></a>00536                                        &amp;maxVals[i], NULL, NULL);
<a name="l00537"></a>00537           <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get seq variable min max"</span>);
<a name="l00538"></a>00538         }
<a name="l00539"></a>00539         <span class="keywordflow">if</span> (!doPerMesh) {
<a name="l00540"></a>00540           <span class="keywordflow">for</span> (i = 0; i &lt; numSeqVar; i++) {
<a name="l00541"></a>00541             <span class="keywordflow">if</span> (i == 0)
<a name="l00542"></a>00542               maxVal = maxVals[i];
<a name="l00543"></a>00543             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (maxVals[i] &gt; maxVal)
<a name="l00544"></a>00544               maxVal = maxVals[i];
<a name="l00545"></a>00545           }
<a name="l00546"></a>00546         }
<a name="l00547"></a>00547       }
<a name="l00548"></a>00548       <span class="keywordflow">for</span> (i = 0; i &lt; numSeqVar; i++) {
<a name="l00549"></a>00549         <span class="keywordtype">double</span> temp_max;
<a name="l00550"></a>00550         <span class="keywordflow">if</span> (doPerMesh)
<a name="l00551"></a>00551           temp_max = maxVals[i];
<a name="l00552"></a>00552         <span class="keywordflow">else</span>
<a name="l00553"></a>00553           temp_max = maxVal;
<a name="l00554"></a>00554         printf(<span class="stringliteral">"Max value for seq var on mesh '%s' = %g\n"</span>,
<a name="l00555"></a>00555                meshNames[seq_meshIDs[i]], temp_max);
<a name="l00556"></a>00556         rc = <a class="code" href="group__VariableMath.html#gabd0e690bab993b84ae62f1d2a70cba4" title="Performs built-in binary operation on a seq variable and constant.">fc_seqVarOperatorConst</a>(numStep, seq_vars[i], <span class="stringliteral">"/"</span>, 
<a name="l00557"></a>00557                                     1, &amp;temp_max, <a class="code" href="group__DataTypes.html#ggcca24e957488bb76e40a84ea651975d9250e83e5dab9b5c1872f0f82665ff905">FC_DT_DOUBLE</a>, 
<a name="l00558"></a>00558                                     new_var_name, &amp;new_seq_vars[i]);
<a name="l00559"></a>00559         <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to divide seq var by const value"</span>);
<a name="l00560"></a>00560       }
<a name="l00561"></a>00561       <span class="keywordflow">if</span> (!maxWasProvided)
<a name="l00562"></a>00562         free(maxVals);
<a name="l00563"></a>00563     }
<a name="l00564"></a>00564   }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566   <span class="comment">// --- If requested, make output sparse by deleting all but the</span>
<a name="l00567"></a>00567   <span class="comment">// new variable. note that in exodus we always keep the sequence</span>
<a name="l00568"></a>00568   <span class="comment">// even if there are no more seq vars on that sequence</span>
<a name="l00569"></a>00569   <span class="keywordflow">if</span> (doSparse) {
<a name="l00570"></a>00570     <span class="keywordtype">int</span> temp_num, *temp_numSteps;
<a name="l00571"></a>00571     <a class="code" href="structFC__Subset.html" title="Subset Handle.">FC_Subset</a> *temp_subsets;
<a name="l00572"></a>00572     <a class="code" href="structFC__Variable.html" title="Variable Handle.">FC_Variable</a> *temp_vars, **temp_seqVars; 
<a name="l00573"></a>00573     <span class="comment">// because vars are in order by mesh, we don't have to search</span>
<a name="l00574"></a>00574     <span class="keywordtype">int</span> i_var = 0; <span class="comment">// current basic var</span>
<a name="l00575"></a>00575     <span class="keywordtype">int</span> i_seqVar = 0; <span class="comment">// current seq var</span>
<a name="l00576"></a>00576 
<a name="l00577"></a>00577     <a class="code" href="group__Variable.html#g1d1333786398ddc0cd571156691272ea" title="Get the global variables in a dataset.">fc_getGlobalVariables</a>(ds_orig, &amp;temp_num, &amp;temp_vars);
<a name="l00578"></a>00578     <span class="keywordflow">for</span> (i = 0; i &lt; temp_num; i++)
<a name="l00579"></a>00579       <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(temp_vars[i]);
<a name="l00580"></a>00580     free(temp_vars);
<a name="l00581"></a>00581     <a class="code" href="group__Variable.html#g3085ad2d7a4be9f81eb0eccaa19ade10" title="Get the global sequence variables in a dataset.">fc_getGlobalSeqVariables</a>(ds_orig, &amp;temp_num, &amp;temp_numSteps,
<a name="l00582"></a>00582                              &amp;temp_seqVars);
<a name="l00583"></a>00583     <span class="keywordflow">for</span> (i = 0; i &lt; temp_num; i++) {
<a name="l00584"></a>00584       <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(temp_numSteps[i], temp_seqVars[i]);
<a name="l00585"></a>00585       free(temp_seqVars[i]);
<a name="l00586"></a>00586     }
<a name="l00587"></a>00587     free(temp_numSteps);
<a name="l00588"></a>00588     free(temp_seqVars);
<a name="l00589"></a>00589     <span class="keywordflow">for</span> (i = 0; i &lt; numMesh; i++) {
<a name="l00590"></a>00590       <a class="code" href="group__Subset.html#gb12aea784bf43ec6a29a8e51a3c0da51" title="Get the subsets in a mesh.">fc_getSubsets</a>(meshes[i], &amp;temp_num, &amp;temp_subsets);
<a name="l00591"></a>00591       <span class="keywordflow">for</span> (j = 0; j &lt; temp_num; j++) 
<a name="l00592"></a>00592         <a class="code" href="group__Subset.html#g550d0636e4f35c29d6dbc427b3165a24" title="Delete a subset.">fc_deleteSubset</a>(temp_subsets[j]);
<a name="l00593"></a>00593       free(temp_subsets);
<a name="l00594"></a>00594       <a class="code" href="group__Variable.html#ga96777675a667d79871c93c54729bde4" title="Get the variables in a mesh.">fc_getVariables</a>(meshes[i], &amp;temp_num, &amp;temp_vars);
<a name="l00595"></a>00595       <span class="keywordflow">for</span> (j = 0; j &lt; temp_num; j++) {
<a name="l00596"></a>00596         <span class="keywordflow">if</span> (numBasicVar &gt; 0 &amp;&amp; 
<a name="l00597"></a>00597             <a class="code" href="group__Handles.html#g390004fca0870147d490f32c55afab8d" title="Check two handles for equality.">FC_HANDLE_EQUIV</a>(temp_vars[j], new_basic_vars[i_var])) {
<a name="l00598"></a>00598           <span class="keywordflow">continue</span>;
<a name="l00599"></a>00599         }
<a name="l00600"></a>00600         <a class="code" href="group__Variable.html#g1de53216125d0074933ecf6006f1796a" title="Delete a variable.">fc_deleteVariable</a>(temp_vars[j]);
<a name="l00601"></a>00601       }
<a name="l00602"></a>00602       free(temp_vars);
<a name="l00603"></a>00603       <a class="code" href="group__Variable.html#g01bf1b0d9b1de983115a461216039449" title="Get the sequence variables in a mesh.">fc_getSeqVariables</a>(meshes[i], &amp;temp_num, &amp;temp_numSteps, &amp;temp_seqVars);
<a name="l00604"></a>00604       <span class="keywordflow">for</span> (j = 0; j &lt; temp_num; j++) {
<a name="l00605"></a>00605         <span class="keywordflow">if</span> (numSeqVar &gt; 0 &amp;&amp;
<a name="l00606"></a>00606             <a class="code" href="group__Handles.html#g390004fca0870147d490f32c55afab8d" title="Check two handles for equality.">FC_HANDLE_EQUIV</a>(temp_seqVars[j][0], new_seq_vars[i_seqVar][0])) {
<a name="l00607"></a>00607           ; <span class="comment">// nothing</span>
<a name="l00608"></a>00608         }
<a name="l00609"></a>00609         <span class="keywordflow">else</span> {
<a name="l00610"></a>00610           <a class="code" href="group__Variable.html#gef5ebe119abe1d217a216f0faad0e667" title="Delete a sequence variable.">fc_deleteSeqVariable</a>(temp_numSteps[j], temp_seqVars[j]);
<a name="l00611"></a>00611         }
<a name="l00612"></a>00612         free(temp_seqVars[j]);
<a name="l00613"></a>00613       }
<a name="l00614"></a>00614       free(temp_numSteps);
<a name="l00615"></a>00615       free(temp_seqVars);
<a name="l00616"></a>00616       <span class="keywordflow">if</span> (numBasicVar &gt; 0 &amp;&amp; basic_meshIDs[i_var] == i)
<a name="l00617"></a>00617         i_var++;
<a name="l00618"></a>00618       <span class="keywordflow">if</span> (numSeqVar &gt; 0 &amp;&amp; seq_meshIDs[i_seqVar] == i)
<a name="l00619"></a>00619         i_seqVar++;
<a name="l00620"></a>00620     }
<a name="l00621"></a>00621   }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623   <span class="comment">// --- Write the new dataset</span>
<a name="l00624"></a>00624   rc = <a class="code" href="group__FileIO.html#gbb1d96d018c1a0bbcc8b7a915730709c" title="Get type of file format.">fc_getDatasetFileIOType</a>(ds_orig, &amp;fileType);
<a name="l00625"></a>00625   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get file IO type"</span>);
<a name="l00626"></a>00626   <span class="keywordflow">if</span> (fileType == <a class="code" href="group__FileIO.html#gge2c4eb60578842e0dfb050ffe07be10fbd862214a0d2b322c7cc81bf035c1f93">FC_FT_LSDYNA</a>)
<a name="l00627"></a>00627     fileType = <a class="code" href="group__FileIO.html#gge2c4eb60578842e0dfb050ffe07be10f99ecebdb6b57140d8fd211b1f9f62c4b">FC_FT_EXODUS</a>;
<a name="l00628"></a>00628   rc = <a class="code" href="group__FileIO.html#g054de7ff5051dda3f84fa92f060b4571" title="Rewrite a dataset.">fc_rewriteDataset</a>(ds_orig, new_file_name, fileType);
<a name="l00629"></a>00629   <a class="code" href="error_8h.html#ed3cf62a82d02c561c0b9c80756fcab9">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to write dataset"</span>);
<a name="l00630"></a>00630 
<a name="l00631"></a>00631   <span class="comment">// --- done</span>
<a name="l00632"></a>00632 
<a name="l00633"></a>00633   <span class="comment">// cleanup</span>
<a name="l00634"></a>00634   <span class="keywordflow">for</span> (i = 0; i &lt; numMesh; i++)
<a name="l00635"></a>00635     free(meshNames[i]);
<a name="l00636"></a>00636   free(meshNames);
<a name="l00637"></a>00637   free(meshes);
<a name="l00638"></a>00638   free(basic_vars);
<a name="l00639"></a>00639   free(new_basic_vars);
<a name="l00640"></a>00640   <span class="keywordflow">for</span> (i = 0; i &lt; numSeqVar; i++) {
<a name="l00641"></a>00641     free(seq_vars[i]);
<a name="l00642"></a>00642     free(new_seq_vars[i]);
<a name="l00643"></a>00643   }
<a name="l00644"></a>00644   free(seq_vars);
<a name="l00645"></a>00645   free(new_seq_vars);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647   <span class="comment">// final library</span>
<a name="l00648"></a>00648   <a class="code" href="group__Library.html#g29ff0e41fb4f58b55489bc875ac32b2f" title="Cleanup when done using Feature Characterization Library.">fc_finalLibrary</a>();
<a name="l00649"></a>00649  
<a name="l00650"></a>00650   exit(0);
<a name="l00651"></a>00651 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Oct 27 13:25:50 2008 for FCLib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
