<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>FCLib: tools/analyzeSpotWelds.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>tools/analyzeSpotWelds.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Analysis of the spot weld behavior in the results of a Presto Simulation. 
<p>
<dl class="rcs" compact><dt><b>Source</b></dt><dd>/usr/local/Repositories/fcdmf/fclib/tools/analyzeSpotWelds.c,v </dd></dl>
<dl class="rcs" compact><dt><b>Revision</b></dt><dd>1.53 </dd></dl>
<dl class="rcs" compact><dt><b>Date</b></dt><dd>2006/09/28 06:34:39 </dd></dl>
<p>
<b>Description:</b> <p>
This program generates a file with information about how many spot welds failed and when. This program also generates a parameter, Pfail, for each spot weld. Spotwelds fail when Pfail reaches one. Usage and validation documentation is available from FCLib developers.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000112">Todo:</a></b></dt><dd>?: more flexible coding of using sequences - what if more than 1? what if none?</dd></dl>
<b>Modifications:</b> <ul>
<li>APR-08-2003 W Koegler Created</li><li>2003-JUN-25 W Koegler Use new Sierra input file parsing code to remove hard coding dependencies</li><li>2003-JUN-30 W Koegler Have input filenames an arguments instead of hard coding. Removed hard coding of sequence name.</li><li>2003-JUL-10 W Koegler Added Pfail calculations when taking into account coordinate displacements</li><li>2003-JUL-10 W Koegler Moved "broken" classifying into FCLib's <a class="el" href="custom_8c.html">custom.c</a></li><li>2003-AUG-18 W Koegler Changed code so that groups spot welds by 'type' which means they share the same normal and tangent functions.</li><li>2003-SEP-03 W Koegler Added ability to use spot weld scale factors if they are present (just in case). Spot welds that use the same normal and tangential functions, but with different scale factors are of different types.</li><li>2003-SEP-08 W Koegler Did a lot of cleaning up and added analysis based on distance between the node and side sets of a spot weld. The force based analysis is really an approximation of this.</li><li>2003-NOV-05 WSK<ul>
<li>Bug fix: was only printing 3 significant digits to the .dat file, now prints 6.</li><li>Added code to general a failure parameter for a group (average)</li><li>Fine tuning of .gnu file for pretty plots</li></ul>
</li><li>01/28/04 WSK, Changed from float to double</li><li>06/22/04 WSK, nodesets/sidesets are now subsets instead of meshes.</li><li>12/13/04 WSK, removed old force version since displacement version is technically more correct (force version was a hack). </li></ul>

<p>
Definition in file <a class="el" href="analyzeSpotWelds_8c-source.html">analyzeSpotWelds.c</a>.
<p>
<code>#include &lt;stdarg.h&gt;</code><br>
<code>#include &lt;math.h&gt;</code><br>
<code>#include &lt;time.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;<a class="el" href="fc_8h-source.html">fc.h</a>&gt;</code><br>

<p>
Include dependency graph for analyzeSpotWelds.c:
<p>
<a href="analyzeSpotWelds_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structSpotWeldType.html">SpotWeldType</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyzeSpotWelds_8c.html#2e41fd2ac14ffc4509fbe0eff51e7973">get_doubles</a> (int num, <a class="el" href="group__DataTypes.html#gbbab9b2f35d4bc42e868e4f5853a6297">FC_DataType</a> dataType, void *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyzeSpotWelds_8c.html#794a3f6c58cea0536d283f3eab1dc8db">nameSpotWeldTypes</a> (int numType, <a class="el" href="structSpotWeldType.html">SpotWeldType</a> *types)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyzeSpotWelds_8c.html#24e6ce6d053864cf5fb7af941457bb0e">main</a> (int argc, char **argv)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="2e41fd2ac14ffc4509fbe0eff51e7973"></a><!-- doxytag: member="analyzeSpotWelds.c::get_doubles" ref="2e41fd2ac14ffc4509fbe0eff51e7973" args="(int num, FC_DataType dataType, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double * get_doubles           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__DataTypes.html#gbbab9b2f35d4bc42e868e4f5853a6297">FC_DataType</a>&nbsp;</td>
          <td class="paramname"> <em>dataType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Converts a void* array to a double* array, given the length and the FC_DataType. 
<p>
Definition at line <a class="el" href="analyzeSpotWelds_8c-source.html#l00909">909</a> of file <a class="el" href="analyzeSpotWelds_8c-source.html">analyzeSpotWelds.c</a>.
<p>
References <a class="el" href="group__DataTypes.html#ggbbab9b2f35d4bc42e868e4f5853a6297806cef8a12ffc6ef267ac21addb95ab3">FC_DT_DOUBLE</a>, <a class="el" href="group__DataTypes.html#ggbbab9b2f35d4bc42e868e4f5853a6297ad59da2c9908f7fd6dcc81b25680057b">FC_DT_FLOAT</a>, <a class="el" href="group__DataTypes.html#ggbbab9b2f35d4bc42e868e4f5853a6297f0b74a7d9f58ca6960dd832980645f7d">FC_DT_INT</a>, and <a class="el" href="base_8c-source.html#l00418">fc_getDataTypeText()</a>.
<p>
Referenced by <a class="el" href="analyzeSpotWelds_8c-source.html#l00135">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00909"></a>00909                                                                {
<a name="l00910"></a>00910   <span class="keywordtype">int</span> i;
<a name="l00911"></a>00911   <span class="keywordtype">double</span>* array;
<a name="l00912"></a>00912 
<a name="l00913"></a>00913   <span class="comment">// make room</span>
<a name="l00914"></a>00914   array = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*num);
<a name="l00915"></a>00915   
<a name="l00916"></a>00916   <span class="keywordflow">switch</span>(dataType) {
<a name="l00917"></a>00917   <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggbbab9b2f35d4bc42e868e4f5853a6297806cef8a12ffc6ef267ac21addb95ab3">FC_DT_DOUBLE</a>: {
<a name="l00918"></a>00918     memcpy(array, data, num*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00919"></a>00919   } <span class="keywordflow">break</span>;
<a name="l00920"></a>00920   <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggbbab9b2f35d4bc42e868e4f5853a6297f0b74a7d9f58ca6960dd832980645f7d">FC_DT_INT</a>: {
<a name="l00921"></a>00921     <span class="keywordtype">int</span>* cast_data = (<span class="keywordtype">int</span>*)data;
<a name="l00922"></a>00922     <span class="keywordflow">for</span> (i = 0; i &lt; num; i++)
<a name="l00923"></a>00923       array[i] = cast_data[i];
<a name="l00924"></a>00924   } <span class="keywordflow">break</span>;
<a name="l00925"></a>00925   <span class="keywordflow">case</span> <a class="code" href="group__DataTypes.html#ggbbab9b2f35d4bc42e868e4f5853a6297ad59da2c9908f7fd6dcc81b25680057b">FC_DT_FLOAT</a>: {
<a name="l00926"></a>00926     <span class="keywordtype">float</span>* cast_data = (<span class="keywordtype">float</span>*)data;
<a name="l00927"></a>00927     <span class="keywordflow">for</span> (i = 0; i &lt; num; i++)
<a name="l00928"></a>00928       array[i] = cast_data[i];
<a name="l00929"></a>00929   } <span class="keywordflow">break</span>;
<a name="l00930"></a>00930   <span class="keywordflow">default</span>:
<a name="l00931"></a>00931     fprintf(stderr, <span class="stringliteral">"Warning:In helper function 'get_doubles', cannot convert "</span>
<a name="l00932"></a>00932             <span class="stringliteral">"data type '%s' to double\n"</span>, <a class="code" href="group__DataTypes.html#g6720a592eace2d7459eb410a3b29cd2f">fc_getDataTypeText</a>(dataType));
<a name="l00933"></a>00933     fflush(NULL);
<a name="l00934"></a>00934     free(array);
<a name="l00935"></a>00935     array = NULL;
<a name="l00936"></a>00936   }
<a name="l00937"></a>00937 
<a name="l00938"></a>00938   <span class="keywordflow">return</span> array;
<a name="l00939"></a>00939 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="24e6ce6d053864cf5fb7af941457bb0e"></a><!-- doxytag: member="analyzeSpotWelds.c::main" ref="24e6ce6d053864cf5fb7af941457bb0e" args="(int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="analyzeSpotWelds_8c-source.html#l00135">135</a> of file <a class="el" href="analyzeSpotWelds_8c-source.html">analyzeSpotWelds.c</a>.
<p>
References <a class="el" href="sierra_8h-source.html#l00082">FC_SierraFuncInfo::abscissa_max</a>, <a class="el" href="sierra_8h-source.html#l00114">FC_SierraSpotWeldInfo::decay_cycles</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00104">SpotWeldType::decay_cycles</a>, <a class="el" href="sierra_8h-source.html#l00160">FC_SierraInfo::displ_alias</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00107">SpotWeldType::exponent</a>, <a class="el" href="sierra_8h-source.html#l00113">FC_SierraSpotWeldInfo::exponent</a>, <a class="el" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>, <a class="el" href="sierra_8c-source.html#l01209">fc_evalPrestoSpotWeld()</a>, <a class="el" href="error_8h-source.html#l00080">fc_exitIfError</a>, <a class="el" href="error_8h-source.html#l00116">fc_exitIfErrorPrintf</a>, <a class="el" href="util_8h-source.html#l00111">FC_FLT_EQUIV</a>, <a class="el" href="mesh_8c-source.html#l01432">fc_getMeshes()</a>, <a class="el" href="subset_8c-source.html#l01713">fc_getMeshFromSubset()</a>, <a class="el" href="variable_8c-source.html#l03571">fc_getOrGenerateUniqueSeqVariableByName()</a>, <a class="el" href="sequence_8c-source.html#l01725">fc_getSequenceCoordsPtr()</a>, <a class="el" href="sequence_8c-source.html#l01600">fc_getSequenceInfo()</a>, <a class="el" href="sequence_8c-source.html#l01138">fc_getSequences()</a>, <a class="el" href="subset_8c-source.html#l00789">fc_getSubsetByName()</a>, <a class="el" href="library_8c-source.html#l00172">fc_initLibrary()</a>, <a class="el" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>, <a class="el" href="fileio_8c-source.html#l01565">fc_loadDataset()</a>, <a class="el" href="group__DataTypes.html#gg6c0891f21e34bad1d8b2bc7c76193a395a6192ba586cd970dd36a49cd8862714">FC_LOG_MESSAGES</a>, <a class="el" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>, <a class="el" href="sierra_8c-source.html#l00348">fc_parseSierraInputFile()</a>, <a class="el" href="group__DataTypes.html#gg6c0891f21e34bad1d8b2bc7c76193a399cb0ad9c1f97775f8954860a08d78144">FC_QUIET</a>, <a class="el" href="library_8c-source.html#l00110">fc_setLibraryVerbosity()</a>, <a class="el" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>, <a class="el" href="group__DataTypes.html#gg6c0891f21e34bad1d8b2bc7c76193a3995521f4f1526a6565b08e663106dd6e7">FC_WARNING_MESSAGES</a>, <a class="el" href="sierra_8h-source.html#l00163">FC_SierraInfo::functions</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00909">get_doubles()</a>, <a class="el" href="sierra_8h-source.html#l00073">FC_SierraFuncInfo::name</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00964">nameSpotWeldTypes()</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00117">SpotWeldType::nodesets</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00102">SpotWeldType::normal_name</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00105">SpotWeldType::normal_scale</a>, <a class="el" href="sierra_8h-source.html#l00111">FC_SierraSpotWeldInfo::normal_scale</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00100">SpotWeldType::normalId</a>, <a class="el" href="sierra_8h-source.html#l00116">FC_SierraSpotWeldInfo::normalId</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00126">SpotWeldType::numBrokenTotal</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00112">SpotWeldType::numSpotWeld</a>, <a class="el" href="sierra_8h-source.html#l00164">FC_SierraInfo::numSpotWeld</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00119">SpotWeldType::numStep</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00114">SpotWeldType::spotweld_names</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00113">SpotWeldType::spotwelds</a>, <a class="el" href="sierra_8h-source.html#l00165">FC_SierraInfo::spotwelds</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00103">SpotWeldType::tangent_name</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00106">SpotWeldType::tangent_scale</a>, <a class="el" href="sierra_8h-source.html#l00112">FC_SierraSpotWeldInfo::tangent_scale</a>, <a class="el" href="sierra_8h-source.html#l00118">FC_SierraSpotWeldInfo::tangentId</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00101">SpotWeldType::tangentId</a>, <a class="el" href="sierra_8c-source.html#l00141">temp_string</a>, <a class="el" href="analyzeSpotWelds_8c-source.html#l00109">SpotWeldType::ucritnorm</a>, and <a class="el" href="analyzeSpotWelds_8c-source.html#l00110">SpotWeldType::ucrittang</a>.<div class="fragment"><pre class="fragment"><a name="l00136"></a>00136 {
<a name="l00137"></a>00137   <span class="keywordtype">int</span> i, j, k;  
<a name="l00138"></a>00138   <a class="code" href="group__DataTypes.html#g2a816f8eddef0c2d8c2e3a0393b1f52e">FC_ReturnCode</a> rc;     <span class="comment">// int to catch return codes</span>
<a name="l00139"></a>00139   time_t start_time = time(NULL); <span class="comment">// the time analysis starts</span>
<a name="l00140"></a>00140   <span class="keywordtype">char</span>* inputfile_name = NULL; <span class="comment">// the simulation's input file</span>
<a name="l00141"></a>00141   <span class="keywordtype">char</span>* database_name = NULL; <span class="comment">// the simulation's results file</span>
<a name="l00142"></a>00142   <span class="keywordtype">char</span>* output_root_name = NULL; <span class="comment">// root name for output files</span>
<a name="l00143"></a>00143   <span class="keywordtype">char</span>* outputfile_name = NULL;  <span class="comment">// name for data file (.dat)</span>
<a name="l00144"></a>00144   <span class="keywordtype">char</span>* gnuplotfile_name = NULL; <span class="comment">// name of gnuplot script file (.gnu)</span>
<a name="l00145"></a>00145   <span class="keywordtype">char</span>* scriptfile_name = NULL;  <span class="comment">// name of script file that will launch</span>
<a name="l00146"></a>00146                                  <span class="comment">// gnuplot and image magic (.script)</span>
<a name="l00147"></a>00147   <span class="keywordtype">char</span>** plotfile_names = NULL;  <span class="comment">// names for the plot files (.eps)</span>
<a name="l00148"></a>00148   <span class="keywordtype">char</span>** jpgfile_names = NULL;   <span class="comment">// names for jpg plot files (.jpg)</span>
<a name="l00149"></a>00149   <span class="keywordtype">char</span>* <a class="code" href="group__PrivateSierra.html#g3226dc2ac4ecce1447ced54532d380cd">temp_string</a>;
<a name="l00150"></a>00150   <a class="code" href="group__DataTypes.html#g6c0891f21e34bad1d8b2bc7c76193a39">FC_VerbosityLevel</a> beVerbose = <a class="code" href="group__DataTypes.html#gg6c0891f21e34bad1d8b2bc7c76193a399cb0ad9c1f97775f8954860a08d78144">FC_QUIET</a>;   <span class="comment">// verbosity flag</span>
<a name="l00151"></a>00151   FILE* outfile = NULL;
<a name="l00152"></a>00152   <a class="code" href="structFC__SierraInfo.html">FC_SierraInfo</a> *sierra_info;
<a name="l00153"></a>00153   <span class="keywordtype">char</span>* displ_name;
<a name="l00154"></a>00154   <span class="keywordtype">int</span> numSpotWeld;
<a name="l00155"></a>00155   <span class="keywordtype">int</span> numType;
<a name="l00156"></a>00156   <a class="code" href="structSpotWeldType.html">SpotWeldType</a>* types;
<a name="l00157"></a>00157   <a class="code" href="structFC__Dataset.html">FC_Dataset</a> dataset;
<a name="l00158"></a>00158   <a class="code" href="structFC__Sequence.html">FC_Sequence</a> *sequences, sequence;
<a name="l00159"></a>00159   <a class="code" href="structFC__Mesh.html">FC_Mesh</a>* meshes;
<a name="l00160"></a>00160   <span class="keywordtype">int</span> numStep, numMesh;
<a name="l00161"></a>00161   <span class="keywordtype">double</span>* times;
<a name="l00162"></a>00162   <span class="keywordtype">int</span> numBrokenTotal; <span class="comment">// value of analysis that was done</span>
<a name="l00163"></a>00163   <span class="keywordtype">int</span> *numBrokens;  <span class="comment">// pointer to the analysis that was done</span>
<a name="l00164"></a>00164   <span class="keywordtype">int</span> count; 
<a name="l00165"></a>00165   <span class="keywordtype">int</span> time_index;
<a name="l00166"></a>00166   <span class="keywordtype">int</span> time_col; <span class="comment">// time column (indexing from 1)</span>
<a name="l00167"></a>00167   <span class="keywordtype">int</span> col;  <span class="comment">// current column (indexing from 1)</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   <span class="comment">//*****************************************************************</span>
<a name="l00170"></a>00170   <span class="comment">//*** End of variable declarations</span>
<a name="l00171"></a>00171   <span class="comment">//*****************************************************************</span>
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="comment">//*****************************************************************</span>
<a name="l00174"></a>00174   <span class="comment">//*** Handle arguments</span>
<a name="l00175"></a>00175   <span class="comment">//*****************************************************************</span>
<a name="l00176"></a>00176 
<a name="l00177"></a>00177   <span class="keywordflow">if</span> (argc &lt; 7) { 
<a name="l00178"></a>00178     usage:
<a name="l00179"></a>00179       printf(<span class="stringliteral">"\n"</span>);
<a name="l00180"></a>00180       printf(<span class="stringliteral">"summary:\n"</span>);
<a name="l00181"></a>00181       printf(<span class="stringliteral">"   analyzeSpotWelds performs an an analysis of Presto spotwelds (grouped\n"</span>); 
<a name="l00182"></a>00182       printf(<span class="stringliteral">"   by spot weld type) and produces a data output file &lt;output_root&gt;.dat,\n"</span>);
<a name="l00183"></a>00183       printf(<span class="stringliteral">"   a gnuplot file &lt;output.gnu&gt;, and script file &lt;output.script&gt; that\n"</span>); 
<a name="l00184"></a>00184       printf(<span class="stringliteral">"   can be used to create a series of eps (if gnuplot is available)\n"</span>);
<a name="l00185"></a>00185       printf(<span class="stringliteral">"   and jpg (if ImageMagick if available) plots &lt;output&gt;.*.[eps|jpg].\n"</span>);
<a name="l00186"></a>00186       printf(<span class="stringliteral">"\n"</span>);
<a name="l00187"></a>00187       printf(<span class="stringliteral">"usage:\n"</span>);
<a name="l00188"></a>00188       printf(<span class="stringliteral">"   analyzeSpotWelds -i &lt;sierra_input_file&gt; -s &lt;database&gt; -o &lt;output_root&gt;\n"</span>);
<a name="l00189"></a>00189       printf(<span class="stringliteral">"\noptions:\n"</span>);
<a name="l00190"></a>00190       printf(<span class="stringliteral">"   -v                         verbose output\n"</span>);
<a name="l00191"></a>00191       printf(<span class="stringliteral">"   -V                         very verbose output\n"</span>);
<a name="l00192"></a>00192       printf(<span class="stringliteral">"\n"</span>);
<a name="l00193"></a>00193       printf(<span class="stringliteral">"\n"</span>);
<a name="l00194"></a>00194       printf(<span class="stringliteral">"example:\n"</span>);
<a name="l00195"></a>00195       printf(<span class="stringliteral">"   analyzeSpotWelds -i problem.i -s problem.ex2 -o spotwelds\n"</span>);
<a name="l00196"></a>00196       printf(<span class="stringliteral">"\n"</span>);
<a name="l00197"></a>00197       fflush(NULL);
<a name="l00198"></a>00198       exit(-1);
<a name="l00199"></a>00199   }
<a name="l00200"></a>00200   <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {
<a name="l00201"></a>00201     <span class="keywordflow">if</span> (!strcmp(argv[i], <span class="stringliteral">"-i"</span>) &amp;&amp; i+1 &lt; argc) {
<a name="l00202"></a>00202       i++;
<a name="l00203"></a>00203       inputfile_name = argv[i];
<a name="l00204"></a>00204     }
<a name="l00205"></a>00205     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(argv[i], <span class="stringliteral">"-o"</span>) &amp;&amp; i+1 &lt; argc) {
<a name="l00206"></a>00206       i++;
<a name="l00207"></a>00207       output_root_name = argv[i];
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(argv[i], <span class="stringliteral">"-s"</span>) &amp;&amp; i+1 &lt; argc) {
<a name="l00210"></a>00210       i++;
<a name="l00211"></a>00211       database_name = argv[i];
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(argv[i], <span class="stringliteral">"-v"</span>)) {
<a name="l00214"></a>00214       beVerbose = <a class="code" href="group__DataTypes.html#gg6c0891f21e34bad1d8b2bc7c76193a3995521f4f1526a6565b08e663106dd6e7">FC_WARNING_MESSAGES</a>;
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(argv[i], <span class="stringliteral">"-V"</span>)) {
<a name="l00217"></a>00217       beVerbose = <a class="code" href="group__DataTypes.html#gg6c0891f21e34bad1d8b2bc7c76193a395a6192ba586cd970dd36a49cd8862714">FC_LOG_MESSAGES</a>;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219     <span class="keywordflow">else</span>
<a name="l00220"></a>00220       <span class="keywordflow">goto</span> usage;
<a name="l00221"></a>00221   }
<a name="l00222"></a>00222   <span class="comment">// check that we got everything we need</span>
<a name="l00223"></a>00223   <span class="keywordflow">if</span> ( (inputfile_name == NULL) || (database_name == NULL) || 
<a name="l00224"></a>00224        (output_root_name == NULL) )
<a name="l00225"></a>00225     <span class="keywordflow">goto</span> usage;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227   <span class="comment">//*** Setup</span>
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   <span class="keywordflow">if</span> (beVerbose) {
<a name="l00230"></a>00230     printf(<span class="stringliteral">"Parsing input file...\n"</span>);
<a name="l00231"></a>00231     fflush(NULL);
<a name="l00232"></a>00232   }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234   <span class="comment">// parse the input file</span>
<a name="l00235"></a>00235   rc = <a class="code" href="group__Sierra.html#g2556b0c7090174e8d86bd448de80fc1b">fc_parseSierraInputFile</a>(inputfile_name, &amp;sierra_info);
<a name="l00236"></a>00236   <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Could not open input file '%s'"</span>, inputfile_name);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238   <span class="comment">// number of spot welds from sierra info</span>
<a name="l00239"></a>00239   numSpotWeld = sierra_info-&gt;<a class="code" href="structFC__SierraInfo.html#a0677f6d13b69797cf81a4408d385ccb">numSpotWeld</a>;
<a name="l00240"></a>00240   <span class="keywordflow">if</span> (numSpotWeld &lt; 1)
<a name="l00241"></a>00241     <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>, <span class="stringliteral">"No spot welds were found"</span>);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243   <span class="comment">// displacement variable's names from sierra info</span>
<a name="l00244"></a>00244   displ_name = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(strlen(sierra_info-&gt;<a class="code" href="structFC__SierraInfo.html#a327aebfe4edc2b4ec80c05e852a3a68">displ_alias</a>)+7));
<a name="l00245"></a>00245   <span class="keywordflow">if</span> (displ_name == NULL)
<a name="l00246"></a>00246     <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>, <span class="stringliteral">"Memory allocation failure"</span>);
<a name="l00247"></a>00247   sprintf(displ_name, <span class="stringliteral">"%s"</span>, sierra_info-&gt;<a class="code" href="structFC__SierraInfo.html#a327aebfe4edc2b4ec80c05e852a3a68">displ_alias</a>);
<a name="l00248"></a>00248 
<a name="l00249"></a>00249   <span class="comment">// distribute spotwelds into types</span>
<a name="l00250"></a>00250   numType = 0;
<a name="l00251"></a>00251   types = NULL;
<a name="l00252"></a>00252   <span class="keywordflow">for</span> (i = 0; i &lt; numSpotWeld; i++) {
<a name="l00253"></a>00253     <span class="keywordtype">void</span>* temp;
<a name="l00254"></a>00254     <a class="code" href="structFC__SierraSpotWeldInfo.html">FC_SierraSpotWeldInfo</a>* sw = sierra_info-&gt;<a class="code" href="structFC__SierraInfo.html#ddbfbd203ed9a338b0ad20c8c5dc8722">spotwelds</a>[i];
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <span class="comment">// find a matching type</span>
<a name="l00257"></a>00257     <span class="keywordflow">for</span> (j = 0; j &lt; numType; j++) {
<a name="l00258"></a>00258       <span class="keywordflow">if</span> (types[j].normalId == sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#f49e2410eae27bb546c1fc811c448da5">normalId</a> &amp;&amp;
<a name="l00259"></a>00259           types[j].<a class="code" href="structSpotWeldType.html#0c54cc87bb711179f41a1c247b7494b0">tangentId</a> == sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#85192596a8ade8d57164e5ae440e113f">tangentId</a> &amp;&amp;
<a name="l00260"></a>00260           types[j].<a class="code" href="structSpotWeldType.html#938b9254d46ed49da022d7473bac5ec1">decay_cycles</a> == sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#b80dcac8c140007b119afdc3e09d764b">decay_cycles</a> &amp;&amp;
<a name="l00261"></a>00261           <a class="code" href="group__PublicFloatingPoint.html#gcca666e28137c4c9e0d737733275530b">FC_FLT_EQUIV</a>(types[j].normal_scale, sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#255219ea9da764a2b9835653ef3b62ed">normal_scale</a>) &amp;&amp;
<a name="l00262"></a>00262           <a class="code" href="group__PublicFloatingPoint.html#gcca666e28137c4c9e0d737733275530b">FC_FLT_EQUIV</a>(types[j].tangent_scale, sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#f65e81ce007ac1460d79d823ee846a03">tangent_scale</a>) &amp;&amp;
<a name="l00263"></a>00263           <a class="code" href="group__PublicFloatingPoint.html#gcca666e28137c4c9e0d737733275530b">FC_FLT_EQUIV</a>(types[j].exponent, sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#4ba7aeb7b71d48de6d25d1a746277b58">exponent</a>))
<a name="l00264"></a>00264         <span class="keywordflow">break</span>;
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266     <span class="comment">// or create a new type</span>
<a name="l00267"></a>00267     <span class="keywordflow">if</span> (j &gt;= numType) {
<a name="l00268"></a>00268       temp = realloc(types, <span class="keyword">sizeof</span>(<a class="code" href="structSpotWeldType.html">SpotWeldType</a>)*(numType+1));
<a name="l00269"></a>00269       <span class="keywordflow">if</span> (temp == NULL)
<a name="l00270"></a>00270         <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>, <span class="stringliteral">"Could not allocate space for types"</span>);
<a name="l00271"></a>00271       types = temp;
<a name="l00272"></a>00272       types[j].<a class="code" href="structSpotWeldType.html#1a627b2a00184f12c42a48bb681008b3">normalId</a> = sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#f49e2410eae27bb546c1fc811c448da5">normalId</a>;
<a name="l00273"></a>00273       types[j].<a class="code" href="structSpotWeldType.html#0c54cc87bb711179f41a1c247b7494b0">tangentId</a> = sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#85192596a8ade8d57164e5ae440e113f">tangentId</a>;
<a name="l00274"></a>00274       types[j].<a class="code" href="structSpotWeldType.html#ded9f4be0e48d1dfda3cd28fedbad967">normal_name</a> = sierra_info-&gt;<a class="code" href="structFC__SierraInfo.html#08f488096064ed241f4ea8ef46113471">functions</a>[sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#f49e2410eae27bb546c1fc811c448da5">normalId</a>]-&gt;<a class="code" href="structFC__SierraFuncInfo.html#d636188eadd92d3618886b6fb75bf4f6">name</a>;
<a name="l00275"></a>00275       types[j].<a class="code" href="structSpotWeldType.html#8d8d3c126db88c67507da71a17bd1f9a">tangent_name</a> = sierra_info-&gt;<a class="code" href="structFC__SierraInfo.html#08f488096064ed241f4ea8ef46113471">functions</a>[sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#85192596a8ade8d57164e5ae440e113f">tangentId</a>]-&gt;<a class="code" href="structFC__SierraFuncInfo.html#d636188eadd92d3618886b6fb75bf4f6">name</a>;
<a name="l00276"></a>00276       types[j].<a class="code" href="structSpotWeldType.html#938b9254d46ed49da022d7473bac5ec1">decay_cycles</a> = sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#b80dcac8c140007b119afdc3e09d764b">decay_cycles</a>;
<a name="l00277"></a>00277       types[j].<a class="code" href="structSpotWeldType.html#bc731dbaf73a7974bee06d1f59d469be">normal_scale</a> = sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#255219ea9da764a2b9835653ef3b62ed">normal_scale</a>;
<a name="l00278"></a>00278       types[j].<a class="code" href="structSpotWeldType.html#b32b00f25286386e18765e17db1aec9a">tangent_scale</a> = sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#f65e81ce007ac1460d79d823ee846a03">tangent_scale</a>;
<a name="l00279"></a>00279       types[j].<a class="code" href="structSpotWeldType.html#a5ba78d9650ccb00dae8d4f1abd06581">exponent</a> = sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#4ba7aeb7b71d48de6d25d1a746277b58">exponent</a>;
<a name="l00280"></a>00280       types[j].<a class="code" href="structSpotWeldType.html#c0aa50caca195f4713e46af37a992d73">ucritnorm</a> = sierra_info-&gt;<a class="code" href="structFC__SierraInfo.html#08f488096064ed241f4ea8ef46113471">functions</a>[sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#f49e2410eae27bb546c1fc811c448da5">normalId</a>]-&gt;<a class="code" href="structFC__SierraFuncInfo.html#3bafc542339ee609879bf8ef852e8aeb">abscissa_max</a>;
<a name="l00281"></a>00281       types[j].<a class="code" href="structSpotWeldType.html#a317bcdcf38bed438482e9062d2e1183">ucrittang</a> = sierra_info-&gt;<a class="code" href="structFC__SierraInfo.html#08f488096064ed241f4ea8ef46113471">functions</a>[sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#85192596a8ade8d57164e5ae440e113f">tangentId</a>]-&gt;<a class="code" href="structFC__SierraFuncInfo.html#3bafc542339ee609879bf8ef852e8aeb">abscissa_max</a>;
<a name="l00282"></a>00282       types[j].<a class="code" href="structSpotWeldType.html#1e71bc457a9a873c8cdaa0f51d20256e">numSpotWeld</a> = 0;
<a name="l00283"></a>00283       types[j].<a class="code" href="structSpotWeldType.html#9a9da06cddd59dae3f43b47be09b3cc7">spotwelds</a> = NULL;
<a name="l00284"></a>00284       numType++;
<a name="l00285"></a>00285     }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="comment">// add spotweld</span>
<a name="l00288"></a>00288     temp = realloc(types[j].spotwelds, 
<a name="l00289"></a>00289                    <span class="keyword">sizeof</span>(<a class="code" href="structFC__SierraSpotWeldInfo.html">FC_SierraSpotWeldInfo</a>*)*(types[j].numSpotWeld+1));
<a name="l00290"></a>00290     <span class="keywordflow">if</span> (temp == NULL)
<a name="l00291"></a>00291       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>, <span class="stringliteral">"Memory allocation failure"</span>);
<a name="l00292"></a>00292     types[j].<a class="code" href="structSpotWeldType.html#9a9da06cddd59dae3f43b47be09b3cc7">spotwelds</a> = temp;
<a name="l00293"></a>00293     types[j].<a class="code" href="structSpotWeldType.html#9a9da06cddd59dae3f43b47be09b3cc7">spotwelds</a>[types[j].<a class="code" href="structSpotWeldType.html#1e71bc457a9a873c8cdaa0f51d20256e">numSpotWeld</a>] = sw;
<a name="l00294"></a>00294     types[j].<a class="code" href="structSpotWeldType.html#1e71bc457a9a873c8cdaa0f51d20256e">numSpotWeld</a>++;
<a name="l00295"></a>00295   }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297   <span class="comment">// generate names for the spot weld types</span>
<a name="l00298"></a>00298   <a class="code" href="analyzeSpotWelds_8c.html#794a3f6c58cea0536d283f3eab1dc8db">nameSpotWeldTypes</a>(numType, types);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="comment">// for each type, setup spot weld names, node and side set names</span>
<a name="l00301"></a>00301   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00302"></a>00302     SpotWeldType *type = &amp;types[i];
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     type-&gt;<a class="code" href="structSpotWeldType.html#0ab9ffab3c66f3633335fb1c2bcaa494">spotweld_names</a> = (<span class="keywordtype">char</span>**)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*)*numSpotWeld);
<a name="l00305"></a>00305     type-&gt;nodeset_names = (<span class="keywordtype">char</span>**)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*)*numSpotWeld);
<a name="l00306"></a>00306     type-&gt;sideset_names = (<span class="keywordtype">char</span>**)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*)*numSpotWeld);
<a name="l00307"></a>00307     <span class="keywordflow">if</span> (type-&gt;spotweld_names == NULL || type-&gt;nodeset_names == NULL || 
<a name="l00308"></a>00308         type-&gt;sideset_names == NULL)
<a name="l00309"></a>00309       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52ee4bf428a2cdead5d4e3e3391a2cdab0d">FC_MEMORY_ERROR</a>, <span class="stringliteral">"Memory allocation failure"</span>);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <span class="keywordflow">for</span> (j = 0; j &lt; type-&gt;numSpotWeld; j++) {
<a name="l00312"></a>00312       FC_SierraSpotWeldInfo* sw = type-&gt;spotwelds[j];
<a name="l00313"></a>00313       type-&gt;spotweld_names[j] = sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#34b4452fe55567368a529ae3f3d31464">name</a>;
<a name="l00314"></a>00314       type-&gt;nodeset_names[j] = sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#b7190ca57484d4dea7d71ba96ab52ea5">nodeset_name</a>;
<a name="l00315"></a>00315       type-&gt;sideset_names[j] = sw-&gt;<a class="code" href="structFC__SierraSpotWeldInfo.html#7e8c367165c9d27b6e384f3b6602f1dc">surface_name</a>;
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317   }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="comment">//*****************************************************************</span>
<a name="l00320"></a>00320   <span class="comment">//*** read dataset</span>
<a name="l00321"></a>00321   <span class="comment">//*****************************************************************</span>
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   <span class="keywordflow">if</span> (beVerbose) { 
<a name="l00324"></a>00324     printf(<span class="stringliteral">"Reading dataset...\n"</span>);
<a name="l00325"></a>00325     fflush(NULL);
<a name="l00326"></a>00326   }
<a name="l00327"></a>00327 
<a name="l00328"></a>00328   <span class="comment">// init the library</span>
<a name="l00329"></a>00329   rc = <a class="code" href="group__Library.html#gf13f047de6d44c9028d4944bc29867db">fc_setLibraryVerbosity</a>(beVerbose);
<a name="l00330"></a>00330   <a class="code" href="group__ErrorHandling.html#g4a09c0024ecd45d5d63c8b9ec333a717">fc_exitIfError</a>(rc);  
<a name="l00331"></a>00331   rc = <a class="code" href="group__Library.html#g355d03ffe3f8c560e9343716f78af097">fc_initLibrary</a>();
<a name="l00332"></a>00332   <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to initialize library"</span>);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334   <span class="comment">// load the dataset</span>
<a name="l00335"></a>00335   rc = <a class="code" href="group__FileIO.html#g953a8c4a7feb785e0091b7cf58626092">fc_loadDataset</a>(database_name, &amp;dataset);
<a name="l00336"></a>00336   <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Could not load database '%s'"</span>, database_name);
<a name="l00337"></a>00337 
<a name="l00338"></a>00338   <span class="comment">// get the sequence </span>
<a name="l00339"></a>00339   {
<a name="l00340"></a>00340     <span class="keywordtype">int</span> numSeq;
<a name="l00341"></a>00341     rc = <a class="code" href="group__Sequence.html#g4e9e6506fc7e6ce22310105003a21789">fc_getSequences</a>(dataset, &amp;numSeq, &amp;sequences);
<a name="l00342"></a>00342     <span class="keywordflow">if</span> (numSeq &lt; 1) {
<a name="l00343"></a>00343       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>, <span class="stringliteral">"Expected time series data"</span>);
<a name="l00344"></a>00344     }
<a name="l00345"></a>00345     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (numSeq &gt; 1) {
<a name="l00346"></a>00346       fprintf(stderr, <span class="stringliteral">"Warning: Expected 1 time series, not %d: using "</span>
<a name="l00347"></a>00347               <span class="stringliteral">"first one\n"</span>, numSeq);
<a name="l00348"></a>00348       fflush(NULL);
<a name="l00349"></a>00349     }
<a name="l00350"></a>00350     sequence = sequences[0];
<a name="l00351"></a>00351     free(sequences);
<a name="l00352"></a>00352   }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354   <span class="comment">// get sequence info &amp; data</span>
<a name="l00355"></a>00355   {
<a name="l00356"></a>00356     <a class="code" href="group__DataTypes.html#gbbab9b2f35d4bc42e868e4f5853a6297">FC_DataType</a> seq_dataType;
<a name="l00357"></a>00357     <span class="keywordtype">void</span>* seq_coords = NULL;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     rc = <a class="code" href="group__Sequence.html#ge7289ce45a13855f48a0b5de93c68101">fc_getSequenceInfo</a>(sequence, &amp;numStep, &amp;seq_dataType);
<a name="l00360"></a>00360     <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get sequence info"</span>);
<a name="l00361"></a>00361     rc = <a class="code" href="group__Sequence.html#g38e90553b530ed6e4ebeb28df20eade8">fc_getSequenceCoordsPtr</a>(sequence, &amp;seq_coords); 
<a name="l00362"></a>00362     <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"failed to get sequence coords"</span>);
<a name="l00363"></a>00363     times = <a class="code" href="analyzeSpotWelds_8c.html#2e41fd2ac14ffc4509fbe0eff51e7973">get_doubles</a>(numStep, seq_dataType, seq_coords);
<a name="l00364"></a>00364     <span class="keywordflow">if</span> (times == NULL)
<a name="l00365"></a>00365       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(FC_MEMORY_ERROR, <span class="stringliteral">"Memory allocation failure"</span>);
<a name="l00366"></a>00366   }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368   <span class="comment">// get the meshes</span>
<a name="l00369"></a>00369   {
<a name="l00370"></a>00370     rc = <a class="code" href="group__Mesh.html#ge71cd0e179143c6d82d58b9cc78cc436">fc_getMeshes</a>(dataset, &amp;numMesh, &amp;meshes);
<a name="l00371"></a>00371     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e27738acee5b8b2ef61be6e9b14a26613">FC_SUCCESS</a>)
<a name="l00372"></a>00372       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get meshes"</span>);
<a name="l00373"></a>00373     <span class="keywordflow">if</span> (numMesh &lt; 1)
<a name="l00374"></a>00374       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>, <span class="stringliteral">"Could not find any meshes in dataset"</span>);
<a name="l00375"></a>00375   }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377   <span class="comment">// for each spotweld type, get the node &amp; side sets</span>
<a name="l00378"></a>00378   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00379"></a>00379     SpotWeldType *type = &amp;types[i];
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     type-&gt;<a class="code" href="structSpotWeldType.html#c376d6cf49d546171999cb007d87c328">nodesets</a> = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structFC__Mesh.html">FC_Mesh</a>)*type-&gt;numSpotWeld);
<a name="l00382"></a>00382     type-&gt;sidesets = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structFC__Mesh.html">FC_Mesh</a>)*type-&gt;numSpotWeld);
<a name="l00383"></a>00383     <span class="keywordflow">if</span> (type-&gt;nodesets == NULL || type-&gt;sidesets == NULL)
<a name="l00384"></a>00384       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(FC_MEMORY_ERROR, <span class="stringliteral">"Memory allocation failure"</span>);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <span class="comment">// FIX? can this be prettied up?</span>
<a name="l00387"></a>00387     <span class="comment">// try getting subsets on each mesh, error if not exactly 1</span>
<a name="l00388"></a>00388     <span class="keywordflow">for</span> (j = 0; j &lt; type-&gt;numSpotWeld; j++) {
<a name="l00389"></a>00389       <span class="keywordtype">int</span> numNodeSet = 0, numSideSet = 0;
<a name="l00390"></a>00390       <span class="keywordtype">int</span> num_tempNodesets, num_tempSidesets;
<a name="l00391"></a>00391       <a class="code" href="structFC__Subset.html">FC_Subset</a> *temp_nodesets, *temp_sidesets;
<a name="l00392"></a>00392       <span class="keywordflow">for</span> (k = 0; k &lt; numMesh; k++) {
<a name="l00393"></a>00393         <a class="code" href="group__Subset.html#g01a47f999da4ef36f72702e52837ecb0">fc_getSubsetByName</a>(meshes[k], type-&gt;nodeset_names[j], &amp;num_tempNodesets,
<a name="l00394"></a>00394                   &amp;temp_nodesets); 
<a name="l00395"></a>00395         <a class="code" href="group__Subset.html#g01a47f999da4ef36f72702e52837ecb0">fc_getSubsetByName</a>(meshes[k], type-&gt;sideset_names[j], &amp;num_tempSidesets,
<a name="l00396"></a>00396                   &amp;temp_sidesets);
<a name="l00397"></a>00397         if (num_tempNodesets == 1){
<a name="l00398"></a>00398           type-&gt;nodesets[j] = temp_nodesets[0];
<a name="l00399"></a>00399           numNodeSet++;
<a name="l00400"></a>00400         }
<a name="l00401"></a>00401         <span class="keywordflow">if</span> (num_tempSidesets == 1){
<a name="l00402"></a>00402           type-&gt;sidesets[j] = temp_sidesets[0];
<a name="l00403"></a>00403           numSideSet++;
<a name="l00404"></a>00404         }
<a name="l00405"></a>00405      <span class="keywordflow">if</span> (temp_nodesets) free(temp_nodesets);
<a name="l00406"></a>00406      <span class="keywordflow">if</span> (temp_sidesets) free(temp_sidesets);
<a name="l00407"></a>00407       }
<a name="l00408"></a>00408       <span class="keywordflow">if</span> (numNodeSet != 1) 
<a name="l00409"></a>00409         <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>, <span class="stringliteral">"problems finding nodeset %s"</span>,
<a name="l00410"></a>00410                              type-&gt;nodeset_names[j]);
<a name="l00411"></a>00411       if (numSideSet != 1) 
<a name="l00412"></a>00412         <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>, <span class="stringliteral">"problems finding sideset %s"</span>,
<a name="l00413"></a>00413                              type-&gt;sideset_names[j]);
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415   }
<a name="l00416"></a>00416   free(meshes);
<a name="l00417"></a>00417   
<a name="l00418"></a>00418   <span class="comment">// get variables: </span>
<a name="l00419"></a>00419   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00420"></a>00420     SpotWeldType *type = &amp;types[i];
<a name="l00421"></a>00421     type-&gt;<a class="code" href="structSpotWeldType.html#c963f5fdc2396bbfd06fc70a4ea43fa6">numStep</a> = numStep;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     type-&gt;side_displs = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structFC__Variable.html">FC_Variable</a>*) * type-&gt;numSpotWeld);
<a name="l00424"></a>00424     <span class="keywordflow">if</span> (type-&gt;side_displs == NULL)
<a name="l00425"></a>00425       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(FC_MEMORY_ERROR, <span class="stringliteral">"Memory allocation failure"</span>);
<a name="l00426"></a>00426     type-&gt;node_displs = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structFC__Variable.html">FC_Variable</a>*) * type-&gt;numSpotWeld);
<a name="l00427"></a>00427     <span class="keywordflow">if</span> (type-&gt;node_displs == NULL)
<a name="l00428"></a>00428       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(FC_MEMORY_ERROR, <span class="stringliteral">"Memory allocation failure"</span>);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="keywordflow">for</span> (j = 0; j &lt; type-&gt;numSpotWeld; j++) {
<a name="l00431"></a>00431       <span class="keywordtype">int</span> temp_numStep;
<a name="l00432"></a>00432       <a class="code" href="structFC__Mesh.html">FC_Mesh</a> nodeset_mesh, sideset_mesh;
<a name="l00433"></a>00433       
<a name="l00434"></a>00434       <span class="comment">// get parent mesh</span>
<a name="l00435"></a>00435       rc = <a class="code" href="group__Subset.html#g095c5b064f4ae81a17682666aadd420b">fc_getMeshFromSubset</a>(type-&gt;nodesets[j], &amp;nodeset_mesh);
<a name="l00436"></a>00436       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get nodeset's parent mesh"</span>);
<a name="l00437"></a>00437       rc = <a class="code" href="group__Subset.html#g095c5b064f4ae81a17682666aadd420b">fc_getMeshFromSubset</a>(type-&gt;sidesets[j], &amp;sideset_mesh);
<a name="l00438"></a>00438       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get sideset's parent mesh"</span>);
<a name="l00439"></a>00439       
<a name="l00440"></a>00440       <span class="comment">// get displs on the node sets</span>
<a name="l00441"></a>00441       rc = <a class="code" href="group__Variable.html#g81cdc76a742e4bbf85fcbf5deba8c0e7">fc_getOrGenerateUniqueSeqVariableByName</a>(nodeset_mesh,
<a name="l00442"></a>00442                                   displ_name,
<a name="l00443"></a>00443                                   &amp;temp_numStep,
<a name="l00444"></a>00444                                   &amp;(type-&gt;node_displs[j]));
<a name="l00445"></a>00445       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to find get displ variable on nodeset by name"</span>);
<a name="l00446"></a>00446       <span class="keywordflow">if</span> (!(type-&gt;node_displs[j])){
<a name="l00447"></a>00447      <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>, <span class="stringliteral">"Failed to find get displ variable on nodeset by name"</span>);
<a name="l00448"></a>00448       }
<a name="l00449"></a>00449       
<a name="l00450"></a>00450       <span class="keywordflow">if</span> (temp_numStep != numStep)
<a name="l00451"></a>00451         <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>, <span class="stringliteral">"Mismatch between number of steps for"</span>
<a name="l00452"></a>00452                              <span class="stringliteral">" the sequence (%d) and the variable (%d)\n"</span>, 
<a name="l00453"></a>00453                              numStep, temp_numStep);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455       <span class="comment">// get displs on the side sets</span>
<a name="l00456"></a>00456       rc = <a class="code" href="group__Variable.html#g81cdc76a742e4bbf85fcbf5deba8c0e7">fc_getOrGenerateUniqueSeqVariableByName</a>(sideset_mesh,
<a name="l00457"></a>00457                                  displ_name,
<a name="l00458"></a>00458                                  &amp;temp_numStep,
<a name="l00459"></a>00459                                  &amp;(type-&gt;side_displs[j]));
<a name="l00460"></a>00460       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Failed to get displ variable on sideset by name"</span>);
<a name="l00461"></a>00461       <span class="keywordflow">if</span> (!(type-&gt;side_displs[j])){
<a name="l00462"></a>00462      <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e4905abab801292d8b6338a89462b8e22">FC_INPUT_ERROR</a>, <span class="stringliteral">"Failed to find get displ variable on sideset by name"</span>);
<a name="l00463"></a>00463       }
<a name="l00464"></a>00464       <span class="keywordflow">if</span> (temp_numStep != numStep)
<a name="l00465"></a>00465         <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e51d318f8c97c8b094cf9820b51e4fa83">FC_ERROR</a>, <span class="stringliteral">"Mismatch between number of steps for "</span>
<a name="l00466"></a>00466                              <span class="stringliteral">"the sequence (%d) and the variable (%d)\n"</span>, 
<a name="l00467"></a>00467                              numStep, temp_numStep);
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469   }
<a name="l00470"></a>00470   free(displ_name);
<a name="l00471"></a>00471 
<a name="l00472"></a>00472   <span class="comment">//*****************************************************************</span>
<a name="l00473"></a>00473   <span class="comment">//*** Do the analysis - calculated fails and fail_stepIds</span>
<a name="l00474"></a>00474   <span class="comment">//*****************************************************************</span>
<a name="l00475"></a>00475 
<a name="l00476"></a>00476   <span class="keywordflow">if</span> (beVerbose) {
<a name="l00477"></a>00477     printf(<span class="stringliteral">"Performing spot weld analysis...\n"</span>);
<a name="l00478"></a>00478     fflush(NULL);
<a name="l00479"></a>00479   }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481   <span class="comment">// remember values for all spot welds</span>
<a name="l00482"></a>00482   numBrokenTotal = 0;
<a name="l00483"></a>00483   numBrokens = calloc(numStep, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00484"></a>00484   <span class="keywordflow">if</span> (numBrokens == NULL)
<a name="l00485"></a>00485     <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(FC_MEMORY_ERROR, <span class="stringliteral">"Memory allocation failure"</span>);
<a name="l00486"></a>00486   
<a name="l00487"></a>00487   <span class="comment">// Do the analysis - get parameters and spot weld failures</span>
<a name="l00488"></a>00488   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00489"></a>00489     SpotWeldType* type = &amp;types[i];
<a name="l00490"></a>00490     
<a name="l00491"></a>00491     <span class="comment">// make room</span>
<a name="l00492"></a>00492     type-&gt;<a class="code" href="structSpotWeldType.html#3f3e1f7ba7b81a339a7d0068a1eac862">numBrokenTotal</a> = 0;
<a name="l00493"></a>00493     type-&gt;fails = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>*)*type-&gt;numSpotWeld);
<a name="l00494"></a>00494     type-&gt;group_fails = calloc(numStep, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)); <span class="comment">// init to 0</span>
<a name="l00495"></a>00495     type-&gt;fail_stepIds = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*type-&gt;numSpotWeld);
<a name="l00496"></a>00496     type-&gt;numBrokens = calloc(numStep, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00497"></a>00497     <span class="keywordflow">if</span> (type-&gt;fails == NULL || type-&gt;group_fails == NULL || 
<a name="l00498"></a>00498         type-&gt;fail_stepIds == NULL || type-&gt;numBrokens == NULL)
<a name="l00499"></a>00499       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(FC_MEMORY_ERROR, <span class="stringliteral">"Memory allocation failure"</span>);
<a name="l00500"></a>00500     type-&gt;fail_times = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*type-&gt;numSpotWeld);
<a name="l00501"></a>00501     <span class="keywordflow">if</span> (type-&gt;fail_times == NULL)
<a name="l00502"></a>00502       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(FC_MEMORY_ERROR, <span class="stringliteral">"Memory allocation failure"</span>);
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     <span class="keywordflow">for</span> (j = 0; j &lt; type-&gt;numSpotWeld; j++) {
<a name="l00505"></a>00505       <span class="keywordtype">int</span> <span class="keywordtype">id</span>;
<a name="l00506"></a>00506       rc = <a class="code" href="group__Sierra.html#gc45a8144f1a4af856e53c19b7baad0a8">fc_evalPrestoSpotWeld</a>(type-&gt;spotwelds[j], type-&gt;nodesets[j],
<a name="l00507"></a>00507                               type-&gt;sidesets[j], numStep, type-&gt;node_displs[j],
<a name="l00508"></a>00508                               type-&gt;side_displs[j], &amp;type-&gt;fails[j], 
<a name="l00509"></a>00509                               &amp;type-&gt;fail_stepIds[j]);
<a name="l00510"></a>00510       <span class="comment">// FIX? do we want this to shut things down?</span>
<a name="l00511"></a>00511       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(rc, <span class="stringliteral">"Presto spot weld evaluation failed"</span>);
<a name="l00512"></a>00512      
<a name="l00513"></a>00513       <span class="comment">// estimate failure time using linear interpolation</span>
<a name="l00514"></a>00514       <span class="keywordtype">id</span> = type-&gt;fail_stepIds[j];
<a name="l00515"></a>00515       <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == 0)
<a name="l00516"></a>00516         type-&gt;fail_times[j] = 0.;
<a name="l00517"></a>00517       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &gt; 0) {
<a name="l00518"></a>00518         <span class="keywordtype">double</span> fails_diff = type-&gt;fails[j][id] - type-&gt;fails[j][<span class="keywordtype">id</span>-1];
<a name="l00519"></a>00519         <span class="keywordtype">double</span> time_diff = times[id] - times[<span class="keywordtype">id</span>-1];
<a name="l00520"></a>00520         type-&gt;fail_times[j] = times[<span class="keywordtype">id</span>-1] + 
<a name="l00521"></a>00521           (1. - type-&gt;fails[j][<span class="keywordtype">id</span>-1])*time_diff/fails_diff;
<a name="l00522"></a>00522       }
<a name="l00523"></a>00523       <span class="keywordflow">else</span> { <span class="comment">// (id &lt; 0) </span>
<a name="l00524"></a>00524         type-&gt;fail_times[j] = type-&gt;fails[j][0];
<a name="l00525"></a>00525         <span class="keywordflow">for</span> (k = 1; k &lt; numStep; k++)
<a name="l00526"></a>00526           <span class="keywordflow">if</span> (type-&gt;fails[j][k] &gt; type-&gt;fail_times[j])
<a name="l00527"></a>00527             type-&gt;fail_times[j] = type-&gt;fails[j][k];
<a name="l00528"></a>00528       }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530       <span class="comment">// accumulate broken info for spot weld type</span>
<a name="l00531"></a>00531       <span class="keywordflow">if</span> (type-&gt;fail_stepIds[j] &gt; -1) {
<a name="l00532"></a>00532         type-&gt;numBrokenTotal++;
<a name="l00533"></a>00533         for (k = type-&gt;fail_stepIds[j]; k &lt; numStep; k++)
<a name="l00534"></a>00534           type-&gt;numBrokens[k]++;
<a name="l00535"></a>00535       }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537       <span class="comment">// accumulate sum of fails for group_fail</span>
<a name="l00538"></a>00538       <span class="keywordflow">for</span> (k = 0; k &lt; numStep; k++) {
<a name="l00539"></a>00539         <span class="keywordflow">if</span> (type-&gt;fails[j][k] &lt; 1)
<a name="l00540"></a>00540           type-&gt;group_fails[k] += type-&gt;fails[j][k];
<a name="l00541"></a>00541         <span class="keywordflow">else</span>
<a name="l00542"></a>00542           type-&gt;group_fails[k] += 1.0;
<a name="l00543"></a>00543       }
<a name="l00544"></a>00544     } <span class="comment">// end of loop over spotwelds</span>
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <span class="comment">// normalize group_fail</span>
<a name="l00547"></a>00547     <span class="keywordflow">for</span> (j = 0; j &lt; numStep; j++)
<a name="l00548"></a>00548       type-&gt;group_fails[j] /= type-&gt;numSpotWeld;
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     <span class="comment">// accumulate broken info for all spot welds</span>
<a name="l00551"></a>00551     numBrokenTotal += type-&gt;numBrokenTotal;
<a name="l00552"></a>00552     for (j = 0; j &lt; numStep; j++)
<a name="l00553"></a>00553       numBrokens[j] += type-&gt;numBrokens[j];
<a name="l00554"></a>00554   }
<a name="l00555"></a>00555    
<a name="l00556"></a>00556   <span class="comment">//*****************************************************************</span>
<a name="l00557"></a>00557   <span class="comment">//*** Write analysis results</span>
<a name="l00558"></a>00558   <span class="comment">//*****************************************************************</span>
<a name="l00559"></a>00559 
<a name="l00560"></a>00560   <span class="keywordflow">if</span> (beVerbose) {
<a name="l00561"></a>00561     printf(<span class="stringliteral">"Writing analysis results file...\n"</span>);
<a name="l00562"></a>00562     fflush(NULL);
<a name="l00563"></a>00563   }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565   <span class="comment">// open output file</span>
<a name="l00566"></a>00566   outputfile_name = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(strlen(output_root_name)+5));
<a name="l00567"></a>00567   sprintf(outputfile_name, <span class="stringliteral">"%s.dat"</span>, output_root_name);
<a name="l00568"></a>00568   outfile = fopen(outputfile_name, <span class="stringliteral">"w"</span>);
<a name="l00569"></a>00569   <span class="keywordflow">if</span> (outfile == NULL)
<a name="l00570"></a>00570     <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>, <span class="stringliteral">"Could not open file '%s' to write "</span>
<a name="l00571"></a>00571                    <span class="stringliteral">"results"</span>, outputfile_name);
<a name="l00572"></a>00572 
<a name="l00573"></a>00573   <span class="comment">// Write header </span>
<a name="l00574"></a>00574   fprintf(outfile, <span class="stringliteral">"# Data file generated by FCLib's analyzeSpotWelds\n"</span>);
<a name="l00575"></a>00575   fprintf(outfile, <span class="stringliteral">"# %s"</span>, ctime(&amp;start_time));
<a name="l00576"></a>00576   fprintf(outfile, <span class="stringliteral">"#\n"</span>);
<a name="l00577"></a>00577   fprintf(outfile, <span class="stringliteral">"# Input file: %s\n"</span>, inputfile_name);
<a name="l00578"></a>00578   fprintf(outfile, <span class="stringliteral">"# Results file: %s\n"</span>, database_name);
<a name="l00579"></a>00579   fprintf(outfile, <span class="stringliteral">"#\n"</span>);
<a name="l00580"></a>00580   fflush(NULL);
<a name="l00581"></a>00581 
<a name="l00582"></a>00582   <span class="comment">// Summary information</span>
<a name="l00583"></a>00583   fprintf(outfile, <span class="stringliteral">"# Summary:\n"</span>);
<a name="l00584"></a>00584   fprintf(outfile, <span class="stringliteral">"# %d of %d total spot welds failed\n"</span>, numBrokenTotal, 
<a name="l00585"></a>00585           numSpotWeld);
<a name="l00586"></a>00586   count = 0;
<a name="l00587"></a>00587   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++)
<a name="l00588"></a>00588     <span class="keywordflow">if</span> (types[i].numBrokenTotal &gt; 0)
<a name="l00589"></a>00589       count++;
<a name="l00590"></a>00590   fprintf(outfile, <span class="stringliteral">"# %d of %d types of spot weld had failures\n"</span>, count, numType);
<a name="l00591"></a>00591   fprintf(outfile, <span class="stringliteral">"# %d time steps (t = %g - %g)\n"</span>, numStep,
<a name="l00592"></a>00592           times[0], times[numStep-1]);
<a name="l00593"></a>00593   fprintf(outfile, <span class="stringliteral">"#\n"</span>);
<a name="l00594"></a>00594   fflush(NULL);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596   <span class="comment">// NumBroken reported for each spot weld type</span>
<a name="l00597"></a>00597   fprintf(outfile, <span class="stringliteral">"# Breakdown by spot weld type:\n"</span>);
<a name="l00598"></a>00598   fflush(NULL);
<a name="l00599"></a>00599   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00600"></a>00600     SpotWeldType *type = &amp;types[i];
<a name="l00601"></a>00601     time_index = 0;
<a name="l00602"></a>00602     <span class="keywordflow">while</span> (time_index &lt; numStep &amp;&amp; type-&gt;numBrokens[time_index] &lt;= 0)
<a name="l00603"></a>00603       time_index ++;
<a name="l00604"></a>00604     fprintf(outfile, <span class="stringliteral">"# %d:  %d of %d '%s' spot welds failed"</span>, i, 
<a name="l00605"></a>00605             type-&gt;numBrokenTotal, type-&gt;numSpotWeld, type-&gt;name);
<a name="l00606"></a>00606     <span class="keywordflow">if</span> (type-&gt;numBrokenTotal &gt; 0)
<a name="l00607"></a>00607       fprintf(outfile, <span class="stringliteral">" beginning at time index %d (t = %g)\n"</span>, time_index, 
<a name="l00608"></a>00608               times[time_index]);
<a name="l00609"></a>00609     <span class="keywordflow">else</span>
<a name="l00610"></a>00610       fprintf(outfile, <span class="stringliteral">"\n"</span>);
<a name="l00611"></a>00611     fflush(NULL);
<a name="l00612"></a>00612   }
<a name="l00613"></a>00613   fprintf(outfile, <span class="stringliteral">"#\n"</span>);
<a name="l00614"></a>00614   fflush(NULL);
<a name="l00615"></a>00615 
<a name="l00616"></a>00616   <span class="comment">// Write break times </span>
<a name="l00617"></a>00617   fprintf(outfile, <span class="stringliteral">"# The estimated time of spot weld failure (NA = didn't fail)\n"</span>);
<a name="l00618"></a>00618   fflush(NULL);
<a name="l00619"></a>00619   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00620"></a>00620     SpotWeldType* type = &amp;types[i];
<a name="l00621"></a>00621     fprintf(outfile, <span class="stringliteral">"# type %d: '%s'\n"</span>, i, type-&gt;name);
<a name="l00622"></a>00622     <span class="keywordflow">for</span> (j = 0; j &lt; type-&gt;numSpotWeld; j++) {
<a name="l00623"></a>00623       fprintf(outfile, <span class="stringliteral">"#   %-13s "</span>, type-&gt;spotweld_names[j]);
<a name="l00624"></a>00624       if (type-&gt;fail_stepIds[j] &lt; 0) 
<a name="l00625"></a>00625         fprintf(outfile, <span class="stringliteral">"NA\n"</span>);
<a name="l00626"></a>00626       <span class="keywordflow">else</span> 
<a name="l00627"></a>00627         fprintf(outfile, <span class="stringliteral">"%g\n"</span>, type-&gt;fail_times[j]);
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629    fflush(NULL);
<a name="l00630"></a>00630   }
<a name="l00631"></a>00631   fprintf(outfile, <span class="stringliteral">"#\n"</span>);
<a name="l00632"></a>00632   fflush(NULL);
<a name="l00633"></a>00633 
<a name="l00634"></a>00634   <span class="comment">// Write plotable info</span>
<a name="l00635"></a>00635   fprintf(outfile, <span class="stringliteral">"# Data:\n"</span>);
<a name="l00636"></a>00636   fprintf(outfile, <span class="stringliteral">"#   (Listed as time index, time value, total cumulative broken spot welds,\n"</span>);
<a name="l00637"></a>00637   fprintf(outfile, <span class="stringliteral">"#   and then for each spot weld type: cumulative broken, group failure\n"</span>);
<a name="l00638"></a>00638   fprintf(outfile, <span class="stringliteral">"#   parameter, and the failure parameters for each of the spot welds in\n"</span>);
<a name="l00639"></a>00639   fprintf(outfile, <span class="stringliteral">"#   this type\n"</span>);
<a name="l00640"></a>00640   fprintf(outfile, <span class="stringliteral">"#\n"</span>);
<a name="l00641"></a>00641   <span class="comment">// header line</span>
<a name="l00642"></a>00642   fprintf(outfile, <span class="stringliteral">"%-6s %11s %9s"</span>, <span class="stringliteral">"#Index"</span>, <span class="stringliteral">"Time"</span>, <span class="stringliteral">"totBroken"</span>);
<a name="l00643"></a>00643   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00644"></a>00644     fprintf(outfile, <span class="stringliteral">" %9s %11s"</span>, <span class="stringliteral">"numBroken"</span>, <span class="stringliteral">"group_fail"</span>);
<a name="l00645"></a>00645     <span class="keywordflow">for</span> (j = 0; j &lt; types[i].<a class="code" href="structSpotWeldType.html#1e71bc457a9a873c8cdaa0f51d20256e">numSpotWeld</a>; j++) 
<a name="l00646"></a>00646       fprintf(outfile, <span class="stringliteral">" %11s"</span>, types[i].spotweld_names[j]);
<a name="l00647"></a>00647   }
<a name="l00648"></a>00648   fprintf(outfile, <span class="stringliteral">"\n"</span>);
<a name="l00649"></a>00649   fflush(NULL);
<a name="l00650"></a>00650   <span class="comment">// data lines</span>
<a name="l00651"></a>00651   <span class="keywordflow">for</span> (i = 0; i &lt; numStep; i++) {
<a name="l00652"></a>00652     fprintf(outfile, <span class="stringliteral">"%-6d %11.6g %9d"</span>, i, times[i], numBrokens[i]);
<a name="l00653"></a>00653     <span class="keywordflow">for</span> (k = 0; k &lt; numType; k++) {
<a name="l00654"></a>00654       fprintf(outfile, <span class="stringliteral">" %9d %11.6g"</span>, types[k].numBrokens[i], types[k].group_fails[i]);
<a name="l00655"></a>00655       <span class="keywordflow">for</span> (j = 0; j &lt; types[k].<a class="code" href="structSpotWeldType.html#1e71bc457a9a873c8cdaa0f51d20256e">numSpotWeld</a>; j++)
<a name="l00656"></a>00656         fprintf(outfile, <span class="stringliteral">" %11.6g"</span>, types[k].fails[j][i]);
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658     fprintf(outfile, <span class="stringliteral">"\n"</span>);
<a name="l00659"></a>00659     fflush(NULL);
<a name="l00660"></a>00660   }
<a name="l00661"></a>00661 
<a name="l00662"></a>00662   <span class="comment">// close file</span>
<a name="l00663"></a>00663   fclose(outfile);
<a name="l00664"></a>00664   
<a name="l00665"></a>00665   <span class="comment">//*****************************************************************</span>
<a name="l00666"></a>00666   <span class="comment">//*** Write gnuplot script file</span>
<a name="l00667"></a>00667   <span class="comment">//*****************************************************************</span>
<a name="l00668"></a>00668 
<a name="l00669"></a>00669   <span class="keywordflow">if</span> (beVerbose) {
<a name="l00670"></a>00670     printf(<span class="stringliteral">"Writing gnuplot script file...\n"</span>);
<a name="l00671"></a>00671     fflush(NULL);
<a name="l00672"></a>00672   }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674   <span class="comment">// create gnuplot name and plot names </span>
<a name="l00675"></a>00675   {
<a name="l00676"></a>00676     <span class="keywordtype">int</span> root_size = strlen(output_root_name) + 1;
<a name="l00677"></a>00677     gnuplotfile_name = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(root_size + 4));
<a name="l00678"></a>00678     <span class="keywordflow">if</span> (gnuplotfile_name == NULL)
<a name="l00679"></a>00679       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(FC_MEMORY_ERROR, <span class="stringliteral">"Could not allocate gnuplotfile_name"</span>);
<a name="l00680"></a>00680     sprintf(gnuplotfile_name, <span class="stringliteral">"%s.gnu"</span>, output_root_name);
<a name="l00681"></a>00681     
<a name="l00682"></a>00682     plotfile_names = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*)*(numType+1));
<a name="l00683"></a>00683     jpgfile_names = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*)*(numType+1));
<a name="l00684"></a>00684     <span class="keywordflow">if</span> (plotfile_names == NULL || jpgfile_names == NULL)
<a name="l00685"></a>00685       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(FC_MEMORY_ERROR, <span class="stringliteral">"Could not allocate plotfile_names"</span>);
<a name="l00686"></a>00686     plotfile_names[0] = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(root_size + 8));
<a name="l00687"></a>00687     jpgfile_names[0] = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(root_size + 8));
<a name="l00688"></a>00688     <span class="keywordflow">if</span> (plotfile_names[0] == NULL || jpgfile_names[0] == NULL)
<a name="l00689"></a>00689       <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(FC_MEMORY_ERROR, <span class="stringliteral">"could not allocate plot or jpg file_names"</span>);
<a name="l00690"></a>00690     sprintf(plotfile_names[0], <span class="stringliteral">"%s.all.eps"</span>, output_root_name);
<a name="l00691"></a>00691     sprintf(jpgfile_names[0], <span class="stringliteral">"%s.all.jpg"</span>, output_root_name);
<a name="l00692"></a>00692     root_size += (int)log10(numType) + 1;  <span class="comment">// maximum chars need for numType</span>
<a name="l00693"></a>00693     <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00694"></a>00694       plotfile_names[i+1] = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(root_size + 5));
<a name="l00695"></a>00695       jpgfile_names[i+1] = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(root_size + 5));
<a name="l00696"></a>00696       <span class="keywordflow">if</span> (plotfile_names[i+1] == NULL || jpgfile_names[i+1] == NULL)
<a name="l00697"></a>00697         <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(FC_MEMORY_ERROR, <span class="stringliteral">"Could not allocate plot or jpg file_names[%d]"</span>, i+1);
<a name="l00698"></a>00698       sprintf(plotfile_names[i+1], <span class="stringliteral">"%s.%d.eps"</span>, output_root_name, i);
<a name="l00699"></a>00699       sprintf(jpgfile_names[i+1], <span class="stringliteral">"%s.%d.jpg"</span>, output_root_name, i);
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701   }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703   <span class="comment">// open output file</span>
<a name="l00704"></a>00704   outfile = fopen(gnuplotfile_name, <span class="stringliteral">"w"</span>);
<a name="l00705"></a>00705   <span class="keywordflow">if</span> (outfile == NULL)
<a name="l00706"></a>00706     <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>, <span class="stringliteral">"Could not open file '%s' to write"</span>
<a name="l00707"></a>00707                          <span class="stringliteral">" results"</span>, gnuplotfile_name);
<a name="l00708"></a>00708     
<a name="l00709"></a>00709   <span class="comment">// Write header </span>
<a name="l00710"></a>00710   fprintf(outfile, <span class="stringliteral">"# Gnuplot script generated by FCLib's analyzeSpotWelds\n"</span>);
<a name="l00711"></a>00711   fprintf(outfile, <span class="stringliteral">"# %s"</span>, ctime(&amp;start_time));
<a name="l00712"></a>00712   fprintf(outfile, <span class="stringliteral">"#\n"</span>);
<a name="l00713"></a>00713   fprintf(outfile, <span class="stringliteral">"# References data file '%s'\n"</span>, outputfile_name);
<a name="l00714"></a>00714   fprintf(outfile, <span class="stringliteral">"# To run: 'gnuplot %s' will generate '%s.&lt;id&gt;.eps'\n"</span>, 
<a name="l00715"></a>00715           gnuplotfile_name, output_root_name);
<a name="l00716"></a>00716   fprintf(outfile, <span class="stringliteral">"#   where &lt;id&gt; is 'all' or the index of the spot weld type\n"</span>);
<a name="l00717"></a>00717   fprintf(outfile, <span class="stringliteral">"# To create jpgs: 'convert -density 144 %s.&lt;id&gt;.eps "</span>
<a name="l00718"></a>00718           <span class="stringliteral">"%s.&lt;id&gt;.jpg'\n"</span>, output_root_name, output_root_name);
<a name="l00719"></a>00719   fprintf(outfile, <span class="stringliteral">"\n"</span>);
<a name="l00720"></a>00720   fflush(NULL);
<a name="l00721"></a>00721 
<a name="l00722"></a>00722   <span class="comment">// General setup</span>
<a name="l00723"></a>00723   fprintf(outfile, <span class="stringliteral">"# set up for all plots\n"</span>);
<a name="l00724"></a>00724   fprintf(outfile, <span class="stringliteral">"set terminal postscript eps color\n"</span>);
<a name="l00725"></a>00725   fprintf(outfile, <span class="stringliteral">"set xlabel 'Time'\n"</span>);
<a name="l00726"></a>00726   fprintf(outfile, <span class="stringliteral">"set y2label 'Number of Broken Spot Welds'\n"</span>);
<a name="l00727"></a>00727   fprintf(outfile, <span class="stringliteral">"set ytics nomirror\n"</span>);
<a name="l00728"></a>00728   fprintf(outfile, <span class="stringliteral">"set y2tics\n"</span>);
<a name="l00729"></a>00729   fprintf(outfile, <span class="stringliteral">"# uncomment below to move legend to left side of plots\n"</span>);
<a name="l00730"></a>00730   fprintf(outfile, <span class="stringliteral">"#set key left Left reverse\n"</span>);
<a name="l00731"></a>00731   fprintf(outfile, <span class="stringliteral">"\n"</span>);
<a name="l00732"></a>00732   fflush(NULL);
<a name="l00733"></a>00733 
<a name="l00734"></a>00734   <span class="comment">// As overall summary, plot group failure parameters and number of broken</span>
<a name="l00735"></a>00735   time_col = 2;
<a name="l00736"></a>00736   col = time_col + 1;
<a name="l00737"></a>00737   fprintf(outfile, <span class="stringliteral">"# plot all data\n"</span>);
<a name="l00738"></a>00738   fprintf(outfile, <span class="stringliteral">"set output '%s'\n"</span>, plotfile_names[0]);
<a name="l00739"></a>00739   fprintf(outfile, <span class="stringliteral">"set title \"Presto Spot Weld Analysis for All "</span>
<a name="l00740"></a>00740           <span class="stringliteral">"Spot Weld Groups\\n"</span>
<a name="l00741"></a>00741           <span class="stringliteral">"Total Number of Broken Spot Welds = %d (of %d)\"\n"</span>, 
<a name="l00742"></a>00742           numBrokenTotal, numSpotWeld);
<a name="l00743"></a>00743   fprintf(outfile, <span class="stringliteral">"set ylabel 'Normalized Group Failure Parameter (no units)'\n"</span>);
<a name="l00744"></a>00744   <span class="keywordflow">if</span> (numBrokenTotal == 0) 
<a name="l00745"></a>00745     fprintf(outfile, <span class="stringliteral">"set y2range [0:1]\n"</span>);
<a name="l00746"></a>00746   <span class="keywordflow">else</span>
<a name="l00747"></a>00747     fprintf(outfile, <span class="stringliteral">"set y2range [0:%d]\n"</span>, numBrokenTotal);
<a name="l00748"></a>00748   fprintf(outfile, <span class="stringliteral">"plot [] [0:1] '%s' using %d:%d axes x1y2 title "</span>
<a name="l00749"></a>00749           <span class="stringliteral">"'NumBroken (on secondary y axis)' with linespoints"</span>, 
<a name="l00750"></a>00750           outputfile_name, time_col, col);
<a name="l00751"></a>00751   col++;
<a name="l00752"></a>00752   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00753"></a>00753     SpotWeldType *type = &amp;types[i];
<a name="l00754"></a>00754 
<a name="l00755"></a>00755     col++;
<a name="l00756"></a>00756     fprintf(outfile, <span class="stringliteral">", \\\n"</span>);
<a name="l00757"></a>00757     fprintf(outfile, <span class="stringliteral">"'%s' using %d:%d title '%s' with linespoints"</span>, 
<a name="l00758"></a>00758             outputfile_name, time_col, col, type-&gt;name);
<a name="l00759"></a>00759     col++;
<a name="l00760"></a>00760     col += types[i].<a class="code" href="structSpotWeldType.html#1e71bc457a9a873c8cdaa0f51d20256e">numSpotWeld</a>;
<a name="l00761"></a>00761   }
<a name="l00762"></a>00762   fprintf(outfile, <span class="stringliteral">"\n"</span>);
<a name="l00763"></a>00763   fflush(NULL);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765   <span class="comment">// plot for each type of spot weld, failure parameters and broken</span>
<a name="l00766"></a>00766   col = time_col + 2; 
<a name="l00767"></a>00767   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00768"></a>00768     SpotWeldType *type = &amp;types[i];
<a name="l00769"></a>00769 
<a name="l00770"></a>00770     fprintf(outfile, <span class="stringliteral">"\n"</span>);
<a name="l00771"></a>00771     fprintf(outfile, <span class="stringliteral">"# plot data for spot weld type index #%d (of %d)\n"</span>,
<a name="l00772"></a>00772             i, numType);
<a name="l00773"></a>00773     fprintf(outfile, <span class="stringliteral">"set output '%s'\n"</span>, plotfile_names[i+1]);
<a name="l00774"></a>00774     fprintf(outfile, <span class="stringliteral">"set title \"Presto Spot Weld Analysis for Group '%s'\\n"</span>
<a name="l00775"></a>00775             <span class="stringliteral">"Number of Broken Spot Welds = %d (of %d)\"\n"</span>, type-&gt;name, 
<a name="l00776"></a>00776             type-&gt;numBrokenTotal, type-&gt;numSpotWeld);
<a name="l00777"></a>00777     fprintf(outfile, <span class="stringliteral">"set ylabel 'Failure Parameter (no units)'\n"</span>);
<a name="l00778"></a>00778     <span class="keywordflow">if</span> (type-&gt;numBrokenTotal == 0) 
<a name="l00779"></a>00779       fprintf(outfile, <span class="stringliteral">"set y2range [0:1]\n"</span>);
<a name="l00780"></a>00780     <span class="keywordflow">else</span>
<a name="l00781"></a>00781       fprintf(outfile, <span class="stringliteral">"set y2range [0:%d]\n"</span>, type-&gt;numBrokenTotal);
<a name="l00782"></a>00782     fprintf(outfile, <span class="stringliteral">"plot [] [0:1] '%s' using %d:%d axes x1y2 title "</span>
<a name="l00783"></a>00783             <span class="stringliteral">"'NumBroken (on secondary y axis)' with linespoints"</span>, 
<a name="l00784"></a>00784             outputfile_name, time_col, col);
<a name="l00785"></a>00785     col += 2;
<a name="l00786"></a>00786     <span class="keywordflow">for</span> (j = 0; j &lt; types[i].<a class="code" href="structSpotWeldType.html#1e71bc457a9a873c8cdaa0f51d20256e">numSpotWeld</a>; j++) {
<a name="l00787"></a>00787       fprintf(outfile, <span class="stringliteral">", \\\n"</span>);
<a name="l00788"></a>00788       fprintf(outfile, <span class="stringliteral">"'%s' using %d:%d title '%s' with linespoints"</span>, 
<a name="l00789"></a>00789               outputfile_name, time_col, col, type-&gt;spotweld_names[j]);
<a name="l00790"></a>00790       col++;
<a name="l00791"></a>00791     }
<a name="l00792"></a>00792     fprintf(outfile, <span class="stringliteral">"\n"</span>);
<a name="l00793"></a>00793     fflush(NULL);
<a name="l00794"></a>00794   }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796   <span class="comment">// close file</span>
<a name="l00797"></a>00797   fclose(outfile);
<a name="l00798"></a>00798 
<a name="l00799"></a>00799   <span class="comment">//*****************************************************************</span>
<a name="l00800"></a>00800   <span class="comment">//*** Write script file</span>
<a name="l00801"></a>00801   <span class="comment">//*****************************************************************</span>
<a name="l00802"></a>00802 
<a name="l00803"></a>00803   <span class="keywordflow">if</span> (beVerbose) {
<a name="l00804"></a>00804     printf(<span class="stringliteral">"Writing image creation script file ...\n"</span>);
<a name="l00805"></a>00805     fflush(NULL);
<a name="l00806"></a>00806   }
<a name="l00807"></a>00807 
<a name="l00808"></a>00808   <span class="comment">// open script file</span>
<a name="l00809"></a>00809   scriptfile_name = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(strlen(output_root_name)+8));
<a name="l00810"></a>00810   sprintf(scriptfile_name, <span class="stringliteral">"%s.script"</span>, output_root_name);
<a name="l00811"></a>00811   outfile = fopen(scriptfile_name, <span class="stringliteral">"w"</span>);
<a name="l00812"></a>00812   <span class="keywordflow">if</span> (outfile == NULL)
<a name="l00813"></a>00813     <a class="code" href="error_8h.html#42c09317184affa18e70826cb35f3f04">fc_exitIfErrorPrintf</a>(<a class="code" href="group__DataTypes.html#gg2a816f8eddef0c2d8c2e3a0393b1f52e41dd0a2fc17e1c521fa4a96cfd412708">FC_FILE_IO_ERROR</a>, <span class="stringliteral">"Could not open file '%s' to write "</span>
<a name="l00814"></a>00814                    <span class="stringliteral">"script"</span>, scriptfile_name);
<a name="l00815"></a>00815  
<a name="l00816"></a>00816   <span class="comment">// Write header </span>
<a name="l00817"></a>00817   fprintf(outfile, <span class="stringliteral">"# Script to make plots, generated by FCLib's analyzeSpotWelds\n"</span>);
<a name="l00818"></a>00818   fprintf(outfile, <span class="stringliteral">"# %s"</span>, ctime(&amp;start_time));
<a name="l00819"></a>00819   fprintf(outfile, <span class="stringliteral">"#\n"</span>);
<a name="l00820"></a>00820   fprintf(outfile, <span class="stringliteral">"# Depends on files '%s' and '%s'\n"</span>, outputfile_name, 
<a name="l00821"></a>00821           gnuplotfile_name);
<a name="l00822"></a>00822   fprintf(outfile, <span class="stringliteral">"# Uses programs 'gnuplot' and 'convert' (an ImageMagick program)\n"</span>);
<a name="l00823"></a>00823   fprintf(outfile, <span class="stringliteral">"#\n"</span>);
<a name="l00824"></a>00824   fflush(NULL);
<a name="l00825"></a>00825 
<a name="l00826"></a>00826   <span class="comment">// write code to make graphs using gnuplot</span>
<a name="l00827"></a>00827   temp_string = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(strlen(gnuplotfile_name)+12));
<a name="l00828"></a>00828   fprintf(outfile, <span class="stringliteral">"gnuplot %s\n"</span>, gnuplotfile_name);
<a name="l00829"></a>00829   fflush(NULL);
<a name="l00830"></a>00830   free(temp_string);
<a name="l00831"></a>00831   
<a name="l00832"></a>00832   <span class="comment">// write code to convert eps to jpg</span>
<a name="l00833"></a>00833   <span class="keywordflow">for</span> (i = 0; i &lt; numType + 1; i++) {
<a name="l00834"></a>00834     temp_string = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(2*strlen(plotfile_names[i]) + 40));
<a name="l00835"></a>00835     fprintf(outfile, <span class="stringliteral">"convert -density 144 %s %s\n"</span>, plotfile_names[i],
<a name="l00836"></a>00836             jpgfile_names[i]);
<a name="l00837"></a>00837     fflush(NULL);
<a name="l00838"></a>00838     free(temp_string);
<a name="l00839"></a>00839   }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841   <span class="comment">// close file</span>
<a name="l00842"></a>00842   fclose(outfile);
<a name="l00843"></a>00843 
<a name="l00844"></a>00844   <span class="comment">// make it executable</span>
<a name="l00845"></a>00845   temp_string = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(strlen(scriptfile_name) + 20));
<a name="l00846"></a>00846   sprintf(temp_string, <span class="stringliteral">"chmod +x %s\n"</span>, scriptfile_name);
<a name="l00847"></a>00847   system(temp_string);
<a name="l00848"></a>00848   free(temp_string);
<a name="l00849"></a>00849 
<a name="l00850"></a>00850 
<a name="l00851"></a>00851   <span class="comment">//*****************************************************************</span>
<a name="l00852"></a>00852   <span class="comment">//*** Cleanup</span>
<a name="l00853"></a>00853   <span class="comment">//*****************************************************************</span>
<a name="l00854"></a>00854   
<a name="l00855"></a>00855   free(numBrokens);
<a name="l00856"></a>00856   free(times);
<a name="l00857"></a>00857   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00858"></a>00858     free(types[i].spotwelds);
<a name="l00859"></a>00859     free(types[i].spotweld_names);
<a name="l00860"></a>00860     free(types[i].nodeset_names);
<a name="l00861"></a>00861     free(types[i].sideset_names);
<a name="l00862"></a>00862     free(types[i].nodesets);
<a name="l00863"></a>00863     free(types[i].sidesets);
<a name="l00864"></a>00864     <span class="keywordflow">for</span> (j = 0; j &lt; types[i].<a class="code" href="structSpotWeldType.html#1e71bc457a9a873c8cdaa0f51d20256e">numSpotWeld</a>; j++)
<a name="l00865"></a>00865       free(types[i].node_displs[j]);
<a name="l00866"></a>00866     free(types[i].node_displs);
<a name="l00867"></a>00867     <span class="keywordflow">for</span> (j = 0; j &lt; types[i].<a class="code" href="structSpotWeldType.html#1e71bc457a9a873c8cdaa0f51d20256e">numSpotWeld</a>; j++)
<a name="l00868"></a>00868       free(types[i].side_displs[j]);
<a name="l00869"></a>00869     free(types[i].side_displs);
<a name="l00870"></a>00870     <span class="keywordflow">for</span> (j = 0; j &lt; types[i].<a class="code" href="structSpotWeldType.html#1e71bc457a9a873c8cdaa0f51d20256e">numSpotWeld</a>; j++)
<a name="l00871"></a>00871       free(types[i].fails[j]);
<a name="l00872"></a>00872     free(types[i].fails);
<a name="l00873"></a>00873     free(types[i].group_fails);
<a name="l00874"></a>00874     free(types[i].fail_stepIds);
<a name="l00875"></a>00875     free(types[i].numBrokens);
<a name="l00876"></a>00876     free(types[i].fail_times);
<a name="l00877"></a>00877     <span class="comment">//for (j = 0; j &lt; types[i].numSpotWeld; j++) {</span>
<a name="l00878"></a>00878     <span class="comment">//free(types[i].spotweld_names[j]);</span>
<a name="l00879"></a>00879     <span class="comment">//free(types[i].nodeset_names[j]);</span>
<a name="l00880"></a>00880     <span class="comment">//free(types[i].sideset_names[j]);</span>
<a name="l00881"></a>00881     <span class="comment">//}</span>
<a name="l00882"></a>00882    }
<a name="l00883"></a>00883   free(types);
<a name="l00884"></a>00884   <span class="keywordflow">for</span> (i = 0; i &lt; numType + 1; i++) {
<a name="l00885"></a>00885     free(plotfile_names[i]);
<a name="l00886"></a>00886     free(jpgfile_names[i]);
<a name="l00887"></a>00887   }
<a name="l00888"></a>00888   free(plotfile_names);
<a name="l00889"></a>00889   free(jpgfile_names);
<a name="l00890"></a>00890   free(outputfile_name);
<a name="l00891"></a>00891   free(gnuplotfile_name);
<a name="l00892"></a>00892   free(scriptfile_name);
<a name="l00893"></a>00893 
<a name="l00894"></a>00894   <span class="comment">// final the library</span>
<a name="l00895"></a>00895   <a class="code" href="group__Sierra.html#g03224fc1acd3d1b195eadae651a95f65">fc_freeSierraInfo</a>(sierra_info);
<a name="l00896"></a>00896   <span class="comment">// FIX? move this sooner?</span>
<a name="l00897"></a>00897   <a class="code" href="group__Dataset.html#gbcd9a9a1b5ca718ac61d0707836703a7">fc_deleteDataset</a>(dataset);
<a name="l00898"></a>00898   <a class="code" href="group__Library.html#g68cec1422dde03b636cf039faafa7baa">fc_finalLibrary</a>();
<a name="l00899"></a>00899 
<a name="l00900"></a>00900   <span class="keywordflow">if</span> (beVerbose) {
<a name="l00901"></a>00901     printf(<span class="stringliteral">"Done.\n"</span>);
<a name="l00902"></a>00902     fflush(NULL);
<a name="l00903"></a>00903   }
<a name="l00904"></a>00904 
<a name="l00905"></a>00905   exit(0); 
<a name="l00906"></a>00906 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="794a3f6c58cea0536d283f3eab1dc8db"></a><!-- doxytag: member="analyzeSpotWelds.c::nameSpotWeldTypes" ref="794a3f6c58cea0536d283f3eab1dc8db" args="(int numType, SpotWeldType *types)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nameSpotWeldTypes           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structSpotWeldType.html">SpotWeldType</a> *&nbsp;</td>
          <td class="paramname"> <em>types</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function determines the shortest distinguishable name for each spot weld type. The name is a string listing the properties of the spot weld types that differ from the other spotwelds in the array.<p>
Procedure:<ol type=1>
<li>Determine a base name for each type from the function names. Strips 'normal' and 'tangential' from the names of the functions to see if the root names are the same. If they are, then the root name is used. Other wise 'normal_name/tangent_name' is used.</li><li>Check to see if names all differ. If they don't, switch all names back to the 'normal_name/tangent_name' form of the names.</li><li>Check to see what other parameters differ, and append their values to all type's names.</li></ol>
<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000113">Todo:</a></b></dt><dd>Might want the program to be even smarter and only append the different properties when they are necessary. For example, right now, if any two types have the same name and they have different scale factors, all types will get scale factors appended. It would be more concise to have the scale factors only added to the names of the two types that were equal. </dd></dl>

<p>
Definition at line <a class="el" href="analyzeSpotWelds_8c-source.html#l00964">964</a> of file <a class="el" href="analyzeSpotWelds_8c-source.html">analyzeSpotWelds.c</a>.
<p>
Referenced by <a class="el" href="analyzeSpotWelds_8c-source.html#l00135">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00964"></a>00964                                                          {
<a name="l00965"></a>00965   <span class="keywordtype">int</span> i, j;
<a name="l00966"></a>00966   <span class="keywordtype">int</span> nameSame = 0;
<a name="l00967"></a>00967   <span class="keywordtype">int</span> decayDiff = 0;
<a name="l00968"></a>00968   <span class="keywordtype">int</span> normScaleDiff = 0;
<a name="l00969"></a>00969   <span class="keywordtype">int</span> tangScaleDiff = 0;
<a name="l00970"></a>00970   <span class="keywordtype">int</span> expDiff = 0;
<a name="l00971"></a>00971   <a class="code" href="structSpotWeldType.html">SpotWeldType</a> *type0 = &amp;types[0];
<a name="l00972"></a>00972   
<a name="l00973"></a>00973   <span class="comment">// make base name</span>
<a name="l00974"></a>00974   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l00975"></a>00975     <a class="code" href="structSpotWeldType.html">SpotWeldType</a> *type = &amp;types[i];
<a name="l00976"></a>00976     <span class="keywordtype">char</span> temp_normal[1024] = <span class="stringliteral">"normal"</span>;
<a name="l00977"></a>00977     <span class="keywordtype">char</span> temp_tangent[1024] = <span class="stringliteral">"tangential"</span>;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <span class="comment">// First, check to see if they are equal</span>
<a name="l00980"></a>00980     <span class="keywordflow">if</span> (!strcasecmp(type-&gt;normal_name, type-&gt;tangent_name)) {
<a name="l00981"></a>00981       strcpy(temp_normal, type-&gt;normal_name);
<a name="l00982"></a>00982       strcpy(temp_tangent, type-&gt;tangent_name);
<a name="l00983"></a>00983     }
<a name="l00984"></a>00984     <span class="keywordflow">else</span> {
<a name="l00985"></a>00985       <span class="keywordtype">int</span> start;          <span class="comment">// index to where strings first differ</span>
<a name="l00986"></a>00986       <span class="keywordtype">int</span> norm_len = strlen(type-&gt;normal_name);
<a name="l00987"></a>00987       <span class="keywordtype">int</span> tang_len = strlen(type-&gt;tangent_name);
<a name="l00988"></a>00988       <span class="keywordtype">int</span> min_len;
<a name="l00989"></a>00989       <span class="keywordtype">int</span> found_norm;  <span class="comment">// holds number of characters of norm string to skip</span>
<a name="l00990"></a>00990       <span class="keywordtype">int</span> found_tang;  <span class="comment">// holds number of characters of tangent str to skip</span>
<a name="l00991"></a>00991 
<a name="l00992"></a>00992       <span class="keywordflow">if</span> (norm_len &lt; tang_len) 
<a name="l00993"></a>00993         min_len = norm_len;
<a name="l00994"></a>00994       <span class="keywordflow">else</span> 
<a name="l00995"></a>00995         min_len = tang_len;
<a name="l00996"></a>00996 
<a name="l00997"></a>00997       <span class="comment">// Walk from start, until they differ</span>
<a name="l00998"></a>00998       <span class="keywordflow">for</span> (start = 0; start &lt; min_len; start++) {
<a name="l00999"></a>00999         <span class="keywordflow">if</span> (strncasecmp(&amp;(type-&gt;normal_name[start]), 
<a name="l01000"></a>01000                         &amp;(type-&gt;tangent_name[start]), 1))
<a name="l01001"></a>01001           <span class="keywordflow">break</span>;
<a name="l01002"></a>01002       }
<a name="l01003"></a>01003 
<a name="l01004"></a>01004       <span class="comment">// check for variations of normal and tangential</span>
<a name="l01005"></a>01005       <span class="keywordflow">if</span> (!strncasecmp(&amp;(type-&gt;normal_name[start]), <span class="stringliteral">"normal"</span>, 6))
<a name="l01006"></a>01006         found_norm = 6;
<a name="l01007"></a>01007       <span class="keywordflow">else</span> if (!strncasecmp(&amp;(type-&gt;normal_name[start]), <span class="stringliteral">"norm"</span>, 4))
<a name="l01008"></a>01008         found_norm = 4;
<a name="l01009"></a>01009       if (!strncasecmp(&amp;(type-&gt;tangent_name[start]), <span class="stringliteral">"tangential"</span>, 10))
<a name="l01010"></a>01010         found_tang = 10;
<a name="l01011"></a>01011       <span class="keywordflow">else</span> if (!strncasecmp(&amp;(type-&gt;tangent_name[start]), <span class="stringliteral">"tangent"</span>, 7))
<a name="l01012"></a>01012         found_tang = 7;
<a name="l01013"></a>01013       <span class="keywordflow">else</span> if (!strncasecmp(&amp;(type-&gt;tangent_name[start]), <span class="stringliteral">"tang"</span>, 4))
<a name="l01014"></a>01014         found_tang = 4;
<a name="l01015"></a>01015 
<a name="l01016"></a>01016       if (found_norm &gt; 0 &amp;&amp; found_tang &gt; 0) {
<a name="l01017"></a>01017         <span class="comment">// check for delimiters before and after (only need to take one)</span>
<a name="l01018"></a>01018         <span class="keywordflow">if</span> (start &gt; 0 &amp;&amp; 
<a name="l01019"></a>01019             (type-&gt;normal_name[start-1] == <span class="charliteral">'_'</span> || 
<a name="l01020"></a>01020              type-&gt;normal_name[start-1] == <span class="charliteral">'-'</span>)   ) {
<a name="l01021"></a>01021           start--;
<a name="l01022"></a>01022           found_norm++;
<a name="l01023"></a>01023           found_tang++;
<a name="l01024"></a>01024         }
<a name="l01025"></a>01025         <span class="keywordflow">else</span> {
<a name="l01026"></a>01026           <span class="keywordflow">if</span> (start + found_norm &lt; norm_len  &amp;&amp;
<a name="l01027"></a>01027               (type-&gt;normal_name[start + found_norm] == <span class="charliteral">'_'</span> ||
<a name="l01028"></a>01028                type-&gt;normal_name[start + found_norm] == <span class="charliteral">'-'</span>)   ) 
<a name="l01029"></a>01029           found_norm++;
<a name="l01030"></a>01030           if (start + found_tang &lt; tang_len &amp;&amp;
<a name="l01031"></a>01031               (type-&gt;tangent_name[start + found_tang] == <span class="charliteral">'_'</span> ||
<a name="l01032"></a>01032                type-&gt;tangent_name[start + found_tang] == <span class="charliteral">'-'</span>)  )
<a name="l01033"></a>01033             found_tang++;
<a name="l01034"></a>01034         }
<a name="l01035"></a>01035         
<a name="l01036"></a>01036         <span class="comment">// copy all but in between bit</span>
<a name="l01037"></a>01037         <span class="keywordflow">if</span> (start &gt; 0) {
<a name="l01038"></a>01038           strncpy(temp_normal, type-&gt;normal_name, start);
<a name="l01039"></a>01039           strncpy(temp_tangent, type-&gt;tangent_name, start);
<a name="l01040"></a>01040         }
<a name="l01041"></a>01041         temp_normal[start] = <span class="charliteral">'\0'</span>;
<a name="l01042"></a>01042         temp_tangent[start] = <span class="charliteral">'\0'</span>;
<a name="l01043"></a>01043         <span class="keywordflow">if</span> (start + found_norm &lt; norm_len)
<a name="l01044"></a>01044           strcat(temp_normal, &amp;(type-&gt;normal_name[start + found_norm]));
<a name="l01045"></a>01045         if (start + found_tang &lt; tang_len)
<a name="l01046"></a>01046           strcat(temp_tangent, &amp;(type-&gt;tangent_name[start + found_tang]));
<a name="l01047"></a>01047 
<a name="l01048"></a>01048         <span class="comment">//printf("norm_len= %d\n", norm_len);</span>
<a name="l01049"></a>01049         <span class="comment">//printf("tang_len= %d\n", tang_len);</span>
<a name="l01050"></a>01050         <span class="comment">//printf("start = %d\n", start);</span>
<a name="l01051"></a>01051         <span class="comment">//printf("found_norm = %d\n", found_norm);</span>
<a name="l01052"></a>01052         <span class="comment">//printf("found_tang = %d\n", found_tang);</span>
<a name="l01053"></a>01053         <span class="comment">//printf("normal_name = %s\n", type-&gt;normal_name);</span>
<a name="l01054"></a>01054         <span class="comment">//printf("temp_norm = %s\n", temp_normal);</span>
<a name="l01055"></a>01055         <span class="comment">//printf("tangent_name = %s\n", type-&gt;tangent_name);</span>
<a name="l01056"></a>01056         <span class="comment">//printf("temp_tang = %s\n", temp_tangent);</span>
<a name="l01057"></a>01057       }
<a name="l01058"></a>01058     }
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     <span class="comment">// write base</span>
<a name="l01061"></a>01061     <span class="keywordflow">if</span> (!strcmp(temp_normal, temp_tangent))
<a name="l01062"></a>01062       sprintf(type-&gt;name, <span class="stringliteral">"%s"</span>, temp_normal);
<a name="l01063"></a>01063     <span class="keywordflow">else</span>
<a name="l01064"></a>01064       sprintf(type-&gt;name, <span class="stringliteral">"%s/%s"</span>, type-&gt;normal_name, type-&gt;tangent_name);
<a name="l01065"></a>01065   }
<a name="l01066"></a>01066     
<a name="l01067"></a>01067   <span class="comment">// Check to see if any type names are the same</span>
<a name="l01068"></a>01068   <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l01069"></a>01069     <span class="keywordflow">for</span> (j = i+1; j &lt; numType; j++) {
<a name="l01070"></a>01070       <span class="keywordflow">if</span> (!strcmp(types[i].name, types[j].name)) {
<a name="l01071"></a>01071         nameSame = 1;
<a name="l01072"></a>01072         <span class="keywordflow">break</span>;
<a name="l01073"></a>01073       }
<a name="l01074"></a>01074     }
<a name="l01075"></a>01075     <span class="keywordflow">if</span> (nameSame)
<a name="l01076"></a>01076       <span class="keywordflow">break</span>;
<a name="l01077"></a>01077   }
<a name="l01078"></a>01078 
<a name="l01079"></a>01079   <span class="comment">// if any are the same, switch back to long names</span>
<a name="l01080"></a>01080   <span class="keywordflow">if</span> (nameSame) {
<a name="l01081"></a>01081     <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l01082"></a>01082       <a class="code" href="structSpotWeldType.html">SpotWeldType</a> *type = &amp;types[i];
<a name="l01083"></a>01083       sprintf(type-&gt;name, <span class="stringliteral">"%s/%s"</span>, type-&gt;normal_name, type-&gt;tangent_name);
<a name="l01084"></a>01084     }
<a name="l01085"></a>01085     <span class="keywordflow">return</span>;
<a name="l01086"></a>01086   }
<a name="l01087"></a>01087   
<a name="l01088"></a>01088   <span class="comment">// figure out what differs</span>
<a name="l01089"></a>01089   <span class="keywordflow">for</span> (i = 1; i &lt; numType; i++) {
<a name="l01090"></a>01090     <a class="code" href="structSpotWeldType.html">SpotWeldType</a> *type = &amp;types[i];
<a name="l01091"></a>01091     <span class="keywordflow">if</span> (decayDiff == 0 &amp;&amp; type-&gt;decay_cycles != type0-&gt;<a class="code" href="structSpotWeldType.html#938b9254d46ed49da022d7473bac5ec1">decay_cycles</a>)
<a name="l01092"></a>01092       decayDiff = 1;
<a name="l01093"></a>01093     if (normScaleDiff == 0 &amp;&amp; type-&gt;normal_scale != type0-&gt;<a class="code" href="structSpotWeldType.html#bc731dbaf73a7974bee06d1f59d469be">normal_scale</a>)
<a name="l01094"></a>01094       normScaleDiff = 1;
<a name="l01095"></a>01095     if (tangScaleDiff == 0 &amp;&amp; type-&gt;tangent_scale != type0-&gt;<a class="code" href="structSpotWeldType.html#b32b00f25286386e18765e17db1aec9a">tangent_scale</a>)
<a name="l01096"></a>01096       tangScaleDiff = 1;
<a name="l01097"></a>01097     if (expDiff == 0 &amp;&amp; type-&gt;exponent != type0-&gt;<a class="code" href="structSpotWeldType.html#a5ba78d9650ccb00dae8d4f1abd06581">exponent</a>)
<a name="l01098"></a>01098       expDiff = 1;
<a name="l01099"></a>01099   }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101   <span class="comment">// append names of things that differ</span>
<a name="l01102"></a>01102   <span class="keywordflow">if</span> (decayDiff || normScaleDiff || tangScaleDiff || expDiff) {
<a name="l01103"></a>01103     <span class="keywordflow">for</span> (i = 0; i &lt; numType; i++) {
<a name="l01104"></a>01104       <a class="code" href="structSpotWeldType.html">SpotWeldType</a> *type = &amp;types[i];
<a name="l01105"></a>01105       <span class="keywordflow">if</span> (normScaleDiff) 
<a name="l01106"></a>01106         sprintf(&amp;(type-&gt;name[strlen(type-&gt;name)]), <span class="stringliteral">"/normal_scale_%g"</span>, 
<a name="l01107"></a>01107                 type-&gt;normal_scale);
<a name="l01108"></a>01108       if (tangScaleDiff) 
<a name="l01109"></a>01109         sprintf(&amp;(type-&gt;name[strlen(type-&gt;name)]), <span class="stringliteral">"/tangent_scale_%g"</span>, 
<a name="l01110"></a>01110                 type-&gt;tangent_scale);
<a name="l01111"></a>01111       if (decayDiff) 
<a name="l01112"></a>01112         sprintf(&amp;(type-&gt;name[strlen(type-&gt;name)]), <span class="stringliteral">"/decay_cycles_%d"</span>, 
<a name="l01113"></a>01113                 type-&gt;decay_cycles);
<a name="l01114"></a>01114       if (expDiff) 
<a name="l01115"></a>01115         sprintf(&amp;(type-&gt;name[strlen(type-&gt;name)]), <span class="stringliteral">"/exponent_%g"</span>, 
<a name="l01116"></a>01116                 type-&gt;exponent);
<a name="l01117"></a>01117     }
<a name="l01118"></a>01118   }
<a name="l01119"></a>01119 }
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Wed Oct 31 11:10:00 2007 for FCLib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
