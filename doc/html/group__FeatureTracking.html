<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>FCLib: Feature Tracking</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Feature Tracking<br>
<small>
[<a class="el" href="group__API.html">FCLib API</a>]</small>
</h1>
<p>
<div class="dynheader">
Collaboration diagram for Feature Tracking:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__FeatureTracking.gif" border="0" alt="" usemap="#group____FeatureTracking_map">
<map name="group____FeatureTracking_map">
<area shape="rect" href="group__FeatureTrackingPrivateHelpers.html" title="(Not available outside this module)" alt="" coords="331,5,605,32"><area shape="rect" href="group__API.html" title="Feature Characterization Library." alt="" coords="7,5,92,32"></map></td></tr></table></center>
</div>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Routines for assembling Regions Of Interest into Features. 
<p>
<b>Description:</b> <p>
The feature tracking module provides routines for assembling Regions of interest from a series of different steps (usually time steps) into Features.<p>
In each (time) step, tracking occurs in three steps.<ul>
<li>1. A score matrix is computed which indicates the amount of correspondence between each ROI in a new step with the ROI's in the previous step.</li><li>2. The score matrix is analyzed and a correspondence matrix is created which indicates, by a nonzero value, which of the new ROIs correspond with the previous ROIs.</li><li>3. The correspondence matrix and the ROIs are used to construct the features.</li></ul>
<p>
The routine <a class="el" href="group__FeatureTracking.html#g993f13a1cdda004e273ddd21f8877cad">fc_trackAllSteps()</a> takes in the ROIs over a number of steps and returns a Feature Group containing the features. The routine <a class="el" href="group__FeatureTracking.html#g82fa54eee1ede57d2481b95732955c5d">fc_trackStep()</a> allows the addition of a single step.<p>
The default algorithm for computing the score score matrix (fc_computeNumOverlapScore) is based on the number of overlapping entities. The default algorithm for computing the correspondence matrix (fc_computeSimpleCorrespond) is just convert the score matrix to an int matrix. The default algorithm for feature assignment (rc_addROIsUsingBasicEvents) is to start new features if there is a split or merge event (and of course when there is a new feature).<p>
The routines <a class="el" href="group__FeatureTracking.html#g5d25de71a86bcf980aa5027f46976950">fc_trackAllSteps_custom()</a> and <a class="el" href="group__FeatureTracking.html#gb0b8fee77a0c96b02d231fab299c4475">fc_trackStep_custom()</a> allow the user to provide their own implementations of each of the three steps in the tracking process. A value of NULL indicates that the default implementation of that step be used. The matrices are accessed by matrix[i][j] where i is the index into the previous step's ROI list and j is the index into the new step's ROI list. Note that a modified Feature Group may be needed if you implement a different feature assignment step.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000103">Todo:</a></b></dt><dd>? Should the score matrix and correspondence matrix really be separate routines?</dd></dl>
<b>Modifications:</b> <ul>
<li>FEB-18-2003 W Koegler Created</li><li>APR-01-2003 W Koegler Adapted to use feature groups</li><li>APR-14-2003 W Koegler Integrated into FCLib</li><li>07/01/04 WSK Changed to take FC_Subsets instead of Linked Lists </li></ul>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Modules</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__FeatureTrackingPrivateHelpers.html">(Not available outside this module)</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__FeatureTracking.html#g82fa54eee1ede57d2481b95732955c5d">fc_trackStep</a> (int stepIndex, int numNew, <a class="el" href="structFC__Subset.html">FC_Subset</a> *newSegments, <a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *group)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Track and create features for a new step.  <a href="#g82fa54eee1ede57d2481b95732955c5d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__FeatureTracking.html#g993f13a1cdda004e273ddd21f8877cad">fc_trackAllSteps</a> (int numStep, int *numSegments, <a class="el" href="structFC__Subset.html">FC_Subset</a> **segments, <a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *group)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Track and create features.  <a href="#g993f13a1cdda004e273ddd21f8877cad"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__FeatureTracking.html#gb0b8fee77a0c96b02d231fab299c4475">fc_trackStep_custom</a> (int stepIndex, int numNew, <a class="el" href="structFC__Subset.html">FC_Subset</a> *newSegments, <a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *group, int compute_scores(int, <a class="el" href="structFC__Subset.html">FC_Subset</a> *, int, <a class="el" href="structFC__Subset.html">FC_Subset</a> *, double ***), int compute_correspondence(int, int, double **, int ***), int add_rois_to_features(int, int, int, <a class="el" href="structFC__Subset.html">FC_Subset</a> *, int **, <a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *))</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Track and create features for a new step using custom tracking.  <a href="#gb0b8fee77a0c96b02d231fab299c4475"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__FeatureTracking.html#g5d25de71a86bcf980aa5027f46976950">fc_trackAllSteps_custom</a> (int numStep, int *numSegments, <a class="el" href="structFC__Subset.html">FC_Subset</a> **segments, <a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *group, int compute_scores(int, <a class="el" href="structFC__Subset.html">FC_Subset</a> *, int, <a class="el" href="structFC__Subset.html">FC_Subset</a> *, double ***), int compute_correspondence(int, int, double **, int ***), int add_rois_to_features(int, int, int, <a class="el" href="structFC__Subset.html">FC_Subset</a> *, int **, <a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *))</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Track and create features using custom tracking.  <a href="#g5d25de71a86bcf980aa5027f46976950"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__FeatureTracking.html#gedc41c37ec48c65a6721ba882f95527d">fc_computeNumOverlapScore</a> (int numPrev, <a class="el" href="structFC__Subset.html">FC_Subset</a> *prevLists, int numNew, <a class="el" href="structFC__Subset.html">FC_Subset</a> *newLists, double ***scores_p)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compute Score Matrix based on overlapping entities.  <a href="#gedc41c37ec48c65a6721ba882f95527d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__FeatureTracking.html#g3b60af2aec06d612f80ba68b5948dc97">fc_computeSimpleCorrespond</a> (int numPrev, int numNew, double **scores, int ***matrix_p)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compute correspondence matrix.  <a href="#g3b60af2aec06d612f80ba68b5948dc97"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__FeatureTracking.html#g295b5d86ccd81ddb4994bc9c51188687">fc_addROIsUsingBasicEvents</a> (int stepIndex, int numPrev, int numNew, <a class="el" href="structFC__Subset.html">FC_Subset</a> *newSegments, int **overlaps, <a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *group)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add ROIs to the features in a Feature Group.  <a href="#g295b5d86ccd81ddb4994bc9c51188687"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__FeatureTracking.html#g08c02218d20f51de88e41790306907e1">fc_groupSelfCorrespond</a> (int num, int **corresponds, int *numGroup, int **numPerGroup, int ***idsPerGroup)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Group objects based on self-correspondance scores.  <a href="#g08c02218d20f51de88e41790306907e1"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="g295b5d86ccd81ddb4994bc9c51188687"></a><!-- doxytag: member="track.c::fc_addROIsUsingBasicEvents" ref="g295b5d86ccd81ddb4994bc9c51188687" args="(int stepIndex, int numPrev, int numNew, FC_Subset *newSegments, int **overlaps, FC_FeatureGroup *group)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_addROIsUsingBasicEvents           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stepIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numPrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numNew</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Subset.html">FC_Subset</a> *&nbsp;</td>
          <td class="paramname"> <em>newSegments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&nbsp;</td>
          <td class="paramname"> <em>overlaps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *&nbsp;</td>
          <td class="paramname"> <em>group</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Add ROIs to the features in a Feature Group. 
<p>
<b>Description:</b> <p>
Given the new ROIs and the correspondence matrix, create or extend the features in the feature Group. Use the devinition of basic events to decide on features (i.e. all events but continue events create new features).<p>
<b>Modifications:</b> <ul>
<li>APR-14-2003 W Koegler Documented </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>stepIndex</em>&nbsp;</td><td>
input - index of the new step </td></tr>
<tr><td valign="top"><em>numPrev</em>&nbsp;</td><td>
input - number of segments in prev step </td></tr>
<tr><td valign="top"><em>numNew</em>&nbsp;</td><td>
input - number of segments in new step </td></tr>
<tr><td valign="top"><em>newSegments</em>&nbsp;</td><td>
input - an array of ROIs </td></tr>
<tr><td valign="top"><em>overlaps</em>&nbsp;</td><td>
input - pointer to a numPrev X numNew </td></tr>
<tr><td valign="top"><em>group</em>&nbsp;</td><td>
input - feature group to store results </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="track_8c-source.html#l00523">523</a> of file <a class="el" href="track_8c-source.html">track.c</a>.</p>

<p>References <a class="el" href="base_8h-source.html#l00105">FC_ERROR</a>, <a class="el" href="feature_8c-source.html#l00344">fc_featureGroup_continueFeature()</a>, <a class="el" href="feature_8c-source.html#l00558">fc_featureGroup_getFeatureIDsInStep()</a>, <a class="el" href="feature_8c-source.html#l00243">fc_featureGroup_newFeature()</a>, <a class="el" href="feature_8c-source.html#l00391">fc_featureGroup_noFeaturesThisStep()</a>, <a class="el" href="feature_8c-source.html#l00306">fc_featureGroup_setParentChildPair()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, and <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="track_8c-source.html#l00192">fc_trackStep_custom()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00530"></a>00530   {
<a name="l00531"></a>00531   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;  
<a name="l00532"></a>00532   <span class="keywordtype">int</span> i, j;
<a name="l00533"></a>00533   <span class="keywordtype">int</span> idx, id;
<a name="l00534"></a>00534   <span class="keywordtype">int</span> temp_numExist;     <span class="comment">// store numExist before adding this step</span>
<a name="l00535"></a>00535   <span class="keywordtype">int</span>* temp_existsIDs;   <span class="comment">// store the existsIDs before adding this step</span>
<a name="l00536"></a>00536   <span class="keywordtype">int</span> *numOldOverlaps, *numNewOverlaps;
<a name="l00537"></a>00537   <a class="code" href="structFC__Subset.html" title="Subset Handle.">FC_Subset</a> roi;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539   <span class="comment">// check input</span>
<a name="l00540"></a>00540   <span class="keywordflow">if</span> (stepIndex &lt; 0 || numPrev &lt; 0 || numNew &lt; 0 || 
<a name="l00541"></a>00541       (numNew &gt; 0 &amp;&amp; !newSegments) || 
<a name="l00542"></a>00542       (numPrev &gt; 0 &amp;&amp; numNew &gt; 0 &amp;&amp; !overlaps) || !group)  {
<a name="l00543"></a>00543       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l00544"></a>00544       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00545"></a>00545   }
<a name="l00546"></a>00546   <span class="keywordflow">if</span> (overlaps) {
<a name="l00547"></a>00547     <span class="keywordflow">for</span> (i = 0; i &lt; numPrev; i++) {
<a name="l00548"></a>00548       <span class="keywordflow">if</span> (!overlaps[i]) {
<a name="l00549"></a>00549      <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>)); 
<a name="l00550"></a>00550      <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>;
<a name="l00551"></a>00551       }
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553   }
<a name="l00554"></a>00554 
<a name="l00555"></a>00555   <span class="comment">// log message</span>
<a name="l00556"></a>00556   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Adding ROIs to the Feature Group for step %d."</span>,
<a name="l00557"></a>00557                 stepIndex);
<a name="l00558"></a>00558 
<a name="l00559"></a>00559   <span class="comment">// if no new segments, no new features </span>
<a name="l00560"></a>00560   <span class="keywordflow">if</span> (numNew &lt; 1) {
<a name="l00561"></a>00561     rc = <a class="code" href="group__Features.html#gb6019787fa72c88e2a273cbbabe55c39" title="Declare that a step in the feature group has no features.">fc_featureGroup_noFeaturesThisStep</a>(group, stepIndex);
<a name="l00562"></a>00562     <span class="keywordflow">return</span> rc;
<a name="l00563"></a>00563   }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565   <span class="comment">// get previous step's existing features (should == numPrev)</span>
<a name="l00566"></a>00566   temp_numExist = 0;
<a name="l00567"></a>00567   <span class="keywordflow">if</span> (stepIndex &gt; 0) {
<a name="l00568"></a>00568     rc = <a class="code" href="group__Features.html#g2852fa2ce32f84bf1f331e990cb4fe78" title="Get the IDs of the features in a step.">fc_featureGroup_getFeatureIDsInStep</a>(group, stepIndex-1, 
<a name="l00569"></a>00569                               &amp;temp_numExist, &amp;temp_existsIDs);
<a name="l00570"></a>00570     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00571"></a>00571       <span class="keywordflow">return</span> rc;
<a name="l00572"></a>00572     <span class="keywordflow">if</span> (temp_numExist != numPrev) {
<a name="l00573"></a>00573       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"passed in numPrev does not agree with "</span>
<a name="l00574"></a>00574                    <span class="stringliteral">"feature group"</span>);
<a name="l00575"></a>00575       free(temp_existsIDs);
<a name="l00576"></a>00576       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578   }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580   <span class="comment">// if no existing features, all new segments are new features</span>
<a name="l00581"></a>00581   <span class="keywordflow">if</span> (temp_numExist &lt; 1) {
<a name="l00582"></a>00582     <span class="keywordflow">for</span> (i = 0; i &lt; numNew; i++) {
<a name="l00583"></a>00583       rc = <a class="code" href="group__Features.html#g256c40743a05f082881e0f022b04d80a" title="Creates a new feature in the feature group.">fc_featureGroup_newFeature</a>(group, stepIndex, newSegments[i], &amp;<span class="keywordtype">id</span>);
<a name="l00584"></a>00584       <span class="keywordflow">if</span>(rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00585"></a>00585         <span class="keywordflow">return</span> rc;
<a name="l00586"></a>00586     }
<a name="l00587"></a>00587     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l00588"></a>00588   }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   <span class="comment">// make numOverlap helper arrays</span>
<a name="l00591"></a>00591   numOldOverlaps = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*(temp_numExist));
<a name="l00592"></a>00592   numNewOverlaps = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*numNew);
<a name="l00593"></a>00593   <span class="keywordflow">if</span> (numOldOverlaps == NULL || numNewOverlaps == NULL) {
<a name="l00594"></a>00594     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l00595"></a>00595     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l00596"></a>00596   }
<a name="l00597"></a>00597   <span class="keywordflow">for</span> (i = 0; i &lt; temp_numExist; i++)
<a name="l00598"></a>00598     numOldOverlaps[i] = 0;
<a name="l00599"></a>00599   <span class="keywordflow">for</span> (i = 0; i &lt; numNew; i++)
<a name="l00600"></a>00600     numNewOverlaps[i] = 0;
<a name="l00601"></a>00601   <span class="keywordflow">for</span> (i = 0; i &lt; temp_numExist; i++)
<a name="l00602"></a>00602     <span class="keywordflow">for</span> (j = 0; j &lt; numNew; j++)
<a name="l00603"></a>00603       <span class="keywordflow">if</span> (overlaps[i][j] &gt; 0) {
<a name="l00604"></a>00604         numOldOverlaps[i]++;
<a name="l00605"></a>00605         numNewOverlaps[j]++;
<a name="l00606"></a>00606       }
<a name="l00607"></a>00607 
<a name="l00608"></a>00608   <span class="comment">//temp_numExist = 0;</span>
<a name="l00609"></a>00609   <span class="comment">// look for new features, merges, splits</span>
<a name="l00610"></a>00610   <span class="comment">// test number of overlaps to see what to do</span>
<a name="l00611"></a>00611   <span class="keywordflow">for</span> (i = 0; i &lt; numNew; i++) {
<a name="l00612"></a>00612     roi = newSegments[i];
<a name="l00613"></a>00613     
<a name="l00614"></a>00614     <span class="comment">// if no overlaps with previous segments, it's a new feature</span>
<a name="l00615"></a>00615     <span class="keywordflow">if</span> (numNewOverlaps[i] == 0) { 
<a name="l00616"></a>00616       rc = <a class="code" href="group__Features.html#g256c40743a05f082881e0f022b04d80a" title="Creates a new feature in the feature group.">fc_featureGroup_newFeature</a>(group, stepIndex, roi, &amp;<span class="keywordtype">id</span>);
<a name="l00617"></a>00617       <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00618"></a>00618         <span class="keywordflow">return</span> rc;
<a name="l00619"></a>00619     }
<a name="l00620"></a>00620     
<a name="l00621"></a>00621     <span class="comment">// if there is one overlap it could be a split or just continue</span>
<a name="l00622"></a>00622     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (numNewOverlaps[i] == 1) { 
<a name="l00623"></a>00623       <span class="comment">// find old segments index that causes this overlap</span>
<a name="l00624"></a>00624       <span class="keywordflow">for</span> (j = 0; j &lt; temp_numExist; j++)
<a name="l00625"></a>00625         <span class="keywordflow">if</span> (overlaps[j][i] &gt; 0) { 
<a name="l00626"></a>00626           idx = j;
<a name="l00627"></a>00627           <span class="keywordflow">break</span>;
<a name="l00628"></a>00628         }
<a name="l00629"></a>00629       <span class="keywordflow">if</span> (numOldOverlaps[idx] == 1) {<span class="comment">// this feature just continues</span>
<a name="l00630"></a>00630         rc = <a class="code" href="group__Features.html#g220cb310cac947b11ed0a74a975d0a5b" title="Continues a feature.">fc_featureGroup_continueFeature</a>(group, temp_existsIDs[idx],
<a name="l00631"></a>00631                               stepIndex, roi);
<a name="l00632"></a>00632         <span class="keywordflow">if</span>(rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00633"></a>00633           <span class="keywordflow">return</span> rc;                          
<a name="l00634"></a>00634       }
<a name="l00635"></a>00635       <span class="keywordflow">else</span> { <span class="comment">// parent has split and this segment is a child</span>
<a name="l00636"></a>00636         rc = <a class="code" href="group__Features.html#g256c40743a05f082881e0f022b04d80a" title="Creates a new feature in the feature group.">fc_featureGroup_newFeature</a>(group, stepIndex, roi, &amp;<span class="keywordtype">id</span>);
<a name="l00637"></a>00637         <span class="keywordflow">if</span>(rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00638"></a>00638           <span class="keywordflow">return</span> rc;
<a name="l00639"></a>00639         rc = <a class="code" href="group__Features.html#g8f5767daeb13b886b30b56760bea8b09" title="Create a Parent/Child Relationship in the feature Group.">fc_featureGroup_setParentChildPair</a>(group, temp_existsIDs[idx],
<a name="l00640"></a>00640                               <span class="keywordtype">id</span>);
<a name="l00641"></a>00641         <span class="keywordflow">if</span>(rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00642"></a>00642           <span class="keywordflow">return</span> rc;
<a name="l00643"></a>00643       }
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645     
<a name="l00646"></a>00646     <span class="comment">// if there are more than one overlaps, it's a merge product</span>
<a name="l00647"></a>00647     <span class="keywordflow">else</span> { 
<a name="l00648"></a>00648       <span class="comment">// make a new feature and then add as child to previous features</span>
<a name="l00649"></a>00649       rc = <a class="code" href="group__Features.html#g256c40743a05f082881e0f022b04d80a" title="Creates a new feature in the feature group.">fc_featureGroup_newFeature</a>(group, stepIndex, roi, &amp;<span class="keywordtype">id</span>);
<a name="l00650"></a>00650       <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00651"></a>00651         <span class="keywordflow">return</span> rc;
<a name="l00652"></a>00652       <span class="keywordflow">for</span> (j = 0; j &lt; temp_numExist; j++) 
<a name="l00653"></a>00653         <span class="keywordflow">if</span> (overlaps[j][i] &gt; 0) {
<a name="l00654"></a>00654           idx = (temp_existsIDs)[j];
<a name="l00655"></a>00655           rc = <a class="code" href="group__Features.html#g8f5767daeb13b886b30b56760bea8b09" title="Create a Parent/Child Relationship in the feature Group.">fc_featureGroup_setParentChildPair</a>(group, idx, <span class="keywordtype">id</span>);
<a name="l00656"></a>00656           <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00657"></a>00657             <span class="keywordflow">return</span> rc;
<a name="l00658"></a>00658         }
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660   }
<a name="l00661"></a>00661 
<a name="l00662"></a>00662   <span class="comment">// cleanup</span>
<a name="l00663"></a>00663   free(temp_existsIDs);
<a name="l00664"></a>00664   free(numOldOverlaps);
<a name="l00665"></a>00665   free(numNewOverlaps);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l00668"></a>00668 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="gedc41c37ec48c65a6721ba882f95527d"></a><!-- doxytag: member="track.c::fc_computeNumOverlapScore" ref="gedc41c37ec48c65a6721ba882f95527d" args="(int numPrev, FC_Subset *prevLists, int numNew, FC_Subset *newLists, double ***scores_p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_computeNumOverlapScore           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numPrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Subset.html">FC_Subset</a> *&nbsp;</td>
          <td class="paramname"> <em>prevLists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numNew</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Subset.html">FC_Subset</a> *&nbsp;</td>
          <td class="paramname"> <em>newLists</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double ***&nbsp;</td>
          <td class="paramname"> <em>scores_p</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Compute Score Matrix based on overlapping entities. 
<p>
<b>Description:</b> <p>
Given a list of previous ROIs and a list of new ROIs, this routine computes the score matrix used to decide which ROIs belong in the same features. This default routine computes the scores as the number of mesh entities (e.g. vertices, elements) that the ROIs have in common. It requires that mesh entity IDs do not change between the steps (i.e. static topology).<p>
The caller is responsible for freeing the dynamically allocated matrix.<p>
Note that if numPrev or numNew are 0, no matrix will be generated.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000104">Todo:</a></b></dt><dd>Should we enforce matching of entity types?</dd></dl>
<b>Modifications:</b> <ul>
<li>APR-14-2003 W Koegler Documented </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numPrev</em>&nbsp;</td><td>
input - number of segments in previous step </td></tr>
<tr><td valign="top"><em>prevLists</em>&nbsp;</td><td>
input - previous ROIs </td></tr>
<tr><td valign="top"><em>numNew</em>&nbsp;</td><td>
input - number of segments in new step </td></tr>
<tr><td valign="top"><em>newLists</em>&nbsp;</td><td>
input - new ROIs </td></tr>
<tr><td valign="top"><em>scores_p</em>&nbsp;</td><td>
output - pointer to a numPrev x numNew matrix </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="track_8c-source.html#l00351">351</a> of file <a class="el" href="track_8c-source.html">track.c</a>.</p>

<p>References <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="subset_8c-source.html#l03001">fc_getSubsetMembersAsArray()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, and <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="custom_8c-source.html#l00131">fc_computeBestMatchNumOverlapScore()</a>, and <a class="el" href="track_8c-source.html#l00192">fc_trackStep_custom()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00357"></a>00357   {
<a name="l00358"></a>00358   <span class="comment">// assumes unchanging geometry &amp; sorted arrays</span>
<a name="l00359"></a>00359   <span class="comment">// returns number of entities in common</span>
<a name="l00360"></a>00360   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc; 
<a name="l00361"></a>00361   <span class="keywordtype">int</span> i, j;
<a name="l00362"></a>00362   <span class="keywordtype">double</span> **scores;
<a name="l00363"></a>00363   <span class="keywordtype">int</span>* arrayA, numA, A;
<a name="l00364"></a>00364   <span class="keywordtype">int</span>* arrayB, numB, B;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   <span class="comment">// default return</span>
<a name="l00367"></a>00367   <span class="keywordflow">if</span> (scores_p)
<a name="l00368"></a>00368     *scores_p = NULL;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   <span class="comment">// check input</span>
<a name="l00371"></a>00371   <span class="keywordflow">if</span> (numPrev &lt; 0 || (numPrev &gt; 0 &amp;&amp; ! prevLists) || numNew &lt; 0 ||
<a name="l00372"></a>00372       (numNew &gt; 0 &amp;&amp; !newLists) || !scores_p)  {
<a name="l00373"></a>00373     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l00374"></a>00374     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00375"></a>00375   }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377   <span class="comment">// log message</span>
<a name="l00378"></a>00378   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Computing Score Matrix."</span>);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   <span class="comment">// early return if no overlaps to compute</span>
<a name="l00381"></a>00381   <span class="keywordflow">if</span> (numPrev == 0 || numNew == 0) 
<a name="l00382"></a>00382     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384   <span class="comment">// create space for the overlap array</span>
<a name="l00385"></a>00385   scores = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>*)*numPrev);
<a name="l00386"></a>00386   <span class="keywordflow">if</span> (scores == NULL) {
<a name="l00387"></a>00387     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l00388"></a>00388     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l00389"></a>00389   }
<a name="l00390"></a>00390   <span class="keywordflow">for</span> (i = 0; i &lt; numPrev; i++) {
<a name="l00391"></a>00391     scores[i] = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*numNew);
<a name="l00392"></a>00392     <span class="keywordflow">if</span> (scores[i] == NULL) {
<a name="l00393"></a>00393       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l00394"></a>00394       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l00395"></a>00395     }
<a name="l00396"></a>00396   }
<a name="l00397"></a>00397   <span class="comment">// for each combination of old and new, compute score</span>
<a name="l00398"></a>00398   <span class="keywordflow">for</span> (i = 0; i &lt; numPrev; i++) {
<a name="l00399"></a>00399     <span class="keywordflow">for</span> (j = 0; j &lt; numNew; j++) {
<a name="l00400"></a>00400       <span class="comment">// walk through both lists at same time:</span>
<a name="l00401"></a>00401       <span class="comment">// if id's match, increment overlap entry &amp; advance both lists</span>
<a name="l00402"></a>00402       <span class="comment">// else if old's id is less than new's, advance the old list</span>
<a name="l00403"></a>00403       <span class="comment">// else advance the new list</span>
<a name="l00404"></a>00404       scores[i][j] = 0;
<a name="l00405"></a>00405       rc = <a class="code" href="group__Subset.html#g6cebfda6e20e2a518636838b170185da" title="Get a copy of subset members as array.">fc_getSubsetMembersAsArray</a>(prevLists[i], &amp;numA, &amp;arrayA);
<a name="l00406"></a>00406       <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00407"></a>00407         <span class="keywordflow">return</span> rc;
<a name="l00408"></a>00408       rc = <a class="code" href="group__Subset.html#g6cebfda6e20e2a518636838b170185da" title="Get a copy of subset members as array.">fc_getSubsetMembersAsArray</a>(newLists[j], &amp;numB, &amp;arrayB);
<a name="l00409"></a>00409       <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00410"></a>00410         <span class="keywordflow">return</span> rc;
<a name="l00411"></a>00411       A = 0; B = 0;
<a name="l00412"></a>00412       <span class="keywordflow">while</span> (A &lt; numA &amp;&amp; B &lt; numB) { <span class="comment">// when hit end of either list</span>
<a name="l00413"></a>00413         <span class="keywordflow">if</span> (arrayA[A] &lt; arrayB[B])
<a name="l00414"></a>00414           A++;
<a name="l00415"></a>00415         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arrayA[A] &gt; arrayB[B])
<a name="l00416"></a>00416           B++; 
<a name="l00417"></a>00417      <span class="keywordflow">else</span> { <span class="comment">// equal</span>
<a name="l00418"></a>00418           scores[i][j]++;
<a name="l00419"></a>00419           A++;
<a name="l00420"></a>00420           B++;
<a name="l00421"></a>00421         }
<a name="l00422"></a>00422      }
<a name="l00423"></a>00423       free(arrayA);
<a name="l00424"></a>00424       free(arrayB);
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426   }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428   *scores_p = scores;
<a name="l00429"></a>00429   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l00430"></a>00430 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="g3b60af2aec06d612f80ba68b5948dc97"></a><!-- doxytag: member="track.c::fc_computeSimpleCorrespond" ref="g3b60af2aec06d612f80ba68b5948dc97" args="(int numPrev, int numNew, double **scores, int ***matrix_p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_computeSimpleCorrespond           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numPrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numNew</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double **&nbsp;</td>
          <td class="paramname"> <em>scores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int ***&nbsp;</td>
          <td class="paramname"> <em>matrix_p</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Compute correspondence matrix. 
<p>
<b>Description:</b> <p>
Given the score matrix, create the correspondence matrix which has the information for assigning ROIs to Features. This default implementation just rounds the score matrix values to ints using the C rint() function to do the rounding. Rint usually behaves so that values of exactly *.5 are rounded up when * is odd and rounded down when * is even. (Examples: 0.5 =&gt; 0, 1.5 =&gt; 2, -0.5 =&gt; 0, -1.5 =&gt; -2.)<p>
The caller is responsible for freeing the dynamically allocated matrix.<p>
Note that if numPrev or numNew are 0, no matrix will be generated.<p>
<b>Modifications:</b> <ul>
<li>APR-14-2003 W Koegler Documented </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numPrev</em>&nbsp;</td><td>
input - number of segments in previous step </td></tr>
<tr><td valign="top"><em>numNew</em>&nbsp;</td><td>
input - number of segments in new step </td></tr>
<tr><td valign="top"><em>scores</em>&nbsp;</td><td>
input - the score matrix, numPrev x numNew </td></tr>
<tr><td valign="top"><em>matrix_p</em>&nbsp;</td><td>
output - pointer to correspd. matrix, numPrev x numNew </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="track_8c-source.html#l00452">452</a> of file <a class="el" href="track_8c-source.html">track.c</a>.</p>

<p>References <a class="el" href="base_8h-source.html#l00105">FC_ERROR</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, and <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="track_8c-source.html#l00192">fc_trackStep_custom()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00457"></a>00457   {
<a name="l00458"></a>00458   <span class="keywordtype">int</span> i, j;
<a name="l00459"></a>00459 
<a name="l00460"></a>00460   <span class="comment">// default return</span>
<a name="l00461"></a>00461   <span class="keywordflow">if</span> (matrix_p)
<a name="l00462"></a>00462     *matrix_p = NULL;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464   <span class="comment">// check input</span>
<a name="l00465"></a>00465   <span class="keywordflow">if</span> (numPrev &lt; 0 || numNew &lt; 0 || (numPrev &gt; 0 &amp;&amp; numNew &gt; 0 &amp;&amp; !scores) ||
<a name="l00466"></a>00466       !matrix_p)  {
<a name="l00467"></a>00467       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l00468"></a>00468       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00469"></a>00469   }
<a name="l00470"></a>00470   <span class="keywordflow">if</span> (scores) {
<a name="l00471"></a>00471     <span class="keywordflow">for</span> (i = 0; i &lt; numPrev; i++) {
<a name="l00472"></a>00472       <span class="keywordflow">if</span> (!scores[i]) {
<a name="l00473"></a>00473      <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>)); 
<a name="l00474"></a>00474      <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>;
<a name="l00475"></a>00475       }
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477   }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479   <span class="comment">// log message</span>
<a name="l00480"></a>00480   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Computing correspondence matrix."</span>);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482   <span class="comment">// early return if no overlaps to compute</span>
<a name="l00483"></a>00483   <span class="keywordflow">if</span> (numPrev == 0 || numNew == 0) { 
<a name="l00484"></a>00484     *matrix_p = NULL;
<a name="l00485"></a>00485     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l00486"></a>00486   }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488   <span class="comment">// create space for the overlap array</span>
<a name="l00489"></a>00489   (*matrix_p) = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>*)*numPrev);
<a name="l00490"></a>00490   <span class="keywordflow">if</span> (*matrix_p == NULL) {
<a name="l00491"></a>00491     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l00492"></a>00492     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l00493"></a>00493   }
<a name="l00494"></a>00494   <span class="keywordflow">for</span> (i = 0; i &lt; numPrev; i++) {
<a name="l00495"></a>00495     (*matrix_p)[i] = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*numNew);
<a name="l00496"></a>00496     <span class="keywordflow">if</span> ( (*matrix_p)[i] == NULL) {
<a name="l00497"></a>00497       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>));
<a name="l00498"></a>00498       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l00499"></a>00499     }
<a name="l00500"></a>00500   }
<a name="l00501"></a>00501   <span class="comment">// for each entry, convert to an int</span>
<a name="l00502"></a>00502   <span class="keywordflow">for</span> (i = 0; i &lt; numPrev; i++) 
<a name="l00503"></a>00503     <span class="keywordflow">for</span> (j = 0; j &lt; numNew; j++) 
<a name="l00504"></a>00504       (*matrix_p)[i][j] = (int)rint(scores[i][j]);
<a name="l00505"></a>00505 
<a name="l00506"></a>00506   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l00507"></a>00507 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="g08c02218d20f51de88e41790306907e1"></a><!-- doxytag: member="track.c::fc_groupSelfCorrespond" ref="g08c02218d20f51de88e41790306907e1" args="(int num, int **corresponds, int *numGroup, int **numPerGroup, int ***idsPerGroup)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_groupSelfCorrespond           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&nbsp;</td>
          <td class="paramname"> <em>corresponds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>numGroup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&nbsp;</td>
          <td class="paramname"> <em>numPerGroup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int ***&nbsp;</td>
          <td class="paramname"> <em>idsPerGroup</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Group objects based on self-correspondance scores. 
<p>
<b>Description:</b> <p>
Given a self-correspondance matrix (= for N objects, an N X N matrix where non-zero entry E(i,j) indicates that objects i and j "correspond"), returns groups of entities that correspond.<p>
For example, if a matrix has only non-zero entries on the diagonal, N groups will be returned with 1 object per group. If all entries are non-zero, 1 group will be returned with all N objects.<p>
The caller is responsible for freeing the dynamically allocated returns: free(numPerGroup) and for (i=0; i&lt;numGroup; i++) { free(idsPerGroup[i]); } free(idsPerGroup).<p>
<b>Modifications:</b> <ul>
<li>2006/03/14 WSD Created</li><li>2008/05/05 CDU Updated to fixe memleak in new sorted lists </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>num</em>&nbsp;</td><td>
input - number of objects </td></tr>
<tr><td valign="top"><em>corresponds</em>&nbsp;</td><td>
input - the corresponds, num X num, only upper tri required (because it's symmetric) </td></tr>
<tr><td valign="top"><em>numGroup</em>&nbsp;</td><td>
output - the number of groups </td></tr>
<tr><td valign="top"><em>numPerGroup</em>&nbsp;</td><td>
output - the number of objects per group, caller is responsible for freeing </td></tr>
<tr><td valign="top"><em>idsPerGroup</em>&nbsp;</td><td>
output - array of ids of objects per group, caller is responsible for freeing </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="track_8c-source.html#l00692">692</a> of file <a class="el" href="track_8c-source.html">track.c</a>.</p>

<p>References <a class="el" href="storage_8c-source.html#l00441">fc_addIntArrayToSortedIntArray()</a>, <a class="el" href="storage_8c-source.html#l00397">fc_addIntToSortedIntArray()</a>, <a class="el" href="base_8h-source.html#l00105">FC_ERROR</a>, <a class="el" href="storage_8c-source.html#l00846">fc_freeSortedIntArray()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="storage_8c-source.html#l00095">fc_initSortedIntArray()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="base_8h-source.html#l00106">FC_MEMORY_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, <a class="el" href="storage_8h-source.html#l00099">FC_SortedIntArray::numVal</a>, and <a class="el" href="storage_8h-source.html#l00101">FC_SortedIntArray::vals</a>.</p>

<p>Referenced by <a class="el" href="tears_8c-source.html#l00922">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00701"></a>00701   {
<a name="l00702"></a>00702   <span class="keywordtype">int</span> i, j, k;
<a name="l00703"></a>00703   <span class="keywordtype">int</span> ret;
<a name="l00704"></a>00704   <span class="keywordtype">int</span>* parents, parentID, temp_num;
<a name="l00705"></a>00705   <a class="code" href="structFC__SortedIntArray.html" title="Sorted, exclusive, self-exanding int array.">FC_SortedIntArray</a>* lists;
<a name="l00706"></a>00706 
<a name="l00707"></a>00707   <span class="comment">// default return</span>
<a name="l00708"></a>00708   <span class="keywordflow">if</span> (numGroup)
<a name="l00709"></a>00709     *numGroup = -1;
<a name="l00710"></a>00710   <span class="keywordflow">if</span> (numPerGroup)
<a name="l00711"></a>00711     *numPerGroup = NULL;
<a name="l00712"></a>00712   <span class="keywordflow">if</span> (idsPerGroup)
<a name="l00713"></a>00713     *idsPerGroup = NULL;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715   <span class="comment">// check input</span>
<a name="l00716"></a>00716   <span class="keywordflow">if</span> (num &lt; 1 || !corresponds || !numGroup || !numPerGroup || !idsPerGroup)  {
<a name="l00717"></a>00717       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l00718"></a>00718       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00719"></a>00719   }
<a name="l00720"></a>00720   <span class="keywordflow">for</span> (i = 0; i &lt; num; i++) {
<a name="l00721"></a>00721     <span class="keywordflow">if</span> (!corresponds[i]) {
<a name="l00722"></a>00722       <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>)); 
<a name="l00723"></a>00723       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>;
<a name="l00724"></a>00724     }
<a name="l00725"></a>00725   }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727   <span class="comment">// log message</span>
<a name="l00728"></a>00728   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Grouping using self corresponds."</span>);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730   <span class="comment">// initialize data structures</span>
<a name="l00731"></a>00731   parents = (<span class="keywordtype">int</span>*)malloc(num*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00732"></a>00732   lists = (<a class="code" href="structFC__SortedIntArray.html" title="Sorted, exclusive, self-exanding int array.">FC_SortedIntArray</a>*)malloc(num*<span class="keyword">sizeof</span>(<a class="code" href="structFC__SortedIntArray.html" title="Sorted, exclusive, self-exanding int array.">FC_SortedIntArray</a>));
<a name="l00733"></a>00733   <span class="keywordflow">if</span> (!parents || !lists) {
<a name="l00734"></a>00734     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>)); 
<a name="l00735"></a>00735     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l00736"></a>00736   }
<a name="l00737"></a>00737   <span class="keywordflow">for</span> (i = 0; i &lt; num; i++) {
<a name="l00738"></a>00738     parents[i] = -1; <span class="comment">// means "none"</span>
<a name="l00739"></a>00739     <a class="code" href="group__SimpleDataObjects.html#g2a977bec6f7ae75297a4dcf7ec079bb7" title="Initialize a sorted int array.">fc_initSortedIntArray</a>(&amp;lists[i]);
<a name="l00740"></a>00740   }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742   <span class="comment">// do it - keep track of ultimate "parent" for each obj</span>
<a name="l00743"></a>00743   <span class="comment">//         accumulate groups in list on ultimate parents</span>
<a name="l00744"></a>00744   <span class="keywordflow">for</span> (i = 0; i &lt; num; i++) {
<a name="l00745"></a>00745     <span class="comment">// process diagonal entry (assumed to be nonzero)</span>
<a name="l00746"></a>00746     parentID = parents[i];
<a name="l00747"></a>00747     <span class="keywordflow">if</span> (parentID &lt; 0) {
<a name="l00748"></a>00748       parentID = i;
<a name="l00749"></a>00749       ret = <a class="code" href="group__SimpleDataObjects.html#gb73f9478dbfb63fadf5e93f8bdfe8c42" title="Add an int to a sorted int array.">fc_addIntToSortedIntArray</a>(&amp;lists[parentID], i);
<a name="l00750"></a>00750       <span class="keywordflow">if</span> (ret &lt; <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00751"></a>00751      <span class="keywordflow">return</span> ret;
<a name="l00752"></a>00752     }
<a name="l00753"></a>00753     <span class="comment">// process the rest of entries on this row</span>
<a name="l00754"></a>00754     <span class="keywordflow">for</span> (j = i+1; j &lt; num; j++) {
<a name="l00755"></a>00755       <span class="keywordflow">if</span> (corresponds[i][j] &gt; 0) { <span class="comment">// only process non-zero entries</span>
<a name="l00756"></a>00756      <span class="keywordflow">if</span> (parents[j] == -1) {
<a name="l00757"></a>00757        <span class="comment">// add j to current parent's list</span>
<a name="l00758"></a>00758        parents[j] = parentID;
<a name="l00759"></a>00759        ret = <a class="code" href="group__SimpleDataObjects.html#gb73f9478dbfb63fadf5e93f8bdfe8c42" title="Add an int to a sorted int array.">fc_addIntToSortedIntArray</a>(&amp;lists[parentID], j);
<a name="l00760"></a>00760        <span class="keywordflow">if</span> (ret &lt; <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00761"></a>00761          <span class="keywordflow">return</span> ret;
<a name="l00762"></a>00762      }
<a name="l00763"></a>00763      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parents[j] &gt; parentID) {  
<a name="l00764"></a>00764        <span class="comment">// move j's parent's list into current parent's list</span>
<a name="l00765"></a>00765        <span class="keywordtype">int</span> tempParent = parents[j];
<a name="l00766"></a>00766        <span class="keywordflow">for</span> (k = 0; k &lt; lists[tempParent].<a class="code" href="structFC__SortedIntArray.html#41c02abac0e388a077675863f16c325f">numVal</a>; k++)
<a name="l00767"></a>00767          parents[lists[tempParent].vals[k]] = parentID;
<a name="l00768"></a>00768        <a class="code" href="group__SimpleDataObjects.html#gf842f060b1f39a0acfc54421bbe0865a" title="Add an array of ints to a sorted int array.">fc_addIntArrayToSortedIntArray</a>(&amp;lists[parentID], 
<a name="l00769"></a>00769                           lists[tempParent].numVal,
<a name="l00770"></a>00770                           lists[tempParent].vals, 1);
<a name="l00771"></a>00771        <a class="code" href="group__SimpleDataObjects.html#g20daa2fb7f38e75da823116f5c41a579" title="Free the sorted int array&amp;#39;s values.">fc_freeSortedIntArray</a>(&amp;lists[tempParent]);
<a name="l00772"></a>00772      }
<a name="l00773"></a>00773      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parents[j] &lt; parentID) {
<a name="l00774"></a>00774        <span class="comment">// move current parent's list to j's parent's list</span>
<a name="l00775"></a>00775        <span class="keywordtype">int</span> tempParent = parentID;
<a name="l00776"></a>00776        parentID = parents[j];
<a name="l00777"></a>00777        <span class="keywordflow">for</span> (k = 0; k &lt; lists[tempParent].<a class="code" href="structFC__SortedIntArray.html#41c02abac0e388a077675863f16c325f">numVal</a>; k++)
<a name="l00778"></a>00778          parents[lists[tempParent].vals[k]] = parentID;
<a name="l00779"></a>00779        <a class="code" href="group__SimpleDataObjects.html#gf842f060b1f39a0acfc54421bbe0865a" title="Add an array of ints to a sorted int array.">fc_addIntArrayToSortedIntArray</a>(&amp;lists[tempParent],
<a name="l00780"></a>00780                           lists[parentID].numVal,
<a name="l00781"></a>00781                           lists[parentID].vals, 1);
<a name="l00782"></a>00782        <a class="code" href="group__SimpleDataObjects.html#g20daa2fb7f38e75da823116f5c41a579" title="Free the sorted int array&amp;#39;s values.">fc_freeSortedIntArray</a>(&amp;lists[parentID]);
<a name="l00783"></a>00783      }
<a name="l00784"></a>00784      <span class="comment">// if parents[j] == parentID, j already in list, do nothing</span>
<a name="l00785"></a>00785       }
<a name="l00786"></a>00786     }
<a name="l00787"></a>00787   }
<a name="l00788"></a>00788   free(parents);
<a name="l00789"></a>00789 
<a name="l00790"></a>00790   <span class="comment">// count groups</span>
<a name="l00791"></a>00791   temp_num = 0;
<a name="l00792"></a>00792   <span class="keywordflow">for</span> (i = 0; i &lt; num; i++) {
<a name="l00793"></a>00793     <span class="keywordflow">if</span> (lists[i].numVal &gt; 0)
<a name="l00794"></a>00794       temp_num++;
<a name="l00795"></a>00795   }
<a name="l00796"></a>00796 
<a name="l00797"></a>00797   <span class="comment">// Convert group lists to arrays</span>
<a name="l00798"></a>00798   *numGroup = temp_num;
<a name="l00799"></a>00799   *numPerGroup = (<span class="keywordtype">int</span>*)malloc(temp_num*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00800"></a>00800   *idsPerGroup = (<span class="keywordtype">int</span>**)malloc(temp_num*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>*));
<a name="l00801"></a>00801   <span class="keywordflow">if</span> (!(*numPerGroup) || !(*idsPerGroup)) {
<a name="l00802"></a>00802     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>)); 
<a name="l00803"></a>00803     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4db79475c8e6c2fcf3e4e7979a4139658">FC_MEMORY_ERROR</a>;
<a name="l00804"></a>00804   }
<a name="l00805"></a>00805   temp_num = 0;
<a name="l00806"></a>00806   <span class="keywordflow">for</span> (i = 0; i &lt; num; i++) {
<a name="l00807"></a>00807     <span class="keywordflow">if</span> (lists[i].numVal &gt; 0) {
<a name="l00808"></a>00808       (*numPerGroup)[temp_num] = lists[i].<a class="code" href="structFC__SortedIntArray.html#41c02abac0e388a077675863f16c325f">numVal</a>;
<a name="l00809"></a>00809       (*idsPerGroup)[temp_num] = lists[i].<a class="code" href="structFC__SortedIntArray.html#fa5b781371ed7570eeecaac539f10426">vals</a>;
<a name="l00810"></a>00810       free(lists[i].tickets); <span class="comment">//not used</span>
<a name="l00811"></a>00811       temp_num++;
<a name="l00812"></a>00812     }
<a name="l00813"></a>00813   }
<a name="l00814"></a>00814   <span class="comment">// don't have to free individual lists 'cause they are passed off</span>
<a name="l00815"></a>00815   free(lists);
<a name="l00816"></a>00816 
<a name="l00817"></a>00817   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l00818"></a>00818 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="g993f13a1cdda004e273ddd21f8877cad"></a><!-- doxytag: member="track.c::fc_trackAllSteps" ref="g993f13a1cdda004e273ddd21f8877cad" args="(int numStep, int *numSegments, FC_Subset **segments, FC_FeatureGroup *group)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_trackAllSteps           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>numSegments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Subset.html">FC_Subset</a> **&nbsp;</td>
          <td class="paramname"> <em>segments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *&nbsp;</td>
          <td class="paramname"> <em>group</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Track and create features. 
<p>
<b>Description:</b> <p>
Given the ROIs in each step over a number of steps, this function tracks the ROIs and creates features which are stored in the feature group.<p>
<b>Modifications:</b> <ul>
<li>APR-14-2003 W Koegler Documented </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - the number of steps </td></tr>
<tr><td valign="top"><em>numSegments</em>&nbsp;</td><td>
input - array of number of segments per step </td></tr>
<tr><td valign="top"><em>segments</em>&nbsp;</td><td>
input - array of arrays of segments per step </td></tr>
<tr><td valign="top"><em>group</em>&nbsp;</td><td>
input - feature group to store results </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="track_8c-source.html#l00159">159</a> of file <a class="el" href="track_8c-source.html">track.c</a>.</p>

<p>References <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, and <a class="el" href="track_8c-source.html#l00288">fc_trackAllSteps_custom()</a>.</p>

<p>Referenced by <a class="el" href="ex1__intro_8c-source.html#l00069">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00164"></a>00164   {
<a name="l00165"></a>00165 
<a name="l00166"></a>00166   <span class="comment">// log message</span>
<a name="l00167"></a>00167   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Tracking and creating features."</span>); 
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   <span class="keywordflow">return</span> <a class="code" href="group__FeatureTracking.html#g5d25de71a86bcf980aa5027f46976950" title="Track and create features using custom tracking.">fc_trackAllSteps_custom</a>(numStep, numSegments, segments, group, 
<a name="l00170"></a>00170                      NULL, NULL, NULL);
<a name="l00171"></a>00171 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="g5d25de71a86bcf980aa5027f46976950"></a><!-- doxytag: member="track.c::fc_trackAllSteps_custom" ref="g5d25de71a86bcf980aa5027f46976950" args="(int numStep, int *numSegments, FC_Subset **segments, FC_FeatureGroup *group, int compute_scores(int, FC_Subset *, int, FC_Subset *, double ***), int compute_correspondence(int, int, double **, int ***), int add_rois_to_features(int, int, int, FC_Subset *, int **, FC_FeatureGroup *))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_trackAllSteps_custom           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>numSegments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Subset.html">FC_Subset</a> **&nbsp;</td>
          <td class="paramname"> <em>segments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *&nbsp;</td>
          <td class="paramname"> <em>group</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &nbsp;</td>
          <td class="paramname"> <em>compute_scores</em>int, FC_Subset *, int, FC_Subset *, double ***, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &nbsp;</td>
          <td class="paramname"> <em>compute_correspondence</em>int, int, double **, int ***, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &nbsp;</td>
          <td class="paramname"> <em>add_rois_to_features</em>int, int, int, FC_Subset *, int **, FC_FeatureGroup *</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Track and create features using custom tracking. 
<p>
<b>Description:</b> <p>
This routine is a customizable version of fc_track(). The use can specify a function for each of the three steps of tracking<ol type=1>
<li>compute score matrix;</li><li>compute correspondence matrix; and</li><li>Assign ROIs to features.</li></ol>
<p>
A NULL value indicates that the default implementation should be used for that step.<p>
<b>Modifications:</b> <ul>
<li>APR-14-2003 W Koegler Documented </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>numStep</em>&nbsp;</td><td>
input - the number of steps </td></tr>
<tr><td valign="top"><em>numSegments</em>&nbsp;</td><td>
input - array of number of segments per step </td></tr>
<tr><td valign="top"><em>segments</em>&nbsp;</td><td>
input - numStep arrays of segments </td></tr>
<tr><td valign="top"><em>group</em>&nbsp;</td><td>
input - feature group to store results </td></tr>
<tr><td valign="top"><em>compute_scores</em>&nbsp;</td><td>
input - user provided routine for computing the overlap table. If NULL is passed, will use the default routine </td></tr>
<tr><td valign="top"><em>compute_correspondence</em>&nbsp;</td><td>
input - user provided routine for computing the correspondence matrix. If NULL is passed, will use the default routine </td></tr>
<tr><td valign="top"><em>add_rois_to_features</em>&nbsp;</td><td>
input - user proved routine for assigning features based on correspondence matrix. If NULL is passed, will use the default routine </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="track_8c-source.html#l00288">288</a> of file <a class="el" href="track_8c-source.html">track.c</a>.</p>

<p>References <a class="el" href="base_8h-source.html#l00105">FC_ERROR</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>, and <a class="el" href="track_8c-source.html#l00192">fc_trackStep_custom()</a>.</p>

<p>Referenced by <a class="el" href="track_8c-source.html#l00159">fc_trackAllSteps()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00303"></a>00303   {
<a name="l00304"></a>00304 
<a name="l00305"></a>00305   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l00306"></a>00306   <span class="keywordtype">int</span> i;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   <span class="comment">// check input FIX add</span>
<a name="l00309"></a>00309   <span class="keywordflow">if</span> (numStep &lt; 1 || numSegments == NULL || segments == NULL || group == NULL) {
<a name="l00310"></a>00310     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l00311"></a>00311     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>;
<a name="l00312"></a>00312   }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314   <span class="comment">// log message</span>
<a name="l00315"></a>00315   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Tracking and creating features using custom tracking."</span>);
<a name="l00316"></a>00316 
<a name="l00317"></a>00317   <span class="comment">// add the steps</span>
<a name="l00318"></a>00318   <span class="keywordflow">for</span> (i = 0; i &lt; numStep; i++) {
<a name="l00319"></a>00319     rc = <a class="code" href="group__FeatureTracking.html#gb0b8fee77a0c96b02d231fab299c4475" title="Track and create features for a new step using custom tracking.">fc_trackStep_custom</a>(i, numSegments[i], segments[i], group, 
<a name="l00320"></a>00320                     compute_scores, compute_correspondence, 
<a name="l00321"></a>00321                     add_rois_to_features);
<a name="l00322"></a>00322     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>)
<a name="l00323"></a>00323       <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce4dfe7727a339a5a362cd2b90d81aeef76">FC_ERROR</a>;
<a name="l00324"></a>00324   }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326   <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>;
<a name="l00327"></a>00327 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="g82fa54eee1ede57d2481b95732955c5d"></a><!-- doxytag: member="track.c::fc_trackStep" ref="g82fa54eee1ede57d2481b95732955c5d" args="(int stepIndex, int numNew, FC_Subset *newSegments, FC_FeatureGroup *group)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_trackStep           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stepIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numNew</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Subset.html">FC_Subset</a> *&nbsp;</td>
          <td class="paramname"> <em>newSegments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *&nbsp;</td>
          <td class="paramname"> <em>group</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Track and create features for a new step. 
<p>
<b>Description:</b> <p>
For a specific step, track and add the new ROIs to the feature group.<p>
<b>Modifications:</b> <ul>
<li>APR-14-2003 W Koegler Documented </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>stepIndex</em>&nbsp;</td><td>
input - the index of the step </td></tr>
<tr><td valign="top"><em>numNew</em>&nbsp;</td><td>
input - the number of new segments </td></tr>
<tr><td valign="top"><em>newSegments</em>&nbsp;</td><td>
input - the new segments to be added </td></tr>
<tr><td valign="top"><em>group</em>&nbsp;</td><td>
input - feature group to store results </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="track_8c-source.html#l00132">132</a> of file <a class="el" href="track_8c-source.html">track.c</a>.</p>

<p>References <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, and <a class="el" href="track_8c-source.html#l00192">fc_trackStep_custom()</a>.</p>

<p>Referenced by <a class="el" href="ex3__createCharactrztn_8c-source.html#l00219">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00138"></a>00138 {
<a name="l00139"></a>00139      
<a name="l00140"></a>00140   <span class="comment">// log message</span>
<a name="l00141"></a>00141   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Tracking and creating features for a new step."</span>);
<a name="l00142"></a>00142      
<a name="l00143"></a>00143   <span class="keywordflow">return</span> <a class="code" href="group__FeatureTracking.html#gb0b8fee77a0c96b02d231fab299c4475" title="Track and create features for a new step using custom tracking.">fc_trackStep_custom</a>(stepIndex, numNew, newSegments, group, NULL, NULL,
<a name="l00144"></a>00144                     NULL);
<a name="l00145"></a>00145 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="gb0b8fee77a0c96b02d231fab299c4475"></a><!-- doxytag: member="track.c::fc_trackStep_custom" ref="gb0b8fee77a0c96b02d231fab299c4475" args="(int stepIndex, int numNew, FC_Subset *newSegments, FC_FeatureGroup *group, int compute_scores(int, FC_Subset *, int, FC_Subset *, double ***), int compute_correspondence(int, int, double **, int ***), int add_rois_to_features(int, int, int, FC_Subset *, int **, FC_FeatureGroup *))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4">FC_ReturnCode</a> fc_trackStep_custom           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stepIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numNew</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__Subset.html">FC_Subset</a> *&nbsp;</td>
          <td class="paramname"> <em>newSegments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFC__FeatureGroup.html">FC_FeatureGroup</a> *&nbsp;</td>
          <td class="paramname"> <em>group</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &nbsp;</td>
          <td class="paramname"> <em>compute_scores</em>int, FC_Subset *, int, FC_Subset *, double ***, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &nbsp;</td>
          <td class="paramname"> <em>compute_correspondence</em>int, int, double **, int ***, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &nbsp;</td>
          <td class="paramname"> <em>add_rois_to_features</em>int, int, int, FC_Subset *, int **, FC_FeatureGroup *</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Track and create features for a new step using custom tracking. 
<p>
<b>Description:</b> <p>
This routine is a customizable version of fc_track_add_step(). The use can specify a function for each of the three steps of tracking<ol type=1>
<li>compute score matrix;</li><li>compute correspondence matrix; and</li><li>Assign ROIs to features.</li></ol>
<p>
A NULL value indicates that the default implementation should be used for that step.<p>
<b>Modifications:</b> <ul>
<li>APR-14-2003 W Koegler Documented </li></ul>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>stepIndex</em>&nbsp;</td><td>
input - the index of the step </td></tr>
<tr><td valign="top"><em>numNew</em>&nbsp;</td><td>
input - the number of new segments </td></tr>
<tr><td valign="top"><em>newSegments</em>&nbsp;</td><td>
input - the new segments to be added </td></tr>
<tr><td valign="top"><em>group</em>&nbsp;</td><td>
input - feature group to store results </td></tr>
<tr><td valign="top"><em>compute_scores</em>&nbsp;</td><td>
input - user provided routine for computing the overlap table. If NULL is passed, will use the default routine </td></tr>
<tr><td valign="top"><em>compute_correspondence</em>&nbsp;</td><td>
input - user provided routine for computing the correspondence matrix. If NULL is passed, will use the default routine </td></tr>
<tr><td valign="top"><em>add_rois_to_features</em>&nbsp;</td><td>
input - user proved routine for assigning features based on correspondence matrix. If NULL is passed, will use the default routine </td></tr>
</table>
</dl>
<p>Definition at line <a class="el" href="track_8c-source.html#l00192">192</a> of file <a class="el" href="track_8c-source.html">track.c</a>.</p>

<p>References <a class="el" href="track_8c-source.html#l00863">_fc_freeDoubleMatrix()</a>, <a class="el" href="track_8c-source.html#l00833">_fc_freeIntMatrix()</a>, <a class="el" href="track_8c-source.html#l00523">fc_addROIsUsingBasicEvents()</a>, <a class="el" href="track_8c-source.html#l00351">fc_computeNumOverlapScore()</a>, <a class="el" href="track_8c-source.html#l00452">fc_computeSimpleCorrespond()</a>, <a class="el" href="feature_8c-source.html#l00644">fc_featureGroup_getROIsInStep()</a>, <a class="el" href="base_8c-source.html#l00355">fc_getReturnCodeText()</a>, <a class="el" href="base_8h-source.html#l00107">FC_INPUT_ERROR</a>, <a class="el" href="library_8h-source.html#l00120">fc_printfErrorMessage</a>, <a class="el" href="library_8h-source.html#l00188">fc_printfLogMessage</a>, and <a class="el" href="base_8h-source.html#l00104">FC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="track_8c-source.html#l00288">fc_trackAllSteps_custom()</a>, and <a class="el" href="track_8c-source.html#l00132">fc_trackStep()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00208"></a>00208 {
<a name="l00209"></a>00209   <a class="code" href="group__DataTypes.html#g2a40aa471d085988d5b582669f766ce4" title="Possible function return values.">FC_ReturnCode</a> rc;
<a name="l00210"></a>00210   <span class="keywordtype">int</span> numPrev;
<a name="l00211"></a>00211   <span class="keywordtype">double</span> **overlaps;
<a name="l00212"></a>00212   <span class="keywordtype">int</span> **matrix;
<a name="l00213"></a>00213   <a class="code" href="structFC__Subset.html" title="Subset Handle.">FC_Subset</a> *prevSegments;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215   <span class="comment">// check input</span>
<a name="l00216"></a>00216   <span class="keywordflow">if</span> (stepIndex &lt; 0 || numNew &lt; 0 || (numNew &gt; 0 &amp;&amp; !newSegments) || !group) {
<a name="l00217"></a>00217     <a class="code" href="group__Library.html#g1473e77471cd1319f76eb9a32e4ad91f" title="Print an error message to stderr.">fc_printfErrorMessage</a>(<span class="stringliteral">"%s"</span>, <a class="code" href="group__DataTypes.html#g510d74cc1e13d4cdc5bde247a25d48e4" title="Return the name of the FC_ReturnCode&amp;#39;s value.">fc_getReturnCodeText</a>(<a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>));
<a name="l00218"></a>00218     <span class="keywordflow">return</span> <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce464a3d55131c355cdf036f95d0d7e1a6e">FC_INPUT_ERROR</a>;
<a name="l00219"></a>00219   }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221   <span class="comment">// log message</span>
<a name="l00222"></a>00222   <a class="code" href="group__Library.html#g7e9664a8765cc08c313df880421c496b" title="Print a log message to stdout.">fc_printfLogMessage</a>(<span class="stringliteral">"Tracking and creating features for a new step "</span>
<a name="l00223"></a>00223                 <span class="stringliteral">"using custom tracking routines."</span>);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225   <span class="comment">// assign any default routines</span>
<a name="l00226"></a>00226   <span class="keywordflow">if</span> (compute_scores == NULL)
<a name="l00227"></a>00227     compute_scores = &amp;<a class="code" href="group__FeatureTracking.html#gedc41c37ec48c65a6721ba882f95527d" title="Compute Score Matrix based on overlapping entities.">fc_computeNumOverlapScore</a>;
<a name="l00228"></a>00228   <span class="keywordflow">if</span> (compute_correspondence == NULL)
<a name="l00229"></a>00229     compute_correspondence = &amp;<a class="code" href="group__FeatureTracking.html#g3b60af2aec06d612f80ba68b5948dc97" title="Compute correspondence matrix.">fc_computeSimpleCorrespond</a>;
<a name="l00230"></a>00230   <span class="keywordflow">if</span> (add_rois_to_features == NULL)
<a name="l00231"></a>00231     add_rois_to_features = &amp;<a class="code" href="group__FeatureTracking.html#g295b5d86ccd81ddb4994bc9c51188687" title="Add ROIs to the features in a Feature Group.">fc_addROIsUsingBasicEvents</a>;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233   <span class="comment">// Get the previous step's ROIs</span>
<a name="l00234"></a>00234   <span class="keywordflow">if</span> (stepIndex == 0) {
<a name="l00235"></a>00235     numPrev = 0;
<a name="l00236"></a>00236     prevSegments = NULL;
<a name="l00237"></a>00237   }
<a name="l00238"></a>00238   <span class="keywordflow">else</span> {
<a name="l00239"></a>00239     rc = <a class="code" href="group__Features.html#g181d61fe6bbd169fc2ca4d80d79623a6" title="Get the ROIs in a step from the Feature Group.">fc_featureGroup_getROIsInStep</a>(group, stepIndex-1, &amp;numPrev,
<a name="l00240"></a>00240                            &amp;prevSegments);
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) 
<a name="l00242"></a>00242       <span class="keywordflow">return</span> rc;
<a name="l00243"></a>00243   }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245   <span class="comment">// first compute overlaps</span>
<a name="l00246"></a>00246   rc = compute_scores(numPrev, prevSegments, numNew, newSegments, &amp;overlaps);
<a name="l00247"></a>00247   free(prevSegments);
<a name="l00248"></a>00248   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) {
<a name="l00249"></a>00249     <a class="code" href="group__FeatureTrackingPrivateHelpers.html#g1fb402455a6b45924d858388dc8b5a1f" title="Free double matrix.">_fc_freeDoubleMatrix</a>(numPrev, numNew, overlaps);
<a name="l00250"></a>00250     <span class="keywordflow">return</span> rc;
<a name="l00251"></a>00251   }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   <span class="comment">// second, compute correspondence matrix</span>
<a name="l00254"></a>00254   rc = compute_correspondence(numPrev, numNew, overlaps, &amp;matrix);
<a name="l00255"></a>00255   <a class="code" href="group__FeatureTrackingPrivateHelpers.html#g1fb402455a6b45924d858388dc8b5a1f" title="Free double matrix.">_fc_freeDoubleMatrix</a>(numPrev, numNew, overlaps);
<a name="l00256"></a>00256   <span class="keywordflow">if</span> (rc != <a class="code" href="group__DataTypes.html#gg2a40aa471d085988d5b582669f766ce46687acb19dbc2e15e6e89cdc39e8e18e">FC_SUCCESS</a>) {
<a name="l00257"></a>00257     <a class="code" href="group__FeatureTrackingPrivateHelpers.html#g1d1b6894396acb28de428d46532a9a79" title="Free int matrix.">_fc_freeIntMatrix</a>(numPrev, numNew, matrix);
<a name="l00258"></a>00258     <span class="keywordflow">return</span> rc;
<a name="l00259"></a>00259   }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   <span class="comment">// third &amp; last, use correspondence matrix to decide on new features</span>
<a name="l00262"></a>00262   rc = add_rois_to_features(stepIndex, numPrev, numNew, newSegments, matrix,
<a name="l00263"></a>00263                    group);
<a name="l00264"></a>00264   <a class="code" href="group__FeatureTrackingPrivateHelpers.html#g1d1b6894396acb28de428d46532a9a79" title="Free int matrix.">_fc_freeIntMatrix</a>(numPrev, numNew, matrix);
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   <span class="keywordflow">return</span> rc;
<a name="l00267"></a>00267 }
</pre></div>
<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Oct 27 13:26:19 2008 for FCLib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
